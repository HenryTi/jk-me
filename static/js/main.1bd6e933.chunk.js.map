{"version":3,"sources":["tonva-core/web/caller.ts","tonva-core/web/httpChannel.ts","tonva-core/web/httpChannelUI.ts","tonva-core/web/apiBase.ts","tonva-core/web/wsChannel.ts","tonva-core/web/uqApi.ts","tonva-core/web/appBridge.ts","tonva-core/web/centerApi.ts","tonva-core/web/guestApi.ts","tonva-core/web/messageHub.ts","tonva-core/web/host.ts","tonva-core/web/Web.ts","tonva-core/uqBuild/TsTemplate.ts","tonva-core/uqCore/uqMan.ts","tonva-core/uqBuild/UqBuildContext.ts","tonva-core/uqCore/entity.ts","tonva-core/uqCore/caller.ts","tonva-core/uqCore/tuid/idCache.ts","tonva-core/uqCore/tuid/tuid.tsx","tonva-core/uqCore/tuid/tuidsCache.ts","tonva-core/uqCore/action.ts","tonva-core/uqCore/sheet.ts","tonva-core/uqCore/query.ts","tonva-core/uqCore/book.ts","tonva-core/uqCore/history.ts","tonva-core/uqCore/map.ts","tonva-core/uqCore/pending.ts","tonva-core/uqCore/enum.ts","tonva-core/uqCore/ID.ts","tonva-core/uqCore/IDCache/IDCache.ts","tonva-core/uqCore/uqsMan.ts","tonva-core/uqCore/uqsLoader.ts","tonva-core/uqCore/uqStringify.ts","tonva-core/res/res.ts","tonva-core/res/inputRes.ts","tonva-core/core/Tonva.ts","tonva-core/res/listRes.ts","tonva-core/core/Navigo.ts","tonva-core/tool/user.ts","tonva-core/tool/uid.ts","tonva-core/tool/local.ts","tonva-core/tool/getObjPropIgnoreCase.ts","tonva-core/tool/date.ts","tonva-core/tool/caseString.ts","tonva-core/tool/rules.ts","tonva-react/components/inputRules.ts","tonva-react/components/form/widgets/widget.tsx","tonva-react/components/form/widgets/textWidget.tsx","tonva-react/components/form/widgets/textareaWidget.tsx","tonva-react/components/form/widgets/passwordWidget.tsx","tonva-react/components/form/widgets/numberWidget.tsx","tonva-react/components/form/widgets/updownWidget.tsx","tonva-react/components/form/widgets/dateWidget.tsx","tonva-react/components/form/widgets/checkBoxWidget.tsx","tonva-react/components/form/widgets/selectWidget.tsx","tonva-react/components/form/widgets/radioWidget.tsx","tonva-react/components/form/widgets/rangeWidget.tsx","tonva-react/components/form/widgets/idWidget.tsx","tonva-react/components/form/widgets/unknown.tsx","tonva-react/components/form/widgets/buttonWidget.tsx","tonva-react/components/form/context.tsx","tonva-react/components/form/widgets/arrComponent.tsx","tonva-react/components/image.tsx","tonva-react/components/loading.tsx","tonva-react/components/simple/Badge.tsx","tonva-react/components/simple/LMR.tsx","tonva-react/components/simple/FA.tsx","tonva-react/components/simple/IconText.tsx","tonva-react/components/resUploader.tsx","tonva-react/components/edit/itemEdit.tsx","tonva-react/components/edit/imageItemEdit.tsx","tonva-react/components/form/widgets/imageWidget.tsx","tonva-react/components/form/widgets/tagWidget.tsx","tonva-react/components/form/widgets/factory.tsx","tonva-react/components/form/form.tsx","tonva-react/components/form/field.tsx","tonva-react/components/edit/stringItemEdit.tsx","tonva-react/components/edit/radioItemEdit.tsx","tonva-react/components/edit/selectItemEdit.tsx","tonva-react/components/edit/idItemEdit.tsx","tonva-react/components/edit/tagItemEdit.tsx","tonva-react/components/edit/textAreaItemEdit.tsx","tonva-react/components/edit/checkBoxItemEdit.tsx","tonva-react/components/edit/rangeItemEdit.tsx","tonva-react/components/edit/numberItemEdit.tsx","tonva-react/components/edit/edit.tsx","tonva-react/components/list/base.tsx","tonva-react/components/list/clickable.tsx","tonva-react/components/list/static.tsx","tonva-react/components/list/selectable.tsx","tonva-react/components/list/index.tsx","tonva-react/components/easyDate/index.tsx","tonva-react/components/dropDownActions/index.tsx","tonva-react/components/propGrid/row.tsx","tonva-react/components/propGrid/propView.tsx","tonva-react/components/propGrid/PropGrid.tsx","tonva-react/components/media.tsx","tonva-react/components/searchBox.tsx","tonva-react/components/ax/index.tsx","tonva-react/components/input/input.tsx","tonva-react/components/input/inputs/inputNumber.tsx","tonva-react/components/input/inputs/checkBox.tsx","tonva-core/uqBuild/tools.ts","tonva-react/vm/ControllerWithWeb.ts","tonva-react/vm/View.tsx","tonva-react/vm/VPage.tsx","tonva-react/vm/components/CStringEdit.tsx","tonva-react/components/page/page.tsx","tonva-core/tool/env.ts","tonva-react/vm/Controller.tsx","tonva-react/components/page/scrollView.tsx","tonva-core/tool/localDb.ts","tonva-react/nav/NavView.tsx","tonva-react/ui/res.ts","tonva-react/components/login.tsx","tonva-core/tool/62.ts","tonva-react/components/page/pageHeader.tsx","tonva-react/components/page/tabs.tsx","tonva-react/nav/FetchErrorView.tsx","tonva-core/uqBuild/buildFieldItem.ts","tonva-react/auth/VLogout.tsx","tonva-react/auth/VLogin.tsx","tonva-react/auth/VChangePassword.tsx","tonva-react/auth/VUserQuit.tsx","tonva-react/auth/CLogin.tsx","tonva-react/img/logo.svg","tonva-react/auth/tools.tsx","tonva-core/uqBuild/TsUqFolder.ts","tonva-core/uqBuild/TsUQ.ts","tonva-react/auth/meInfo.tsx","tonva-react/app/vMain.tsx","tonva-react/uq/Uq.ts","tonva-react/uq/createUQsProxy.tsx","tonva-react/app/CAppBase.ts","tonva-react/app/start.ts","tonva-react/app/CBase.ts","tonva-react/app/WebReact.ts","tonva-react/views/userIcon.tsx","tonva-react/app/UqBuildContext.ts","tonva-react/CStringEdit.tsx","tonva-react/tool/cacheIds.ts","tonva-react/tool/PageItems.ts","tonva-react/components/reloadPage.tsx","tonva-react/TonvaReact.tsx","uq-app/CBase.ts","home/VHome.tsx","account/VAccount.tsx","account/VObjectAccountHistory.tsx","account/CAccount.ts","home/CHome.ts","uq-app/appConfig.ts","me/VAbout.tsx","me/renderUser.tsx","me/VMe.tsx","me/VEditMe.tsx","me/VAdminSetting.tsx","me/CMe.ts","uq-app/bug/tester/test-times-change.ts","uq-app/bug/tester/test1.ts","uq-app/bug/tester/test2.ts","uq-app/bug/tester/test3.ts","uq-app/bug/tester/test4.ts","uq-app/bug/tester/index.ts","uq-app/bug/VBug.tsx","uq-app/bug/VConsole.tsx","uq-app/bug/CBug.ts","uq-app/res/index.ts","uq-app/res/zh.ts","uq-app/res/en.ts","uq-app/VMain.tsx","uq-app/uqs/JkMe/JkMe.ts","uq-app/test-uqui/VTest.tsx","uq-app/test-uqui/CTest.tsx","uq-app/uqs/JkMe/Group.ui.tsx","uq-app/uqs/JkMe/index.ts","uq-app/uqs/JkProduct/JkProduct.ts","uq-app/uqs/JkProduct/Chemical.ui.tsx","uq-app/uqs/JkProduct/SalesRegion.ui.tsx","uq-app/uqs/JkProduct/Currency.ui.tsx","uq-app/uqs/JkProduct/PackType.ui.tsx","uq-app/uqs/JkProduct/Language.ui.tsx","uq-app/uqs/JkProduct/Brand.ui.tsx","uq-app/uqs/JkProduct/Stuff.ui.tsx","uq-app/uqs/JkProduct/ProductX.ui.tsx","uq-app/uqs/JkProduct/ProductCategory.ui.tsx","uq-app/uqs/JkProduct/Lot.ui.tsx","uq-app/uqs/JkProduct/PackSalesLevel.ui.tsx","uq-app/uqs/JkProduct/ProductCategoryResearchDomain.ui.tsx","uq-app/uqs/JkPointShop/JkPointShop.ts","uq-app/uqs/JkPointShop/ProductX.ui.tsx","uq-app/uqs/JkPointShop/Customer.ui.tsx","uq-app/uqs/JkPointShop/WebUser.ui.tsx","uq-app/uqs/JkPointShop/Contact.ui.tsx","uq-app/uqs/JkPointShop/Currency.ui.tsx","uq-app/uqs/JkPointShop/BuyerAccount.ui.tsx","uq-app/uqs/JkPointShop/Genre.ui.tsx","uq-app/uqs/JkPointShop/PointProductLib.ui.tsx","uq-app/uqs/JkPointShop/Brand.ui.tsx","uq-app/uqs/JkPointShop/OrderMain.ui.tsx","uq-app/uqs/JkPointShop/OrderDetail.ui.tsx","uq-app/uqs/JkPointShop/ExchangeDetail.ui.tsx","uq-app/uqs/JkPointShop/ExchangeMain.ui.tsx","uq-app/uqs/JkPointShop/ReceiveMain.ui.tsx","uq-app/uqs/JkPointShop/ReceiveDetail.ui.tsx","uq-app/uqs/JkPointShop/DxOrderDetail.ui.tsx","uq-app/uqs/JkPointShop/DxReOrderDetail.ui.tsx","uq-app/uqs/JkPointShop/DxExchangeDetail.ui.tsx","uq-app/uqs/JkPointShop/DxExchangeMainState.ui.tsx","uq-app/uqs/JkPointShop/IxExchangeMainUsedPoint.ui.tsx","uq-app/uqs/JkPointShop/ExchangeDetailDeliver.ui.tsx","uq-app/uqs/JkPointShop/IxOrderDetailReceive.ui.tsx","uq-app/uqs/JkHr/JkHr.ts","uq-app/uqs/JkHr/Employee.ui.tsx","uq-app/uqs/JkHr/Role.ui.tsx","uq-app/uqs/JkHr/Company.ui.tsx","uq-app/uqs/index.ts","uq-app/uqs/JkProduct/index.ts","uq-app/uqs/JkPointShop/index.ts","uq-app/uqs/JkHr/index.ts","supervise/VSupervise.tsx","supervise/VItemDayHistory.tsx","supervise/VItemSumHistory.tsx","supervise/VItemHistory.tsx","supervise/VSumByMonth.tsx","supervise/objects/CObjects.ts","supervise/objects/VObjects.tsx","supervise/objects/VAgents.tsx","supervise/objects/CAgents.ts","supervise/objects/VDistributors.tsx","supervise/objects/CDistributors.ts","supervise/objects/VGroups.tsx","supervise/objects/CGroups.ts","tools/parts.tsx","supervise/objects/VPosts.tsx","supervise/objects/CPosts.ts","supervise/objects/VStaffs.tsx","supervise/objects/CStaffs.ts","supervise/objects/initCObjects.ts","supervise/VAccounts.tsx","supervise/CSupervise.ts","portal/period.ts","portal/bizOpDetail.tsx","portal/VBizOpDetail.tsx","portal/VPostItemHistory.tsx","portal/VPeriodPostItemHistory.tsx","portal/VPortal.tsx","portal/CPortal.ts","portal/object/VObjectPortal.tsx","portal/object/CObjectPortal.ts","portal/unit/VUnitPortal.tsx","portal/unit/CUnitPortal.ts","uq-app/CApp.ts","uq-app/startApp.tsx","reportWebVitals.ts","index.tsx"],"names":["Caller","params","$$user","undefined","waiting","_params","method","this","methodsWithBody","HttpChannel","web","hostUrl","apiToken","ui","timeout","startWait","endWait","url","reject","showError","error","a","env","isDevelopment","post","urlPrefix","caller","options","buildOptions","headers","path","i","h","encodeURI","p","buildParams","indexOf","body","JSON","stringify","innerFetch","ret","res","keys","Object","length","c","k","innerFetchResult","resolve","buildError","err","ex","retErr","key","channel","that","console","log","now","Date","timeOutHandler","setTimeout","fetch","ok","clearTimeout","statusText","ct","get","json","then","retJson","Array","isArray","retError","catch","text","toLowerCase","startsWith","logout","Promise","buildHeaders","language","culture","lang","CenterHttpChannel","u","appBridge","isBridged","bridgeCenterApi","UqHttpChannel","HttpChannelNavUI","onError","refetchApi","subAppWindow","ApiBase","showWaiting","token","getHttpChannel","xcall","callFetch","put","delete","UqApi","basePath","uqOwner","uqName","uq","buildAppUq","channels","channelUIs","channelUI","channelNoUIs","arr","push","uqToken","getUqToken","init","parts","split","s","trim","theUser","roles","name","start","page","entities","UnitxApi","unitId","buildChannel","centerAppApi","CenterAppApi","unitxUq","db","urlTest","realUrl","host","getUrlOrTest","CenterApiBase","getCenterChannelUI","getCenterChannel","uqTokensName","UqTokenApi","localMap","localDb","map","un","localCache","child","unit","user","loginedUserId","remove","nowTick","Math","floor","tick","value","assign","uqParams","testing","set","removeItem","CallCenterApi","call","appOwner","appName","uqs","param","UserApi","decodeUserToken","nick","icon","account","type","oem","verify","password","prop","id","postWsToSubApp","msg","postMessage","WsBase","messageHub","dispatch","wsBaseSeed","WsBridge","wsBaseId","WSChannel","wsHost","ws","WebSocket","centerToken","onopen","ev","onerror","onmessage","wsMessage","onclose","close","event","data","parse","receive","netThis","connect","send","AppBridge","uqTokens","uqTokenActions","brideCenterApis","window","addEventListener","evt","message","subFrameStarted","onWsReceive","initSubWin","navBack","callCenterApiFromMessage","source","bridgeCenterApiReturn","onReceiveAppApiMessage","hash","apiName","onAppApiReturn","clearLocal","self","parent","subWin","hideFrameBack","el","document","getElementById","hidden","setCenterToken","showAppView","uqTokenApi","action","Error","at","opener","callId","uid","from","callCenterapi","directCall","result","bca","CenterApi","app","userId","userName","GuestApi","decodeGuestToken","guest","unitName","MessageHub","handlerSeed","anyHandlers","msgHandlers","handler","seed","args0","handlerId","$type","centerHost","uqDebugHost","hosts","centerhost","local","reshost","uqhost","unitxhost","httpArr","urlFromHost","str","isAbsoluteUrl","endsWith","centerUrlFromHost","centerWsFromHost","https","substr","fetchOptions","mode","Host","resHost","tryLocal","getCenterHost","getResHost","promises","hostArr","findIndex","v","fetchUrl","debugHostUrl","localCheck","all","results","len","j","hostValue","location","includes","debugHost","testProd","getUrlOrDebug","urlDebug","fetchLocalCheck","e","Web","centerChannelUI","centerChannel","centerApi","userApi","unitxApi","guestApi","wsBridge","isBuildingUQ","_uqs","logoutUqTokens","t","resUrlFromHost","EnumResultType","TsTemplate","buildContext","tsHeader","uiPlatform","UqBuildContext","uqsLoader","uqTsSrcPath","tsTemplate","ln","chars","codeBackSlash","charCodeAt","codeN","codeT","codeB","codeF","codeV","codeR","codes","codeBN","codeBT","codeBB","codeBF","codeBV","codeBR","Entity","typeId","jName","schema","ver","sys","schemaLocal","uqApi","fields","arrFields","returns","face","fieldMaps","item","find","f","loadEntitySchema","buildSchema","loadValues","setSchema","buildFieldsTuid","version","setJName","arrs","buildFieldTuid","buildArrFieldsTuid","fieldName","arrName","fn","getTuid","an","fieldArr","tuid","buildFieldsParams","arrResult","pa","rowResult","field","d","val","buildDateTimeParam","getFullYear","getMonth","getDate","_tuid","getIdFromObj","dt","getTime","toISOString","packRow","arrData","getObjPropIgnoreCase","packArr","join","row","r","ch","substring","escape","values","boxId","unpackRow","unpackArr","ch0","fLen","to","reverseNT","n","Number","isNaN","p0","vals","EntityCaller","entity","tries","_entity","loadSchema","innerRequest","innerCall","jsonResult","$uq","$modify","pullModify","xresult","retry","uqVersion","en","rebuildSchema","buildEntities","ActionCaller","QueryQueryCaller","unpackReturns","QueryPageCaller","pageStart","pageSize","IdCache","tuidLocal","queue","cache","localArr","waitingIds","tuidInner","tonva","createObservableMap","initLocalArr","defer","has","cacheTuids","moveToHead","shift","index","splice","_id","getValue","useId","cacheSet","loadIds","tuidValues","cacheIdValues","tuids","unpackTuidIds","tuidValue","cacheValue","cacheTuidFieldValues","ids","loadTuidIdsOrLocal","localedValues","filter","getItem","loadingIds","netIds","loadValuesFromIds","netRet","pos","setItem","IdDivCache","div","divName","UqTuid","noCache","typeName","idName","unique","isImport","TuidBox","obj","id1","ix","Tuid","idValue","TuidInner","divs","cacheFields","idCache","newVersion","removeAll","tuidDiv","TuidDiv","valueFromId","resetCache","assureObj","cacheIds","modifyIds","IdsCaller","request","GetCaller","cacheFieldsInValue","arrValues","mainFields","$create","$update","stampOnMain","unpackTuidIdsOfFields","props","SaveCaller","SavePropCaller","AllCaller","searchArr","owner","SearchCaller","LoadArrCaller","SaveArrCaller","order","ArrPosCaller","TuidNoCaller","TuidCaller","$id","transParams","arrParams","arrValue","buildDateParam","bid","$order","year","month","date","TuidImport","getObj","assureBox","hasDiv","loadMain","load","save","saveProp","search","loadArr","saveArr","posArr","no","ownerField","alert","TuidBoxDiv","TuidsCache","modifyMax","cacheTimer","clearCacheTimer","localModifyMax","max","seconds","tuidCached","innerPullModify","tuidLists","queueModify","group","modify","UqAction","ActionSubmitCaller","SubmitReturnsCaller","SubmitConvertCaller","Action","pack","UqSheet","states","ops","op","actions","discription","SaveDirectCaller","flow","state","ActionDirectCaller","brief","unpackSheet","flows","GetSheetCaller","getArchive","unpack","SheetArchiveCaller","SheetArchivesCaller","StateSheetsCaller","StateSheetCountCaller","UserSheetsCaller","MySheetsCaller","Sheet","SheetCaller","suffix","resVerify","count","UqQuery","isPaged","pageCaller","queryCaller","query","table","Query","UqBook","queryApiName","BookQueryCaller","Book","UqHistory","History","UqMap","queries","schemaFrom","actionSchema","newAction","querySchema","newQuery","AddCaller","DelCaller","PageCaller","qc","QueryCaller","Map","MapCaller","getCaller","MapAddCaller","add","MapDelCaller","MapAllCaller","MapPageCaller","MapQueryCaller","UqPending","Pending","UqEnum","UqID","create","update","ID","QueryID","IDX","UqIDX","UqIX","IX","IDCache","uqMan","timeoutHandler","timeOut","TvIdValues","IDTv","UqMan","uqData","enums","idxs","ixs","sheets","books","maps","histories","pendings","tuidsCache","localEntities","proxy","config","allRoles","tuidArr","actionArr","queryArr","idArr","idxArr","ixArr","enumArr","sheetArr","bookArr","mapArr","historyArr","pendingArr","Acts","apiActs","retArr","retActs","getAdmins","$Acts","sql","ActIX","apiActIX","$ActIX","ActIXSort","apiActIxSort","$ActIXSort","ActDetail","apiActDetail","items","main","detail","detail2","detail3","$ActDetail","apiQueryID","$QueryID","apiIDTv","retValues","$tv","nameNoVice","$IDTv","IDNO","apiIDNO","$IDNO","IDDetailGet","apiIDDetailGet","$IDDetailGet","apiID","$ID","KeyID","apiKeyID","$KeyID","apiIX","$IX","IXr","apiIXr","$IXr","KeyIX","apiKeyIX","$KeyIX","IDLog","apiIDLog","$IDLog","IDSum","apiIDSum","$IDSum","IDinIX","apiIDinIX","$IDinIX","IDxID","apiIDxID","$IDxID","IDTree","apiIDTree","$IDTree","getRoles","sheet","loadEntities","access","role","names","buildTuids","buildAccess","newTuid","entityName","allSchemas","forEach","fromType","fromObj","enm","setEntity","book","history","pending","lName","idEntity","idx","newID","newIDX","newIX","newBook","newMap","newHistory","newSheet","newPending","newEnum","buildSheet","build","buildTuidBox","buildTuidDivBox","uqKey","dev","alias","capitalCase","Proxy","target","receiver","lk","func","String","showReload","reloadTick","showReloadPage","reload","api","resultType","apiParam","nv","tv","prototype","toString","apiPost","IXs","after","postParam","toScalars","IDXToString","IX1","ID2","UQsMan","collection","uqMans","uqDataArr","uqConfigs","localCacheVersion","cacheVersion","retErrors","setTuidImportsLocal","uqConfig","ownerAlias","uqLower","buildUQs","uqsData","promiseInits","uqAlias","uqFullName","uqFull","lower","setUq","createProxy","getUqKey","getUqKeyWithConfig","setInner","tuidImport","fromName","iName","setFrom","buildingUq","UQsLoader","appConfig","uqsMan","loadApp","loadUqs","uqsManApp","UQsManApp","localData","uqAppData","loadUqAppData","loadUqData","buildUqs","appUqs","tonvaAppName","uqStringify","resOptions","$lang","district","$district","resLang","_","l","navigator","languages","toUpperCase","setResOptions","resGlobal","setRes","setGlobalRes","logMark","inputRes","required","number","integer","min","zh","listRes","none","Navigo","useHash","root","_routes","_useHash","_hash","_paused","_destroyed","_lastRouteResolved","_notFoundHandler","_defaultHandler","_usePushState","_genericHooks","_historyUpdateMethod","timout","_onLocationChange","isPushStateAvailable","replace","_cLoc","_listen","updatePageLinks","absolute","_getRoot","_historyUpdate","RegExp","href","arg0","arg1","hooks","orderedRoutes","sort","compareUrlDepth","route","on","uses","_add","reduce","current","GETParameters","extractGETParameters","onlyURL","getOnlyURL","already","matched","match","manageHooks","_callLeave","isHashedRoot","m","slice","removeEventListener","_findLinks","link","hasListenerAttached","ctrlKey","metaKey","currentTarget","tagName","getLinkPath","preventDefault","navigate","status","pause","destroy","getAttribute","as","title","pushState","replaceState","cLocRoot","isHashChangeAPIAvailable","cached","check","cleanUrl","querySelectorAll","lastRouteResolved","leave","decodeURIComponent","paramNames","regexp","PARAMETER_REGEXP","full","dots","REPLACE_VARIABLE_REGEXP","WILDCARD_REGEXP","REPLACE_WILDCARD","FOLLOWED_BY_SLASH_REGEXP","MATCH_REGEXP_FLAGS","urlA","urlB","getUrlDepth","routes","replaceDynamicURLParts","clean","regExpResultToParams","findMatchedRoutes","colonExp","routeExp","fallbackURL","matched0","cleanGETParam","exHooks","before","shouldRoute","logs","Tonva","LocalData","navigo","navSettings","resUrl","resetAll","hashParam","windowOnError","lineno","colno","windowOnUnhandledRejection","reason","windowOnClick","windowOnMouseMove","userAgent","x","y","windowOnScroll","forceDevelopment","reloadUser","curUser","logined","onChangeLogin","race","serviceWorker","ready","registration","unregister","plus","webview","webView","createWeb","g","unitJsonPath","unitRes","innerText","loadUnitJson","innerHTML","process","getPredefinedUnitName","unitFromName","settings","htmlTitle","html0","getElementsByTagName","origin","pathname","setCenterUrl","setGuest","onunhandledrejection","onfocus","isMobile","onselectstart","oncontextmenu","clear","nav","isWebNav","historyAPIUpdateMethod","showPage","setNetToken","me","callback","isUserLogin","logoutApis","saveLocalUser","internalLogined","defaultTop","loginTop","logoutClear","toTimeString","step","jwtDecode","ALPHABET","rtn","charAt","random","_user","_guest","_unit","minute2020_01_01","dateFromMinuteId","timeZone","envTimezone","pow","dateFromHourId","firstCharUppercase","camelCase","ACode","ZCode","fromCharCode","firstCharLowercase","aCode","zCode","mobileRegex","emailRegex","Rule","defaultInputRes","RuleCustom","defy","RulePredefined","RuleRequired","RuleNum","minMsg","maxMsg","template","checkMore","RuleInt","isInteger","Widget","context","itemSchema","fieldProps","children","_itemSchema","_ui","defaultValue","rules","readOnly","disabled","errors","contextErrors","visible","isChanging","onInputChange","changeValue","container","observer","form","inNode","render","label","requiredFlag","className","FieldContainer","renderBody","makeObservable","observable","hasError","computed","isOk","getUiItem","buildRules","rule","removeErrorWidget","addErrorWidget","initData","newValue","fromElement","onChanging","onChanged","prev","allowChange","setDataValue","setElementValue","fieldClass","classNames","FieldClass","elDiscription","discriptionClassName","uiLabel","Templet","errorList","tag","React","TextWidget","inputType","input","hasFocus","onKeyDown","internalOnKeyDown","keyCode","onEnter","blur","setError","onBlur","runInAction","checkRules","checkContextRules","onFocus","clearError","clearErrors","focus","select","placeholder","renderTemplet","cn","ref","onChange","maxLength","renderErrors","TextAreaWidget","setValue","rows","PasswordWidget","UrlWidget","EmailWidget","NumberWidget","UpdownWidget","returnValue","isValidKey","DateWidget","DateTimeWidget","TimeWidget","MonthWidget","CheckBoxWidget","trueValue","falseValue","checked","onClick","defaultChecked","SelectWidget","option","list","radioStyle","height","RadioWidget","inputs","rowKey","isRow","style","RangeWidget","IdWidget","pickId","clearContextError","content","Unknown","dataType","uiType","dataTypes","ButtonWidget","submit","onButtonClick","observerRender","caption","widgetType","widget","button","ButtonClass","Context","uiSchema","subContexts","widgets","errorWidgets","arrRowContexts","itemName","getDisabled","setDisabled","getReadOnly","setReadOnly","getVisible","setVisible","buttonName","ew","checkFieldRules","rowContext","setContextError","clearWidgetsErrors","checkHasError","clearContextErrors","rowKeySeed","RowContext","parentContext","arrSchema","uiArr","itemSchemas","FormContext","ContextContainer","ArrComponent","selectable","deletable","restorable","getArrRowContexts","onDeleted","onRestored","arrLabel","ArrContainer","RowContainer","RowSeperator","formSelectable","formDeletable","formRestorable","arrSelectable","arrDeletable","arrRestorable","ac","rc","rs","first","rowContent","sep","typeofTemplet","factory","selectCheck","deleteIcon","$isSelected","$source","isDeleted","$isDeleted","editContainer","Provider","Image","src","altImage","alt","Loading","b","badge","size","color","badgeAlign","badgeVertical","LMR","cursor","left","right","FA","spin","fixWidth","border","pull","pulse","rotate","flip","inverse","IconText","iconClass","textClass","ResUploader","fileInput","fileName","upload","formData","buildFormData","Headers","append","onFilesChange","files","maxSize","FormData","file","multiple","display","formatSize","pointLength","units","toFixed","xlargeSize","mediumSize","ImageUploader","imgBaseSize","imageTypes","resUploader","desImgWidth","desImgHeight","desImgSize","srcImgWidth","srcImgHeight","isChanged","resId","enableUploadButton","srcImage","desImage","fileError","uploaded","onFileChange","lastIndexOf","reader","FileReader","readAsDataURL","onload","setSize","compress","img","width","w","scale","round","canvas","createElement","ctx","getContext","anw","createAttribute","nodeValue","anh","setAttributeNode","drawImage","base64","toDataURL","blob","convertBase64UrlToBlob","onSaved","showOrgImage","header","maxWidth","urlData","mime","bstr","atob","u8arr","Uint8Array","Blob","levelDiv","padding","ItemEdit","fileSize","uploading","AudioUploader","audioTypes","edit","uiItem","_uiItem","internalStart","internalEnd","divValue","labelHide","templet","pop","verifyRule","ImageItemEdit","ImageWidget","imageSrc","end","TagWidget","TagSingleWidget","valuesView","wrapClassName","inputName","renderRadios","TagMultiWidget","defaultArr","def","renderChecks","stringWidget","widgetFactories","string","textarea","datetime","time","email","updown","checkbox","image","checkboxes","radio","tagSingle","tagMulti","range","typeWidget","getItemSchema","getTypeWidget","hiden","widgetFactory","WidgetClass","Form","formContext","disposer","Container","watch","calcSelectOrDelete","DefaultContainer","onSubmit","DefaultFieldContainer","fieldLabelSize","fieldLabelAlign","labelView","cnAlign","fieldCol","DefaultFieldClass","DefaultButtonClass","DefaultRes","autorun","dv","initDataItem","arrItem","arrItems","arrDict","arrItemOperated","formArrVal","beforeShow","renderContent","FormField","contextType","StringItemEdit","preValue","verifyValue","onSave","inputOptions","element","RadioItemEdit","SelectItemEdit","IdItemEdit","TagItemEdit","renderInputs","TagSingleItemEdit","TagMultiItemEdit","TextAreaItemEdit","CheckBoxItemEdit","onItemChanged","RangeItemEdit","NumberItemEdit","Edit","defaultSepClassName","defaultRowContainerClassName","topBorder","bottomBorder","rowContainerClassName","rowClick","itemEdit","editInRow","onItemClick","stopEdit","topBorderClassName","bottomBorderClassName","sepClassName","ie","createItemEdit","divLabel","requireFlag","ListBase","loading","pageItems","Clickable","Static","Selectable","_items","inputItems","buildItems","itemsArray","isItemSelected","selectedItems","compare","retItems","selected","labelId","comp","selectItem","si","obItem","onSelect","flex","marginBottom","htmlFor","listenArraySplice","isObservableArray","observe","change","removedCount","added","_added","checkAll","anySelected","some","List","listBase","_$scroll","direct","buildBase","prevProps","prevState","isEqual","forceUpdate","dispose","selectAll","unselectAll","footer","waitingMore","tabIndex","isLoading","staticRow","timeRes","md","ymd","yesterday","today","tomorrow","$zh","$en","tt","renderDate","vDate","withTime","always","nDate","_date","nowYear","hour","getHours","minute","getMinutes","appendTime","dPart","hm","EasyTime","VDate","vTime","hideTime","hideSameYear","PropRow","PropBorder","borderTop","PropGap","valueAlignStart","valueAlignCenter","valueAlignEnd","LabeledPropRow","gridProps","_prop","col","labelFixLeft","bk","renderLabel","renderProp","align","vAlign","alignValue","renderPropBody","renderPropContent","StringPropRow","NumberPropRow","ListPropRow","borderBottom","ComponentPropRow","component","PropView","buildRows","isGap","setValues","PropGrid","propView","Ax","axProps","aClassName","naClassName","openSysPage","Input","requiredFlagElement","ruleMessage","defaultRequiredFlagElement","onValueChange","inp","containerClassName","ruleClassName","defaultRuleClassName","valueFromInput","Component","InputNumber","defaultClassName","parseFloat","parseValue","InputCheckBox","red","lastBuildTime","saveSrcTsFileIfNotExists","saveTsFileIfNotExists","saveTsFile","srcFile","tsFile","fs","existsSync","renameSync","writeFileSync","overrideTsFile","tsFilePath","getNameFromUq","devPart","uqPart","devName","ControllerWithWeb","receiveHandlerId","unregisterReceiveHandler","onDispose","onMessageReceive","onMessage","_resolve_$","webNav","registerReceiveHandler","beforeStart","afterStart","vp","open","Controller","View","controller","getTonva","V","bind","vm","afterBack","go","view","onClosePage","openPage","replacePage","backPage","level","closePage","ceasePage","removeCeased","confirmClose","regConfirmClose","popToTopPage","VPage","retOnClosePage","_onClosePage","openPageElement","renderPage","replacePageElement","onScroll","onPageScroll","onScrollTop","scroller","onPageScrollTop","onScrollBottom","onPageScrollBottom","back","headerClassName","tabsProps","pageWebNav","Page","tabsView","TabsView","inWebNav","pageHeaderProps","center","rph","renderPageHeader","elFooter","errorInfo","renderHeader","renderFooter","pl","decode","exec","sUnit","tc","from62","test","parseInt","getTimezoneOffset","initEnv","browser","detectBrowser","LocalMap","ms","args","global","handle","setInterval","clearInterval","documentMode","internalT","isDev","topPageKey","buildReactiveProps","shallow","ob","beforeInit","getPageWebNav","afterInit","replaceOpen","onEvent","ceaseTop","topKey","popTo","yes","buttons","Scroller","scrollTo","scrollTop","offsetHeight","scrollTimeGap","ScrollViewBase","bottomTime","topTime","refDiv","onResize","sh","scrollHeight","top","Children","eachChild","ScrollView","WebNavScrollView","vHeader","vFooter","navHeader","navRawHeader","navFooter","navRawFooter","__ls","localStorage","LocalCache","removeLocal","Local","caches","locals","keyForGet","keyForSet","sk","LocalArr","keyForRemove","ks","unshift","saveIndex","ls","stackKey","notSupportedBrowsers","NavView","stack","waitCount","waitTimeHandler","isHistoryBack","confirm","setState","fetchError","backIcon","closeIcon","notSupportedBrowser","wait","ceased","refresh","backLevel","popAndDispose","elWait","elError","FetchErrorView","zIndex","visibility","position","onLogined","onNotLogined","createLogin","importCLogin","CLogin","showRegister","importCRegister","CRegister","showForget","CForget","digits","c0","c9","A","Z","z","NaN","onBack","vBack","debugLogout","showLogout","rightView","Tab","loaded","contentBuilder","notify","onShown","_content","TabCaptionComponent","tabBg","selectedTab","tabArr","tabClick","tab","shown","tabs","bsCur","bsTab","tabPosition","borderColor","borderStyle","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","notifyCircle","num","displayNone","pageHeader","pageFooter","tabBack","isSelected","reApi","errContent","wordWrap","SystemNotifyPage","buildFieldItem","isKey","$FieldItemType","fieldItemType","VLogout","onLogout","VLogin","onLogin","withBack","username","login","pwd","sender","getSender","defaultLoginTop","privacyEntry","VChangePassword","orgPassword","newPassword","newPassword1","waitingTime","VUserQuitBase","button1Caption","onClickButton1","button2Caption","onClickButton2","note","renderButton1","renderButton2","VUserQuit","openVPage","VQuitConfirm","userQuit","VQuitDone","userLogined","vPage","getVChangePassword","changePassword","logo","senders","regex","fieldItemReplaceProps","TsUqFolder","uqsFolder","uqFolder","mkdirSync","tsUq","TsUQ","saveTuidAndIDTsIndexAndRender","imports","sets","coll","sName","cName","tsUI","toLocaleLowerCase","buildFields","tsFieldArr","buildFieldArr","replaceTsFileFields","tsImportFieldItemsBegin","tsImportFieldItemsEnd","replaceTsFileString","begin","tsIndex","readdirSync","fileEntityName","unFile","unlinkSync","buildIDFields","buildIDXFields","buildIXFields","ts","buildIDFieldArr","buildIDXFieldArr","buildIXFieldArr","readFileSync","startStr","lBrace","rBrace","oldText","fieldsText","buildFieldsFromOldText","setFieldOldProp","buildFieldText","fieldStart","fieldText","eval","sec","fieldTypeMap","sysFields","buildTuid","buildTuidInterface","buildAction","buildActionInterface","buildArrs","buildReturns","buildEnumInterface","buildQuery","buildQueryInterface","buildSheetInterface","buildBook","buildBookInterface","buildMap","buildMapInterface","buildHistory","buildHistoryInterface","buildPending","buildPendingInterface","buildID","buildIDX","buildIX","buildIDInterface","schemaKeys","others","buildIDXInterface","exFields","repeat","hasTrack","hasMemo","exField","track","memo","buildIDXActParamInterface","buildIXInterface","tsImport","appendArr","tsBuild","tsLen","uqEntityInterface","buildActsInterface","uqBlock","buildInterface","entityCode","isInID","indent","buildField","q","af","retName","VErrorsPage","VStartError","Uq","$_uqMan","IDRender","renderIDUnknownType","IDType","IDV","IDLocalV","IDLocalRender","createUQsProxy","TuidView","uqReacts","$_createProxy","onUqProxyError","CAppBase","timezone","unitTimezone","uqsUser","afterBuiltUQs","onNavRoutes","initUQs","resolveRoute","userFromId","userRoles","getUqUserRoles","setUqRoles","isRole","CApp","html","cApp","CBase","getUqRoles","internalInit","wn","getWebNav","CSub","_owner","ownerWNs","own","staticUserCache","WebReact","UserCache","loader","onLoaded","getUserCache","noneImage","UserView","idProp","userCache","useUser","use","PageItems","itemObservable","beforeLoad","allLoaded","topDiv","bottomDiv","isFirst","pageItemAction","itemConverter","scrollToTop","scrollIntoView","scrollToBottom","firstSize","appendPosition","sortOrder","changing","array","deep","divId","getPageId","loadResults","pageList","$page","reset","more","isAsc","endItem","scrollToEnd","pushItem","endIndex","startId","pid","sum","setLoaded","onLoad","setPageStart","reverse","ReloadPage","timerHandler","ConfirmReloadPage","TonvaReact","navView","showPrivacyPage","privacy","getPrivacyContent","privacyPage","htmlString","__html","dangerouslySetInnerHTML","navLogin","showLogin","navLogout","navRegister","navForget","upgradeUq","navPageRoutes","doneSysRoutes","sysRoutes","notLogined","userPassword","getLogin","showChangePassword","showUserQuit","parser","DOMParser","htmlDoc","parseFromString","elHtml","unauthorized","show","confirmBox","navPage","queryStr","routeFromNavPage","internalOnNavRoutes","navOns","CUqBase","CUqSub","CUqApp","VHome","cAccount","renderAccounts","renderVPortal","VAccount","react","onAccountClick","accounts","accountTitles","postTitles","balance","fixed","postTitle","VObjectAccountHistory","renderHistory","accountTitle","itemTitles","dateString","accountHistory","CAccount","objectAccount","enumAccount","JkMe","GetObjectAccountHistory","renderView","object","GetUserObjectAccount","isObservable","CHome","newC","cPortal","jk","noUnit","VAbout","renderUserText","VMe","meInfo","showEditMe","userSpan","about","aboutRows","renderAdmin","isAdmin","admins","adminSetting","VEditMe","userSetProp","onExit","gridRows","VAdminSetting","CMe","unitOwner","rootUnits","mapAdd","backend","testPointShop","testTimesChange","testItem1","testItem2","testItem3","testItem4","debugItems","VBug","renderItem","openDebugPage","VConsole","divBottom","autoScrollEnd","autoScroll","lastScrollTop","timeHandler","createRange","selectNode","objToHtml","createContextualFragment","appendChild","startAutoScrollToBottom","currentItem","pauseAutoScrollToBottom","arrToHtml","objToString","indentVal","objToLine","CBug","span","home","relation","discover","supervise","debug","aboutTheApp","pleaseLogin","Item","Post","OrderReady","EnumRole","EnumRoleOp","EnumObjectType","EnumAccount","EnumBizOpType","VMain","cHome","cMe","cSupervise","VTester","click","uiItems","CTester","setUI","hasEntity","Group","description","descriptionC","imageUrl","EnumPointType","EnumPointChangingSource","EnumExchangeState","orderMainNo","orderDetailNo","endUser","createDate","quantity","point","subAmount","customer","shippingContact","amount","sheetId","orderDetail","totalPoint","deliver","deliverDone","deliverTime","xi","receiveAmount","JkProduct","Chemical","SalesRegion","Currency","PackType","Language","Brand","Stuff","ProductX","ProductCategory","Lot","PackSalesLevel","ProductCategoryResearchDomain","Customer","WebUser","Contact","BuyerAccount","Genre","PointProductLib","OrderMain","OrderDetail","ExchangeDetail","ExchangeMain","ReceiveMain","ReceiveDetail","DxOrderDetail","DxReOrderDetail","DxExchangeDetail","DxExchangeMainState","IxExchangeMainUsedPoint","ExchangeDetailDeliver","IxOrderDetailReceive","JkPointShop","Employee","Role","Company","JkHr","VIndex","iconColor","fa","VSupervise","renderOpTest","queryList","orderAmount","showProductSumByMonth","orderProfit","showCustomerSumByMonth","superviseItems","renderVUnitSum","cObjectsArr","loadAndShowList","showAccounts","renderSuperviseItem","onClickSuperviseItem","opRenders","vice","showItemSumHistory","ViewItemDayHistory","renderDayItem","toLocaleDateString","onClickDayItem","setDate","showItemHistory","itemSumDays","VItemDayHistory","VItemSumHistory","renderMonthItem","onClickMonthItem","setMonth","showItemDayHistory","itemSumMonths","VItemHistory","bizOp","onClickItem","pageItemHistory","VSumByMonth","$serial","renderId","monthSum","vCaption","hasNext","next","VProductSumByMonth","VCustomerSumByMonth","CObjects","baseList","internalLoadList","loadList","showList","VObjects","renderRow","onClickRow","renderListHeader","renderListFooter","VAgents","CAgents","GetAgents","VDistributors","CDistributors","GetDistributors","VGroups","CGroups","GetGroups","cnAmount","VPosts","amountThisMonth","amountLastMonth","itemTitle","vAmount","CPosts","GetPosts","VStaffs","staff","monthValuesArr","dThis","mThis","mLast","vValue","renderEmployee","pageTop","showObjectPortal","employee","CStaffs","GetStaffs","opi","valueToday","valueThisMonth","valueLastMonth","staffRow","sumItem","newCObjectPortal","initCObjects","VAccounts","renderAccount","objectType","objectTo","renderObject","showAccountHistory","EnumPeriod","CSupervise","objects","groups","distributors","agents","staffs","posts","GetUserSuperviseItem","MonthSumProduct","MonthSumCustomer","GetAccounts","GetItemSumDays","days","GetItemSumMonths","months","PageItemHistory","GetItemHistory","MonthSum","setHours","GetProductSumByMonth","GetCustomerSumByMonth","BizOpDetail","Period","newDate","initObservable","DayPeriod","day","dw","getDay","WeekPeriod","week","diff","yf","mf","df","mt","MonthPeriod","YearPeriod","setFullYear","VBizOpDetail","bizOpDetail","minuteId","itemPeriodSum","VPostItemHistory","showBizOpDetail","VPeriodPostItemHistory","clickItem","periodHistory","VDayPostItemHistory","showPostItemHistory","VMonthPostItemHistory","showDayPostItemHistory","VPeriodSum","postPeriodSum","itemList","renderItemPeriodSum","onClickItemPeriodSum","ips","period","showMonthPostItemHistory","periodList","ep","setPeriod","refreshTime","CPortal","internalSetPeriod","periodType","createPeriod","GetUserObjectItemPeriodSum","GetPeriodSum","postPeriodSumColl","postPeriodSumList","itemColl","fromDate","toDate","objectPostItem","GetObjectItemHistory","sumPeriod","GetObjectItemPeriodHistory","loadPostItemHistory","loadPeriodPostItemHistory","VObjectPortal","CObjectPortal","GetObjectItemPeriodSum","nf","Intl","NumberFormat","minimumFractionDigits","maximumFractionDigits","VUnitPortal","format","CUnitPortal","GetItemPeriodSum","abs","gaps","cBug","cUI","cUnitPortal","timer","gapIndex","callTick","$poked","poke","loadBaseData","appStart","loginedOnly","renderNavView","GetItemTitles","GetPostTitles","GetAccountTitles","GetRoleOps","$getMyTimezone","retItemTitles","retPostTitles","retAccountTitles","roleOps","myTimezone","it","pt","tz","unitTimeZone","setSettings","ReactDOM","StrictMode","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","startApp"],"mappings":"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","file":"static/js/main.1bd6e933.chunk.js","sourcesContent":["export abstract class Caller<T> {\r\n    protected readonly _params: T;\r\n    constructor(params: T, $$user:number = undefined, waiting: boolean) {\r\n        this._params = params;\r\n        this.$$user = $$user;\r\n        this.waiting = waiting;\r\n    }\r\n    readonly $$user: number;\r\n    protected get params():any {return this._params;}\r\n    buildParams():any {return this.params;}\r\n    method: string  = 'POST';\r\n    abstract get path(): string;\r\n    get headers(): {[header:string]: string} {return undefined}\r\n    waiting: boolean;\r\n}\r\n","//import {bridgeCenterApi, isBridged} from './appBridge';\r\nimport {FetchError} from './fetchError';\r\nimport {HttpChannelUI} from './httpChannelUI';\r\nimport { Caller } from './caller';\r\nimport { env } from '../tool';\r\nimport { Web } from './Web';\r\n\r\n/*\r\nexport async function httpGet(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.get('', params);\r\n    return ret;\r\n}\r\n\r\nexport async function httpPost(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.post('', params);\r\n    return ret;\r\n}\r\n*/\r\n\r\nconst methodsWithBody = ['POST', 'PUT'];\r\n\r\nexport abstract class HttpChannel {\r\n    private timeout: number;\r\n    protected web: Web;\r\n    protected ui?: HttpChannelUI;\r\n    protected hostUrl: string;\r\n    protected apiToken: string;\r\n\r\n    constructor(web:Web, hostUrl: string, apiToken:string, ui?: HttpChannelUI) {\r\n        this.web = web;\r\n        this.hostUrl = hostUrl;\r\n        this.apiToken = apiToken;\r\n        this.ui = ui;\r\n        this.timeout = env.isDevelopment === true? 500000:50000;\r\n    }\r\n\r\n    private startWait = (waiting: boolean) => {\r\n        if (waiting === true) {\r\n            if (this.ui !== undefined) this.ui.startWait();\r\n        }\r\n    }\r\n\r\n    private endWait = (url?:string, reject?:(reason?:any)=>void) => {\r\n        if (this.ui !== undefined) this.ui.endWait();\r\n        if (reject !== undefined) reject('访问webapi超时 ' + url);\r\n    }\r\n\r\n    private showError = async (error:FetchError) => {\r\n        if (this.ui !== undefined) await this.ui.showError(error);\r\n    }\r\n\r\n    used() {\r\n        this.post('', {});\r\n    }\r\n\r\n    async xcall(urlPrefix:string, caller:Caller<any>): Promise<void> {\r\n        let options = this.buildOptions();\r\n        let {headers, path, method} = caller;\r\n        if (headers !== undefined) {\r\n            let h = options.headers;\r\n            for (let i in headers) {\r\n\t\t\t\t//h.append(i, encodeURI(headers[i]));\r\n\t\t\t\th[i] = encodeURI(headers[i]);\r\n            }\r\n        }\r\n        options.method = method;\r\n        let p = caller.buildParams();\r\n        if (methodsWithBody.indexOf(method) >= 0 && p !== undefined) {\r\n            options.body = JSON.stringify(p)\r\n        }\r\n        return await this.innerFetch(urlPrefix + path, options, caller.waiting);\r\n    }\r\n\r\n    private async innerFetchResult(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let ret = await this.innerFetch(url, options, waiting);\r\n        return ret.res;\r\n    }\r\n\r\n    async get(url: string, params: any = undefined, waiting?: boolean): Promise<any> {\r\n        if (params) {\r\n            let keys = Object.keys(params);\r\n            if (keys.length > 0) {\r\n                let c = '?';\r\n                for (let k of keys) {\r\n                    let v = params[k];\r\n                    if (v === undefined) continue;\r\n                    url += c + k + '=' + params[k];\r\n                    c = '&';\r\n                }\r\n            }\r\n        }\r\n        let options = this.buildOptions();\r\n        options.method = 'GET';\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async post(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'POST';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async put(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'PUT';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async delete(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'DELETE';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n    async fetch(url: string, options: any, waiting: boolean, resolve:(value?:any)=>any, reject:(reason?:any)=>void):Promise<void> {\r\n        let that = this;\r\n        this.startWait(waiting);\r\n        let path = url;\r\n        function buildError(err: any, ex?: string) {\r\n            switch (typeof err) {\r\n                case 'string':\r\n                    if (ex !== undefined) err += ' ' + ex;\r\n                    break;\r\n                case 'object':\r\n                    let keys = Object.keys(err);\r\n                    let retErr:any = {\r\n                        ex: ex,\r\n                    };\r\n                    for (let key of keys) {\r\n                        retErr[key] = err[key];\r\n                    }\r\n                    err = retErr;\r\n                    break;\r\n            }\r\n            return {\r\n                channel: that,\r\n                url: path,\r\n                options: options,\r\n                resolve: resolve,\r\n                reject: reject,\r\n                error: err,\r\n            }\r\n        }\r\n        try {\r\n            console.log('%s-%s %s', options.method, path, options.body || '');\r\n            let now = Date.now();\r\n            let timeOutHandler = env.setTimeout(\r\n                undefined, //'httpChannel.fetch',\r\n                () => {\r\n                    that.endWait(url + ' timeout endWait: ' + (Date.now() - now) + 'ms', reject);\r\n                },\r\n                this.timeout);\r\n            let res = await fetch(encodeURI(path), options);\r\n            if (res.ok === false) {\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('ok false endWait');       \r\n                that.endWait();\r\n                console.log('call error %s', res.statusText);\r\n                throw res.statusText;\r\n            }\r\n            let ct = res.headers.get('content-type');\r\n            if (ct && ct.indexOf('json')>=0) {\r\n                return res.json().then(async retJson => {\r\n                    env.clearTimeout(timeOutHandler);\r\n                    that.endWait();\r\n                    if (retJson.ok === true) {\r\n                        if (typeof retJson !== 'object') {\r\n                            debugger;\r\n                        }\r\n                        else if (Array.isArray(retJson) === true) {\r\n                            debugger;\r\n                        }\r\n                        return resolve(retJson);\r\n                    }\r\n                    let retError = retJson.error;\r\n                    if (retError === undefined) {\r\n                        await that.showError(buildError('not valid tonva json'));\r\n                    }\r\n                    else {\r\n                        await that.showError(buildError(retError, 'retJson.error'));\r\n                        reject(retError);\r\n                    }\r\n                }).catch(async error => {\r\n                    await that.showError(buildError(error, 'catch res.json()'));\r\n                });\r\n            }\r\n            else {\r\n                let text = await res.text();\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('text endWait');\r\n                that.endWait();\r\n                resolve(text);\r\n            }\r\n        }\r\n        catch(error) {\r\n            this.endWait(url, reject);\r\n            if (typeof error === 'string') {\r\n                let err = error.toLowerCase();\r\n                if (err.startsWith('unauthorized') === true || err.startsWith('$roles') === true) {\r\n                    this.web.logout();\r\n                    return;\r\n                }\r\n            }\r\n            console.error('fecth error (no nav.showError): ' + url);\r\n        };\r\n    }\r\n\r\n    protected abstract innerFetch(url: string, options: any, waiting: boolean): Promise<any>;\r\n\r\n    async callFetch(url:string, method:string, body:any):Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = method;\r\n        options.body = body;\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(url, options, true, resolve, reject);\r\n        });\r\n    }\r\n\r\n    //private buildOptions(): {method:string; headers:Headers; body:any} {\r\n\t\tprivate buildOptions(): {method:string; headers:{[name:string]: string}; body:any} {\r\n        let headers = this.buildHeaders();\r\n        let options = {\r\n            headers: headers,\r\n            method: undefined as any,\r\n            body: undefined as any,\r\n            // cache: 'no-cache',\r\n        };\r\n        return options;\r\n    }\r\n\r\n\t/*\r\n    protected buildHeaders():Headers {\r\n        let {language, culture} = nav;\r\n        let headers = new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n        headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n        headers.append('Accept-Language', lang);\r\n        if (this.apiToken) { \r\n            headers.append('Authorization', this.apiToken); \r\n        }\r\n        return headers;\r\n\t}\r\n\t*/\r\n\tprotected buildHeaders():{[name:string]: string} { \r\n        let {language, culture} = this.web;\r\n        let headers:{[name:string]: string} = {}; //new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n\t\t//headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n\t\theaders['Content-Type'] = 'application/json;charset=UTF-8';\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n\t\t//headers.append('Accept-Language', lang);\r\n\t\theaders['Accept-Language'] = lang;\r\n        if (this.apiToken) { \r\n\t\t\t//headers.append('Authorization', this.apiToken); \r\n\t\t\theaders['Authorization'] = this.apiToken;\r\n        }\r\n        return headers;\r\n\t}\r\n}\r\n\r\nexport class CenterHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        let {appBridge} = this.web;\r\n        if (this.apiToken === undefined && appBridge.isBridged())\r\n            return await appBridge.bridgeCenterApi(u, options.method, options.body);\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n\r\nexport class UqHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n","import { Web } from './Web';\r\nimport { FetchError } from './fetchError';\r\n\r\nexport interface HttpChannelUI {\r\n    startWait():void;\r\n    endWait():void;\r\n    showError(error:FetchError):Promise<void>;\r\n    // showUpgradeUq(uq:string, version:number):Promise<void>;\r\n}\r\n\r\nexport class HttpChannelNavUI implements HttpChannelUI {\r\n    protected readonly web:Web;\r\n\r\n    constructor(web:Web) {\r\n        this.web = web;\r\n    }\r\n\r\n    startWait() {\r\n        this.web.startWait();\r\n    }\r\n    endWait() {\r\n        this.web.endWait();\r\n    }\r\n    async showError(error:FetchError):Promise<void> {\r\n        this.web.endWait();\r\n        /*\r\n        if (error.name === 'SyntaxError') {\r\n            error = {\r\n                name: error.name,\r\n                message: error.message,\r\n            }\r\n        }*/\r\n        await this.web.onError(error);\r\n    }\r\n    /*\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        await this.web.tonva.nav.showUpgradeUq(uq, version);\r\n    }\r\n    */\r\n}\r\n","import {HttpChannel} from './httpChannel';\r\nimport { Caller } from './caller';\r\nimport { Web } from './Web';\r\n\r\nexport async function refetchApi(channel:HttpChannel, url:string, options:any, \r\n    resolve:(values:any)=>any, reject:(reason:any)=>void)\r\n{\r\n    await channel.fetch(url, options, false, resolve, reject);\r\n}\r\n\r\nexport abstract class ApiBase {\r\n    protected readonly web: Web;\r\n    protected token: string;\r\n    protected path: string;\r\n    protected showWaiting: boolean;\r\n\r\n    constructor(web: Web, path: string, showWaiting: boolean) {\r\n        this.web = web;\r\n        this.path = path || '';\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    protected abstract getHttpChannel(): Promise<HttpChannel>;\r\n\r\n    async xcall(caller:Caller<any>):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.xcall(this.path, caller);\r\n    }\r\n\r\n    public async call(url:string, method:string, body:any):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.callFetch(url, method, body);\r\n    }\r\n\r\n    public async get(path:string, params:any=undefined): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.get(this.path + path, params);\r\n    }\r\n\r\n    public async post(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.post(this.path + path, params);\r\n    }\r\n\r\n    public async put(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.put(this.path + path, params);\r\n    }\r\n\r\n    public async delete(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.delete(this.path + path, params);\r\n    }\r\n}\r\n","import { Web } from \"./Web\";\r\n\r\nlet subAppWindow:Window;\r\nfunction postWsToSubApp(msg:any) {\r\n    if (subAppWindow === undefined) return;\r\n    subAppWindow.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport function setSubAppWindow(win:Window) {\r\n    subAppWindow = win;\r\n}\r\n\r\nexport function postWsToTop(msg:any) {\r\n    window.top.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport abstract class WsBase {\r\n    protected web: Web;\r\n\t//private messageHub = messageHub;\r\n    constructor(web: Web) {\r\n        this.web = web;\r\n    }\r\n\r\n\t/*\r\n    wsBaseId:string;\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n\tprivate msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n\t*/\r\n\t/*\r\n    onWsReceiveAny(handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.anyHandlers[seed] = handler;\r\n        return seed;\r\n    }\r\n    onWsReceive(type:string, handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.msgHandlers[seed] = {type:type, handler: handler};\r\n        return seed;\r\n    }\r\n    endWsReceive(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n\t}\r\n\t*/\r\n    async receive(msg:any) {\r\n\t\tthis.web.messageHub.dispatch(msg);\r\n\t\t/*\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n\t\t}\r\n\t\t*/\r\n    }\r\n}\r\n\r\nlet wsBaseSeed = 1;\r\nexport class WsBridge extends WsBase {\r\n    wsBaseId:string = 'WsBridge seed ' + wsBaseSeed++;\r\n}\r\n\r\nexport class WSChannel extends WsBase {\r\n    wsBaseId:string = 'WSChannel seed ' + wsBaseSeed++;\r\n    static centerToken:string;\r\n    private wsHost: string;\r\n    private token: string;\r\n    private ws: WebSocket;\r\n\r\n    constructor(web: Web, wsHost: string, token: string) {\r\n        super(web);\r\n        this.wsHost = wsHost;\r\n        this.token = token;\r\n    }\r\n\r\n    static setCenterToken(token?: string) {\r\n        WSChannel.centerToken = token;\r\n    }\r\n    \r\n    connect():Promise<void> {\r\n        //this.wsHost = wsHost;\r\n        //this.token = token || WSChannel.centerToken;\r\n        if (this.ws !== undefined) return;\r\n        let that = this;\r\n        return new Promise((resolve, reject) => {\r\n            let ws = new WebSocket(this.wsHost, this.token || WSChannel.centerToken);\r\n            console.log('connect webSocket %s', this.wsHost);\r\n            ws.onopen = (ev) => {\r\n                console.log('webSocket connected %s', this.wsHost);\r\n                that.ws = ws;\r\n                resolve();\r\n            };\r\n            ws.onerror = (ev) => {\r\n                reject('webSocket can\\'t open!');\r\n            };\r\n            ws.onmessage = async (msg) => await that.wsMessage(msg);\r\n            ws.onclose = (ev) => {\r\n                that.ws = undefined;\r\n                console.log('webSocket closed!');\r\n            }\r\n        });\r\n    }\r\n    close() {\r\n        if (this.ws !== undefined) {\r\n            this.ws.close();\r\n            this.ws = undefined;\r\n        }\r\n    }\r\n    private async wsMessage(event:any):Promise<void> {\r\n        try {\r\n            console.log('websocket message: %s', event.data);\r\n            let msg = JSON.parse(event.data);\r\n            postWsToSubApp(msg);\r\n            await this.receive(msg);\r\n        }\r\n        catch (err) {\r\n            console.log('ws msg error: ', err);\r\n        }\r\n    }\r\n    sendWs(msg:any) {\r\n        let netThis = this;\r\n        this.connect().then(() => {\r\n            netThis.ws.send(msg);\r\n        });\r\n    }\r\n}\r\n","import {HttpChannel, UqHttpChannel} from './httpChannel';\r\nimport {HttpChannelNavUI} from './httpChannelUI';\r\n//import {getUqToken, logoutUqTokens, buildAppUq} from './appBridge';\r\nimport {ApiBase} from './apiBase';\r\n//import { host } from './host';\r\nimport { LocalMap, env, decodeUserToken } from '../tool';\r\nimport { Web, PromiseValue } from './Web';\r\n\r\ninterface UqLocal {\r\n    user: number;\r\n    unit: number;\r\n    value: any;\r\n    tick?: number;\r\n    isNet?: boolean;\r\n}\r\n\r\nexport class UqApi extends ApiBase {\r\n    uqOwner: string;\r\n    uqName: string;\r\n    uq: string;\r\n\r\n    constructor(web:Web, basePath:string, uqOwner:string, uqName:string, showWaiting?: boolean) {\r\n        super(web, basePath, showWaiting);\r\n        if (uqName) {\r\n            this.uqOwner = uqOwner;\r\n            this.uqName = uqName;\r\n            this.uq = uqOwner + '/' + uqName;\r\n        }\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    async init() {\r\n        await this.web.appBridge.buildAppUq(this.uq, this.uqOwner, this.uqName);\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channels: {[name:string]: HttpChannel|(PromiseValue<any>[])};\r\n        let channelUI: HttpChannelNavUI;\r\n        if (this.showWaiting === true || this.showWaiting === undefined) {\r\n            channels = this.web.channelUIs;\r\n            channelUI = new HttpChannelNavUI(this.web);\r\n        }\r\n        else {\r\n            channels = this.web.channelNoUIs;\r\n        }\r\n        let channel = channels[this.uq];\r\n\t\tif (channel !== undefined) {\r\n\t\t\tif (Array.isArray(channel) === false) return channel as HttpChannel;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tchannel = channels[this.uq] = [];\r\n\t\t}\r\n\t\tlet arr = channel as PromiseValue<any>[];\r\n\t\treturn new Promise(async (resolve, reject) => {\r\n\t\t\tarr.push({resolve, reject});\r\n\t\t\tif (arr.length !== 1) return;\r\n\t\t\tlet uqToken = this.web.appBridge.getUqToken(this.uq); //, this.uqOwner, this.uqName);\r\n\t\t\tif (!uqToken) {\r\n\t\t\t\t//debugger;\r\n\t\t\t\tawait this.init();\r\n\t\t\t\tuqToken = this.web.appBridge.getUqToken(this.uq);\r\n\t\t\t}\r\n\t\t\tlet {url, token} = uqToken;\r\n\t\t\tthis.token = token;\r\n\t\t\tchannel = new UqHttpChannel(this.web, url, token, channelUI);\r\n\t\t\tchannels[this.uq] = channel;\r\n\t\t\tfor (let pv of arr) {\r\n\t\t\t\tpv.resolve(channel);\r\n\t\t\t}\r\n\r\n\t\t});\r\n    }\r\n\r\n    /*async update():Promise<string> {\r\n        return await this.get('update');\r\n    }*/\r\n\r\n    /*\r\n    async __loadAccess():Promise<any> {\r\n        let acc = this.access === undefined?\r\n            '' :\r\n            this.access.join('|');\r\n        let ret = await this.get('access', {acc:acc});\r\n        return ret;\r\n    }\r\n    */\r\n    async loadEntities():Promise<any> {\r\n        //return await localUqs.loadAccess(this);\r\n        //let acc = this.access === undefined?\r\n        //    '' :\r\n        //    this.access.join('|');\r\n\t\t//let ret = await this.get('access', {acc:acc});\r\n\t\tlet ret = await this.get('entities');\r\n        return ret;\r\n\t}\r\n    async getAdmins():Promise<{id:number;role:number}[]> {\r\n\t\tlet ret = await this.get('get-admins',);\r\n\t\treturn ret;\r\n    }\r\n \tasync getRoles():Promise<string[]> {\r\n\t\tlet ret = await this.get('get-roles',);\r\n\t\tif (!ret) return null;\r\n\t\tlet parts:string[] = (ret as string).split('|');\r\n\t\tlet s:string[] = [];\r\n\t\tfor (let p of parts) {\r\n\t\t\tp = p.trim();\r\n\t\t\tif (!p) continue;\r\n\t\t\ts.push(p);\r\n\t\t}\r\n\t\tif (s.length === 0) return null;\r\n\t\treturn s;\r\n\t}\r\n\tasync getAllRoleUsers():Promise<{user:number, admin:number, roles:string}[]> {\r\n\t\tlet ret = await this.get('get-all-role-users');\r\n\t\treturn ret;\r\n\t}\r\n\tasync setUserRoles(theUser:number, roles:string):Promise<void> {\r\n\t\tawait this.post('set-user-roles', {theUser, roles});\r\n\t}\r\n\tasync deleteUserRoles(theUser:number):Promise<void> {\r\n\t\tawait this.get('delete-user-roles', {theUser});\r\n\t}\r\n\r\n\tasync allSchemas(): Promise<any> {\r\n\t\treturn await this.get('all-schemas');\r\n\t}\r\n\r\n    async schema(name:string):Promise<any> {\r\n        return await this.get('schema/' + name);\r\n    }\r\n\r\n    async queueModify(start:number, page:number, entities:string) {\r\n        return await this.post('queue-modify', {start:start, page:page, entities:entities});\r\n    }\r\n}\r\n\r\n/*\r\nlet channels:{[unitId:number]: HttpChannel} = {};\r\n\r\nexport function logoutUnitxApis() {\r\n    channels = {};\r\n}\r\n*/\r\n\r\nexport class UnitxApi extends UqApi {\r\n    private unitId:number;\r\n    constructor(web:Web, unitId:number) {\r\n        super(web, 'tv/', undefined, undefined, true);\r\n        this.unitId = unitId;\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channel = this.web.channels[this.unitId];\r\n        if (channel !== undefined) return channel;\r\n        return this.web.channels[this.unitId] = await this.buildChannel();\r\n    }\r\n\r\n    private async buildChannel():Promise<HttpChannel> {        \r\n        let channelUI = new HttpChannelNavUI(this.web);\r\n        let centerAppApi = new CenterAppApi(this.web, 'tv/', undefined);\r\n        let ret = await centerAppApi.unitxUq(this.unitId);\r\n        let {token, db, url, urlTest} = ret;\r\n        let realUrl = this.web.host.getUrlOrTest(db, url, urlTest);\r\n        this.token = token;\r\n        return new UqHttpChannel(this.web, realUrl, token, channelUI);\r\n    }\r\n}\r\nexport abstract class CenterApiBase extends ApiBase {\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let ret: HttpChannel;\r\n        if (this.showWaiting === true || this.showWaiting === undefined) {\r\n            ret = this.web.getCenterChannelUI();\r\n        }\r\n        else {\r\n            ret = this.web.getCenterChannel();\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nconst uqTokensName = 'uqTokens';\r\nexport class UqTokenApi extends CenterApiBase {\r\n\tstatic clearLocal() {\r\n\t\tenv.localDb.removeItem(uqTokensName);\r\n\t}\r\n    private localMap: LocalMap = env.localDb.map(uqTokensName);\r\n\r\n    async uq(params: {unit:number, uqOwner:string, uqName:string}):Promise<any> {\r\n        let {uqOwner, uqName} = params;\r\n        let un = uqOwner+'/'+uqName;\r\n        let localCache = this.localMap.child(un);\r\n        try {\r\n            let uqToken:UqLocal = localCache.get();\r\n            if (uqToken !== undefined) {\r\n                let {unit, user} = uqToken;\r\n                if (unit !== params.unit || user !== this.web.loginedUserId) {\r\n                    localCache.remove();\r\n                    uqToken = undefined;\r\n                }\r\n            }\r\n            let nowTick = Math.floor(Date.now() / 1000);\r\n            if (uqToken !== undefined) {\r\n                let {tick, value} = uqToken;\r\n                if (value !== undefined && (nowTick - tick) < 24*3600) {\r\n                    return Object.assign({}, value);\r\n                }\r\n            }\r\n            let uqParams:any = Object.assign({}, params);\r\n            uqParams.testing = this.web.host.testing;\r\n            let ret = await this.get('uq-token', uqParams);\r\n            if (ret === undefined) {\r\n                let {unit, uqOwner, uqName} = params;\r\n                let err = `center get app-uq(unit=${unit}, '${uqOwner}/${uqName}') - not exists or no unit-service`;\r\n                throw err;\r\n            }\r\n\r\n            uqToken = {\r\n                unit: params.unit,\r\n                user: this.web.loginedUserId,\r\n                tick: nowTick,\r\n                value: ret,\r\n            }\r\n            localCache.set(uqToken);\r\n            return Object.assign({}, ret);\r\n        }\r\n        catch (err) {\r\n            localCache.remove();\r\n            throw err;\r\n        }\r\n    }\r\n}\r\n\r\nexport class CallCenterApi extends CenterApiBase {\r\n    directCall(url:string, method:string, body:any):Promise<any> {\r\n        return this.call(url, method, body);\r\n    }\r\n}\r\n\r\nexport interface UqAppData {\r\n    appName: string;\r\n    appOwner: string;\r\n    id: number;\r\n    version: string;        // AppUI version\r\n    uqs: UqData[];\r\n}\r\n\r\nexport interface UqData {\r\n    id: number;\r\n    uqOwner: string;\r\n\townerAlias: string;\r\n    uqName: string;\r\n\tuqAlias: string;\r\n    access: string;\r\n    newVersion: boolean;\r\n}\r\n\r\nexport interface UqServiceData {\r\n    id: number;\r\n    db: string;\r\n    url: string;\r\n    urlTest: string;\r\n    token: string;\r\n}\r\n\r\n//const appUqsName = 'appUqs';\r\n\r\nexport class CenterAppApi extends CenterApiBase {\r\n    async appUqs(appOwner:string, appName:string):Promise<UqAppData> {\r\n        let ret:UqAppData = await this.get('tie/app-uqs', {appOwner, appName});\r\n        return ret;\r\n    }\r\n    async uqs(uqs: {owner:string; name:string; version:string}[]):Promise<UqData[]> {\r\n        return await this.post('tie/pure-uqs', uqs);\r\n    }\r\n    async unitxUq(unit:number):Promise<UqServiceData> {\r\n        return await this.get('tie/unitx-uq', {unit:unit});\r\n    }\r\n    async changePassword(param: {orgPassword:string, newPassword:string}) {\r\n        return await this.post('tie/change-password', param);\r\n    }\r\n\r\n    async userQuit(): Promise<void> {\r\n        await this.get('tie/user-ask-quit', {});\r\n    }\r\n}\r\n\r\nexport interface RegisterParameter {\r\n    nick:string, \r\n    user:string, \r\n    pwd:string,\r\n    country:number, \r\n    mobile:number, \r\n    mobileCountry:number,\r\n    email:string,\r\n    verify:string,\r\n};\r\n\r\nexport class UserApi extends CenterApiBase {\r\n    async login(params: {user: string, pwd: string, guest: number}): Promise<any> {\r\n        //(params as any).device = nav.local.device.get();\r\n        let ret = await this.post('user/login', params);\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeUserToken(ret);\r\n            case 'object':\r\n                let token = ret.token;\r\n                let user = decodeUserToken(token);\r\n                let {nick, icon} = ret;\r\n                if (nick) user.nick = nick;\r\n                if (icon) user.icon = icon;\r\n                return user;\r\n        }\r\n        // !== undefined) return decodeToken(token);\r\n    }\r\n    async register(params: RegisterParameter): Promise<any>\r\n    {\r\n        return await this.post('user/register', params);\r\n    }\r\n\r\n    async sendVerify(account:string, type:'mobile'|'email', oem:string) {\r\n        return await this.post('user/set-verify', {account:account, type:type, oem:oem});\r\n    }\r\n\r\n    async checkVerify(account:string, verify:string) {\r\n        return await this.post('user/check-verify', {account:account, verify:verify});\r\n    }\r\n\r\n    async isExists(account:string) {\r\n        return await this.get('user/is-exists', {account:account});\r\n    }\r\n\r\n    async resetPassword(account:string, password:string, verify:string, type:'mobile'|'email'):Promise<any[]> {\r\n        return await this.post('user/reset-password', {account:account, password, verify, type});\r\n    }\r\n    \r\n    async userSetProp(prop:string, value:any) {\r\n        await this.post('tie/user-set-prop', {prop:prop, value:value});\r\n    }\r\n\r\n    async me():Promise<any> {\r\n        return await this.get('tie/me');\r\n    }\r\n\r\n    async user(id:number): Promise<any> {\r\n        return await this.get('tie/user', {id:id});\r\n\t}\r\n\t\r\n\tasync fromKey(key:string): Promise<{id:number, name:string, nick:string, icon:string}> {\r\n\t\treturn await this.get('tie/user-from-key', {key});\r\n\t}\r\n}\r\n","//import {nav} from '../components';\r\nimport { UqTokenApi } from './uqApi';\r\nimport { setSubAppWindow } from './wsChannel';\r\n//import { host } from './host';\r\nimport { env, uid } from '../tool';\r\nimport { Web } from './Web';\r\n\r\nexport interface UqToken {\r\n    name: string;\r\n    db: string;\r\n    url: string;\r\n    token: string;\r\n}\r\n\r\ninterface UqTokenAction {\r\n    resolve: (value?: UqToken | PromiseLike<UqToken>) => void;\r\n    reject: (reason?: any) => void;\r\n}\r\n\r\ninterface BridgeCenterApi {\r\n    id: string;\r\n    resolve: (value?:any)=>any;\r\n    reject: (reason?:any)=>void;\r\n}\r\n\r\nexport class AppBridge {\r\n    private readonly web: Web;\r\n    private readonly uqTokens:{[uqName:string]: UqToken}  = {};\r\n\r\n    constructor(web: Web) {\r\n        this.web = web;\r\n    }\r\n\r\n    addMessageListener() {\r\n        window.addEventListener('message', async (evt) => {\r\n            var message = evt.data;\r\n            if (!message) return;\r\n            //let {nav} = this.web.tonva;\r\n            switch (message.type) {\r\n                case 'sub-frame-started':\r\n                    this.subFrameStarted(evt);\r\n                    break;\r\n                case 'ws':\r\n                    //wsBridge.receive(message.msg);\r\n                    await this.web.onWsReceive(message.msg);\r\n                    break;\r\n                case 'init-sub-win':\r\n                    await this.initSubWin(message);\r\n                    break;\r\n                case 'pop-app':\r\n                    window.console.log('///\\\\\\\\\\\\ pop-app');\r\n                    this.web.navBack();\r\n                    break;\r\n                case 'center-api':\r\n                    await this.callCenterApiFromMessage(evt.source as Window, message);\r\n                    break;\r\n                case 'center-api-return':\r\n                    this.bridgeCenterApiReturn(message);\r\n                    break;\r\n                case 'app-api':\r\n                    let ret = await this.onReceiveAppApiMessage(message.hash, message.apiName);\r\n                    (evt.source as Window).postMessage({\r\n                        type: 'app-api-return', \r\n                        apiName: message.apiName,\r\n                        db: ret.db,\r\n                        url: ret.url,\r\n                        token: ret.token} as any, \"*\");\r\n                    break;\r\n                case 'app-api-return':\r\n                    console.log(\"app-api-return: %s\", JSON.stringify(message));\r\n                    console.log('await onAppApiReturn(message);');\r\n                    await this.onAppApiReturn(message);\r\n                    break;\r\n                default:\r\n                    if ((message.source as string)?.startsWith('react-devtools') === true) break;\r\n                    window.console.log('message: %s', JSON.stringify(message));\r\n                    break;\r\n            }\r\n        });\r\n    }\r\n\r\n    logoutUqTokens() {\r\n        for (let i in this.uqTokens) {\r\n            this.uqTokens[i] = undefined;\r\n        }\r\n        UqTokenApi.clearLocal();\r\n    }\r\n\r\n    isBridged():boolean {\r\n        return window.self !== window.parent;\r\n    }\r\n\r\n    private subFrameStarted(evt:any) {\r\n        var message = evt.data;\r\n        let subWin = evt.source as Window;\r\n        setSubAppWindow(subWin);\r\n        this.hideFrameBack(message.hash);\r\n        let msg:any =  Object.assign({}, this.web.user);\r\n        msg.type = 'init-sub-win';\r\n        subWin.postMessage(msg, '*');\r\n    }\r\n\r\n    hideFrameBack(hash:string) {\r\n        let el = document.getElementById(hash);\r\n        if (el !== undefined) el.hidden = true;\r\n    }\r\n\r\n    async initSubWin(message:any) {\r\n        console.log('initSubWin: set nav.user', message);\r\n        let user = this.web.user = message; // message.user;\r\n        this.web.setCenterToken(user.id, user.token);\r\n        await this.web.showAppView();\r\n    }\r\n\r\n    private async onReceiveAppApiMessage(hash: string, apiName: string): Promise<UqToken> {\r\n        let {unit} = env;\r\n        if (!unit) {\r\n            console.error('no unit defined in unit.json or in index.html, or not logined in', unit);\r\n        }\r\n        let parts = apiName.split('/');\r\n        let param = {unit: unit, uqOwner: parts[0], uqName: parts[1], appOwner: parts[2], appName:parts[3]};\r\n        console.log('uqTokenApi.uq onReceiveAppApiMessage', param);\r\n        let ret = await this.web.uqTokenApi.uq(param);\r\n        let {db, url, token} = ret;\r\n        return {name: apiName, db:db, url: url, token: token};\r\n    }\r\n\r\n    private async onAppApiReturn(message:any) {\r\n        let {apiName, db, url, urlTest, token} = message;\r\n        let action = this.uqTokenActions[apiName];\r\n        if (action === undefined) {\r\n            throw new Error('error app api return');\r\n            //return;\r\n        }\r\n        let realUrl = this.web.host.getUrlOrTest(db, url, urlTest);\r\n        console.log('onAppApiReturn(message:any): url=' + url + ', real=' + realUrl);\r\n        //action.url = realUrl;\r\n        //action.token = token;\r\n        action.resolve({\r\n            name: apiName,\r\n            db: db,\r\n            url: realUrl,\r\n            token: token,\r\n        } as UqToken);\r\n    }\r\n\r\n    private readonly uqTokenActions:{[uq:string]: UqTokenAction} = {};\r\n\r\n    async buildAppUq(uq:string, uqOwner:string, uqName:string):Promise<void> {\r\n        if (!this.isBridged()) {\r\n            //let unit = getUnit();\r\n            let {unit} = env;\r\n            let uqToken = await this.web.uqTokenApi.uq({unit,  uqOwner, uqName});\r\n            if (uqToken.token === undefined) uqToken.token = this.web.centerToken;\r\n            let {db, url, urlTest} = uqToken;\r\n            let realUrl = this.web.host.getUrlOrTest(db, url, urlTest);\r\n            console.log('realUrl: %s', realUrl);\r\n            uqToken.url = realUrl;\r\n            this.uqTokens[uq] = uqToken;\r\n            return uqToken;\r\n        }\r\n        //console.log(\"**** before buildAppUq ****\", appInFrame);\r\n        let bp = this.uqTokenActions[uq];\r\n        if (bp !== undefined) return;\r\n        return new Promise<void>((resolve, reject) => {\r\n            this.uqTokenActions[uq] = {\r\n                resolve: async (at:any) => {\r\n                    let {db, url, token} = await at;\r\n                    this.uqTokens[uq] = {\r\n                        name: uq,\r\n                        db: db,\r\n                        url: url,\r\n                        token: token,\r\n                    };\r\n                    this.uqTokenActions[uq] = undefined;\r\n                    //console.log(\"**** after buildAppUq ****\", appInFrame);\r\n                    resolve();\r\n                },\r\n                reject: reject,\r\n            };\r\n            (window.opener || window.parent).postMessage({\r\n                type: 'app-api',\r\n                apiName: uq,\r\n                //hash: appInFrame.hash,\r\n            }, \"*\");\r\n        });\r\n    }\r\n\r\n    getUqToken(uq:string):UqToken {\r\n        let uts = this.uqTokens;\r\n        return uts[uq];\r\n    }\r\n\r\n    private readonly brideCenterApis:{[id:string]: BridgeCenterApi} = {};\r\n    async bridgeCenterApi(url:string, method:string, body:any):Promise<any> {\r\n        console.log('bridgeCenterApi: url=%s, method=%s', url, method);\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            let callId:string;\r\n            for (;;) {\r\n                callId = uid();\r\n                let bca = this.brideCenterApis[callId];\r\n                if (bca === undefined) {\r\n                    this.brideCenterApis[callId] = {\r\n                        id: callId,\r\n                        resolve: resolve,\r\n                        reject: reject,\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n            (window.opener || window.parent).postMessage({\r\n                type: 'center-api',\r\n                callId: callId,\r\n                url: url,\r\n                method: method,\r\n                body: body\r\n            }, '*');\r\n        });\r\n    }\r\n\r\n    async callCenterApiFromMessage(from:Window, message:any):Promise<void> {\r\n        let {callId, url, method, body} = message;\r\n        let result = await this.web.callCenterapi.directCall(url, method, body);\r\n        from.postMessage({\r\n            type: 'center-api-return',\r\n            callId: callId,\r\n            result: result,\r\n        }, '*');\r\n    }\r\n\r\n    bridgeCenterApiReturn(message:any) {\r\n        let {callId, result} = message;\r\n        let bca = this.brideCenterApis[callId];\r\n        if (bca === undefined) return;\r\n        this.brideCenterApis[callId] = undefined;\r\n        bca.resolve(result);\r\n    }\r\n}\r\n","import {CenterApiBase} from './uqApi';\r\n\r\nexport class CenterApi extends CenterApiBase {\r\n    async userAppUnits(app:number):Promise<any[]> {\r\n        return await this.get('tie/user-app-units', {app:app});\r\n    }\r\n    async userFromId(userId:number):Promise<any> {\r\n        return await this.get('user/user-name-nick-icon-from-id', {userId:userId});\r\n\t}\r\n\tasync userFromKey(userName:string):Promise<any> {\r\n\t\treturn await this.get('tie/user-from-key', {key:userName});\r\n\t}\r\n}\r\n","import { decodeGuestToken } from '../tool';\r\nimport { CenterApiBase } from './uqApi';\r\n\r\nexport class GuestApi extends CenterApiBase {\r\n    async guest(): Promise<any> {\r\n        //let guest = nav.local.guest.get();\r\n        let ret = await this.get('', {});\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeGuestToken(ret);\r\n            case 'object':\r\n                let guest = decodeGuestToken(ret.token);\r\n                return guest;\r\n        }\r\n    }\r\n\r\n    async unitFromName(unitName:string): Promise<number> {\r\n        let ret = await this.get(unitName);\r\n        return ret && ret.unit;\r\n    }\r\n}\r\n","import { Web } from \"./Web\";\r\n\r\nexport class MessageHub {\r\n    web: Web;\r\n    constructor(web: Web) {\r\n        this.web = web;\r\n    }\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n    private msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n\tregisterReceiveHandler(handler:(msg:any)=>Promise<void>):number;\r\n\tregisterReceiveHandler(type:string, handler:(msg:any)=>Promise<void>):number;\t\r\n    registerReceiveHandler(...args:any[]):number {\r\n\t\tlet seed = this.handlerSeed++;\r\n\t\tlet args0 = args[0];\r\n\t\tlet handler:(msg:any)=>Promise<void>;\r\n\t\tswitch (typeof args0) {\r\n\t\t\tcase 'string':\r\n\t\t\t\thandler = args[1];\r\n\t\t\t\tthis.msgHandlers[seed] = {type:args0, handler};\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'function':\r\n\t\t\t\tthis.anyHandlers[seed] = args0;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn seed;\r\n    }\r\n    unregisterReceiveHandler(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n    }\r\n    async dispatch(msg:any) {\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n        }\r\n    }\r\n}\r\n","import { env } from '../tool';\r\n\r\n/*\r\n.env\r\n#REACT_APP_CENTER_HOST=101.200.46.56\r\n#REACT_APP_CENTER_HOST=47.92.87.6\r\nREACT_APP_CENTER_HOST=https://tv.jkchemical.com\r\nREACT_APP_RES_HOST=https://tv.jkchemical.com\r\nREACT_APP_UNIT=24\r\n*/\r\n\r\nconst centerHost = 'https://tv.jkchemical.com'; // process.env['REACT_APP_CENTER_HOST'];\r\nconst centerDebugHost = 'localhost:3000'; //'192.168.86.64';\r\nconst resHost = 'https://tv.jkchemical.com' || centerHost;\r\nconst resDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugBuilderHost = 'localhost:3009';\r\ninterface HostValue {\r\n    value: string;\r\n\tlocal: boolean;\r\n}\r\nconst hosts:{[name:string]:HostValue} = {\r\n    centerhost: {\r\n        value: /*process.env['REACT_APP_CENTER_DEBUG_HOST']*/ undefined || centerDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    reshost: {\r\n        value: /*process.env['REACT_APP_RES_DEBUG_HOST']*/ undefined || resDebugHost,\r\n\t\tlocal: false,\r\n    },\r\n    uqhost: {\r\n        value: /*process.env['REACT_APP_UQ_DEBUG_HOST']*/ undefined || uqDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    unitxhost: {\r\n        value: /*process.env['REACT_APP_UQ_DEBUG_HOST']*/ undefined || uqDebugHost, \r\n\t\tlocal: false,\r\n    },\r\n    \"uq-build\": {\r\n        value: /*process.env['REACT_APP_UQ_DEBUG_BUILDER_HOST']*/ undefined || uqDebugBuilderHost, \r\n\t\tlocal: false,\r\n    }\r\n}\r\n\r\nconst httpArr = ['https://', 'http://'];\r\nfunction isAbsoluteUrl(url:string):boolean {\r\n    for (let str of httpArr) {\r\n        if (url.startsWith(str) === true) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction urlFromHost(host:string):string {\r\n    if (isAbsoluteUrl(host) === true) {\r\n        if (host.endsWith('/')) return host;\r\n        return host + '/';\r\n    }\r\n    return `http://${host}/`;\r\n}\r\n\r\nfunction centerUrlFromHost(host:string):string {\r\n    return urlFromHost(host);\r\n}\r\nfunction centerWsFromHost(host:string) {\r\n    let https = 'https://';\r\n    if (host.startsWith(https) === true) {\r\n        host = host.substr(https.length);\r\n        if (host.endsWith('/') === true) host = host.substr(0, host.length-1);\r\n        return 'wss://' + host + '/tv/';\r\n    }\r\n    return `ws://${host}/tv/`\r\n}\r\nexport function resUrlFromHost(host:string) {\r\n\tif (!host) return;\r\n    let url = urlFromHost(host);\r\n    return url + 'res/';\r\n}\r\n\r\nconst fetchOptions = {\r\n    method: \"GET\",\r\n    mode: \"no-cors\", // no-cors, cors, *same-origin\r\n    headers: {\r\n        \"Content-Type\": \"text/plain\"\r\n    },\r\n};\r\n\r\nexport class Host {\r\n    testing: boolean;\r\n    url: string;\r\n    ws: string;\r\n    resHost: string;\r\n\r\n    async start(testing:boolean) {\r\n\t\tif (!centerHost) debugger;\r\n        this.testing = testing;\r\n        if (env.isDevelopment === true) {\r\n            await this.tryLocal();\r\n        }\r\n        let host = this.getCenterHost();\r\n        this.url = centerUrlFromHost(host);\r\n        this.ws = centerWsFromHost(host);\r\n\t\tthis.resHost = this.getResHost();\r\n    }\r\n\r\n    private debugHostUrl(host:string) {return `http://${host}/hello`}\r\n    private async tryLocal() {\r\n        let promises:PromiseLike<any>[] = [];\r\n        let hostArr:string[] = [];\r\n        for (let i in hosts) {\r\n            let hostValue = hosts[i];\r\n            let {value} = hostValue;\r\n            if (hostArr.findIndex(v => v === value) < 0) hostArr.push(value);\r\n        }\r\n\r\n        for (let host of hostArr) {\r\n            let fetchUrl = this.debugHostUrl(host);\r\n            promises.push(localCheck(fetchUrl));\r\n        }\r\n        let results = await Promise.all(promises);\r\n        let len = hostArr.length;\r\n        for (let i=0; i<len; i++) {\r\n            let local = results[i];\r\n            let host = hostArr[i];\r\n            for (let j in hosts) {\r\n                let hostValue = hosts[j];\r\n                if (hostValue.value === host) {\r\n                    hostValue.local = local;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private getCenterHost():string {\r\n        let {value, local} = hosts.centerhost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return centerHost;\r\n    }\r\n\r\n    private getResHost():string {\r\n        let {value, local} = hosts.reshost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return resHost;\r\n    }\r\n\r\n    getUrlOrDebug(url:string, debugHost:string = 'uqhost'):string {\r\n        if (env.isDevelopment === false) return url;\r\n        let host = hosts[debugHost];\r\n        if (host === undefined) return url;\r\n        let {value, local} = host;\r\n        if (local === false) return url;\r\n        return `http://${value}/`;\r\n    }\r\n    getUrlOrTest(db:string, url:string, urlTest:string):string {\r\n\t\tif (!urlTest) {\r\n\t\t\turlTest = url;\r\n\t\t\tif (!urlTest) {\r\n\t\t\t\tconsole.error('no server set for ' + db);\r\n\t\t\t\tdebugger;\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (!url) {\r\n\t\t\turl = urlTest;\r\n\t\t}\r\n\t\tlet testProd:string;\r\n        if (this.testing === true) {\r\n\t\t\tif (urlTest !== '-') url = urlTest;\r\n\t\t\ttestProd = 'test';\r\n        }\r\n        else {\r\n\t\t\ttestProd = 'prod';\r\n        }\r\n\t\turl = this.getUrlOrDebug(url);\r\n\t\tif (url.endsWith('/') === false) {\r\n\t\t\turl += '/';\r\n\t\t}\r\n        return `${url}uq/${testProd}/${db}/`;\r\n    }\r\n\r\n    async localCheck(urlDebug: string):Promise<boolean> {\r\n        return await localCheck(urlDebug);\r\n    }\r\n}\r\n\r\n//export const host:Host = new Host();\r\n\r\n// 因为测试的都是局域网服务器，甚至本机服务器，所以一秒足够了\r\n// 网上找了上面的fetch timeout代码。\r\n// 尽管timeout了，fetch仍然继续，没有cancel\r\n\r\n// 实际上，一秒钟不够。web服务器会自动停。重启的时候，可能会比较长时间。也许两秒甚至更多。\r\n//const timeout = 2000;\r\nconst timeout = 2000;\r\n\r\nfunction fetchLocalCheck(url:string):Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n      fetch(url, fetchOptions as any)\r\n      .then(v => {\r\n          v.text().then(resolve).catch(reject);\r\n      })\r\n      .catch(reject);\r\n      const e = new Error(\"Connection timed out\");\r\n      env.setTimeout('fetchLocalCheck', reject, timeout, e);\r\n    });\r\n}\r\n\r\nasync function localCheck(url:string):Promise<boolean> {\r\n    try {\r\n\t\tawait fetchLocalCheck(url);\r\n        return true;\r\n    }\r\n    catch (err) {\r\n        return false;\r\n    }\r\n}\r\n\r\n/*\r\nexport interface IUqForChannel {\r\n    uq: string;\r\n    uqVersion: number;\r\n}\r\n*/","/* eslint-disable */\r\n//import { Tonva } from \"../Tonva\";\r\nimport { AppBridge } from \"./appBridge\";\r\nimport { CenterApi } from \"./centerApi\";\r\nimport { UqData, CallCenterApi, CenterAppApi, UnitxApi, UqAppData, UqTokenApi, UserApi } from \"./uqApi\";\r\nimport { HttpChannel, CenterHttpChannel, UqHttpChannel } from './httpChannel';\r\nimport { GuestApi } from \"./guestApi\";\r\nimport { MessageHub } from \"./messageHub\";\r\nimport { HttpChannelNavUI } from \"./httpChannelUI\";\r\nimport { WsBridge, WSChannel } from \"./wsChannel\";\r\nimport { FetchError } from \"./fetchError\";\r\nimport { Host, resUrlFromHost } from './host';\r\n//import { UQsMan, UQsManApp, TVs } from \"../uq\";\r\n//import { AppConfig, UqConfig } from \"../app\";\r\n\r\nexport interface PromiseValue<T> {\r\n\tresolve: (value?: T | PromiseLike<T>) => void;\r\n\treject: (reason?: any) => void;\r\n}\r\n\r\nexport abstract class Web {\r\n    // ----- 从nav搬移过来的内容\r\n\r\n\r\n\r\n    // ===== nav搬移内容结束\r\n\r\n\t// abstract navInit(): Promise<void>\r\n\r\n\treload() {\r\n\t\tthrow new Error('Method not implemented.');\r\n\t}\r\n\tshowReloadPage(msg: string) {\r\n\t\tthrow new Error('Method not implemented.');\r\n\t}\r\n    // 这个应该会去掉\r\n    navBack() {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    // 这个是收到websocket消息的处理\r\n    async onWsReceive(msg: any) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    async showAppView() {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    logout() {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    async onError(error: FetchError) {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n    endWait() {\r\n        //throw new Error('Method not implemented.');\r\n    }\r\n    startWait() {\r\n        //throw new Error('Method not implemented.');\r\n    }\r\n    centerHost:string;\r\n    centerToken:string|undefined = undefined;\r\n    loginedUserId:number = 0;    \r\n    centerChannelUI:HttpChannel;\r\n    centerChannel:HttpChannel;\r\n\r\n    channelUIs:{[name:string]: HttpChannel|(PromiseValue<any>[])} = {};\r\n    channelNoUIs:{[name:string]: HttpChannel|(PromiseValue<any>[])} = {};\r\n    channels:{[unitId:number]: HttpChannel} = {};\r\n\r\n//    readonly tonva: Tonva;\r\n    readonly centerApi: CenterApi;\r\n    readonly appBridge: AppBridge;\r\n    readonly userApi: UserApi;\r\n    readonly uqTokenApi: UqTokenApi;\r\n    readonly callCenterapi: CallCenterApi;\r\n    readonly unitxApi: UnitxApi;\r\n    readonly guestApi: GuestApi;\r\n    readonly messageHub: MessageHub;\r\n    readonly wsBridge: WsBridge;\r\n    readonly host:Host;\r\n\r\n    language: string;\r\n    culture: string;\r\n\r\n    // 下面的变量应该以后会去掉\r\n    isBuildingUQ: boolean;\r\n    _uqs: any;\r\n    user: any;\r\n    // -- end -------------------\r\n\r\n\r\n    constructor() {\r\n        this.centerApi = new CenterApi(this, '/tv', undefined);\r\n        this.appBridge = new AppBridge(this);\r\n        this.userApi = new UserApi(this, 'tv/', undefined);\r\n        this.uqTokenApi = new UqTokenApi(this, 'tv/tie/', undefined);\r\n        this.callCenterapi = new CallCenterApi(this, '', undefined);\r\n        let unitId: number = 0;\r\n        this.unitxApi = new UnitxApi(this, unitId);\r\n        this.guestApi = new GuestApi(this, 'tv/guest/', undefined);\r\n        this.messageHub = new MessageHub(this);\r\n        this.wsBridge = new WsBridge(this);\r\n        this.host = new Host();\r\n    }\r\n    \r\n    logoutApis() {\r\n        this.channelUIs = {};\r\n        this.channelNoUIs = {};\r\n        this.channels = {};\r\n        this.appBridge.logoutUqTokens();\r\n    }\r\n\r\n    setCenterUrl(url:string) {\r\n        console.log('setCenterUrl %s', url);\r\n        this.centerHost = url;\r\n        this.centerChannel = undefined;\r\n        this.centerChannelUI = undefined;\r\n    }\r\n    \r\n    setCenterToken(userId:number, t?:string) {\r\n        this.loginedUserId = userId;\r\n        this.centerToken = t;\r\n        this.centerChannel = undefined;\r\n        this.centerChannelUI = undefined;\r\n    }\r\n\r\n    getCenterChannelUI():HttpChannel {\r\n        if (this.centerChannelUI !== undefined) return this.centerChannelUI;\r\n        return this.centerChannelUI = new CenterHttpChannel(this, this.centerHost, this.centerToken, new HttpChannelNavUI(this));\r\n    }\r\n    \r\n    getCenterChannel():HttpChannel {\r\n        if (this.centerChannel !== undefined) return this.centerChannel;\r\n        return this.centerChannel = new CenterHttpChannel(this, this.centerHost, this.centerToken);\r\n    }\r\n\r\n    setNetToken(userId:number, token:string) {\r\n        this.setCenterToken(userId, token);\r\n        WSChannel.setCenterToken(token);\r\n    }\r\n\r\n    clearNetToken() {\r\n        this.setCenterToken(0, undefined);\r\n        WSChannel.setCenterToken(undefined);\r\n    }\r\n\r\n    resUrlFromHost(host:string): string {\r\n        return resUrlFromHost(host);\r\n    }\r\n}\r\n","import { UqBuildContext } from \"./UqBuildContext\";\r\n\r\nexport class TsTemplate {\r\n    private readonly buildContext: UqBuildContext;\r\n\r\n    constructor(buildContext: UqBuildContext) {\r\n        this.buildContext = buildContext;\r\n        this.tsHeader = `//=== UqApp builder created on ${new Date()} ===//`;\r\n    }\r\n\r\n    readonly tsHeader: string;\r\n    \r\n    get tsApp():string {\r\n        return `${this.tsHeader}\r\n    import { NavView, start, nav } from 'tonva-${this.buildContext.uiPlatform}';\r\n    import { CApp } from './CApp';\r\n    import { appConfig } from './appConfig';\r\n    \r\n    export const App: React.FC = () => {\r\n        nav.setSettings(appConfig);\r\n        const onLogined = async (isUserLogin?:boolean) => {\r\n            await start(CApp, appConfig, isUserLogin);\r\n        }\r\n        return <NavView onLogined={onLogined} />;\r\n    }\r\n    \r\n    `;\r\n    }\r\n\r\n    get tsCApp():string {\r\n        return `${this.tsHeader}\r\n    import { CUqApp } from \"./CBase\";\r\n    import { res } from \"./res\";\r\n    import { VMain } from \"./VMain\";\r\n    import { setUI } from \"./uqs\";\r\n    \r\n    const gaps = [10, 3,3,3,3,3,5,5,5,5,5,5,5,5,10,10,10,10,15,15,15,30,30,60];\r\n    \r\n    export class CApp extends CUqApp {\r\n        protected async internalStart(isUserLogin: boolean) {\r\n            this.setRes(res);\r\n            setUI(this.uqs);\r\n            \r\n            this.openVPage(VMain, undefined, this.dispose);\r\n        }\r\n    \r\n        private timer:any;\r\n        protected onDispose() {\r\n            clearInterval(this.timer);\r\n            this.timer = undefined;\r\n        }\r\n    \r\n        private tick = 0;\r\n        private gapIndex = 0;\r\n        private callTick = async () => {\r\n            try {\r\n                if (!this.user) return;\r\n                ++this.tick;\r\n                if (this.tick<gaps[this.gapIndex]) return;\r\n                this.tick = 0;\r\n                if (this.gapIndex < gaps.length - 1) ++this.gapIndex;\r\n                let ret = await this.uqs.BzHelloTonva.$poked.query(undefined, false);\r\n                let v = ret.ret[0];\r\n                if (v === undefined) return;\r\n                if (!v.poke) return;\r\n                this.gapIndex = 1;\r\n    \r\n                // 数据服务器提醒客户端刷新，下面代码重新调入的数据\r\n                //this.cHome.refresh();\r\n            }\r\n            catch {\r\n            }\r\n        }\r\n    }\r\n    `;\r\n    }    \r\n\r\n    get tsCBase():string {\r\n        return `${this.tsHeader}\r\n    import { CSub, CBase, CAppBase, IConstructor } from 'tonva-${this.buildContext.uiPlatform}';\r\n    import { UQs } from './uqs';\r\n    import { CApp } from './CApp';\r\n    \r\n    export abstract class CUqBase extends CBase<CApp, UQs> {\r\n        protected async internalStart(param?:any, ...params:any[]):Promise<void> {}\r\n    }\r\n    \r\n    export abstract class CUqSub<A extends CAppBase<U>, U, T extends CBase<A,U>> extends CSub<A, U, T> {\r\n    }\r\n    \r\n    export abstract class CUqApp extends CAppBase<UQs> {\r\n        protected newC<T extends CUqBase>(type: IConstructor<T>, ...param:any[]): T {\r\n            let c = new type(this);\r\n            c.internalInit(...param);\r\n            return c;\r\n        }\r\n    }\r\n    `;\r\n    }\r\n\r\n    get tsIndex():string {\r\n        return `${this.tsHeader}\r\n    export { CUqApp, CUqBase, CUqSub } from './CBase';\r\n    export { CApp } from './CApp';\r\n    export * from './uqs';\r\n    export * from './App';\r\n    export * from './startApp';\r\n    `;\r\n    }\r\n        \r\n    get tsVMain():string {\r\n        return `${this.tsHeader}\r\n    import { VPage, Page } from 'tonva-${this.buildContext.uiPlatform}';\r\n    import { CApp } from './CApp';\r\n    \r\n    export class VMain extends VPage<CApp> {\r\n        header() { return 'TEST'; }\r\n        content() {\r\n            return <div className=\"m-3\">\r\n                <div>{this.renderMe()}</div>\r\n                <div className=\"mb-5\">同花样例主页面</div>\r\n            </div>;\r\n        }\r\n    }\r\n    `;\r\n    }\r\n    \r\n\r\n\r\n}\r\n","/* eslint-disable */\r\n//import { UqApi, UqData, UnitxApi } from '../net';\r\nimport { UqApi, UqData, UnitxApi } from '../web';\r\nimport { Tonva, UqConfig } from '../core';\r\nimport { Tuid, TuidDiv, TuidImport, TuidInner, TuidBox, TuidsCache } from './tuid';\r\nimport { Action } from './action';\r\nimport { Sheet } from './sheet';\r\nimport { Query } from './query';\r\nimport { Book } from './book';\r\nimport { History } from './history';\r\nimport { Map } from './map';\r\nimport { Pending } from './pending';\r\n//import { CreateBoxId, BoxId } from './tuid';\r\nimport { LocalMap, LocalCache, env, capitalCase } from '../tool';\r\n//import { ReactBoxId } from './tuid/reactBoxId';\r\nimport { UqEnum } from './enum';\r\nimport { Entity } from './entity';\r\nimport { ID, IX, IDX } from './ID';\r\nimport { IDCache } from './IDCache';\r\nimport { Web } from '../web';\r\n\r\nexport type FieldType = 'id' | 'tinyint' | 'smallint' | 'int' | 'bigint' | 'dec' | 'float' | 'double' | 'char' | 'text'\r\n    | 'datetime' | 'date' | 'time' | 'timestamp' | 'enum';\r\n\r\nexport function fieldDefaultValue(type:FieldType) {\r\n    switch (type) {\r\n        case 'tinyint':\r\n        case 'smallint':\r\n        case 'int':\r\n        case 'bigint':\r\n        case 'dec':\r\n\t\tcase 'float':\r\n\t\tcase 'double':\r\n\t\tcase 'enum':\r\n            return 0;\r\n        case 'char':\r\n        case 'text':\r\n            return '';\r\n        case 'datetime':\r\n        case 'date':\r\n            return '2000-1-1';\r\n        case 'time':\r\n            return '0:00';\r\n    }\r\n}\r\n\r\nexport interface Field {\r\n    name: string;\r\n    type: FieldType;\r\n    tuid?: string;\r\n    arr?: string;\r\n    null?: boolean;\r\n    size?: number;\r\n    owner?: string;\r\n    _tuid?: TuidBox;\r\n}\r\nexport interface ArrFields {\r\n    name: string;\r\n    fields: Field[];\r\n    id?: string;\r\n    order?: string;\r\n}\r\nexport interface FieldMap {\r\n    [name:string]: Field;\r\n}\r\nexport interface SchemaFrom {\r\n    owner:string;\r\n    uq:string;\r\n}\r\nexport interface TuidModify {\r\n    max: number;\r\n    seconds: number;\r\n}\r\n\r\ninterface ParamPage {\r\n\tstart:number;\r\n\tend?: number;\r\n\tsize:number;\r\n}\r\n\r\nexport interface ParamActIX<T> {\r\n\tIX: IX;\r\n\tID?: ID;\r\n\tIXs?:{IX:IX, ix:number}[];\t\t\t\t// 一次写入多个IX\r\n\tvalues: {ix:number, xi:number|T}[];\r\n}\r\n\r\nexport interface ParamActIXSort {\r\n\tIX: IX;\r\n\tix: number;\r\n\tid: number;\t\t\t\t\t// id to be moved\r\n\tafter: number;\t\t\t\t// insert after id. if before first, then 0\r\n}\r\n\r\nexport interface ParamActDetail<M,D> {\r\n\tmain: {\r\n\t\tID: ID;\r\n\t\tvalue: M;\r\n\t};\r\n\tdetail: {\r\n\t\tID: ID;\r\n\t\tvalues: D[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail {\r\n\tmain: number;\r\n\tdetail: number[];\r\n}\r\n\r\nexport interface ParamActDetail2<M,D,D2> extends ParamActDetail<M, D> {\r\n\tdetail2: {\r\n\t\tID: ID;\r\n\t\tvalues: D2[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail2 extends RetActDetail {\r\n\tdetail2: number[];\r\n}\r\n\r\nexport interface ParamActDetail3<M,D,D2,D3> extends ParamActDetail2<M, D, D2> {\r\n\tdetail3: {\r\n\t\tID: ID;\r\n\t\tvalues: D3[];\r\n\t};\r\n}\r\n\r\nexport interface RetActDetail3 extends RetActDetail2 {\r\n\tdetail3: number[];\r\n}\r\n\r\nexport interface ParamQueryID {\r\n\tID?: ID;\r\n\tIX?: (IX|string)[];\r\n\tIDX?: (ID|IDX)[];\r\n\tid?: number | number[];\r\n\tkey?: {[key:string]:string|number};\r\n\tix?: number;\r\n\tidx?: number | number[];\r\n\tkeyx?: {[key:string]:string|number};\r\n\tpage?: ParamPage;\r\n\torder?: 'desc'|'asc';\r\n}\r\n\r\nexport interface ParamIDNO {\r\n\tID: ID;\r\n}\r\n\r\nexport interface ParamIDDetailGet {\r\n\tid: number;\r\n\tmain: ID;\r\n\tdetail: ID;\r\n\tdetail2?: ID;\r\n\tdetail3?: ID;\r\n}\r\n\r\nexport interface ParamID {\r\n\tIDX: (ID|IDX) | (ID|IDX)[];\r\n\tid: number | number[];\r\n\torder?: 'asc' | 'desc',\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamKeyID {\r\n\tID: ID;\r\n\tIDX?: (ID|IDX)[];\r\n\tIX?: IX[];\r\n\tkey: {[key:string]:string|number};\r\n\tix?: number;\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIX {\r\n\tIX: IX;\r\n\tIX1?: IX;\r\n\tix: number | number[];\r\n\tIDX?: (ID|IDX)[];\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamKeyIX {\r\n\tID: ID;\r\n\tkey: {[key:string]:string|number};\r\n\tIX: IX;\r\n\tIDX?: (ID|IDX)[];\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIDLog {\r\n\tIDX: (ID|IDX);\r\n\tfield: string;\r\n\tid: number;\r\n\tlog: 'each' | 'day' | 'week' | 'month' | 'year';\r\n\ttimeZone?: number;\r\n\tfar?: number;\r\n\tnear?: number;\r\n\tpage: ParamPage;\r\n}\r\n\r\nexport interface ParamIDSum {\r\n\tIDX: IDX;\r\n\tfield: string[];\r\n\tid: number|number[];\r\n\tfar?: number;\t\t\t\t// 以前\r\n\tnear?: number;\t\t\t\t// 最近\r\n}\r\n\r\nexport interface ParamIDxID {\r\n\tID: ID;\r\n\tIX: IX;\r\n\tID2: ID;\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface IDXValue {\r\n\tvalue: number;\r\n\ttime?: number|Date;\r\n\tsetAdd: '='|'+';\r\n}\r\n\r\nexport interface ParamIDinIX {\r\n\tID: ID;\r\n\tid: number;\r\n\tIX: IX;\r\n\tpage?: ParamPage;\r\n}\r\n\r\nexport interface ParamIDTree {\r\n\tID: ID;\r\n\tparent: number;\r\n\tkey: string|number;\r\n\tlevel?: number;\t\t\t\t// 无值，默认1一级\r\n\tpage?: ParamPage;\r\n}\r\n\r\nfunction IDPath(path:string):string {return path;}\r\nenum EnumResultType {data, sql};\r\n\r\nexport interface Uq {\r\n\tgetAdmins(): Promise<{id:number; role:number}[]>;\r\n\t$: UqMan;\t\r\n\tActs(param:any): Promise<any>;\r\n\t$Acts(param:any): Promise<string>;\r\n\tActIX<T>(param: ParamActIX<T>): Promise<number[]>;\r\n\t$ActIX<T>(param: ParamActIX<T>): Promise<string>;\r\n\tActIXSort(param: ParamActIXSort): Promise<void>;\r\n\t$ActIXSort(param: ParamActIXSort): Promise<string>;\r\n\tActDetail<M,D>(param: ParamActDetail<M,D>): Promise<RetActDetail>;\r\n\t$ActDetail<M,D>(param: ParamActDetail<M,D>): Promise<string>;\r\n\tActDetail<M,D,D2>(param: ParamActDetail2<M,D,D2>): Promise<RetActDetail2>;\r\n\t$ActDetail<M,D,D2>(param: ParamActDetail2<M,D,D2>): Promise<string>;\r\n\tActDetail<M,D,D2,D3>(param: ParamActDetail3<M,D,D2,D3>): Promise<RetActDetail3>;\r\n\t$ActDetail<M,D,D2,D3>(param: ParamActDetail3<M,D,D2,D3>): Promise<string>;\r\n\tQueryID<T>(param: ParamQueryID): Promise<T[]>;\r\n\t$QueryID<T>(param: ParamQueryID): Promise<string>;\r\n\tIDNO(param: ParamIDNO): Promise<string>;\r\n\t$IDNO(param: ParamIDNO): Promise<string>;\r\n\tIDDetailGet<M,D>(param: ParamIDDetailGet): Promise<[M[], D[]]>;\r\n\t$IDDetailGet<M,D>(param: ParamIDDetailGet): Promise<string>;\r\n\tIDDetailGet<M,D,D2>(param: ParamIDDetailGet): Promise<[M[], D[], D2[]]>;\r\n\t$IDDetailGet<M,D,D2>(param: ParamIDDetailGet): Promise<string>;\r\n\tIDDetailGet<M,D,D2,D3>(param: ParamIDDetailGet): Promise<[M[], D[], D2[], D3[]]>;\r\n\t$IDDetailGet<M,D,D2,D3>(param: ParamIDDetailGet): Promise<string>;\r\n\tID<T>(param: ParamID): Promise<T[]>;\r\n\t$ID<T>(param: ParamID): Promise<string>;\r\n\tKeyID<T>(param: ParamKeyID): Promise<T[]>;\r\n\t$KeyID<T>(param: ParamKeyID): Promise<string>;\r\n\tIX<T>(param: ParamIX): Promise<T[]>;\r\n\t$IX<T>(param: ParamIX): Promise<string>;\r\n\tIXr<T> (param: ParamIX): Promise<T[]>; // IX id 反查IX list\r\n\t$IXr<T> (param: ParamIX): Promise<string>; // IX id 反查IX list\r\n\tKeyIX<T>(param: ParamKeyIX): Promise<T[]>;\r\n\t$KeyIX<T>(param: ParamKeyIX): Promise<string>;\r\n\tIDLog<T> (param: ParamIDLog): Promise<T[]>;\r\n\t$IDLog<T> (param: ParamIDLog): Promise<string>;\r\n\tIDSum<T> (param: ParamIDSum): Promise<T[]>;\r\n\t$IDSum<T> (param: ParamIDSum): Promise<string>;\r\n\tIDxID<T,T2> (param: ParamIDxID): Promise<[T[],T2[]]>; // ID list with IX 对应的子集\r\n\t$IDxID<T,T2> (param: ParamIDxID): Promise<string>; // ID list with IX 对应的子集\r\n\tIDinIX<T>(param:ParamIDinIX): Promise<T&{$in:boolean}[]>;\r\n\t$IDinIX<T>(param:ParamIDinIX): Promise<string>;\r\n\tIDTree<T>(param:ParamIDTree): Promise<T[]>;\r\n\t$IDTree<T>(param:ParamIDTree): Promise<string>;\r\n\r\n\tIDTv(ids: number[]): Promise<any[]>;\r\n\t/*\r\n\tIDRender(id: number, render?:(value:any) => JSX.Element): JSX.Element;\r\n\tIDV<T>(id: number): T;\r\n\r\n\tIDLocalTv(ids: number[]): Promise<any[]>;\r\n\tIDLocalRender(id: number, render?:(value:any) => JSX.Element): JSX.Element;\r\n\tIDLocalV<T>(id: number): T;\r\n\t*/\r\n}\r\n\r\nexport class UqMan {\r\n\treadonly entities: {[name:string]: Entity} = {};\r\n\tprivate readonly enums: {[name:string]: UqEnum} = {};\r\n\tprivate readonly actions: {[name:string]: Action} = {};\r\n    private readonly queries: {[name:string]: Query} = {};\r\n\treadonly ids: {[name:string]: ID} = {};\r\n\tprivate readonly idxs: {[name:string]: IDX} = {};\r\n\tprivate readonly ixs: {[name:string]: IX} = {};\r\n\r\n    private readonly sheets: {[name:string]: Sheet} = {};\r\n    private readonly books: {[name:string]: Book} = {};\r\n    private readonly maps: {[name:string]: Map} = {};\r\n    private readonly histories: {[name:string]: History} = {};\r\n\tprivate readonly pendings: {[name:string]: Pending} = {};\r\n    private readonly tuidsCache: TuidsCache;\r\n    private readonly localEntities: LocalCache;\r\n    //private readonly tvs:{[entity:string]:(values:any)=>JSX.Element};\r\n\tidCache: IDCache;\r\n\tproxy: any;\r\n    readonly localMap: LocalMap;\r\n    readonly localModifyMax: LocalCache;\r\n    readonly tuids: {[name:string]: Tuid} = {};\r\n    //readonly createBoxId: CreateBoxId;\r\n    readonly newVersion: boolean;\r\n    readonly uqOwner: string;\r\n    readonly uqName: string;\r\n    readonly name: string;\r\n    readonly uqApi: UqApi;\r\n\treadonly id: number;\r\n\treadonly tonva: Tonva;\r\n\treadonly web: Web;\r\n\r\n    uqVersion: number;\r\n\tconfig: UqConfig;\r\n\r\n    constructor(tonva: Tonva, uqData: UqData/*, createBoxId:CreateBoxId, tvs:{[entity:string]:(values:any)=>JSX.Element}*/) {\r\n\t\tthis.tonva = tonva;\r\n\t\tthis.web = tonva.web;\r\n        //this.createBoxId = createBoxId;\r\n\t\t/*\r\n        if (createBoxId === undefined) {\r\n            this.createBoxId = this.createBoxIdFromTVs;\r\n            this.tvs = tvs || {};\r\n        }\r\n\t\t*/\r\n        let {id, uqOwner, uqName, /*access, */newVersion} = uqData;\r\n        this.newVersion = newVersion;\r\n        this.uqOwner = uqOwner;\r\n        this.uqName = uqName;\r\n        this.id = id;\r\n        this.name = uqOwner + '/' + uqName;\r\n        this.uqVersion = 0;\r\n\t\tthis.localMap = env.localDb.map(this.name);\r\n        this.localModifyMax = this.localMap.child('$modifyMax');\r\n        this.localEntities = this.localMap.child('$access');\r\n        let baseUrl = 'tv/';\r\n\r\n        if (this.name === '$$$/$unitx') {\r\n            // 这里假定，点击home link之后，已经设置unit了\r\n            // 调用 UnitxApi会自动搜索绑定 unitx service\r\n            this.uqApi = new UnitxApi(this.web, env.unit);\r\n        }\r\n        else {\r\n            this.uqApi = new UqApi(this.web, baseUrl, uqOwner, uqName, true);\r\n        }\r\n        this.tuidsCache = new TuidsCache(this);\r\n    }\r\n\r\n\tgetID(name:string):ID {return this.ids[name.toLowerCase()];};\r\n\tgetIDX(name:string):IDX {return this.idxs[name.toLowerCase()];};\r\n\tgetIX(name:string):IX {return this.ixs[name.toLowerCase()];};\r\n\r\n\t/*\r\n    private createBoxIdFromTVs:CreateBoxId = (tuid:Tuid, id:number):BoxId =>{\r\n        let {name} = tuid;\r\n        return new ReactBoxId(id, tuid, this.tvs[name]);\r\n\t}\r\n\t*/\r\n\t\r\n\tprivate roles:string[];\r\n\tasync getRoles():Promise<string[]> {\r\n\t\tif (this.roles !== undefined) return this.roles;\r\n\t\tthis.roles = await this.uqApi.getRoles();\r\n\t\treturn this.roles;\r\n\t}\r\n\r\n    tuid(name:string):Tuid {return this.tuids[name.toLowerCase()]}\r\n    tuidDiv(name:string, div:string):TuidDiv {\r\n        let tuid = this.tuids[name.toLowerCase()]\r\n        return tuid && tuid.div(div.toLowerCase());\r\n    }\r\n    action(name:string):Action {return this.actions[name.toLowerCase()]}\r\n    sheet(name:string):Sheet {return this.sheets[name.toLowerCase()]}\r\n    query(name:string):Query {return this.queries[name.toLowerCase()]}\r\n    book(name:string):Book {return this.books[name.toLowerCase()]}\r\n    map(name:string):Map {return this.maps[name.toLowerCase()]}\r\n    history(name:string):History {return this.histories[name.toLowerCase()]}\r\n    pending(name:string):Pending {return this.pendings[name.toLowerCase()]}\r\n\r\n    sheetFromTypeId(typeId:number):Sheet {\r\n        for (let i in this.sheets) {\r\n            let sheet = this.sheets[i];\r\n            if (sheet.typeId === typeId) return sheet;\r\n        }\r\n    }\r\n\r\n\tallRoles: string[];\r\n    readonly tuidArr: Tuid[] = [];\r\n    readonly actionArr: Action[] = [];\r\n    readonly queryArr: Query[] = [];\r\n    readonly idArr: ID[] = [];\r\n    readonly idxArr: IDX[] = [];\r\n    readonly ixArr: IX[] = [];\r\n    readonly enumArr: UqEnum[] = [];\r\n    readonly sheetArr: Sheet[] = [];\r\n    readonly bookArr: Book[] = [];\r\n    readonly mapArr: Map[] = [];\r\n    readonly historyArr: History[] = [];\r\n    readonly pendingArr: Pending[] = [];\r\n\r\n    async init() {\r\n        await this.uqApi.init();\r\n    }\r\n\r\n    async loadEntities(): Promise<string> {\r\n        try {\r\n            let entities = this.localEntities.get();\r\n            if (!entities) {\r\n                entities = await this.uqApi.loadEntities();\r\n\t\t\t}\r\n            if (!entities) return;\r\n            this.buildEntities(entities);\r\n        }\r\n        catch (err) {\r\n            return err as any;\r\n        }\r\n    }\r\n\r\n\tbuildEntities(entities:any) {\r\n        if (entities === undefined) {\r\n            debugger;\r\n        }\r\n        this.localEntities.set(entities);\r\n        let {access, tuids, role, version} = entities;\r\n\t\tthis.uqVersion = version;\r\n\t\tthis.allRoles = role?.names;\r\n        this.buildTuids(tuids);\r\n\t\tthis.buildAccess(access);\r\n\t}\r\n\t\r\n    private buildTuids(tuids:any) {\r\n        for (let i in tuids) {\r\n            let schema = tuids[i];\r\n            let {typeId, from} = schema;\r\n            let tuid = this.newTuid(i, typeId, from);\r\n            tuid.sys = true;\r\n        }\r\n        for (let i in tuids) {\r\n            let schema = tuids[i];\r\n            let tuid = this.getTuid(i);\r\n            tuid.setSchema(schema);\r\n        }\r\n        for (let i in this.tuids) {\r\n            let tuid = this.tuids[i];\r\n            tuid.buildFieldsTuid();\r\n        }\r\n\t}\r\n\r\n    async loadEntitySchema(entityName: string): Promise<any> {\r\n        return await this.uqApi.schema(entityName);\r\n    }\r\n\r\n\tasync loadAllSchemas():Promise<void> {\r\n\t\tlet ret = await this.uqApi.allSchemas();\r\n\t\tlet entities: Entity[][] = [\r\n\t\t\tthis.actionArr, \r\n\t\t\tthis.enumArr,\r\n\t\t\tthis.sheetArr,\r\n\t\t\tthis.queryArr,\r\n\t\t\tthis.bookArr,\r\n\t\t\tthis.mapArr,\r\n\t\t\tthis.historyArr,\r\n\t\t\tthis.pendingArr,\r\n\t\t\tthis.idArr,\r\n\t\t\tthis.idxArr,\r\n\t\t\tthis.ixArr,\r\n\t\t];\r\n\t\tentities.forEach(arr => {\r\n\t\t\tarr.forEach(v => {\r\n\t\t\t\tlet entity = ret[v.name.toLowerCase()];\r\n\t\t\t\tif (!entity) return;\r\n\t\t\t\tlet schema = entity.call;\r\n\t\t\t\tif (!schema) return;\r\n\t\t\t\tv.buildSchema(schema);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n    getTuid(name:string): Tuid {\r\n        return this.tuids[name];\r\n    }\r\n\r\n    private buildAccess(access:any) {\r\n        for (let a in access) {\r\n            let v = access[a];\r\n            switch (typeof v) {\r\n                case 'string': this.fromType(a, v); break;\r\n                case 'object': this.fromObj(a, v); break;\r\n            }\r\n        }\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.tuidsCache.cacheTuids(defer);\r\n    }\r\n\r\n\tprivate setEntity(name:string, entity:Entity) {\r\n\t\tthis.entities[name] = entity;\r\n\t\tthis.entities[name.toLowerCase()] = entity;\r\n\t}\r\n\r\n    newEnum(name:string, id:number):UqEnum {\r\n        let enm = this.enums[name];\r\n        if (enm !== undefined) return enm;\r\n\t\tenm = this.enums[name] = new UqEnum(this, name, id);\r\n\t\tthis.setEntity(name, enm);\r\n        this.enumArr.push(enm);\r\n        return enm;\r\n    }\r\n\tnewAction(name:string, id:number):Action {\r\n        let action = this.actions[name];\r\n        if (action !== undefined) return action;\r\n        action = this.actions[name] = new Action(this, name, id);\r\n\t\tthis.setEntity(name, action);\r\n        this.actionArr.push(action);\r\n        return action;\r\n    }\r\n    private newTuid(name:string, id:number, from:SchemaFrom):Tuid {\r\n        let tuid = this.tuids[name];\r\n        if (tuid !== undefined) return tuid;\r\n        if (from !== undefined)\r\n            tuid = new TuidImport(this, name, id, from);\r\n        else\r\n            tuid = new TuidInner(this, name, id);\r\n        this.tuids[name] = tuid;\r\n\t\tthis.setEntity(name, tuid);\r\n        this.tuidArr.push(tuid);\r\n        return tuid;\r\n    }\r\n    newQuery(name:string, id:number):Query {\r\n        let query = this.queries[name];\r\n        if (query !== undefined) return query;\r\n        query = this.queries[name] = new Query(this, name, id)\r\n\t\tthis.setEntity(name, query);\r\n        this.queryArr.push(query);\r\n        return query;\r\n    }\r\n    private newBook(name:string, id:number):Book {\r\n        let book = this.books[name];\r\n        if (book !== undefined) return book;\r\n        book = this.books[name] = new Book(this, name, id);\r\n\t\tthis.setEntity(name, book);\r\n        this.bookArr.push(book);\r\n        return book;\r\n    }\r\n    private newMap(name:string, id:number):Map {\r\n        let map = this.maps[name];\r\n        if (map !== undefined) return map;\r\n        map = this.maps[name] = new Map(this, name, id)\r\n\t\tthis.setEntity(name, map);\r\n        this.mapArr.push(map);\r\n        return map;\r\n    }\r\n    private newHistory(name:string, id:number):History {\r\n        let history = this.histories[name];\r\n        if (history !== undefined) return;\r\n        history = this.histories[name] = new History(this, name, id)\r\n\t\tthis.setEntity(name, history);\r\n        this.historyArr.push(history);\r\n        return history;\r\n    }\r\n    private newPending(name:string, id:number):Pending {\r\n        let pending = this.pendings[name];\r\n        if (pending !== undefined) return;\r\n        pending = this.pendings[name] = new Pending(this, name, id)\r\n\t\tthis.setEntity(name, pending);\r\n        this.pendingArr.push(pending);\r\n        return pending;\r\n    }\r\n    private newSheet(name:string, id:number):Sheet {\r\n        let sheet = this.sheets[name];\r\n        if (sheet !== undefined) return sheet;\r\n        sheet = this.sheets[name] = new Sheet(this, name, id);\r\n\t\tthis.setEntity(name, sheet);\r\n        this.sheetArr.push(sheet);\r\n        return sheet;\r\n    }\r\n    private newID(name:string, id:number):ID {\r\n\t\tlet lName = name.toLowerCase();\r\n        let idEntity = this.ids[lName];\r\n        if (idEntity !== undefined) return idEntity;\r\n        idEntity = this.ids[lName] = new ID(this, name, id);\r\n\t\tthis.setEntity(name, idEntity);\r\n        this.idArr.push(idEntity);\r\n        return idEntity;\r\n    }\r\n    private newIDX(name:string, id:number):IDX {\r\n\t\tlet lName = name.toLowerCase();\r\n        let idx = this.idxs[lName];\r\n        if (idx !== undefined) return idx;\r\n        idx = this.idxs[lName] = new IDX(this, name, id);\r\n\t\tthis.setEntity(name, idx);\r\n        this.idxArr.push(idx);\r\n        return idx;\r\n    }\r\n    private newIX(name:string, id:number):IX {\r\n\t\tlet lName = name.toLowerCase();\r\n        let ix = this.ixs[lName];\r\n        if (ix !== undefined) return ix;\r\n        ix = this.ixs[lName] = new IX(this, name, id);\r\n\t\tthis.setEntity(name, ix);\r\n        this.ixArr.push(ix);\r\n        return ix;\r\n    }\r\n    private fromType(name:string, type:string) {\r\n        let parts = type.split('|');\r\n        type = parts[0];\r\n        let id = Number(parts[1]);\r\n        switch (type) {\r\n            //case 'uq': this.id = id; break;\r\n            case 'tuid':\r\n                // Tuid should not be created here!;\r\n                //let tuid = this.newTuid(name, id);\r\n                //tuid.sys = false;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'id': this.newID(name, id); break;\r\n\t\t\tcase 'idx': this.newIDX(name, id); break;\r\n\t\t\tcase 'ix': this.newIX(name, id); break;\r\n            case 'action': this.newAction(name, id); break;\r\n            case 'query': this.newQuery(name, id); break;\r\n            case 'book': this.newBook(name, id); break;\r\n            case 'map': this.newMap(name, id); break;\r\n            case 'history': this.newHistory(name, id); break;\r\n            case 'sheet':this.newSheet(name, id); break;\r\n\t\t\tcase 'pending': this.newPending(name, id); break;\r\n\t\t\tcase 'enum': this.newEnum(name, id); break;\r\n        }\r\n    }\r\n    private fromObj(name:string, obj:any) {\r\n        switch (obj['$']) {\r\n            case 'sheet': this.buildSheet(name, obj); break;\r\n        }\r\n    }\r\n    private buildSheet(name:string, obj:any) {\r\n        let sheet = this.sheets[name];\r\n        if (sheet === undefined) sheet = this.newSheet(name, obj.id);\r\n        sheet.build(obj);\r\n    }\r\n    buildFieldTuid(fields:Field[], mainFields?:Field[]) {\r\n        if (fields === undefined) return;\r\n        for (let f of fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            f._tuid = t.buildTuidBox();\r\n        }\r\n        for (let f of fields) {\r\n            let {owner} = f;\r\n            if (owner === undefined) continue;\r\n            let ownerField = fields.find(v => v.name === owner);\r\n            if (ownerField === undefined) {\r\n                if (mainFields !== undefined) {\r\n                    ownerField = mainFields.find(v => v.name === owner);\r\n                }\r\n                if (ownerField === undefined) {\r\n                    debugger;\r\n                    throw new Error(`owner field ${owner} is undefined`);\r\n                }\r\n            }\r\n            let {arr, tuid} = f;\r\n            let t = this.getTuid(ownerField._tuid.tuid.name);\r\n            if (t === undefined) continue;\r\n            let div = t.div(arr || tuid);\r\n            f._tuid = div && div.buildTuidDivBox(ownerField);\r\n\t\t\t/*\r\n            if (f._tuid === undefined) {\r\n                debugger;\r\n                throw new Error(`owner field ${owner} is not tuid`);\r\n            }\r\n\t\t\t*/\r\n        }\r\n    }\r\n    buildArrFieldsTuid(arrFields:ArrFields[], mainFields:Field[]) {\r\n        if (arrFields === undefined) return;\r\n        for (let af of arrFields) {\r\n            let {fields} = af;\r\n            if (fields === undefined) continue;\r\n            this.buildFieldTuid(fields, mainFields);\r\n        }\r\n    }\r\n\r\n    pullModify(modifyMax:number) {\r\n        this.tuidsCache.pullModify(modifyMax);\r\n\t}\r\n\r\n\tgetUqKey() {\r\n\t\tlet uqKey:string = this.uqName.split(/[-._]/).join('').toLowerCase();\r\n\t\treturn uqKey;\r\n\t}\r\n\r\n\tgetUqKeyWithConfig() {\r\n\t\tif (!this.config) return;\r\n\t\tlet uqKey:string = this.uqName.split(/[-._]/).join('').toLowerCase();\r\n\t\tlet {dev, alias} = this.config;\r\n\t\tuqKey = capitalCase(dev.alias || dev.name) + capitalCase(alias??uqKey);\r\n\t\treturn uqKey;\r\n\t}\r\n\r\n\thasEntity(name: string):boolean {\r\n\t\treturn this.entities[name] !== undefined\r\n\t\t\t|| this.entities[name.toLowerCase()] !== undefined;\r\n\t}\r\n\r\n\tcreateProxy():any {\r\n\t\tlet ret = new Proxy(this.entities, {\r\n\t\t\tget: (target, key, receiver) => {\r\n\t\t\t\tlet lk = (key as string).toLowerCase();\r\n\t\t\t\tif (lk === '$') {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\t\t\t\tlet ret = target[lk];\r\n\t\t\t\tif (ret !== undefined) return ret;\r\n\t\t\t\tlet func = (this as any)[key];\r\n\t\t\t\tif (func !== undefined) return func;\r\n\t\t\t\tlet err = `entity ${this.name}.${String(key)} not defined`;\r\n\t\t\t\tconsole.error('UQ错误：' + err);\r\n\t\t\t\tthis.showReload('服务器正在更新');\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.proxy = ret;\r\n\t\tthis.idCache = new IDCache(this);\r\n\t\treturn ret;\r\n\t}\r\n\r\n    private showReload(msg: string) {\r\n\t\tlet cache = this.localMap.child('$reload-tick');\r\n\t\tlet reloadTick = cache.get();\r\n\t\tif (!reloadTick) reloadTick = 0;\r\n\t\tconsole.error(msg);\r\n\t\tthis.localMap.removeAll();\r\n\t\tlet tick = Date.now();\r\n\t\tcache.set(tick);\r\n\t\tif (tick - reloadTick  < 10*1000)  {\r\n\t\t\tthis.web.showReloadPage(msg);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.web.reload();\r\n\t\t}\r\n    }\r\n\r\n\tprivate async apiPost(api:string, resultType: EnumResultType, apiParam: any): Promise<any> {\r\n\t\tif (resultType === EnumResultType.sql) api = 'sql-' + api;\r\n\t\tlet ret = await this.uqApi.post(IDPath(api), apiParam);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate async apiActs(param: any, resultType: EnumResultType): Promise<any> {\r\n\t\t// 这边的obj属性序列，也许会不一样\r\n\t\tlet arr:string[] = [];\r\n\t\tlet apiParam:any = {};\r\n\t\tfor (let i in param) {\r\n\t\t\tarr.push(i);\r\n\t\t\tapiParam[i] = (param[i] as any[]).map(v => {\r\n\t\t\t\tlet obj:any = {};\r\n\t\t\t\tfor (let j in v) {\r\n\t\t\t\t\tlet val = v[j];\r\n\t\t\t\t\tif (typeof val === 'object') {\r\n\t\t\t\t\t\tlet nv:any = {};\r\n\t\t\t\t\t\tfor (let n in val) {\r\n\t\t\t\t\t\t\tlet tv = val[n];\r\n\t\t\t\t\t\t\tif (tv && typeof tv === 'object') {\r\n\t\t\t\t\t\t\t\tif (n === 'time') {\r\n\t\t\t\t\t\t\t\t\tif (Object.prototype.toString.call(tv) === '[object Date]') {\r\n\t\t\t\t\t\t\t\t\t\ttv = (tv as Date).getTime();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tlet id = tv['id'];\r\n\t\t\t\t\t\t\t\t\ttv = id;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tnv[n] = tv;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tobj[j] = nv;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tobj[j] = val;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn obj;\r\n\t\t\t});\r\n\t\t}\r\n\t\tapiParam['$'] = arr;\r\n\t\tlet ret = await this.apiPost('acts', resultType,  apiParam);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected Acts = async (param:any): Promise<any> => {\r\n\t\t//let apiParam = this.ActsApiParam(param);\r\n\t\tlet ret = await this.apiActs(param, EnumResultType.data); // await this.apiPost('acts', apiParam);\r\n\t\tlet retArr = (ret[0].ret as string).split('\\n');\r\n\t\tlet arr:string[] = [];\r\n\t\tfor (let i in param) arr.push(i);\r\n\t\tlet retActs:{[key:string]:number[]} = {};\r\n\t\tfor (let i=0; i<arr.length; i++) {\r\n\t\t\tretActs[arr[i]] = ids(retArr[i].split('\\t'));\r\n\t\t}\r\n\t\treturn retActs;\r\n\t}\r\n\r\n\tprotected getAdmins = async(): Promise<{id:number; role:number}[]> => {\r\n\t\treturn await this.uqApi.getAdmins();\r\n\t}\r\n\r\n\tprotected $Acts = async (param:any): Promise<any> => {\r\n\t\treturn await this.apiActs(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiActIX(param: any, resultType: EnumResultType): Promise<any> {\r\n\t\tlet {IX, ID, values, IXs} = param;\r\n\t\tlet apiParam:any = {\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIXs: IXs?.map((v: any) => ({IX:entityName(v.IX), ix:v.ix})),\r\n\t\t\tvalues,\r\n\t\t};\r\n\t\tlet ret = await this.apiPost('act-ix', resultType, apiParam);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected ActIX = async (param: ParamActIX<any>): Promise<number[]> => {\r\n\t\t/*\r\n\t\tlet {IX, ID, values, IXs} = param;\r\n\t\tlet apiParam:any = {\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIXs: IXs?.map(v => ({IX:entityName(v.IX), ix:v.ix})),\r\n\t\t\tvalues,\r\n\t\t};\r\n\t\tlet ret = await this.apiPost('act-ix'), apiParam);\r\n\t\t*/\r\n\t\tlet ret = await this.apiActIX(param, EnumResultType.data);\r\n\t\treturn (ret[0].ret as string).split('\\t').map(v => Number(v));\r\n\t}\r\n\r\n\tprotected $ActIX = async (param: ParamActIX<any>): Promise<string> => {\r\n\t\tlet ret = await this.apiActIX(param, EnumResultType.sql);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate async apiActIxSort(param: ParamActIXSort, resultType: EnumResultType): Promise<any> {\r\n\t\tlet {IX, ix, id, after} = param;\r\n\t\tlet apiParam:any = {\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tix,\r\n\t\t\tid,\r\n\t\t\tafter,\r\n\t\t};\r\n\t\treturn await this.apiPost('act-ix-sort', resultType, apiParam);\r\n\t}\r\n\r\n\tprotected ActIXSort = async (param: ParamActIXSort): Promise<void> => {\r\n\t\t/*\r\n\t\tlet {IX, ix, id, after} = param;\r\n\t\tlet apiParam:any = {\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tix,\r\n\t\t\tid,\r\n\t\t\tafter,\r\n\t\t};\r\n\t\tawait this.apiPost('act-ix-sort'), apiParam);\r\n\t\t*/\r\n\t\treturn await this.apiActIxSort(param, EnumResultType.data);\r\n\t}\r\n\r\n\tprotected $ActIXSort = async (param: ParamActIXSort): Promise<string> => {\r\n\t\treturn await this.apiActIxSort(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiActDetail(param: ParamActDetail<any, any>, resultType: EnumResultType): Promise<any> {\r\n\t\tlet {main, detail, detail2, detail3} = param as unknown as ParamActDetail3<any, any, any, any>;\r\n\t\tlet postParam:any = {\r\n\t\t\tmain: {\r\n\t\t\t\tname: entityName(main.ID),\r\n\t\t\t\tvalue: toScalars(main.value),\r\n\t\t\t},\r\n\t\t\tdetail: {\r\n\t\t\t\tname: entityName(detail.ID),\r\n\t\t\t\tvalues: detail.values?.map(v => toScalars(v)),\r\n\t\t\t},\r\n\t\t}\r\n\t\tif (detail2) {\r\n\t\t\tpostParam.detail2 = {\r\n\t\t\t\tname: entityName(detail2.ID),\r\n\t\t\t\tvalues: detail2.values?.map(v => toScalars(v)),\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (detail3) {\r\n\t\t\tpostParam.detail3 = {\r\n\t\t\t\tname: entityName(detail3.ID),\r\n\t\t\t\tvalues: detail3.values?.map(v => toScalars(v)),\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet ret = await this.apiPost('act-detail', resultType, postParam);\r\n\t}\r\n\r\n\tprotected ActDetail = async (param: ParamActDetail<any, any>) => {\r\n\t\tlet ret = await this.apiActDetail(param, EnumResultType.data);\r\n\t\tlet val:string = ret[0].ret;\r\n\t\tlet parts = val.split('\\n');\r\n\t\tlet items = parts.map(v => v.split('\\t'));\r\n\t\tret = {\r\n\t\t\tmain: ids(items[0])[0],\r\n\t\t\tdetail: ids(items[1]),\r\n\t\t\tdetail2: ids(items[2]),\r\n\t\t\tdetail3: ids(items[3]),\r\n\t\t};\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected $ActDetail = async (param: ParamActDetail<any, any>) => {\r\n\t\treturn await this.apiActDetail(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiQueryID(param: ParamQueryID, resultType: EnumResultType): Promise<any[]> {\r\n\t\tlet {ID, IX, IDX} = param;\r\n\t\tlet ret = await this.apiPost('query-id', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: IX?.map(v => entityName(v)),\r\n\t\t\tIDX: this.IDXToString(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected QueryID = async (param: ParamQueryID) => {\r\n\t\treturn await this.apiQueryID(param, EnumResultType.data);\r\n\t}\r\n\r\n\tprotected $QueryID = async (param: ParamQueryID) => {\r\n\t\treturn await this.apiQueryID(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDTv(ids: number[], resultType: EnumResultType): Promise<any[]> {\t\t\r\n\t\tlet ret = await this.apiPost('id-tv', resultType, ids);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tIDTv = async (ids: number[]): Promise<any[]> => {\r\n\t\tlet ret = await this.apiIDTv(ids, EnumResultType.data);\r\n\t\tlet retValues: any[] = [];\r\n\t\tfor (let row of ret) {\r\n\t\t\tlet {$type, $tv} = row;\r\n\t\t\tif (!$tv) continue;\r\n\t\t\tlet ID = this.ids[$type];\r\n\t\t\tif (!ID) continue;\r\n\t\t\tlet {schema} = ID;\r\n\t\t\tif (!schema) {\r\n\t\t\t\tawait ID.loadSchema();\r\n\t\t\t\tschema = ID.schema;\r\n\t\t\t}\r\n\t\t\tlet {nameNoVice} = schema;\r\n\t\t\tif (!nameNoVice) continue;\r\n\t\t\tlet values = ($tv as string).split('\\n');\r\n\t\t\tlet len = nameNoVice.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet p = nameNoVice[i];\r\n\t\t\t\trow[p] = values[i];\r\n\t\t\t}\r\n\t\t\tdelete row.$tv;\r\n\t\t\tretValues.push(row);\r\n\t\t}\r\n\t\treturn retValues;\r\n\t}\r\n\r\n\tprotected $IDTv = async (ids: number[]): Promise<any> => {\r\n\t\treturn await this.apiIDTv(ids, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDNO(param: ParamIDNO, resultType: EnumResultType): Promise<string> {\r\n\t\tlet {ID} = param;\r\n\t\tlet ret = await this.apiPost('id-no', resultType, {ID: entityName(ID)});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected IDNO = async (param: ParamIDNO): Promise<string> => {\r\n\t\treturn await this.apiIDNO(param, EnumResultType.data);\r\n\t}\r\n\r\n\tprotected $IDNO = async (param: ParamIDNO): Promise<string> => {\r\n\t\treturn await this.apiIDNO(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDDetailGet(param: ParamIDDetailGet, resultType: EnumResultType): Promise<any> {\r\n\t\tlet {id, main, detail, detail2, detail3} = param;\r\n\t\tlet ret = await this.apiPost('id-detail-get', resultType, {\r\n\t\t\tid,\r\n\t\t\tmain: entityName(main),\r\n\t\t\tdetail: entityName(detail),\r\n\t\t\tdetail2: entityName(detail2),\r\n\t\t\tdetail3: entityName(detail3),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tIDDetailGet = async (param: ParamIDDetailGet): Promise<any> => {\r\n\t\treturn await this.apiIDDetailGet(param, EnumResultType.data);\r\n\t}\r\n\r\n\tprotected $IDDetailGet = async (param: ParamIDDetailGet): Promise<any> => {\r\n\t\treturn await this.apiIDDetailGet(param, EnumResultType.sql);\r\n\t}\r\n\r\n\t//private checkParam(ID:ID, IDX:(ID|IDX)|(ID|IDX)[], IX:IX, id:number|number[], key:{[key:string]:string|number}, page: ParamPage) {\r\n\t//}\r\n\tprivate IDXToString(p:ID|IDX|((ID|IDX)[])):string|string[] {\r\n\t\tif (Array.isArray(p) === true) return (p as (ID|IDX)[]).map(v => entityName(v));\r\n\t\treturn entityName(p as ID|IDX);\r\n\t}\r\n\tprivate async apiID(param: ParamID, resultType: EnumResultType): Promise<any> {\r\n\t\tlet {IDX} = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.apiPost('id', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIDX: this.IDXToString(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected  ID = async (param: ParamID): Promise<any[]> => {\r\n\t\treturn await this.apiID(param, EnumResultType.data);\r\n\t}\r\n\tprotected  $ID = async (param: ParamID): Promise<string> => {\r\n\t\treturn await this.apiID(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiKeyID(param: ParamKeyID, resultType: EnumResultType): Promise<any> {\r\n\t\tlet {ID, IDX} = param;\r\n\t\t//this.checkParam(null, IDX, null, null, key, page);\r\n\t\tlet ret = await this.apiPost('key-id', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected KeyID = async (param: ParamKeyID): Promise<any[]> => {\r\n\t\treturn await this.apiKeyID(param, EnumResultType.data);\r\n\t}\r\n\tprotected $KeyID = async (param: ParamKeyID): Promise<string> => {\r\n\t\treturn await this.apiKeyID(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIX(param: ParamIX, resultType: EnumResultType): Promise<any> {\r\n\t\tlet {IX, IX1, IDX} = param;\r\n\t\t//this.checkParam(null, IDX, IX, id, null, page);\r\n\t\tlet ret = await this.apiPost('ix', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIX1: entityName(IX1),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IX = async (param: ParamIX): Promise<any[]> => {\r\n\t\treturn await this.apiIX(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IX = async (param: ParamIX): Promise<string> => {\r\n\t\treturn await this.apiIX(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIXr(param: ParamIX, resultType: EnumResultType): Promise<any> {\r\n\t\tlet {IX, IX1, IDX} = param;\r\n\t\t//this.checkParam(null, IDX, IX, id, null, page);\r\n\t\tlet ret = await this.apiPost('ixr', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIX1: entityName(IX1),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IXr = async (param: ParamIX): Promise<any[]> => {\r\n\t\treturn await this.apiIXr(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IXr = async (param: ParamIX): Promise<any[]> => {\r\n\t\treturn await this.apiIXr(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiKeyIX(param: ParamKeyIX, resultType: EnumResultType): Promise<any> {\r\n\t\tlet {ID, IX, IDX} = param;\r\n\t\t//this.checkParam(ID, IDX, IX, null, key, page);\r\n\t\tlet ret = await this.apiPost('key-ix', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tIDX: IDX?.map(v => entityName(v)),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected KeyIX = async (param: ParamKeyIX): Promise<any[]> => {\r\n\t\treturn await this.apiKeyIX(param, EnumResultType.data);\r\n\t}\r\n\tprotected $KeyIX = async (param: ParamKeyIX): Promise<any[]> => {\r\n\t\treturn await this.apiKeyIX(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDLog(param: ParamIDLog, resultType: EnumResultType): Promise<any> {\r\n\t\tlet {IDX} = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.apiPost('id-log', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIDX: entityName(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IDLog = async (param: ParamIDLog): Promise<any[]> => {\r\n\t\treturn await this.apiIDLog(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IDLog = async (param: ParamIDLog): Promise<string> => {\r\n\t\treturn await this.apiIDLog(param, EnumResultType.sql);\r\n\t}\r\n\t\r\n\tprivate async apiIDSum(param: ParamIDSum, resultType: EnumResultType): Promise<any> {\r\n\t\tlet {IDX} = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.apiPost('id-sum', resultType, {\r\n\t\t\t...param,\r\n\t\t\tIDX: entityName(IDX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IDSum = async (param: ParamIDSum): Promise<any[]> => {\r\n\t\treturn await this.apiIDSum(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IDSum = async (param: ParamIDSum): Promise<string> => {\r\n\t\treturn await this.apiIDSum(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDinIX(param:ParamIDinIX, resultType: EnumResultType): Promise<any> {\r\n\t\tlet {ID, IX} = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.apiPost('id-in-ix', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IDinIX = async (param:ParamIDinIX): Promise<any|{$in:boolean}[]> => {\r\n\t\treturn await this.apiIDinIX(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IDinIX = async (param:ParamIDinIX): Promise<string> => {\r\n\t\treturn await this.apiIDinIX(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDxID(param:ParamIDxID,resultType: EnumResultType): Promise<any> {\r\n\t\tlet {ID, IX, ID2} = param;\r\n\t\t//this.checkParam(null, IDX, null, id, null, page);\r\n\t\tlet ret = await this.apiPost('id-x-id', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t\tIX: entityName(IX),\r\n\t\t\tID2: entityName(ID2),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IDxID = async (param:ParamIDxID): Promise<any[]> => {\r\n\t\treturn await this.apiIDxID(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IDxID = async (param:ParamIDxID): Promise<string> => {\r\n\t\treturn await this.apiIDxID(param, EnumResultType.sql);\r\n\t}\r\n\r\n\tprivate async apiIDTree(param:ParamIDTree, resultType: EnumResultType): Promise<any> {\r\n\t\tlet {ID} = param;\r\n\t\tlet ret = await this.apiPost('id-tree', resultType, {\r\n\t\t\t...param,\r\n\t\t\tID: entityName(ID),\r\n\t\t});\r\n\t\treturn ret;\r\n\t}\r\n\tprotected IDTree = async (param:ParamIDTree): Promise<any[]> => {\r\n\t\treturn await this.apiIDTree(param, EnumResultType.data);\r\n\t}\r\n\tprotected $IDTree = async (param:ParamIDTree): Promise<string> => {\r\n\t\treturn await this.apiIDTree(param, EnumResultType.sql);\r\n\t}\r\n}\r\n\r\nfunction ids(item:string[]):number[] {\r\n\tif (!item) return;\r\n\tlet len = item.length;\r\n\tif (len <= 1) return;\r\n\tlet ret:number[] = [];\r\n\tfor (let i=0; i<len-1; i++) ret.push(Number(item[i]));\r\n\treturn ret;\r\n}\r\n\r\nfunction entityName(entity:Entity | string): string {\r\n\tif (!entity) return;\r\n\tif (typeof entity === 'string') return entity;\r\n\treturn entity.name;\r\n}\r\n\r\nfunction toScalars(value:any):any {\r\n\tif (!value) return value;\r\n\tlet ret:any = {};\r\n\tfor (let i in value) {\r\n\t\tlet v = value[i];\r\n\t\tif (typeof v === 'object') v = v['id'];\r\n\t\tret[i] = v;\r\n\t}\r\n\treturn ret;\r\n}","import { UQsBuildingLoader } from \"../uqCore\";\r\nimport { TsTemplate } from \"./TsTemplate\";\r\n\r\nexport abstract class UqBuildContext {\r\n\treadonly uqsLoader: UQsBuildingLoader;\r\n\treadonly uqTsSrcPath: string;\r\n\treadonly tsTemplate: TsTemplate;\r\n\r\n\tconstructor(uqsLoader: UQsBuildingLoader, uqTsSrcPath: string) {\r\n\t\tthis.uqsLoader = uqsLoader;\r\n\t\tthis.uqTsSrcPath = uqTsSrcPath;\r\n\t\tthis.tsTemplate = new TsTemplate(this);\r\n\t}\r\n\r\n\tabstract get uiPlatform():string;\r\n\tabstract get uiPlatformUpper():string;\r\n\tabstract get uiPlatformCamel():string;\r\n\tabstract get element(): string;\r\n}\r\n","import { UqApi } from '../web';\r\nimport { LocalCache, getObjPropIgnoreCase } from '../tool';\r\nimport { UqMan, Field, ArrFields, FieldMap } from './uqMan';\r\nimport { Tuid } from './tuid';\r\n\r\nconst tab = '\\t';\r\nconst ln = '\\n';\r\nconst chars = '\\\\ntbfvr';\r\nconst codeBackSlash = chars.charCodeAt(0);\r\nconst codeN = chars.charCodeAt(1);\r\nconst codeT = chars.charCodeAt(2);\r\nconst codeB = chars.charCodeAt(3);\r\nconst codeF = chars.charCodeAt(4);\r\nconst codeV = chars.charCodeAt(5);\r\nconst codeR = chars.charCodeAt(6);\r\n\r\nconst codes = '\\n\\t\\b\\f\\v\\r';\r\nconst codeBN = codes.charCodeAt(0);\r\nconst codeBT = codes.charCodeAt(1);\r\nconst codeBB = codes.charCodeAt(2);\r\nconst codeBF = codes.charCodeAt(3);\r\nconst codeBV = codes.charCodeAt(4);\r\nconst codeBR = codes.charCodeAt(5);\r\n\r\nexport abstract class Entity {\r\n    private jName: string;\r\n    schema: any;\r\n    ver: number = 0;\r\n    sys?: boolean;\r\n    readonly uq: UqMan;\r\n    readonly name: string;\r\n    readonly typeId: number;\r\n    readonly schemaLocal: LocalCache;\r\n    readonly uqApi: UqApi;\r\n    abstract get typeName(): string;\r\n    get sName():string {return this.jName || this.name}\r\n\tfields: Field[];\r\n    arrFields: ArrFields[];\r\n    returns: ArrFields[];\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        this.uq = uq;\r\n        this.name = name;\r\n        this.typeId = typeId;\r\n        this.sys = this.name.indexOf('$') >= 0;\r\n        this.schemaLocal = this.uq.localMap.item(this.name); // new EntityCache(this);\r\n        this.uqApi = this.uq.uqApi;\r\n    }\r\n\r\n    public face: any;           // 对应字段的label, placeHolder等等的中文，或者语言的翻译\r\n\r\n    //getApiFrom() {return this.entities.uqApi;}\r\n\r\n    private fieldMaps: {[arr:string]: FieldMap} = {};\r\n    fieldMap(arr?:string): FieldMap {\r\n        if (arr === undefined) arr = '$';\r\n        let ret = this.fieldMaps[arr];\r\n        if (ret === undefined) {\r\n            let fields:Field[];\r\n            if (arr === '$') fields = this.fields;\r\n            else if (this.arrFields !== undefined) {\r\n                let arrFields = this.arrFields.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            else if (this.returns !== undefined) {\r\n                let arrFields = this.returns.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            if (fields === undefined) return {};\r\n            ret = {};\r\n            for (let f of fields) ret[f.name] = f;\r\n            this.fieldMaps[arr] = ret;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public async loadSchema():Promise<void> {\r\n        if (this.schema !== undefined) return;\r\n        let schema = this.schemaLocal.get();\r\n        if (!schema) {\r\n            schema = await this.uq.loadEntitySchema(this.name);\r\n        }\r\n        //this.setSchema(schema);\r\n\t\t//this.buildFieldsTuid();\r\n\t\tthis.buildSchema(schema);\r\n\t\tawait this.loadValues();\r\n\t}\r\n\r\n\tbuildSchema(schema: any) {\r\n        this.setSchema(schema);\r\n\t\tthis.buildFieldsTuid();\r\n\t\t//await this.loadValues();\r\n\t}\r\n\t\r\n\tprotected async loadValues():Promise<any> {}\r\n\r\n    // 如果要在setSchema里面保存cache，必须先调用clearSchema\r\n    public clearSchema() {\r\n        this.schema = undefined;\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        if (schema === undefined) return;\r\n        let {name, version} = schema;\r\n        this.ver = version || 0;\t\t\r\n\t\tthis.setJName(name);\r\n        this.schemaLocal.set(schema);\r\n\t\tthis.schema = schema;\r\n\t\tthis.buildFieldsTuid();\r\n\t}\r\n\t\r\n\tprotected setJName(name:string) {\r\n        if (name !== this.name) this.jName = name;\r\n\t}\r\n\r\n    public buildFieldsTuid() {\r\n        let {fields, arrs, returns} = this.schema;\r\n\t\tthis.fields = fields;\r\n        this.uq.buildFieldTuid(fields);\r\n\t\tthis.arrFields = arrs;\r\n        this.uq.buildArrFieldsTuid(arrs, fields);\r\n\t\tthis.returns = returns;\r\n        this.uq.buildArrFieldsTuid(returns, fields);\r\n    }\r\n\r\n    schemaStringify():string {\r\n        return JSON.stringify(this.schema, (key:string, value:any) => {\r\n            if (key === '_tuid') return undefined;\r\n            return value;\r\n        }, 4);\r\n    }\r\n\r\n    tuidFromName(fieldName:string, arrName?:string):Tuid {\r\n        if (this.schema === undefined) return;\r\n        let {fields, arrs} = this.schema;\r\n        let entities = this.uq;\r\n        function getTuid(fn:string, fieldArr:Field[]) {\r\n            if (fieldArr === undefined) return;\r\n            let f = fieldArr.find(v => v.name === fn);\r\n            if (f === undefined) return;\r\n            return entities.getTuid(f.tuid);\r\n        }\r\n        let fn = fieldName.toLowerCase();\r\n        if (arrName === undefined) return getTuid(fn, fields);\r\n        if (arrs === undefined) return;\r\n        let an = arrName.toLowerCase();\r\n        let arr = (arrs as ArrFields[]).find(v => v.name === an);\r\n        if (arr === undefined) return;\r\n        return getTuid(fn, arr.fields);\r\n    }\r\n\r\n    buildParams(params:any):any {\r\n        let result:any = {};\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.buildFieldsParams(result, fields, params);\r\n        let arrs = this.arrFields;\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let {name, fields} = arr;\r\n                let paramsArr:any[] = params[name];\r\n                if (paramsArr === undefined) continue;\r\n                let arrResult:any[] = [];\r\n                result[name] = arrResult;\r\n                for (let pa of params) {\r\n                    let rowResult = {};\r\n                    this.buildFieldsParams(rowResult, fields, pa);\r\n                    arrResult.push(rowResult);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private buildFieldsParams(result:any, fields:Field[], params:any) {\r\n        for (let field of fields) {\r\n            let {name, type} = field;            \r\n            let d = params[name];\r\n            let val:any;\r\n            switch (type) {\r\n\t\t\t\tcase 'datetime':\r\n                \tval = this.buildDateTimeParam(d);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'date':\r\n\t\t\t\t\tif (d instanceof Date) {\r\n\t\t\t\t\t\tval = `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tval = d;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tswitch (typeof d) {\r\n\t\t\t\t\t\tdefault: val = d; break;\r\n\t\t\t\t\t\tcase 'object':\r\n\t\t\t\t\t\t\tif (d instanceof Date) {\r\n\t\t\t\t\t\t\t\tval = d;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlet tuid = field._tuid;\r\n\t\t\t\t\t\t\tif (tuid === undefined) val = d.id;\r\n\t\t\t\t\t\t\telse val = tuid.getIdFromObj(d);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n            }\r\n            result[name] = val;\r\n        }\r\n    }\r\n\r\n    buildDateTimeParam(val:any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return undefined;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'string':\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        return Math.floor(dt.getTime()/1000);\r\n    }\r\n\r\n    buildDateParam(val:any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return '';\r\n            case 'string': return val;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        let ret = dt.toISOString();\r\n        let p = ret.indexOf('T');\r\n        return p>0? ret.substr(0, p) : ret;\r\n    }\r\n\r\n    pack(data:any):string {\r\n        let ret:string[] = [];\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.packRow(ret, fields, data);\r\n        let arrs = this.arrFields; \r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n\t\t\t\tlet {name, fields} = arr;\r\n\t\t\t\tlet arrData = getObjPropIgnoreCase(data, name);\r\n\t\t\t\t//if (!arrData) arrData = data[name.toLowerCase()];\r\n                this.packArr(ret, fields, arrData);\r\n            }\r\n        }\r\n        return ret.join('');\r\n    }\r\n\r\n    private escape(row:any, field:Field):any {\r\n        let d = row[field.name];\r\n        if (d === null) return '';\r\n        switch (field.type) {\r\n            case 'datetime':\r\n                return this.buildDateTimeParam(d);\r\n            default:\r\n                switch (typeof d) {\r\n                    default: return d;\r\n                    case 'object':\r\n                        let tuid = field._tuid;\r\n                        if (tuid === undefined) return d.id;\r\n                        return tuid.getIdFromObj(d);\r\n                    case 'string':\r\n                        let len = d.length;\r\n                        let r = '', p = 0;\r\n                        for (let i=0;i<len;i++) {\r\n                            let c:number = d.charCodeAt(i), ch:string;\r\n                            switch(c) {\r\n\t\t\t\t\t\t\t\tdefault: continue;\r\n\t\t\t\t\t\t\t\tcase codeBackSlash: ch = '\\\\\\\\'; break;\r\n                                case codeBT: ch = '\\\\t'; break;\r\n\t\t\t\t\t\t\t\tcase codeBN: ch = '\\\\n'; break;\r\n\t\t\t\t\t\t\t\tcase codeBF: ch = '\\\\f'; break;\r\n\t\t\t\t\t\t\t\tcase codeBV: ch = '\\\\v'; break;\r\n\t\t\t\t\t\t\t\tcase codeBB: ch = '\\\\b'; break;\r\n\t\t\t\t\t\t\t\tcase codeBR: ch = '\\\\r'; break;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tr += d.substring(p, i) + ch;\r\n\t\t\t\t\t\t\tp = i+1;\r\n                        }\r\n                        return r + d.substring(p);\r\n                    case 'undefined': return '';\r\n                }\r\n        }\r\n    }\r\n\r\n    private packRow(result:string[], fields:Field[], data:any) {\r\n        let len = fields.length;\r\n        if (len === 0) {\r\n            result.push(ln);\r\n            return;\r\n        }\r\n        let ret = '';\r\n        ret += this.escape(data, fields[0]);\r\n        for (let i=1;i<len;i++) {\r\n            let f = fields[i];\r\n            ret += tab + this.escape(data, f);\r\n        }\r\n        result.push(ret + ln);\r\n    }\r\n\r\n    private packArr(result:string[], fields:Field[], data:any[]) {\r\n        if (data !== undefined) {\r\n\t\t\tif (data.length === 0) {\r\n\t\t\t\tresult.push(ln);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfor (let row of data) {\r\n\t\t\t\t\tthis.packRow(result, fields, row);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tresult.push(ln);\r\n\t\t}\r\n        result.push(ln);\r\n    }\r\n    protected cacheFieldsInValue(values:any, fields:Field[]) {\r\n        for (let f of fields as Field[]) {\r\n            let {name, _tuid} = f;\r\n            if (_tuid === undefined) continue;\r\n            let id = values[name];\r\n            //_tuid.useId(id);\r\n            values[name] = _tuid.boxId(id);\r\n        }\r\n    }\r\n\r\n    protected unpackTuidIdsOfFields(values:string[], fields: Field[]):any[] {\r\n        if (fields === undefined) {\r\n            return values as any[];\r\n        }\r\n        let ret:any[] = []\r\n        for (let ln of values) {\r\n            if (!ln) continue;\r\n            let len = ln.length;\r\n            let p = 0;\r\n            while (p<len) {\r\n                let ch = ln.charCodeAt(p);\r\n                if (ch === 10) {\r\n                    ++p;\r\n                    break;\r\n                }\r\n                let row = {};\r\n                p = this.unpackRow(row, fields, ln, p);\r\n                ret.push(row);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    unpackSheet(data:string):any {\r\n        let ret = {} as any; //new this.newMain();\r\n        //if (schema === undefined || data === undefined) return;\r\n        let fields = this.fields;\r\n        let p = 0;\r\n        if (fields !== undefined) p = this.unpackRow(ret, fields, data, p);\r\n        let arrs = this.arrFields; //schema['arrs'];\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                p = this.unpackArr(ret, arr, data, p);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n\tunpackReturns(data:string, returns?:ArrFields[]):{[name:string]:any[]} {\r\n\t\tif (data === undefined) debugger;\r\n\t\tlet ret = {} as any;\r\n\t\tlet p = 0;\r\n\t\tlet arrs = returns || this.returns;\r\n\t\tif (arrs !== undefined) {\r\n\t\t\tfor (let arr of arrs) {\r\n\t\t\t\tp = this.unpackArr(ret, arr, data, p);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n    protected unpackRow(ret:any, fields:Field[], data:string, p:number):number {\r\n        let ch0 = 0, ch = 0, c = p, i = 0, len = data.length, fLen = fields.length;\r\n        for (;p<len;p++) {\r\n            ch0 = ch;\r\n            ch = data.charCodeAt(p);\r\n            if (ch === 9) {\r\n                let f = fields[i];\r\n                let {name} = f;\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                c = p+1;\r\n                ++i;\r\n                if (i>=fLen) {\r\n                    p = data.indexOf('\\n', c);\r\n                    if (p >= 0) ++p;\r\n                    else p = len;\r\n                    return p;\r\n                }\r\n            }\r\n            else if (ch === 10) {\r\n                let f = fields[i];\r\n                let {name} = f;\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                ++p;\r\n                ++i;\r\n                return p;\r\n            }\r\n        }\r\n        let f = fields[i];\r\n        let {name} = f;\r\n        if (ch0 !== 8) {\r\n            let v = data.substring(c);\r\n            ret[name] = this.to(ret, v, f);\r\n        }\r\n        return len;\r\n    }\r\n\r\n    private to(ret:any, v:string, f:Field):any {\r\n        switch (f.type) {\r\n\t\t\tdefault: return v;\r\n\t\t\tcase 'text':\r\n\t\t\tcase 'char':\r\n\t\t\t\treturn this.reverseNT(v);\r\n            case 'datetime':\r\n            case 'time':\r\n\t\t\tcase 'timestamp':\r\n                let n = Number(v);\r\n                let date = isNaN(n) === true? new Date(v) : new Date(n*1000);\r\n                return date;\r\n            case 'date':\r\n                let parts = v.split('-');\r\n                return new Date(Number(parts[0]), Number(parts[1])-1, Number(parts[2]));\r\n            case 'enum':\r\n            case 'tinyint':\r\n            case 'smallint':\r\n            case 'int':\r\n            case 'bigint':\r\n            case 'dec':\r\n\t\t\tcase 'float':\r\n\t\t\tcase 'double':\r\n                return Number(v);\r\n            case 'id':\r\n                let id = Number(v);\r\n                let {_tuid} = f;\r\n                if (_tuid === undefined) return id;\r\n                return _tuid.boxId(id);\r\n        }\r\n\t}\r\n\t\r\n\tprivate reverseNT(text:string):string {\r\n\t\tif (text === undefined) return;\r\n\t\tif (text === null) return;\r\n\t\tlet len = text.length;\r\n\t\tlet r = '';\r\n\t\tlet p = 0;\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet c = text.charCodeAt(i);\r\n\t\t\tif (c === codeBackSlash) {\r\n\t\t\t\tif (i===len-1) break;\r\n\t\t\t\tlet c1 = text.charCodeAt(i+1);\r\n\t\t\t\tlet ch:string;\r\n\t\t\t\tswitch (c1) {\r\n\t\t\t\t\tdefault: continue;\r\n\t\t\t\t\tcase codeBackSlash: ch = '\\\\'; break;\r\n\t\t\t\t\tcase codeN: ch = '\\n'; break;\r\n\t\t\t\t\tcase codeT: ch = '\\t'; break;\r\n\t\t\t\t\tcase codeB: ch = '\\b'; break;\r\n\t\t\t\t\tcase codeF: ch = '\\f'; break;\r\n\t\t\t\t\tcase codeV: ch = '\\v'; break;\r\n\t\t\t\t\tcase codeR: ch = '\\r'; break;\r\n\t\t\t\t}\r\n\t\t\t\tr += text.substring(p, i) + ch;\r\n\t\t\t\tp = i+2;\r\n\t\t\t\t++i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tr += text.substring(p, len);\r\n\t\treturn r;\r\n\t}\r\n\r\n    private unpackArr(ret:any, arr:ArrFields, data:string, p:number):number {\r\n\t\tlet p0 = p;\r\n        let vals:any[] = [], len = data.length;\r\n        let {name, fields} = arr;\r\n        while (p<len) {\r\n            let ch = data.charCodeAt(p);\r\n            if (ch === 10) {\r\n\t\t\t\tif (p === p0) {\r\n\t\t\t\t\tch = data.charCodeAt(p);\r\n\t\t\t\t\tif (ch !== 10) {\r\n\t\t\t\t\t\tthrow new Error('upackArr: arr第一个字符是10，则必须紧跟一个10，表示整个arr的结束')\r\n\t\t\t\t\t}\r\n\t\t\t\t\t++p;\r\n\t\t\t\t}\r\n                ++p;\r\n                break;\r\n            }\r\n            let val = {} as any; //new creater();\r\n            vals.push(val);\r\n            p = this.unpackRow(val, fields, data, p);\r\n        }\r\n        ret[name] = vals;\r\n        return p;\r\n    }\r\n}\r\n","import { Caller } from '../web';\r\nimport { Entity } from './entity';\r\nimport { Action } from './action';\r\nimport { Query } from './query';\r\n\r\ninterface UqResponseSchema {\r\n    uq: any;\r\n    entity: any;\r\n}\r\n\r\nexport abstract class EntityCaller<T> extends Caller<T> {\r\n    private tries: number;\r\n    protected _entity: Entity;\r\n\r\n    constructor(entity: Entity, params:T, $$user:number = undefined, waiting: boolean = true) {\r\n        super(params, $$user, waiting);\r\n        this.tries = 0;\r\n        this._entity = entity;\r\n    }\r\n\r\n    protected get entity(): Entity {return this._entity;}\r\n\r\n    //大多的entityCaller都不需要这个\r\n    //buildParams() {return this.entity.buildParams(this.params);}\r\n    \r\n    async request(): Promise<any> {\r\n        await this.entity.loadSchema();\r\n        let ret = await this.innerRequest();\r\n        return ret;\r\n    }\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        return await this.entity.uqApi.xcall(this);\r\n    }\r\n\r\n    async innerRequest(): Promise<any> {\r\n        let jsonResult = await this.innerCall();\r\n        let {$uq, $modify, res} = jsonResult;\r\n        this.entity.uq.pullModify($modify);\r\n        if ($uq === undefined) {\r\n            let ret = this.xresult(res);\r\n            return ret;\r\n        }\r\n        return await this.retry($uq);\r\n    }\r\n\r\n    xresult(res:any):any {return res}\r\n\r\n    get headers(): {[header:string]: string} {\r\n        let {ver, uq} = this.entity;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }\r\n\r\n    private async retry(schema: UqResponseSchema) {\r\n        ++this.tries;\r\n        if (this.tries > 5) throw new Error(`${schema.entity.name} can not get right uq response schema, 5 tries`);\r\n        this.rebuildSchema(schema);\r\n        return await this.innerRequest();\r\n    }\r\n\r\n    private rebuildSchema(schema: UqResponseSchema) {\r\n        let {uq, entity} = schema;\r\n        if (uq !== undefined) {\r\n\t\t\tthis.entity.uq.buildEntities(uq);\r\n\t\t}\r\n        if (entity !== undefined) {\r\n\t\t\tthis.entity.setSchema(entity);\r\n\t\t}\r\n    }\r\n}\r\n\r\nexport abstract class ActionCaller extends EntityCaller<any> {\r\n    protected get entity(): Action {return this._entity as Action;}\r\n}\r\n\r\nexport class QueryQueryCaller extends EntityCaller<any> {\r\n    protected get entity(): Query {return this._entity as Query};\r\n    get path():string {return `query/${this.entity.name}`;}\r\n    xresult(res:any) {\r\n        let data = this.entity.unpackReturns(res);\r\n        return data;\r\n    }\r\n    buildParams() {return this.entity.buildParams(this.params);}\r\n}\r\n\r\nexport class QueryPageCaller extends EntityCaller<any> {\r\n    protected get params(): {pageStart:any; pageSize:number, params:any} {return this._params};\r\n\tprotected get entity(): Query {return this._entity as Query};\r\n\t//results: {[name:string]:any[]};\r\n\tget path():string {return `query-page/${this.entity.name}`;}\t\r\n    buildParams() {\r\n        let {pageStart, pageSize, params} = this.params;\r\n        let p:any;\r\n        if (params === undefined) {\r\n            p = {key: ''};\r\n        }\r\n        else {\r\n            p = this.entity.buildParams(params);\r\n        }\r\n        /*\r\n        switch (typeof params) {\r\n            case 'undefined': p = {key: ''}; break;\r\n            default: p = _.clone(params); break;\r\n        }\r\n        */\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        return p;\r\n    };\r\n    xresult(res:any): {[name:string]:any[]} {\r\n        let ret = this.entity.unpackReturns(res);\r\n\t\t//return this.results.$page;// as any[];\r\n\t\treturn ret;\r\n    }\r\n}\r\n","import { LocalArr } from '../../tool';\r\nimport { BoxId } from './boxId';\r\nimport { TuidInner, TuidDiv } from './tuid';\r\n\r\nconst maxCacheSize = 10000;\r\n\r\nexport class IdCache {\r\n    private queue: number[] = [];                   // 每次使用，都排到队头\r\n\tprivate readonly cache:Map<number, any>;    // 已经缓冲的\r\n\r\n    protected localArr:LocalArr;\r\n    protected waitingIds: number[] = [];          // 等待loading的\r\n    protected tuidInner: TuidInner;\r\n\r\n    constructor(tuidLocal: TuidInner) {\r\n        this.cache =  tuidLocal.uq.tonva.createObservableMap();\r\n        this.tuidInner = tuidLocal;\r\n        this.initLocalArr();\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        this.localArr = this.tuidInner.schemaLocal.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    cacheSet(id:number, val:any) {\r\n        this.cache.set(id, val);\r\n    }\r\n\r\n    useId(id:number, defer?:boolean) {\r\n        if (!id) return;\r\n        if (typeof id !== 'number') {\r\n\t\t\tconsole.error('id cache ' + id + ' is not number');\r\n\t\t\treturn;\r\n\t\t}\r\n        if (this.cache.has(id) === true) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n        this.tuidInner.cacheTuids(defer===true?70:20);\r\n        if (this.waitingIds.findIndex(v => v === id) >= 0) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n\r\n        if (this.queue.length >= maxCacheSize) {\r\n            // 缓冲已满，先去掉最不常用的\r\n            let r = this.queue.shift();\r\n            if (r === id) {\r\n                // 如果移除的，正好是现在用的，则插入\r\n                this.queue.push(r);\r\n                return;\r\n            }\r\n\r\n            if (this.cache.has(r) === true) {\r\n                // 如果移除r已经缓存\r\n                this.cache.delete(r);\r\n            }\r\n            else {\r\n                // 如果移除r还没有缓存\r\n                let index = this.waitingIds.findIndex(v => v === r);\r\n                this.waitingIds.splice(index, 1);\r\n            }\r\n        }\r\n        this.waitingIds.push(id);\r\n        this.queue.push(id);\r\n\t\treturn;\r\n    }\r\n\r\n    private moveToHead(id:number) {\r\n        let index = this.queue.findIndex(v => v === id);\r\n        this.queue.splice(index, 1);\r\n        this.queue.push(id);\r\n    }\r\n\r\n    getValue(id:number) {\r\n\t\treturn this.cache.get(id);\r\n    }\r\n\r\n    remove(id:number) {\r\n        this.cache.delete(id);\r\n        let index = this.queue.findIndex(v => v === id);\r\n\t\tthis.queue.splice(index, 1);\r\n\t\tthis.localArr.removeItem(id);\r\n    }\r\n\r\n    valueFromId(id:number|BoxId):any {\r\n        let _id:number;\r\n        switch (typeof id) {\r\n            case 'object': _id = (id as BoxId).id; break;\r\n            case 'number': _id = id as number; break;\r\n            default: return;\r\n        }\r\n        return this.getValue(_id);\r\n    }\r\n\r\n    resetCache(id:number) {\r\n        this.remove(id);\r\n        this.useId(id);\r\n    }\r\n\r\n    cacheValue(val:any):boolean {\r\n        if (val === undefined) return false;\r\n        let id = this.getIdFromObj(val);\r\n        if (id === undefined) return false;\r\n        this.cacheSet(id, val);\r\n        return true;\r\n    }\r\n    protected getIdFromObj(val:any) {return this.tuidInner.getIdFromObj(val)}\r\n\r\n    async cacheIds():Promise<void> {\r\n\t\tlet tuidValues = await this.loadIds();\r\n        this.cacheIdValues(tuidValues);\r\n    }\r\n\r\n    protected cacheIdValues(tuidValues: any[]) {\r\n        if (tuidValues === undefined) return;\r\n        let tuids = this.unpackTuidIds(tuidValues);\r\n        for (let tuidValue of tuids) {\r\n            if (this.cacheValue(tuidValue) === true) {\r\n                this.cacheTuidFieldValues(tuidValue);\r\n            }\r\n        }\r\n    }\r\n    async modifyIds(ids:any[]):Promise<void> {\r\n        let tuidValues:string[] = await this.loadTuidIdsOrLocal(ids);\r\n        let localedValues = tuidValues.filter(v => {\r\n            let p = v.indexOf('\\t');\r\n            if (p<0) p = v.length;\r\n            let id = Number(v.substr(0, p));\r\n            let val = this.localArr.getItem(id);\r\n            return (val !== undefined);\r\n        });\r\n        if (localedValues.length === 0) return;\r\n        this.cacheIdValues(localedValues);\r\n    }\r\n    protected async loadIds(): Promise<any[]> {\r\n\t\tif (this.waitingIds.length === 0) return;\r\n\t\tlet loadingIds = [...this.waitingIds];\r\n\t\tthis.waitingIds = [];\r\n\t\treturn await this.loadTuidIdsOrLocal(loadingIds);\r\n    }\r\n    protected unpackTuidIds(values:string[]):any[] {\r\n        return this.tuidInner.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.tuidInner.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\r\n    async assureObj(id:number):Promise<object|number> {\r\n        let val = this.cache.get(id);\r\n        if (val !== undefined) return val;\r\n        /*\r\n        switch (typeof val) {\r\n            case 'object': return val;\r\n            // case 'number': this.cache.set(id, undefined); break;\r\n        }\r\n        */\r\n        let ret = await this.loadTuidIdsOrLocal([id]);\r\n        this.cacheIdValues(ret);\r\n    }\r\n\r\n\tprotected async loadValuesFromIds(netIds: number[]):Promise<any[]> {\r\n\t\tlet netRet = await this.tuidInner.loadValuesFromIds(undefined, netIds);\r\n\t\treturn netRet;\r\n\t}\r\n\r\n    private async loadTuidIdsOrLocal(ids:number[]):Promise<string[]> {\r\n        let ret:string[] = [];        \r\n        let netIds:number[] = [];\r\n        for (let id of ids) {\r\n            let value = this.localArr.getItem(id);\r\n            //if (value === undefined)\r\n            // 值不存在或者是空字符串，重新获取\r\n            if (!value)\r\n                netIds.push(id);\r\n            else\r\n                ret.push(value);\r\n        }\r\n        let len = netIds.length;\r\n        if (len === 0) return ret;\r\n\r\n\t\tlet netRet = await this.loadValuesFromIds(netIds);\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t//有些id可能没有内容，不会返回\r\n\t\t\t//let id = netIds[i]; \r\n\t\t\tlet row:string = netRet[i];\r\n\t\t\tif (!row) continue;\r\n\t\t\tlet p = row.indexOf('\\t');\r\n\t\t\tif (p < 0) p = row.length;\r\n\t\t\tlet id = Number(row.substr(0, p));\r\n            let pos = netIds.findIndex(v => v === id);\r\n            if (pos >= 0) netIds.splice(pos, 1);\r\n\t\t\tret.push(row);\r\n\t\t\tthis.localArr.setItem(id, row);\r\n\t\t}\r\n\t\tlen = netIds.length;\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tthis.localArr.setItem(netIds[i], '');\r\n\t\t}\r\n        return ret;\r\n    }\r\n}\r\n\r\nexport class IdDivCache extends IdCache {\r\n    private div: TuidDiv;\r\n    protected divName:string;\r\n\r\n    constructor(tuidLocal:TuidInner, div: TuidDiv) {\r\n        super(tuidLocal);\r\n        this.div = div;\r\n        this.divName = div.name;\r\n        this.localArr = tuidLocal.schemaLocal.arr(tuidLocal.name + '.ids.' + this.divName);\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        // 这个不需要，必须去掉\r\n        // this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    protected getIdFromObj(val:any) {return this.div.getIdFromObj(val)}\r\n    protected unpackTuidIds(values:string[]):any[] {\r\n        return this.div.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.div.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\tprotected async loadValuesFromIds(netIds: number[]):Promise<any[]> {\r\n\t\tlet netRet = await this.tuidInner.loadValuesFromIds(this.divName, netIds);\r\n\t\treturn netRet;\r\n\t}\r\n}\r\n","import { LocalArr } from '../../tool';\r\nimport { Entity } from '../entity';\r\nimport { UqMan, ArrFields, Field, SchemaFrom } from '../uqMan';\r\nimport { EntityCaller } from '../caller';\r\nimport { BoxId } from './boxId';\r\nimport { IdCache, IdDivCache } from './idCache';\r\n\r\nexport interface TuidSaveResult {\r\n    id: number;\r\n    inId: number;\r\n}\r\n\r\nexport interface TuidNOResult {\r\n\tdate: string;\r\n\tno: number;\r\n}\r\n\r\nexport abstract class UqTuid<M> extends Entity {\r\n    protected noCache: boolean;\r\n    readonly typeName:string = 'tuid';\r\n    protected idName: string;\r\n    unique: string[];\r\n\t//render: Render<M>;\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {id} = schema;\r\n        this.idName = id;\r\n    }\r\n\r\n    buildTuidBox(): TuidBox {\r\n        return new TuidBox(this);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    stopCache():void {this.noCache = true}\r\n    //abstract tv(id:number, render?:Render<M>):JSX.Element;\r\n    abstract getObj(id:number):M;\r\n    abstract useId(id:number):void;\r\n    abstract boxId(id:number):BoxId;\r\n    abstract valueFromId(id:number):any;\r\n\tabstract resetCache(id:number|BoxId):void;\r\n\tabstract assureBox<T> (id:number|BoxId): Promise<T>;\r\n\tstatic idValue(id: {id:number}|number):number {\r\n\t\tlet t = typeof id;\r\n\t\tswitch (t) {\r\n\t\t\tdefault: debugger; throw new Error('unknown id type: ' + t);\r\n\t\t\tcase 'undefined': return undefined;\r\n\t\t\tcase 'object': return (id as any).id;\r\n\t\t\tcase 'number': return id as number;\r\n\t\t}\r\n\t}\r\n    static equ(id1:{id:number}|number, ix:{id:number}|number): boolean {\r\n        if (id1 === undefined || id1 === null) return false;\r\n\t\tif (ix === undefined || ix === null) return false;\r\n\t\treturn Tuid.idValue(id1) === Tuid.idValue(ix);\r\n\t\t/*\r\n        if (typeof id1 === 'object') {\r\n\t\t\tlet id1Id = id1.id;\r\n            return typeof ix === 'object'? id1Id === ix.id : id1Id === ix;\r\n        }\r\n        if (typeof ix === 'object') {\r\n\t\t\tlet id2Id = ix.id;\r\n            return typeof id1 === 'object'? id2Id === id1.id : id2Id === id1;\r\n        }\r\n\t\treturn id1 === ix;\r\n\t\t*/\r\n    }\r\n    cacheIds() {}\r\n    async modifyIds(ids:any[]) {}\r\n    isImport = false;\r\n    abstract get hasDiv():boolean;// {return this.divs!==undefined}\r\n    abstract div(name:string):TuidDiv;\r\n    abstract loadMain(id:number|BoxId):Promise<M>;\r\n\tabstract load(id:number|BoxId):Promise<M>;\r\n    abstract all():Promise<M[]>;\r\n\tabstract save(id:number, props:M):Promise<TuidSaveResult>;\r\n\tabstract saveProp(id:number, prop:string, value:any):Promise<void>;\r\n    abstract search(key:string, pageStart:string|number, pageSize:number):Promise<M[]>;\r\n    abstract searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any>;\r\n    abstract loadArr(arr:string, owner:number, id:number):Promise<any>;\r\n    abstract saveArr(arr:string, owner:number, id:number, props:any):Promise<void>;\r\n\tabstract posArr(arr:string, owner:number, id:number, order:number):Promise<void>;\r\n\tabstract no():Promise<TuidNOResult>;\r\n}\r\n\r\nexport abstract class Tuid extends UqTuid<any> {\r\n}\r\n\r\nexport class TuidInner extends Tuid {\r\n    private divs: {[div:string]: TuidDiv};\r\n    protected cacheFields: Field[];\r\n    protected idCache: IdCache;\r\n    protected localArr:LocalArr;\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        super(uq, name, typeId);\r\n        this.idCache = new IdCache(this);\r\n        this.localArr = this.schemaLocal.arr(this.name + '.whole');\r\n        if (uq.newVersion === true) this.localArr.removeAll();\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {arrs} = schema;\r\n        if (arrs !== undefined) {\r\n            this.divs = {};\r\n            for (let arr of arrs) {\r\n                let {name} = arr;\r\n                let tuidDiv = new TuidDiv(this.uq, this, name);\r\n                this.divs[name] = tuidDiv;\r\n                tuidDiv.setSchema(arr);\r\n                tuidDiv.buildFieldsTuid();\r\n            }\r\n        }\r\n    }\r\n    \r\n    getObj(id:number):any {\r\n        let obj = this.valueFromId(id);\r\n        if (obj) return obj;\r\n        this.useId(id);\r\n        return {id};\r\n    }\r\n\r\n    useId(id:number, defer?:boolean) {\r\n        if (this.noCache === true) return;\r\n        if (!id) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n    boxId(id:number):BoxId {\r\n        if (!id) return;\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        //let {createBoxId} = this.uq;\r\n        //if (!createBoxId) \r\n        return {id: id} as BoxId;\r\n        //return createBoxId(this, id);\r\n    }\r\n    valueFromId(id:number) {return this.idCache.getValue(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tthis.idCache.resetCache(id);\r\n\t}\r\n    async assureBox<T> (id:number|BoxId):Promise<T> {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    cacheIds() {\r\n        this.idCache.cacheIds();\r\n        if (this.divs === undefined) return;\r\n        for (let i in this.divs) this.divs[i].cacheIds();\r\n    }\r\n    async modifyIds(ids:any[]) {\r\n        await this.idCache.modifyIds(ids);\r\n    }\r\n    cacheTuids(defer:number) {this.uq.cacheTuids(defer)}\r\n    get hasDiv():boolean {return this.divs!==undefined}\r\n    div(name:string):TuidDiv {\r\n        return this.divs && this.divs[name];\r\n    }\r\n    async loadValuesFromIds(divName:string, ids:number[]):Promise<any[]> {\r\n        let ret:any[] = await new IdsCaller(this, {divName:divName, ids:ids}, undefined, false).request();\r\n        return ret;\r\n    }\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        if (typeof id === 'object') id = id.id;\r\n        await this.idCache.assureObj(id);\r\n        return this.idCache.valueFromId(id);\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let cacheValue = this.idCache.valueFromId(id); \r\n        //if (typeof cacheValue === 'object') return cacheValue;\r\n        if (typeof id === 'object') id = id.id;\r\n        let valuesText = undefined; //this.localArr.getItem(id);\r\n        let values: any;\r\n        if (valuesText) {\r\n            values = JSON.parse(valuesText);\r\n        }\r\n        else {\r\n            values = await new GetCaller(this, id).request();\r\n            if (values !== undefined) {\r\n                // this.localArr.setItem(id, JSON.stringify(values));\r\n            }\r\n        }\r\n        if (values === undefined) return;\r\n        for (let f of this.schema.fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.uq.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            let n = f.name;\r\n            values[n] = t.boxId(values[n]);\r\n        }\r\n        this.idCache.cacheValue(values);\r\n        this.cacheTuidFieldValues(values);\r\n        return values;\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let {fields, arrs} = this.schema;\r\n        this.cacheFieldsInValue(values, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs as ArrFields[]) {\r\n                let {name, fields} = arr;\r\n                let arrValues = values[name];\r\n                if (arrValues === undefined) continue;\r\n                let tuidDiv = this.div(name);\r\n                for (let row of arrValues) {\r\n                    //row._$tuid = tuidDiv;\r\n                    //row.$owner = this.boxId(row.owner);\r\n                    tuidDiv.cacheValue(row);\r\n                    this.cacheFieldsInValue(row, fields);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields, $create, $update, stampOnMain} = this.schema;\r\n\t\tif (mainFields === undefined) debugger;\r\n\t\tthis.cacheFields = mainFields || this.fields;\r\n\t\tif (stampOnMain === true) {\r\n\t\t\tif ($create === true) this.cacheFields.push({name: '$create', type: 'timestamp', _tuid: undefined});\r\n\t\t\tif ($update === true) this.cacheFields.push({name: '$update', type: 'timestamp', _tuid: undefined});\r\n\t\t}\r\n        this.uq.buildFieldTuid(this.cacheFields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        let ret = await new SaveCaller(this, {id:id, props:props}).request();\r\n        if (id !== undefined) {\r\n            this.idCache.remove(id);\r\n            this.localArr.removeItem(id);\r\n        }\r\n        return ret;\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait new SavePropCaller(this, {id, prop, value}).request();\r\n\t\tthis.idCache.remove(id);\r\n\t\tawait this.idCache.assureObj(id);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        let ret: any[] = await new AllCaller(this, {}).request();\r\n        return ret;\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any[]> {\r\n        let ret:any[] = await this.searchArr(undefined, key, pageStart, pageSize);\r\n        return ret;\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        //let api = this.uqApi;\r\n        //let ret = await api.tuidSearch(this.name, undefined, owner, key, pageStart, pageSize);\r\n        let params:any = {arr:undefined, owner:owner, key:key, pageStart:pageStart, pageSize:pageSize};\r\n        let ret = await new SearchCaller(this, params).request();\r\n        let {fields} = this.schema;\r\n        for (let row of ret) {\r\n            this.cacheFieldsInValue(row, fields);\r\n        }\r\n        return ret;\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let api = this.uqApi;\r\n        //return await api.tuidArrGet(this.name, arr, owner, id);\r\n        return await new LoadArrCaller(this, {arr:arr, owner:owner, id:id}).request();\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any) {\r\n        //let params = _.clone(props);\r\n        //params[\"$id\"] = id;\r\n        //return await this.uqApi.tuidArrSave(this.name, arr, owner, params);\r\n        return await new SaveArrCaller(this, {arr:arr, owner:owner, id:id, props:props}).request();\r\n    }\r\n\r\n    async posArr(arr:string, owner:number, id:number, order:number) {\r\n        //return await this.uqApi.tuidArrPos(this.name, arr, owner, id, order);\r\n        return await new ArrPosCaller(this, {arr:arr, owner:owner, id:id, order:order}).request();\r\n\t}\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await new TuidNoCaller(this, undefined).request();\r\n\t}\r\n}\r\n\r\nabstract class TuidCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Tuid {return this._entity as Tuid};\r\n}\r\n\r\n// 包含main字段的load id\r\n// 当前为了兼容，先调用的包含所有字段的内容\r\nclass GetCaller extends TuidCaller<number> {\r\n    method = 'GET';\r\n    get path():string {return `tuid/${this.entity.name}/${this.params}`}\r\n}\r\n\r\nclass IdsCaller extends TuidCaller<{divName:string, ids:number[]}> {\r\n    get path():string {\r\n        let {divName} = this.params;\r\n        return `tuidids/${this.entity.name}/${divName !== undefined?divName:'$'}`;\r\n    }\r\n    buildParams():any {return this.params.ids}\r\n    xresult(res:any):any {\r\n        return (res as string).split('\\n');\r\n    }\r\n}\r\n\r\n\r\nclass SaveCaller extends TuidCaller<{id:number, props:any}> {\r\n    get path():string {return `tuid/${this.entity.name}`}\r\n    buildParams():any {\r\n        let {fields, arrs} = this.entity.schema;\r\n        let {id, props} = this.params;\r\n        let params:any = {$id: id};\r\n        this.transParams(params, props, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let arrName = arr.name;\r\n                let arrParams = [];\r\n                let arrFields = arr.fields;\r\n                let arrValues = props[arrName];\r\n                if (arrValues !== undefined) {\r\n                    for (let arrValue of arrValues) {\r\n                        let row = {};\r\n                        this.transParams(row, arrValue, arrFields);\r\n                        arrParams.push(row);\r\n                    }\r\n                }\r\n                params[arrName] = arrParams;\r\n            }\r\n        }\r\n        return params;\r\n    }\r\n    private transParams(values:any, params:any, fields:Field[]) {\r\n        if (params === undefined) return;\r\n        for (let field of fields) {\r\n            let {name, tuid, type} = field;\r\n            let val = params[name];\r\n            if (tuid !== undefined) {\r\n                if (typeof val === 'object') {\r\n                    if (val !== null) val = val.id;\r\n                }\r\n            }\r\n            else {\r\n                switch (type) {\r\n                    case 'date':\r\n                        val = this.entity.buildDateParam(val); \r\n                        break;\r\n                    case 'datetime':\r\n                        val = this.entity.buildDateTimeParam(val);\r\n                        break;\r\n                }\r\n            }\r\n            values[name] = val;\r\n        }\r\n    }\r\n}\r\n\r\nclass SearchCaller extends TuidCaller<{arr:string, owner:number, key:string, pageStart:string|number, pageSize:number}> {\r\n    get path():string {return `tuids/${this.entity.name}`}\r\n}\r\n\r\nclass AllCaller extends TuidCaller<{}> {\r\n    method = 'GET';\r\n    get path():string {return `tuid-all/${this.entity.name}`}\r\n}\r\n\r\nclass LoadArrCaller extends TuidCaller<{arr:string, owner:number, id:number}> {\r\n    method = 'GET';\r\n    get path():string {\r\n        let {arr, owner, id} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/${id}`;\r\n    }\r\n}\r\nclass SavePropCaller extends TuidCaller<{id:number, prop:string, value:any}> {\r\n    get path():string {return `tuid-prop/${this.entity.name}/`;}\r\n}\r\nclass SaveArrCaller extends TuidCaller<{arr:string, owner:number, id:number, props:any}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, props} = this.params;\r\n        let params = Object.assign({}, props);\r\n        params['$id'] = id;\r\n        return params;\r\n    }\r\n}\r\nclass ArrPosCaller extends TuidCaller<{arr:string, owner:number, id:number, order:number}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr-pos/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, order} = this.params;\r\n        return { bid: id, $order: order}\r\n    }\r\n}\r\nclass TuidNoCaller extends TuidCaller<{}> {\r\n    get path():string {\r\n        return `tuid-no/${this.entity.name}/`;\r\n    }\r\n    buildParams():any {\r\n\t\tlet d = new Date();\r\n\t\tlet year = d.getFullYear();\r\n\t\tlet month = d.getMonth() + 1;\r\n\t\tlet date = d.getDate();\r\n        return {year, month, date};\r\n    }\r\n}\r\n\r\nexport class TuidImport extends Tuid {\r\n    private tuidLocal: TuidInner;\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number, from: SchemaFrom) {\r\n        super(uq, name, typeId);\r\n        this.from = from;\r\n    }\r\n\r\n    setFrom(tuidLocal: TuidInner) {this.tuidLocal = tuidLocal}\r\n    \r\n    readonly from: SchemaFrom;\r\n    isImport = true;\r\n\r\n    getObj(id:number): any {return this.tuidLocal?.getObj(id)}\r\n    /*\r\n\ttv(id:number, render?:Render<any>):JSX.Element {\r\n\t\treturn this.tuidLocal?.tv(id, render);\r\n\t}\r\n    */\r\n\r\n    useId(id:number) {this.tuidLocal?.useId(id);}\r\n    boxId(id:number):BoxId {\r\n\t\tif (!this.tuidLocal) debugger;\r\n\t\treturn this.tuidLocal?.boxId(id);\r\n\t}\r\n    valueFromId(id:number) {return this.tuidLocal?.valueFromId(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tthis.tuidLocal?.resetCache(id);\r\n\t}\r\n    async assureBox<T>(id:number):Promise<T> {\r\n        await this.tuidLocal.assureBox(id);\r\n\t\treturn this.tuidLocal.valueFromId(id);\r\n    }\r\n    get hasDiv():boolean {return this.tuidLocal?.hasDiv}\r\n    div(name:string):TuidDiv {return this.tuidLocal?.div(name)}\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        let ret = await this.tuidLocal.loadMain(id);\r\n        return ret;\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        return await this.tuidLocal.load(id);\r\n    }\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        return await this.tuidLocal.save(id, props);\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait this.tuidLocal.saveProp(id, prop, value);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        return await this.tuidLocal.all();\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.search(key, pageStart, pageSize);\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.searchArr(owner, key, pageStart, pageSize);\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        return await this.tuidLocal.loadArr(arr, owner, id);\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any):Promise<void> {\r\n        await this.tuidLocal.saveArr(arr, owner, id, props);\r\n    }\r\n    async posArr(arr:string, owner:number, id:number, order:number):Promise<void> {\r\n        await this.tuidLocal.posArr(arr, owner, id, order);\r\n    }\r\n\tasync no():Promise<TuidNOResult> {\r\n\t\treturn await this.tuidLocal.no();\r\n\t}\r\n}\r\n\r\n// field._tuid 用这个接口\r\n// Tuid, TuidDiv 实现这个接口\r\nexport class TuidBox {\r\n    tuid: Tuid;\r\n    ownerField:Field = undefined;\r\n    constructor(tuid: Tuid) {\r\n        this.tuid = tuid;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.tuid.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.tuid.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.tuid.useId(id);\r\n    }\r\n    async showInfo() {\r\n        alert('showInfo not implemented');\r\n    }\r\n}\r\n\r\n\r\nexport class TuidDiv extends TuidInner {\r\n    readonly typeName:string = 'div';\r\n    protected cacheFields: Field[];\r\n    protected tuid: TuidInner;\r\n    protected idName: string;\r\n    protected idCache: IdDivCache;\r\n\r\n    constructor(uq: UqMan, tuid: TuidInner, name: string) {\r\n        super(uq, name, 0);\r\n        this.tuid = tuid;\r\n        this.idName = 'id';\r\n        this.idCache = new IdDivCache(tuid, this);\r\n    }\r\n\r\n    get owner() {return this.tuid}\r\n\r\n    buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields} = this.schema;\r\n        if (mainFields === undefined) debugger;\r\n        this.uq.buildFieldTuid(this.cacheFields = mainFields);\r\n    }\r\n\r\n    buildTuidDivBox(ownerField: Field): TuidBoxDiv {\r\n        return new TuidBoxDiv(this.tuid, this, ownerField);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    cacheValue(value:any):void {\r\n        this.idCache.cacheValue(value);\r\n    }\r\n\r\n    useId(id:number, defer?:boolean):void {\r\n        if (this.noCache === true) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n\r\n    valueFromId(id:number):any {\r\n        return this.idCache.getValue(id)\r\n    }\r\n\r\n    async assureBox<T>(id:number):Promise<T> {\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    async cacheIds() {\r\n        await this.idCache.cacheIds();\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let fields = this.schema.fields;\r\n        this.cacheFieldsInValue(values, fields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n}\r\n\r\nexport class TuidBoxDiv extends TuidBox {\r\n    ownerField: Field;\r\n    private div: TuidDiv;\r\n    constructor(tuid: Tuid, div: TuidDiv, ownerField: Field) {\r\n        super(tuid);\r\n        this.div = div;\r\n        this.ownerField = ownerField;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.div.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.div.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.div.useId(id);\r\n    }\r\n}\r\n","import { UqMan, TuidModify } from '../uqMan';\r\nimport { Tuid } from \"./tuid\";\r\nimport { env } from '../../tool';\r\n\r\ninterface Modify {\r\n    id: number;\r\n    entity: string;\r\n    key: string;\r\n}\r\n\r\nexport class TuidsCache {\r\n    private readonly uq: UqMan;\r\n    private modifyMax: TuidModify;\r\n    private cacheTimer: any;\r\n    constructor(uq: UqMan) {\r\n        this.uq = uq;\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.clearCacheTimer();\r\n        this.cacheTimer = env.setTimeout('TuidsCache.cacheTuids', this.loadIds, defer);\r\n    }\r\n    private clearCacheTimer() {\r\n        if (this.cacheTimer === undefined) return;\r\n        env.clearTimeout(this.cacheTimer);\r\n        this.cacheTimer = undefined;\r\n    }\r\n    private loadIds = () => {\r\n        this.clearCacheTimer();\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            let tuid = tuids[i];\r\n            tuid.cacheIds();\r\n        }\r\n    }\r\n    \r\n    pullModify(modifyMax:number) {\r\n        if (modifyMax === undefined) return;\r\n        let now = Math.floor(Date.now() / 1000);\r\n        if (this.modifyMax === undefined) {\r\n            this.modifyMax = this.uq.localModifyMax.get();\r\n            if (this.modifyMax === undefined) {\r\n                this.modifyMax = {\r\n                    max: modifyMax,\r\n                    seconds: now,\r\n                };\r\n                this.uq.localModifyMax.set(this.modifyMax);\r\n            }\r\n        }\r\n        let {max, seconds} = this.modifyMax;\r\n        let lockGap = 3600;\r\n        if (now - seconds < lockGap) return;\r\n        if (modifyMax <= max) return;\r\n        let tuidCached:string[] = [];\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            //if (tuids[i].cached === true) \r\n            tuidCached.push(i);\r\n        }\r\n        if (tuidCached.length === 0) return;\r\n        this.modifyMax.seconds = now;\r\n        this.innerPullModify(tuidCached.join('\\t'));\r\n    }\r\n\r\n    private async innerPullModify(tuidLists:string):Promise<void> {\r\n        let {uqApi, tuids} = this.uq;\r\n        let {max} = this.modifyMax;\r\n        let ret:{queue:Modify[], queueMax:number} = await uqApi.queueModify(max, 30, tuidLists);\r\n        let group:{[entity:string]: {tuid:Tuid; ids: string[]}} = {};\r\n        let modifyMax:number = 0;\r\n        for (let modify of ret.queue) {\r\n\t\t\tlet {id, entity, key} = modify;\r\n\t\t\tif (!key) continue;\r\n            let tuid = tuids[entity];\r\n            if (tuid === undefined) continue;\r\n            let item = group[entity];\r\n            if (item === undefined) {\r\n                item = group[entity] = {tuid: tuid, ids:[]};\r\n            }\r\n            item.ids.push(key);\r\n            if (id > modifyMax) modifyMax = id;\r\n        }\r\n        for (let i in group) {\r\n            let {tuid, ids} = group[i];\r\n            await tuid.modifyIds(ids);\r\n        }\r\n        let now = Math.floor(Date.now() / 1000);\r\n        this.modifyMax = {\r\n            max: modifyMax,\r\n            seconds: now,\r\n        }\r\n        this.uq.localModifyMax.set(this.modifyMax);\r\n    }\r\n}\r\n","import { Entity } from './entity';\r\nimport { ActionCaller } from './caller';\r\n\r\nexport class UqAction<P, R> extends Entity {\r\n    get typeName(): string { return 'action';}\r\n    async submit(data:P, $$user:number = undefined, waiting: boolean = true) {\r\n\t\tlet caller = new ActionSubmitCaller(this, data, $$user, waiting)\r\n\t\tlet ret = await caller.request();\r\n\t\treturn ret;\r\n    }\r\n    async submitReturns(data:P, $$user:number = undefined):Promise<R> {\r\n       return await new SubmitReturnsCaller(this, data, $$user).request();\r\n    }\r\n    async submitConvert(data:P, $$user:number = undefined) {\r\n        return await new SubmitConvertCaller(this, data, $$user).request();\r\n    }\r\n}\r\n\r\nexport class Action extends UqAction<any, any> {\r\n}\r\n\r\nexport class ActionSubmitCaller extends ActionCaller {\r\n    get path():string {return 'action/' + this.entity.name;}\r\n    buildParams():any {\r\n\t\treturn {\r\n            $$user: this.$$user,\r\n            data: this.entity.pack(this.params)\r\n        };\r\n\t}\r\n}\r\n\r\nclass SubmitReturnsCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action/' + this.entity.name + '/returns';}\r\n    xresult(res:any):any {\r\n        let {returns} = this.entity;\r\n        let len = returns.length;\r\n        let ret:{[r:string]:any[]} = {};\r\n        for (let i=0; i<len; i++) {\r\n            let retSchema = returns[i];\r\n            ret[retSchema.name] = res[i];\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nclass SubmitConvertCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action-convert/' + this.entity.name;}\r\n    buildParams():any {\r\n        return {\r\n            $$user: this.$$user,\r\n            data: this.params\r\n        };\r\n    }\r\n}\r\n","import { Entity } from './entity';\r\nimport { EntityCaller } from './caller';\r\nimport { ArrFields } from './uqMan';\r\n\r\nexport interface SheetState {\r\n    name: string;\r\n    actions: SheetAction[];\r\n}\r\n\r\nexport interface SheetAction {\r\n    name: string;\r\n}\r\n\r\nexport interface StateCount {\r\n    state: string;\r\n    count: number;\r\n}\r\n\r\nexport interface SheetSaveReturnV<V> {\r\n\tid: number;\r\n\tflow: number;\r\n\tstate: string;\r\n\tverify: V[];\r\n}\r\n\r\nexport interface SheetSaveReturn extends SheetSaveReturnV<any> {\r\n}\r\n\r\ninterface GetSheetReturn<M> {\r\n\tbrief: any;\r\n\tdata: M;\r\n\tflows: any[];\r\n}\r\n\r\nexport class UqSheet<M, V> extends Entity {\r\n    get typeName(): string { return 'sheet';}\r\n\tstates: SheetState[];\r\n\tverify: {returns: ArrFields[]};\r\n\r\n    /*\r\n    setStates(states: SheetState[]) {\r\n        for (let state of states) {\r\n            this.setStateAccess(this.states.find(s=>s.name==state.name), state);\r\n        }\r\n    }*/\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n\t\tthis.states = schema.states;\r\n\t\tthis.verify = schema.verify;\r\n    }\r\n    build(obj:any) {\r\n        this.states = [];\r\n        for (let op of obj.ops) {\r\n            this.states.push({name: op, actions:undefined});\r\n        }\r\n        /*\r\n        for (let p in obj) {\r\n            switch(p) {\r\n                case '#':\r\n                case '$': continue;\r\n                default: this.states.push(this.createSheetState(p, obj[p])); break;\r\n            }\r\n        }*/\r\n    }\r\n    private createSheetState(name:string, obj:object):SheetState {\r\n        let ret:SheetState = {name:name, actions:[]};\r\n        let actions = ret.actions;\r\n        for (let p in obj) {\r\n            let action:SheetAction = {name: p};\r\n            actions.push(action);\r\n        }\r\n        return ret;\r\n    }\r\n    async save(discription:string, data:M):Promise<SheetSaveReturnV<V>> {\r\n        let {id} = this.uq;\r\n        let params = {app: id, discription: discription, data:data};\r\n        return await new SaveCaller(this, params).request();\r\n    }\r\n    async saveDebugDirect(discription:string, data:M):Promise<SheetSaveReturn> {\r\n        let {id} = this.uq;\r\n        let params = {app: id, discription: discription, data:data};\r\n        return await new SaveDirectCaller(this, params).request();\r\n    }\r\n    async action(id:number, flow:number, state:string, action:string) {\r\n        return await new ActionCaller(this, {id:id, flow:flow, state:state, action:action}).request();\r\n    }\r\n    async actionDebugDirect(id:number, flow:number, state:string, action:string) {\r\n        return await new ActionDirectCaller(this, {id:id, flow:flow, state:state, action:action}).request();\r\n    }\r\n    private unpack(data:any):GetSheetReturn<M> {\r\n        //if (this.schema === undefined) await this.loadSchema();\r\n        let ret = data[0];\r\n        let brief = ret[0];\r\n        let sheetData = this.unpackSheet(brief.data);\r\n        let flows = data[1];\r\n        return {\r\n            brief: brief,\r\n            data: sheetData,\r\n            flows: flows,\r\n        }\r\n    }\r\n    async getSheet(id:number):Promise<GetSheetReturn<M>> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.getSheet(this.name, id);\r\n        */\r\n        let ret = await new GetSheetCaller(this, id).request();\r\n        if (ret[0].length === 0) return await this.getArchive(id);\r\n        return this.unpack(ret);\r\n    }\r\n    async getArchive(id:number):Promise<GetSheetReturn<M>> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchive(this.name, id)\r\n        return this.unpack(ret);\r\n        */\r\n        let ret = await new SheetArchiveCaller(this, id).request();\r\n        return this.unpack(ret);\r\n    }\r\n\r\n    async getArchives(pageStart:number, pageSize:number) {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchives(this.name, {pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {pageStart:pageStart, pageSize:pageSize};\r\n        return await new SheetArchivesCaller(this, params).request();\r\n    }\r\n\r\n    async getStateSheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.stateSheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\r\n        return await new StateSheetsCaller(this, params).request();\r\n    }\r\n    //createPageStateItems<T>(): PageStateItems<T> {return new PageStateItems<T>(this);}\r\n\r\n    async stateSheetCount():Promise<StateCount[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret:StateCount[] = await this.uqApi.stateSheetCount(this.name);\r\n        return this.states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = ret.find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n        */\r\n        return await new StateSheetCountCaller(this, undefined).request();\r\n    }\r\n\r\n    async userSheets(state:string, user:number, pageStart:number, pageSize:number):Promise<any[]> {\r\n        let params = {state:state, user:user, pageStart:pageStart, pageSize:pageSize};\r\n        return await new UserSheetsCaller(this, params).request();\r\n    }\r\n\r\n    async mySheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.mySheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\r\n        return await new MySheetsCaller(this, params).request();\r\n    }\r\n}\r\n\r\nexport class Sheet extends UqSheet<any, any> {\r\n}\r\n\r\nabstract class SheetCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Sheet {return this._entity as Sheet;}\r\n    protected readonly suffix:string;\r\n    get path():string {return `sheet/${this.entity.name}/${this.suffix}`;}\r\n}\r\n\r\nclass SaveCaller extends SheetCaller<{app:number; discription:string; data:any}> {\r\n    get path():string {return `sheet/${this.entity.name}`;}\r\n    buildParams() {\r\n        let {app, discription, data} = this.params;\r\n        return {\r\n            app: app,\r\n            discription: discription,\r\n            data: this.entity.pack(data)\r\n        };\r\n    }\r\n    xresult(res:any):any {\r\n\t\tlet {verify} = this.entity;\r\n\t\tif (verify === undefined) return res;\r\n\t\tlet resVerify = res.verify;\r\n\t\tif (resVerify === undefined || resVerify.length === 0) {\r\n\t\t\tres.verify = undefined;\r\n\t\t\treturn res;\r\n\t\t}\r\n\t\tlet {returns} = verify;\r\n\t\tres.verify = this.entity.unpackReturns(resVerify, returns);\r\n        return res;\r\n    }\r\n}\r\n\r\nclass SaveDirectCaller extends SaveCaller {\r\n    get path():string {return `sheet/${this.entity.name}/direct`;}\r\n}\r\n\r\nclass ActionCaller extends SheetCaller<{id:number, flow:number, state:string, action:string}> {\r\n    method = 'PUT';\r\n    get path():string {return `sheet/${this.entity.name}`;}\r\n}\r\n\r\nclass ActionDirectCaller extends ActionCaller {\r\n    get path():string {return `sheet/${this.entity.name}/direct`;}\r\n}\r\n\r\nclass GetSheetCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //private id:number;\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() {}\r\n    get path():string {return `sheet/${this.entity.name}/get/${this.params}`;}\r\n}\r\n\r\nclass SheetArchiveCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() {}\r\n    get path():string {return `sheet/${this.entity.name}/archive/${this.params}`;}\r\n}\r\n\r\nclass SheetArchivesCaller extends SheetCaller<{pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'archives';\r\n}\r\n\r\nclass StateSheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'states';\r\n}\r\n\r\nclass StateSheetCountCaller extends SheetCaller<undefined> {\r\n    method = 'GET';\r\n    protected readonly suffix = 'statecount';\r\n    xresult(res:any):any {\r\n        let {states} = this.entity;\r\n        return states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = (res as any[]).find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n    }\r\n}\r\n\r\nclass UserSheetsCaller extends SheetCaller<{state:string, user:number, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'user-sheets';\r\n    xresult(res:any):any {\r\n        return res;\r\n    }\r\n}\r\n\r\nclass MySheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'my-sheets';\r\n    xresult(res:any):any {\r\n        return res;\r\n    }\r\n}\r\n/*\r\nexport class PageStateItems<T> extends PageItems<T> {\r\n    private sheet: Sheet;\r\n    constructor(sheet: Sheet) {\r\n        super(true);\r\n        this.sheet = sheet;\r\n        this.pageSize = 10;\r\n\t}\r\n\tprotected async loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n\t\treturn {$page: ret};\r\n\t}\r\n\tprotected getPageId(item:T) {\r\n\t\treturn item === undefined? 0 : (item as any).id;\r\n\t}\r\n}\r\n*/\r\n","import { /*Field, */ArrFields } from './uqMan';\r\nimport { Entity } from './entity';\r\nimport { QueryQueryCaller, QueryPageCaller } from './caller';\r\n\r\nexport type QueryPageApi = (name:string, pageStart:any, pageSize:number, params:any) => Promise<string>;\r\n\r\nexport class UqQuery<P, R> extends Entity {\r\n    get typeName(): string { return 'query';}\r\n    /*\r\n    private pageStart: any;\r\n    private pageSize:number;\r\n    private params:any;\r\n    private more: boolean;\r\n    private startField: Field;\r\n    */\r\n    //list:IObservableArray; \r\n    returns: ArrFields[];\r\n\tisPaged: boolean;\r\n\t\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {returns} = schema;\r\n        this.returns = returns;\r\n        this.isPaged = returns && (returns as any[]).find(v => v.name === '$page') !== undefined;\r\n    }\r\n    /*\r\n    resetPage(size:number, params:any) {\r\n        this.pageStart = undefined;\r\n        this.pageSize = size;\r\n        this.params = params;\r\n        this.more = false;\r\n        //this.list = undefined;\r\n    }\r\n    */\r\n    //get hasMore() {return this.more;}\r\n    /*\r\n    async loadPage():Promise<void> {\r\n        if (this.pageSize === undefined) {\r\n            throw new Error('call resetPage(size:number, params:any) first');\r\n        }\r\n        let pageStart:any;\r\n        if (this.pageStart !== undefined) {\r\n            switch (this.startField.type) {\r\n                default: pageStart = this.pageStart; break;\r\n                case 'date':\r\n                case 'time':\r\n                case 'datetime': pageStart = (this.pageStart as Date).getTime(); break;\r\n            }\r\n        }\r\n\t\tlet ret = await this.page(this.params, pageStart, this.pageSize+1);\r\n\t\tlet page = (ret as any).$page;\r\n        this.list = observable.array([], {deep: false});\r\n        if (page !== undefined) {\r\n            if (page.length > this.pageSize) {\r\n                this.more = true;\r\n                page.pop();\r\n                let ret = this.returns.find(r => r.name === '$page');\r\n                this.startField = ret.fields[0];\r\n                this.pageStart = page[page.length-1][this.startField.name];\r\n            }\r\n            else {\r\n                this.more = false;\r\n            }\r\n            this.list.push(...page);\r\n        }\r\n    }\r\n    */\r\n    protected pageCaller(params: any, $$user:number = undefined, showWaiting: boolean = true): QueryPageCaller {\r\n        return new QueryPageCaller(this, params, $$user, showWaiting);\r\n    }\r\n\r\n    async page(params:P, pageStart:any, pageSize:number, $$user:number = undefined, showWaiting: boolean = true):Promise<R> {\r\n        let p = {pageStart, pageSize, params};\r\n        let res = await this.pageCaller(p, $$user, showWaiting).request();\r\n        return res;\r\n    }\r\n    protected queryCaller(params: P, $$user:number = undefined, showWaiting: boolean = true): QueryQueryCaller {\r\n        return new QueryQueryCaller(this, params, $$user, showWaiting);\r\n    }\r\n    async query(params:P, $$user:number = undefined, showWaiting:boolean = true):Promise<R> {\r\n        let res = await this.queryCaller(params, $$user, showWaiting).request();\r\n        return res;\r\n    }\r\n    async table(params:P, $$user:number = undefined, showWaiting:boolean = true): Promise<any[]> {\r\n        let ret = await this.query(params, $$user, showWaiting);\r\n        for (let i in ret) {\r\n            return (ret as any)[i];\r\n        }\r\n    }\r\n    async obj(params:P, $$user:number = undefined, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.table(params, $$user,showWaiting);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:P, $$user:number = undefined, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.obj(params, $$user, showWaiting);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nexport class Query extends UqQuery<any, any> {\r\n}\r\n","import { UqQuery} from './query';\r\nimport { QueryQueryCaller } from './caller';\r\n\r\nexport class UqBook<P, R> extends UqQuery<P, R> {\r\n    get typeName(): string { return 'book';}\r\n    protected queryApiName = 'book';\r\n\r\n    protected queryCaller(params: any): QueryQueryCaller {\r\n        return new BookQueryCaller(this, params);\r\n    }\r\n}\r\n\r\nexport class Book extends UqBook<any, any> {\r\n}\r\n\r\nexport class BookQueryCaller extends QueryQueryCaller {\r\n    get path():string {return `book/${this.entity.name}`;}\r\n}\r\n","import { UqQuery } from './query';\r\n\r\nexport class UqHistory<P,R> extends UqQuery<P,R>  {\r\n    get typeName(): string { return 'history';}\r\n    protected queryApiName = 'history';\r\n}\r\n\r\nexport class History extends UqHistory<any, any> {\r\n}\r\n","import { Entity } from './entity';\r\nimport { Action, ActionSubmitCaller } from './action';\r\nimport { Query } from './query';\r\nimport { Field } from './uqMan';\r\nimport { EntityCaller, QueryPageCaller, QueryQueryCaller } from './caller';\r\n\r\ninterface MapActions {\r\n    add: Action;\r\n    del: Action;\r\n}\r\ninterface MapQueries {\r\n    all: Query;\r\n    page: Query;\r\n    query: Query;\r\n}\r\n\r\nexport class UqMap extends Entity {\r\n    get typeName(): string { return 'map';}\r\n    keys: Field[];\r\n    actions: MapActions = {} as any;\r\n    queries: MapQueries = {} as any;\r\n    schemaFrom: {owner:string; uq:string};\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.schemaFrom = this.schema.from;\r\n        let {actions, queries, keys} = schema;\r\n        this.uq.buildFieldTuid(this.keys = keys);\r\n        for (let i in actions) {\r\n            let actionSchema = actions[i];\r\n            let {name} = actionSchema;\r\n            let action = this.uq.newAction(name, undefined);\r\n            action.setSchema(actionSchema);\r\n            action.buildFieldsTuid();\r\n            (this.actions as any)[i] = action;\r\n        }\r\n        for (let i in queries) {\r\n            let querySchema = queries[i];\r\n            let {name} = querySchema;\r\n            let query = this.uq.newQuery(name, undefined);\r\n            query.setSchema(querySchema);\r\n            query.buildFieldsTuid();\r\n            (this.queries as any)[i] = query;\r\n        }\r\n    }\r\n\r\n    async add(param:any) {\r\n        let ret = await new AddCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async del(param:any) {\r\n        let ret = await new DelCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async all() {\r\n        let ret = await new AllCaller(this, undefined).request();\r\n        return ret;\r\n    }\r\n\r\n    async page(param:any, pageStart:any, pageSize: number) {\r\n        let ret = await new PageCaller(this, {pageStart:pageStart, pageSize:pageSize, param:param}).request();\r\n        return ret;\r\n    }\r\n\r\n    async query(param:any) {\r\n       let qc = new QueryCaller(this, param);\r\n       let ret = await qc.request();\r\n       return ret;\r\n   }\r\n    async table(params:any): Promise<any[]> {\r\n        let ret = await this.query(params);\r\n        for (let i in ret) {\r\n            return ret[i];\r\n        }\r\n    }\r\n    async obj(params:any):Promise<any> {\r\n        let ret = await this.table(params);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:any):Promise<any> {\r\n        let ret = await this.obj(params);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nexport class Map extends UqMap {\r\n}\r\n\r\nabstract class MapCaller extends EntityCaller<any> {\r\n    protected get entity(): Map {return this._entity as Map;}\r\n    get path():string {return undefined;}\r\n\r\n    protected abstract getCaller(param: any):EntityCaller<any>;\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        let caller = this.getCaller(this.params);\r\n        let res = await this.entity.uqApi.xcall(caller);\r\n        let ret = caller.xresult(res.res);\r\n        return {res: ret};\r\n    }\r\n\r\n    buildParams() {\r\n        let p = super.buildParams();\r\n        return p;\r\n    }\r\n}\r\n\r\nclass AddCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAddCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass DelCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapDelCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass AllCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAllCaller(this.entity, this.entity.queries.all, param);\r\n    }\r\n}\r\n\r\nclass PageCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapPageCaller(this.entity, this.entity.queries.page, param);\r\n    }\r\n}\r\n\r\nclass QueryCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapQueryCaller(this.entity, this.entity.queries.query, param);\r\n    }\r\n}\r\n\r\nclass MapAddCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/add`}\r\n    get headers(): {[header:string]: string} {return undefined;}\r\n}\r\n\r\nclass MapDelCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/del`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapAllCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/all`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapPageCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/page`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n\r\nclass MapQueryCaller extends QueryQueryCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/query`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n}\r\n","import { UqQuery } from './query';\r\n\r\nexport class UqPending<P,R> extends UqQuery<P,R>  {\r\n    get typeName(): string { return 'pending';}\r\n    protected queryApiName = 'pending';\r\n}\r\n\r\nexport class Pending extends UqPending<any, any> {\r\n}\r\n","import { Entity } from \"./entity\";\r\n\r\nexport class UqEnum extends Entity {\r\n    get typeName(): string { return 'enum';}\r\n}","import { Entity } from \"./entity\";\r\nimport { Uq } from \"./uqMan\";\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class UqID<M extends {id:number}> extends Entity {\r\n\tget typeName() {return 'id'}\r\n\tcreate: boolean;\r\n\tupdate: boolean;\r\n\towner: boolean;\r\n\tasync NO(): Promise<string> {\r\n\t\tlet ret = await this.uqApi.post('id-no', {ID:this.name});\r\n\t\treturn ret;\r\n\t};\r\n\tgetIdFromObj(value: any): number {return value['id'];}\r\n\tcacheTuids(defer: number): void {}\r\n\tasync loadValuesFromIds(divName: string, ids:number[]): Promise<M[]> {\r\n\t\tlet ret = await (this.uq as unknown as Uq).QueryID<M>({\r\n\t\t\tIDX: [this],\r\n\t\t\tid: ids\r\n\t\t});\r\n        return ret;\r\n\t}\r\n\tcacheTuidFieldValues(value: any): void {}\r\n\tunpackTuidIds(values:string[]): any[] {return;}\r\n}\r\n\r\nexport class ID extends UqID<any> {\t\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class UqIDX<M> extends Entity {\r\n\tget typeName() {return 'idx'}\r\n}\r\n\r\nexport class IDX extends UqIDX<any> {\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nexport class UqIX<M> extends Entity {\r\n\tget typeName() {return 'ix'}\r\n}\r\n\r\nexport class IX extends UqIX<any> {\r\n}\r\n\r\n/* eslint-enable no-unused-vars */\r\n","import { UqMan } from '../uqMan';\r\n\r\nconst maxCacheSize = 1000;\r\nconst delayLoad = 30; \t// 延迟loading的时间\r\nexport class IDCache {\r\n\tprotected uqMan: UqMan;\r\n\tprivate queue: number[] = [];               \t\t\t\t\t\t\t// 每次使用，都排到队头\r\n\tprivate cache:Map<number, object|number>;    // 已经缓冲的, 如果是数值，则是重复取的次数\r\n\tprivate waitingIds: number[] = [];          \t\t\t\t\t\t\t// 等待loading的\r\n\tprivate timeoutHandler: any;\r\n\r\n\tconstructor(uqMan: UqMan) {\r\n\t\tthis.uqMan = uqMan;\r\n\t\tthis.cache = uqMan.tonva.createObservableMap<number, object|number>();\r\n\t}\r\n\r\n\tgetValue(id:number): object {\r\n\t\tlet ret = this.cache.get(id);\r\n\t\tif (ret === null) return;\r\n\t\tif (ret === undefined) {\r\n\t\t\tthis.useId(id);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (typeof ret === 'number') return;\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprotected async TvIdValues(waitingIds: number[]) {\r\n\t\treturn await this.uqMan.IDTv(waitingIds);\r\n\t}\r\n\r\n\tprivate timeOut = async () => {\r\n\t\tlet waitingIds = this.waitingIds;\r\n\t\tthis.waitingIds = [];\r\n\t\tif (waitingIds.length === 0) return;\r\n\t\tlet values = await this.TvIdValues(waitingIds);\r\n\t\tfor (let val of values) {\r\n\t\t\tlet {id} = val;\r\n\t\t\tif (waitingIds[0] < 0) id = -id;\r\n\t\t\tthis.cache.set(id, val);\r\n\t\t\tlet index = waitingIds.findIndex(v => v === id);\r\n\t\t\tif (index >= 0) waitingIds.splice(index, 1);\r\n\t\t}\r\n\t\tfor (let id of waitingIds) {\r\n\t\t\tthis.cache.set(id, null);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate useId(id:number) {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id !== 'number') {\r\n\t\t\tconsole.error('id cache ' + id + ' is not number');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.cache.has(id) === true) {\r\n\t\t\tthis.moveToHead(id);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tclearTimeout(this.timeoutHandler);\r\n\t\tthis.timeoutHandler = setTimeout(this.timeOut, delayLoad);\r\n\t\t//this.cache.set(id, 0);\r\n\t\tif (this.waitingIds.findIndex(v => v === id) >= 0) {\r\n\t\t\tthis.moveToHead(id);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.queue.length >= maxCacheSize) {\r\n\t\t\t// 缓冲已满，先去掉最不常用的\r\n\t\t\tlet r = this.queue.shift();\r\n\t\t\tif (r === id) {\r\n\t\t\t\t// 如果移除的，正好是现在用的，则插入\r\n\t\t\t\tthis.queue.push(r);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t//let rKey = String(r);\r\n\t\t\tif (this.cache.has(r) === true) {\r\n\t\t\t\t// 如果移除r已经缓存\r\n\t\t\t\tthis.cache.delete(r);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// 如果移除r还没有缓存\r\n\t\t\t\tlet index = this.waitingIds.findIndex(v => v === r);\r\n\t\t\t\tthis.waitingIds.splice(index, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.waitingIds.push(id);\r\n\t\tthis.queue.push(id);\r\n\t\treturn;\r\n\t}\r\n\r\n\tprivate moveToHead(id:number) {\r\n\t\tlet index = this.queue.findIndex(v => v === id);\r\n\t\tthis.queue.splice(index, 1);\r\n\t\tthis.queue.push(id);\r\n\t}\r\n\r\n\tremove(id:number) {\r\n\t\tthis.cache.delete(id);\r\n\t\tlet index = this.queue.findIndex(v => v === id);\r\n\t\tthis.queue.splice(index, 1);\r\n\t\t//this.localArr.removeItem(id);\r\n\t}\r\n\r\n\tresetCache(id:number) {\r\n\t\tthis.remove(id);\r\n\t\tthis.useId(id);\r\n\t}\r\n}\r\n","import { env } from '../tool';\r\nimport { UqMan } from './uqMan';\r\nimport { TuidImport, TuidInner } from './tuid';\r\nimport { Web, UqData } from '../web';\r\nimport { Tonva, UqConfig } from '../core';\r\n\r\n/*\r\nexport interface TVs {\r\n    [uqName:string]: {\r\n        [tuidName: string]: (values: any) => JSX.Element;\r\n    }\r\n}\r\n*/\r\n\r\nexport class UQsMan {\r\n\tprivate readonly tonva: Tonva;\r\n\tprivate readonly web:Web;\r\n    private collection: {[uqLower: string]: UqMan};\r\n    //private readonly tvs: TVs;\r\n\tproxy: any;\r\n\tuqMans: UqMan[] = [];\r\n\r\n    constructor(tonva: Tonva/*, tvs:TVs*/) {\r\n\t\tthis.tonva = tonva;\r\n\t\tthis.web = tonva.web;\r\n        //this.tvs = tvs || {};\r\n\t\t//this.buildTVs();\r\n\t\tthis.uqMans = [];\r\n        this.collection = {};\r\n    }\r\n\r\n\tasync buildUqs(uqDataArr:UqData[], version:string, uqConfigs:UqConfig[], isBuildingUQ:boolean):Promise<string[]> {\r\n        await this.init(uqDataArr);\r\n\r\n\t\tlet localMap = env.localDb.map('$app');\r\n\t\tlet localCacheVersion = localMap.child('version');\r\n\t\tlet cacheVersion = localCacheVersion.get();\r\n\t\tif (version !== cacheVersion) {\r\n\t\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\t\tuqMan.localMap.removeAll();\r\n\t\t\t}\r\n\t\t\tlocalCacheVersion.set(version);\r\n\t\t}\r\n\r\n        let retErrors = await this.load();\r\n\t\tif (retErrors.length > 0) return retErrors;\r\n\t\tif (isBuildingUQ === false) {\r\n\t\t\tthis.setTuidImportsLocal();\r\n\t\t}\r\n\t\tif (retErrors.length > 0) return retErrors;\r\n\t\tif (uqConfigs) {\r\n\t\t\tfor (let uqConfig of uqConfigs) {\r\n\t\t\t\tlet {dev, name, alias} = uqConfig;\r\n\t\t\t\tlet {name:owner, alias:ownerAlias} = dev;\r\n\t\t\t\tlet uqLower = (ownerAlias??owner).toLowerCase() + '/' + (alias??name).toLowerCase();\r\n\t\t\t\tlet uq = this.collection[uqLower];\r\n\t\t\t\tuq.config = uqConfig;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.proxy = this.buildUQs();\r\n\t}\r\n\r\n\tuq(uqName: string): UqMan {\r\n\t\treturn this.collection[uqName.toLowerCase()];\r\n\t}\r\n\t\r\n\tasync getUqUserRoles(uqLower:string):Promise<string[]> {\r\n\t\tlet uqMan = this.collection[uqLower];\r\n\t\tif (uqMan === undefined) return null;\r\n\t\tlet roles = await uqMan.getRoles();\r\n\t\treturn roles;\r\n\t}\r\n\r\n\t/*\r\n    private buildTVs() {\r\n\t\tif (!this.tvs) return;\r\n        for (let i in this.tvs) {\r\n            let uqTVs = this.tvs[i];\r\n            if (uqTVs === undefined) continue;\r\n            let l = i.toLowerCase();\r\n            if (l === i) continue;\r\n            this.tvs[l] = uqTVs;\r\n            for (let j in uqTVs) {\r\n                let en = uqTVs[j];\r\n                if (en === undefined) continue;\r\n                let lj = j.toLowerCase();\r\n                if (lj === j) continue;\r\n                uqTVs[lj] = en;\r\n            }\r\n        }\r\n    }\r\n\t*/\r\n\r\n    async init(uqsData:UqData[]):Promise<void> {\r\n        let promiseInits: PromiseLike<void>[] = [];\r\n\t\tfor (let uqData of uqsData) {\r\n\t\t\tlet {uqOwner, ownerAlias, uqName, uqAlias} = uqData;\r\n\r\n\t\t\t// 原名加入collection\r\n\t\t\tlet uqFullName = uqOwner + '/' + uqName;\r\n\t\t\tlet uqFull = this.collection[uqFullName];\r\n\t\t\tlet uq:UqMan;\r\n\t\t\tif (uqFull) {\r\n\t\t\t\tuq = uqFull;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tuq  = new UqMan(this.tonva, uqData/*, undefined, this.tvs[uqFullName] || this.tvs[uqName]*/);\r\n\t\t\t\tthis.collection[uqFullName] = uq;\r\n\t\t\t\tpromiseInits.push(uq.init());\r\n\t\t\t}\r\n\t\t\tthis.uqMans.push(uq);\r\n\t\t\tlet lower = uqFullName.toLowerCase();\r\n\t\t\tthis.collection[lower] = uq;\r\n\r\n\t\t\t// 别名加入collection\r\n\t\t\tif (uqAlias) uqName = uqAlias;\r\n\t\t\tif (ownerAlias) uqOwner = ownerAlias;\r\n\t\t\tuqFullName = uqOwner + '/' + uqName;\r\n\t\t\tlower = uqFullName.toLowerCase();\r\n\t\t\tthis.collection[lower] = uq;\r\n\t\t}\r\n        await Promise.all(promiseInits);\r\n    }\r\n\r\n    async load(): Promise<string[]> {\r\n        let retErrors:string[] = [];\r\n\t\tlet promises: PromiseLike<string>[] = [];\r\n\t\t//let lowerUqNames:string[] = [];\r\n\t\t// collection有小写名字，还有正常名字\r\n        //for (let i in this.collection) {\r\n\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\t//let lower = (i as string).toLowerCase();\r\n\t\t\t//if (lowerUqNames.indexOf(lower) >= 0) continue;\r\n\t\t\t//lowerUqNames.push(lower);\r\n            //let uq = this.collection[i];\r\n            promises.push(uqMan.loadEntities());\r\n\t\t}\r\n\t\tlet results = await Promise.all(promises);\r\n        for (let result of results)\r\n        {\r\n            let retError = result; // await cUq.loadSchema();\r\n            if (retError !== undefined) {\r\n                retErrors.push(retError);\r\n            }\r\n\t\t}\r\n        return retErrors;\r\n    }\r\n\r\n    private buildUQs(): any {\r\n        let uqs:any = {};\r\n\t\tfunction setUq(uqKey: string, proxy: any):void {\r\n\t\t\tif (!uqKey) return;\r\n\t\t\tlet lower = uqKey.toLowerCase();\r\n\t\t\tuqs[uqKey] = proxy;\r\n\t\t\tif (lower !== uqKey) uqs[lower] = proxy;\r\n\t\t}\r\n\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\tlet proxy = uqMan.createProxy();\r\n\t\t\tsetUq(uqMan.getUqKey(), proxy);\r\n\t\t\tsetUq(uqMan.getUqKeyWithConfig(), proxy);\r\n\t\t\t/*\r\n\t\t\tlet uqKey = uqMan.getUqKey();\r\n\t\t\tlet lower = uqKey.toLowerCase();\r\n\t\t\tuqs[uqKey] = proxy;\r\n\t\t\tif (lower !== uqKey) uqs[lower] = proxy;\r\n            let uqKeyWithConfig = uqMan.getUqKeyWithConfig();\r\n\t\t\tlet lowerWithConfig = uqKeyWithConfig.toLowerCase();\r\n\t\t\tuqs[uqKeyWithConfig] = proxy;\r\n\t\t\tif (lowerWithConfig !== uqKeyWithConfig) uqs[lowerWithConfig] = proxy;\r\n\t\t\t*/\r\n        }\r\n        return new Proxy(uqs, {\r\n            get: (target, key, receiver) => {\r\n                let lk = (key as string).toLowerCase();\r\n                let ret = target[lk];\r\n                if (ret !== undefined) return ret;\r\n                debugger;\r\n                console.error(`controller.uqs.${String(key)} undefined`);\r\n                this.showReload(`新增 uq ${String(key)}`);\r\n                return undefined;\r\n            },\r\n        });\r\n\t}\r\n\t\r\n\tgetUqMans() {\r\n\t\treturn this.uqMans;\r\n\t}\r\n\r\n    private showReload(msg: string) {\r\n\t\tfor (let uqMan of this.uqMans) {\r\n\t\t\tuqMan.localMap.removeAll();\r\n\t\t}\r\n        this.web.showReloadPage(msg);\r\n    }\r\n\r\n    setTuidImportsLocal():string[] {\r\n        let ret:string[] = [];\r\n        for (let uqMan of this.uqMans) {\r\n            for (let tuid of uqMan.tuidArr) {\r\n                if (tuid.isImport === true) {\r\n                    let error = this.setInner(tuid as TuidImport);\r\n                    if (error) ret.push(error);\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private setInner(tuidImport: TuidImport):string {\r\n        let {from} = tuidImport;\r\n        let fromName = from.owner + '/' + from.uq;\r\n        let uq = this.collection[fromName];\r\n        if (uq === undefined) {\r\n            //debugger;\r\n\t\t\tif (env.buildingUq === false) {\r\n            \tconsole.error(`setInner(tuidImport: TuidImport): uq ${fromName} is not loaded`);\r\n\t\t\t}\r\n\t\t\treturn;\r\n        }\r\n        let iName = tuidImport.name\r\n        let tuid = uq.tuid(iName);\r\n        if (tuid === undefined) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} has no Tuid ${iName}`;\r\n        }\r\n        if (tuid.isImport === true) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} Tuid ${iName} is import`;\r\n        }\r\n        tuidImport.setFrom(tuid as TuidInner);\r\n    }\r\n}\r\n","import { Tonva, AppConfig as AppConfigCore, UqConfig } from '../core';\r\nimport { UQsMan } from \"./uqsMan\";\r\nimport { LocalMap, LocalCache, env } from '../tool';\r\nimport { UqData, UqAppData, CenterAppApi } from '../web';\r\n\r\nexport class UQsLoader {\r\n\treadonly tonva: Tonva;\r\n    protected readonly appConfig: AppConfigCore;\r\n\tprotected isBuildingUQ: boolean = false;\r\n\tuqsMan: UQsMan;         // value\r\n\r\n    constructor(tonva: Tonva, appConfig: AppConfigCore) {\r\n        this.appConfig = appConfig;\r\n\t\tthis.tonva = tonva;\r\n    }\r\n\r\n\tasync build() {\r\n\t\tlet {app, uqs} = this.appConfig;\r\n\t\tlet retErrors:string[];\r\n\t\tif (app) {\r\n\t\t\tretErrors = await this.loadApp();\r\n\t\t}\r\n\t\telse if (uqs) {\r\n\t\t\tretErrors = await this.loadUqs();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error('either uqs or app must be defined in AppConfig');\r\n\t\t}\r\n\t\treturn retErrors;\r\n\t}\r\n    /*\r\n\tasync buildUQs(uqsConfig: AppConfig) {\r\n\t\tlet {uqs, tvs, version} = uqsConfig;\r\n\t\tlet retErrors:string[];\r\n\t\tif (uqs) {\r\n\t\t\tUQsMan.isBuildingUQ = true;\r\n\t\t\tretErrors = await this.loadUqs();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error('either uqs or app must be defined in AppConfig');\r\n\t\t}\r\n\t\treturn retErrors;\r\n\t}\r\n    */\r\n\r\n\t// 返回 errors, 每个uq一行\r\n\tprivate async loadApp():Promise<string[]> {\r\n\t\tlet {app, uqs:uqConfigs, version} = this.appConfig;\r\n\r\n\t\tlet {name, dev} = app;\r\n        let uqsManApp = new UQsManApp(this.tonva, `${dev.name}/${name}`);\r\n\t\tthis.uqsMan = uqsManApp;\r\n        let {appOwner, appName, localData} = uqsManApp;\r\n        let uqAppData:UqAppData = localData.get();\r\n        if (!uqAppData || uqAppData.version !== version) {\r\n\t\t\tuqAppData = await this.loadUqAppData(appOwner, appName);\r\n\t\t\tif (!uqAppData.id) {\r\n\t\t\t\treturn [\r\n\t\t\t\t\t`${appOwner}/${appName}不存在。请仔细检查app全名。`\r\n\t\t\t\t];\r\n\t\t\t}\r\n            uqAppData.version = version;\r\n\r\n\t\t\tif (uqConfigs) {\r\n\t\t\t\tlet data = await this.loadUqData(uqConfigs);\r\n\t\t\t\tuqAppData.uqs.push(...data);\r\n\t\t\t}\r\n\r\n            localData.set(uqAppData);\r\n            // \r\n            for (let uq of uqAppData.uqs) uq.newVersion = true;\r\n        }\r\n        let {id, uqs} = uqAppData;\r\n\t\tuqsManApp.id = id;\r\n\t\treturn await this.uqsMan.buildUqs(uqs, version, uqConfigs, this.isBuildingUQ);\r\n\t}\r\n\r\n\t// 返回 errors, 每个uq一行\r\n\tasync loadUqs(/*uqConfigs: UqConfig[], version:string, tvs:TVs*/):Promise<string[]> {\r\n        let {uqs:uqConfigs, version} = this.appConfig;\r\n\t\tthis.uqsMan = new UQsMan(this.tonva);\r\n\t\tlet uqs = await this.loadUqData(uqConfigs);\r\n\t\treturn await this.uqsMan.buildUqs(uqs, version, uqConfigs, this.isBuildingUQ);\r\n\t}\r\n\r\n    private async loadUqAppData(appOwner:string, appName:string): Promise<UqAppData> {\r\n        let centerAppApi = new CenterAppApi(this.tonva.web, 'tv/', undefined);\r\n        let ret = await centerAppApi.appUqs(appOwner, appName);\r\n        return ret;\r\n    }\r\n    \r\n    private async loadUqData(uqConfigs: UqConfig[]): Promise<UqData[]> {\r\n        let uqs: {owner:string; ownerAlias: string; name:string; alias:string; version:string}[] = uqConfigs.map(\r\n            v => {\r\n                let {dev, name, version, alias} =v;\r\n                let {name:owner, alias:ownerAlias} = dev;\r\n                return {owner, ownerAlias, name, version, alias};\r\n            }\r\n        );\r\n        let centerAppApi = new CenterAppApi(this.tonva.web, 'tv/', undefined);\r\n        let ret:UqData[] = await centerAppApi.uqs(uqs);\r\n        if (ret.length < uqs.length) {\r\n            let err = `下列UQ：\\n${uqs.map(v => `${v.owner}/${v.name}`).join('\\n')}之一不存在`;\r\n            console.error(err);\r\n            throw Error(err);\r\n        }\r\n        for (let i=0; i<uqs.length; i++) {\r\n            let {ownerAlias, alias} = uqs[i];\r\n            ret[i].ownerAlias = ownerAlias;\r\n            ret[i].uqAlias = alias;\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nclass UQsManApp extends UQsMan {\r\n    readonly appOwner: string;\r\n    readonly appName: string;\r\n    readonly localMap: LocalMap;\r\n    readonly localData: LocalCache;\r\n    id: number;\r\n\r\n\tconstructor(tonva: Tonva, tonvaAppName:string/*, tvs:TVs*/) {\r\n\t\tsuper(tonva/*, tvs*/);\r\n        let parts = tonvaAppName.split('/');\r\n        if (parts.length !== 2) {\r\n            throw new Error('tonvaApp name must be / separated, owner/app');\r\n        }\r\n        this.appOwner = parts[0];\r\n        this.appName = parts[1];\r\n        this.localMap = env.localDb.map(tonvaAppName);\r\n        this.localData = this.localMap.child('uqData');\r\n\t}\r\n}\r\n\r\nexport class UQsBuildingLoader extends UQsLoader {\r\n\tasync build() {\r\n\t\t//nav.forceDevelopment = true;\r\n\t\tenv.isDevelopment = true;\r\n\t\t//await nav.init();\r\n\t\t//await this.tonva.web.navInit();\r\n\t\tawait this.tonva.init();\r\n\t\tthis.isBuildingUQ = true;\r\n\t\tlet {uqs} = this.appConfig;\r\n\t\tlet retErrors:string[];\r\n\t\tif (uqs) {\r\n\t\t\tretErrors = await this.loadUqs();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthrow new Error('uqs must be defined in AppConfig');\r\n\t\t}\r\n\t\treturn retErrors;\r\n\t}\r\n}\r\n","export function uqStringify(values: any): string {\r\n    let s = '{';\r\n    if (values === undefined) return 'undefined';\r\n    for (let i in values) {\r\n        let v = values[i];\r\n        s += i + ': ';\r\n        if (v === undefined) {\r\n            s += 'undefined';\r\n        }\r\n        else if (v === null) {\r\n            s += 'null';\r\n        }\r\n        else {\r\n            switch (typeof v) {\r\n                default:\r\n                    s += v;\r\n                    break;\r\n                case 'function':\r\n                    s += 'function';\r\n                    break;\r\n                case 'object':\r\n                    s += '{obj}';\r\n                    break;\r\n            }\r\n        }\r\n        s += ', ';\r\n    }\r\n    return s + '}';\r\n}\r\n","export interface KeyValueRes {\r\n    [key:string]: any;\r\n}\r\n\r\nexport interface Res<T extends KeyValueRes> {\r\n    [lang:string]: T | {[district:string]: T};\r\n}\r\n\r\nexport const resOptions:{\r\n\tlang: string;\r\n\t$lang: string;\r\n\tdistrict: string;\r\n\t$district: string;\r\n} = {\r\n\tlang: undefined,\r\n\t$lang: undefined,\r\n\tdistrict: undefined,\r\n\t$district: undefined,\r\n}\r\n\r\nexport function setResOptions(lang:string, district:string) {\r\n\tresOptions.lang = lang;\r\n\tresOptions.$lang = '$' + lang;\r\n    resOptions.district = district;\r\n    resOptions.$district = '$' + district;\r\n}\r\n\r\n(function() {\r\n    let lang: string, district: string;\r\n    let language = (navigator.languages && navigator.languages[0])  // Chrome / Firefox\r\n        || navigator.language; // ||   // All browsers\r\n    //navigator.userLanguage; // IE <= 10\r\n    if (!language) {\r\n        lang = 'zh';\r\n        district = 'CN';\r\n    }\r\n    else {\r\n        let parts = language.split('-');\r\n        lang = parts[0];\r\n        if (parts.length > 1) district = parts[1].toUpperCase();\r\n    }\r\n    setResOptions(lang, district);\r\n}());\r\n\r\nexport function resLang<T extends KeyValueRes>(res:Res<T>):T {\r\n    let {lang, district} = resOptions;\r\n    let ret:T = {} as T;\r\n    if (res === undefined) return ret;\r\n    Object.assign(ret, res._);\r\n    let l = res[lang];\r\n    if (l === undefined) return ret;\r\n    Object.assign(ret, l._);\r\n    let d = l[district];\r\n    if (d === undefined) return ret;\r\n    Object.assign(ret, d);\r\n    let {entity} = ret;\r\n    if (entity !== undefined) {\r\n        for (let i in entity) {\r\n            entity[i.toLowerCase()] = entity[i];\r\n        }\r\n    }\r\n    return ret;\r\n}\r\n\r\nexport const resGlobal:any = {};\r\nexport function setRes(target: any, res: any):(str:string)=>any {\r\n\tif (res === undefined) return;\r\n\tlet {$lang, $district} = resOptions;\r\n\tObject.assign(target, res);\r\n\tif ($lang !== undefined) {\r\n\t\tlet l = res[$lang];\r\n\t\tif (l !== undefined) {\r\n\t\t\tObject.assign(target, l);\r\n\t\t\tlet d = l[$district];\r\n\t\t\tif (d !== undefined) {\r\n\t\t\t\tObject.assign(target, d);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn function(str:string) {\r\n\t\treturn target[str] || str;\r\n\t}\r\n}\r\nexport function setGlobalRes(res: any) {\r\n\tsetRes(resGlobal, res);\r\n}\r\n/*\r\nexport function t(str:string):string|JSX.Element {\r\n\treturn resGlobal[str] || str;\r\n}\r\nexport type TFunc = (str:string|JSX.Element) => string|JSX.Element;\r\n*/\r\n\r\n","import { KeyValueRes, Res } from './res';\r\n\r\nexport interface InputRes extends KeyValueRes {\r\n    required: string;\r\n    number: string;\r\n    integer: string;\r\n    min: string;\r\n    max: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const inputRes:Res<InputRes> = {\r\n    _: {\r\n        required: 'required',\r\n        number: 'not valid number',\r\n        integer: 'not valid integer',\r\n        min: 'min value is ${min}',\r\n        max: 'max value is ${max}',\r\n    },\r\n    zh: {\r\n        _: {\r\n            required: '必须填',\r\n            number: '需要数字',\r\n            integer: '需要整数',\r\n            min: '不能小于${min}',\r\n            max: '不能大于${max}',\r\n        }\r\n    },\r\n}\r\n","import { Navigo, Hooks, NamedRoute, RouteFunc } from \"./Navigo\";\r\nimport { Nav} from './Nav';\r\nimport { Web } from '../web';\r\nimport { resOptions } from '../res';\r\nimport { LocalData, env, User, Guest } from '../tool';\r\n\r\nexport interface NavSettings {\r\n    oem?: string;\r\n    loginTop?: JSX.Element;\r\n    privacy?: string;\r\n\thtmlTitle?: string;\r\n}\r\n\r\nlet logMark: number;\r\nconst logs:string[] = [];\r\n\r\nexport let tonva: Tonva;\r\n\r\nexport abstract class Tonva {\r\n    readonly web: Web;\r\n\tprivate wsHost: string;\r\n    private local: LocalData = new LocalData();\r\n\tprivate navigo: Navigo;\r\n\t//isWebNav:boolean = false;\r\n\tnavSettings: NavSettings;\r\n    user: User = null;\r\n    testing: boolean;\r\n    language: string;\r\n    culture: string;\r\n    resUrl: string;\r\n\r\n    constructor() {\r\n        tonva = this;\r\n        this.web = this.createWeb();\r\n        let {lang, district} = resOptions;\r\n        this.language = lang;\r\n        this.culture = district;\r\n\t\tthis.testing = false;\r\n    }\r\n\r\n    protected abstract startWait(): void;\r\n    protected abstract endWait(): void;\r\n    protected abstract showLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean): Promise<void>;\r\n    \r\n    abstract createWeb(): Web;\r\n    abstract createObservableMap<K, V>(): Map<K, V>;\r\n    abstract get nav(): Nav;\r\n\r\n    abstract privacyEntry():void;\r\n    abstract showLogout(callback?: ()=>Promise<void>): Promise<void>;\r\n    abstract openSysPage(url: string):boolean;\r\n    abstract changePassword(): Promise<void>;\r\n    abstract userQuit(): Promise<void>;\r\n    abstract resetAll: () => void;\r\n    abstract showAppView(isUserLogin?: boolean):Promise<void>;\r\n    abstract clear(): void;\r\n\r\n    get guest(): number {\r\n        let guest = this.local.guest;\r\n        if (guest === undefined) return 0;\r\n        let g = guest.get();\r\n        if (g === undefined) return 0;\r\n        return g.guest;\r\n    }\r\n    async onReceive(msg:any) {\r\n        //if (this.ws === undefined) return;\r\n        await this.web.messageHub.dispatch(msg);\r\n    }\r\n\r\n\tprivate async loadUnitJson() {\r\n\t\ttry {\r\n\t\t\tlet unitJsonPath = this.unitJsonPath();\r\n\t\t\tlet unitRes = await fetch(unitJsonPath, {});\r\n\t\t\tlet res = await unitRes.json();\r\n\t\t\treturn res.unit;\r\n\t\t}\r\n\t\tcatch (err1) {\r\n\t\t\tthis.local.unit.remove();\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n    private async getPredefinedUnitName() {\t\t\r\n\t\tlet el = document.getElementById('unit');\r\n\t\tif (el) {\r\n\t\t\treturn el.innerText;\r\n\t\t}\r\n\t\tel = document.getElementById('unit.json');\r\n\t\tif (!el) {\r\n\t\t\treturn await this.loadUnitJson();\r\n\t\t}\r\n\t\ttry {\r\n            let json = el.innerHTML;\r\n            let res = JSON.parse(json);\r\n            return res.unit;\r\n        }\r\n        catch (err) {\r\n\t\t\treturn await this.loadUnitJson();\r\n        }\r\n    }\r\n\r\n    private async loadPredefinedUnit() {\r\n        let envUnit = process.env.REACT_APP_UNIT;\r\n        if (envUnit !== undefined) {\r\n            return Number(envUnit);\r\n        }\r\n        let unitName:string;\r\n        let unit = this.local.unit.get();\r\n        if (unit !== undefined) {\r\n            if (env.isDevelopment !== true) return unit.id;\r\n            unitName = await this.getPredefinedUnitName();\r\n            if (unitName === undefined) return;\r\n            if (unit.name === unitName) return unit.id;\r\n        }\r\n        else {\r\n            unitName = await this.getPredefinedUnitName();\r\n            if (unitName === undefined) return;\r\n        }\r\n        let unitId = await this.web.guestApi.unitFromName(unitName);\r\n        if (unitId !== undefined) {\r\n            this.local.unit.set({id: unitId, name: unitName});\r\n        }\r\n        return unitId;\r\n    }\r\n\r\n    setSettings(settings?: NavSettings) {\r\n        this.navSettings = settings;\r\n\t\tlet {htmlTitle} = settings;\r\n\t\tif (htmlTitle) {\r\n\t\t\tdocument.title = htmlTitle;\r\n\t\t}\r\n\t\tlet html = document.getElementsByTagName('html');\r\n\t\tlet html0 = html[0];\r\n\t\tif (html0) {\r\n\t\t\tlet version = html0?.getAttribute('data-version');\r\n\t\t\tif (version) {\r\n\t\t\t\t//appConfig.version = version;\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t}\r\n\r\n    get oem():string {\r\n        return this.navSettings && this.navSettings.oem;\r\n    }\r\n\r\n    hashParam: string;\r\n    private centerHost: string;\r\n    private arrs = ['/test', '/test/'];\r\n    private unitJsonPath():string {\r\n        let {origin, pathname} = document.location;\r\n\t\tpathname = pathname.toLowerCase();\r\n        for (let item of this.arrs) {\r\n            if (pathname.endsWith(item) === true) {\r\n                pathname = pathname.substr(0, pathname.length - item.length);\r\n                break;\r\n            }\r\n        }\r\n        if (pathname.endsWith('/') === true || pathname.endsWith('\\\\') === true) {\r\n            pathname = pathname.substr(0, pathname.length-1);\r\n        }\r\n        return origin + pathname + '/unit.json';\r\n    }\r\n    private windowOnError = (event: Event | string, source?: string, lineno?: number, colno?: number, error?: Error) => {\r\n\t\tdebugger;\r\n        console.error('windowOnError');\r\n        console.error(error);\r\n    }\r\n    private windowOnUnhandledRejection = (ev: PromiseRejectionEvent) => {\r\n\t\tdebugger;\r\n        console.error('windowOnUnhandledRejection');\r\n        console.error(ev.reason);\r\n    }\r\n    private windowOnClick = (ev: MouseEvent) => {\r\n        console.error('windowOnClick');\r\n    }\r\n    private windowOnMouseMove = (ev: MouseEvent) => {\r\n        console.log('navigator.userAgent: ' + navigator.userAgent);\r\n        console.log('mouse move (%s, %s)', ev.x, ev.y);\r\n    }\r\n    private windowOnScroll = (ev: Event) => {\r\n        console.log('scroll event');\r\n\t}\r\n\r\n\tforceDevelopment:boolean;\r\n\t\r\n\tasync init() {\r\n\t\tthis.testing = env.testing;\r\n\t\tif (this.forceDevelopment === true) {\r\n\t\t\tenv.isDevelopment = true;\r\n\t\t}\r\n\t\tawait this.web.host.start(this.testing);\r\n\t\t/*\r\n\t\tlet hash = document.location.hash;\r\n\t\tif (hash !== undefined && hash.length > 0) {\r\n\t\t\tlet pos = getExHashPos();\r\n\t\t\tif (pos < 0) pos = undefined;\r\n\t\t\tthis.hashParam = hash.substring(1, pos);\r\n\t\t}\r\n\t\t*/\r\n\t\tlet {url, ws, resHost} = this.web.host;\r\n\t\tthis.centerHost = url;\r\n\t\tthis.resUrl = this.web.resUrlFromHost(resHost);\r\n\t\tthis.wsHost = ws;\r\n\t\tthis.web.setCenterUrl(url);\r\n\r\n\t\tlet guest:Guest = this.local.guest.get();\r\n\t\tif (guest === undefined) {\r\n\t\t\tguest = await this.web.guestApi.guest();\r\n\t\t}\r\n\t\tif (!guest) {\r\n\t\t\tdebugger;\r\n\t\t\tthrow Error('guest can not be undefined');\r\n\t\t}\r\n\t\tthis.setGuest(guest);\r\n\t}\r\n\r\n\treloadUser = () => {\r\n\t\tlet user: User = this.local.user.get();\r\n\t\tlet curUser = this.user;\r\n\t\tif (!user && !curUser) return;\r\n\t\tif (user?.id === curUser?.id) return;\r\n\t\tif (!user) {\r\n\t\t\tthis.logout();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.logined(user);\r\n\t\t}\r\n\t}\r\n\r\n    //private appStarted:boolean = false;\r\n    async appStart() {\r\n        //if (this.appStarted === true) return;\r\n        //this.appStarted = true;\r\n        await this.init();\r\n        await this.start();\r\n    }\r\n\r\n    async start() {\r\n        try {\r\n            window.onerror = this.windowOnError;\r\n            window.onunhandledrejection = this.windowOnUnhandledRejection;\r\n            window.onfocus = this.reloadUser;\r\n            if (env.isMobile === true) {\r\n                document.onselectstart = function() {return false;}\r\n                document.oncontextmenu = function() {return false;}\r\n            }\r\n\t\t\tthis.clear();\r\n\t\t\tthis.startWait();\r\n            \r\n            let user: User = this.local.user.get();\r\n            if (user === undefined) {\r\n                throw new Error('to be implemented');\r\n                /*\r\n                let {userPassword} = this.navView.props;\r\n\t\t\t\tif (userPassword) {\r\n\t\t\t\t\tlet ret = await userPassword();\r\n\t\t\t\t\tif (ret) {\r\n\t\t\t\t\t\tlet {user:userName, password} = ret;\r\n\t\t\t\t\t\tlet logindUser = await this.web.userApi.login({\r\n\t\t\t\t\t\t\tuser: userName,\r\n\t\t\t\t\t\t\tpwd: password,\r\n\t\t\t\t\t\t\tguest: this.guest,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tuser = logindUser;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (user === undefined) {\r\n\t\t\t\t\tlet {notLogined} = this.navView.props;\r\n\t\t\t\t\tif (notLogined !== undefined) {\r\n\t\t\t\t\t\tawait notLogined();\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tawait this.showLogin(undefined);\r\n\t\t\t\t\t\t//nav.navigateToLogin();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n                */\r\n            }\r\n\r\n            await this.logined(user);\r\n        }\r\n        catch (err) {\r\n\t\t\tconsole.error(err);\r\n\t\t\tdebugger;\r\n        }\r\n        finally {\r\n            this.endWait();\r\n        }\r\n\t}\r\n\r\n\tresolveRoute() {\r\n\t\t//if (this.isRouting === false) return;\r\n\t\tif (this.navigo === undefined) return;\r\n\t\tthis.navigo.resolve();\r\n\t}\r\n\r\n\ton(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\ton(...args:any[]):Navigo {\r\n\t\tif (this.navigo === undefined) {\r\n\t\t\tthis.navigo = new Navigo();\r\n\t\t\tif (this.nav.isWebNav !== true) this.navigo.historyAPIUpdateMethod('replaceState');\r\n\t\t}\r\n\t\treturn this.navigo.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tnavigateToLogin() {\r\n\t\tthis.navigate('/login');\r\n\t}\r\n\r\n\tnavigate(url:string, absolute?:boolean) {\r\n\t\tif (!this.navigo) {\r\n\t\t\talert('Is not in webnav state, cannot navigate to url \"' + url + '\"');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.testing === true) {\r\n\t\t\turl += '#test';\r\n\t\t}\r\n\t\treturn this.navigo.navigate(url, absolute);\r\n\t}\r\n\r\n\tgo(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tif (this.navigo !== undefined) {\r\n\t\t\tthis.navigate(url, absolute);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tshowPage();\r\n\t\t}\r\n\t}\r\n\r\n    setGuest(guest: Guest) {\r\n        this.local.guest.set(guest);\r\n        this.web.setNetToken(0, guest.token);\r\n    }\r\n\r\n    saveLocalUser() {\r\n        this.local.user.set(this.user);\r\n    }\r\n\r\n\tsetUqRoles(uq:string, roles:string[]) {\r\n\t\tlet {roles:userRoles} = this.user;\r\n\t\tif (!userRoles) {\r\n\t\t\tthis.user.roles = {};\r\n\t\t}\r\n\t\tthis.user.roles[uq] = roles;\r\n\t\tthis.local.user.set(this.user);\r\n\t}\r\n\r\n    async loadMe() {\r\n        let me = await this.web.userApi.me();\r\n        this.user.icon = me.icon;\r\n        this.user.nick = me.nick;\r\n    }\r\n\r\n\tprivate async internalLogined(user: User, callback: (user:User)=>Promise<void>, isUserLogin:boolean) {\r\n        this.web.logoutApis();\r\n        this.user = user;\r\n        this.saveLocalUser();\r\n\t\tthis.web.setNetToken(user.id, user.token);\r\n\t\tthis.clear();\r\n\r\n\t\tawait this.onChangeLogin?.(this.user);\r\n        if (callback !== undefined) {\r\n            await callback(user);\r\n\t\t}\r\n        else if (this.nav.isWebNav === true) {\r\n\t\t\tthis.navigate('/index');\r\n\t\t}\r\n\t\telse {\r\n            await this.showAppView(isUserLogin);\r\n        }\r\n\t}\r\n\r\n\tonChangeLogin: (user:User) => Promise<void>;\r\n\r\n\t// 缓冲登录\r\n    async logined(user: User, callback?: (user:User)=>Promise<void>) {\r\n\t\tawait this.internalLogined(user, callback, false);\r\n    }\r\n\r\n\t// 用户操作之后登录\r\n    async userLogined(user: User, callback?: (user:User)=>Promise<void>) {\r\n\t\tawait this.internalLogined(user, callback, true);\r\n    }\r\n\r\n    loginTop(defaultTop:JSX.Element) {\r\n        return (this.navSettings && this.navSettings.loginTop) || defaultTop;\r\n    }\r\n\r\n    async logout(callback?:()=>Promise<void>) { //notShowLogin?:boolean) {\r\n\t\tthis.local.logoutClear();\r\n        this.user = undefined; //{} as User;\r\n        this.web.logoutApis();\r\n        let guest = this.local.guest.get();\r\n        this.web.setCenterToken(0, guest && guest.token);\r\n\t\tthis.clear();\r\n        if (callback === undefined)\r\n            await this.start();\r\n        else\r\n            await callback();\r\n\t\tthis.onChangeLogin?.(undefined);\r\n\t}\r\n\r\n\r\n    get logs() {return logs};\r\n    log(msg:string) {\r\n        logs.push(msg);\r\n    }\r\n    logMark() {\r\n        let date = new Date();\r\n        logMark = date.getTime();\r\n        logs.push('log-mark: ' + date.toTimeString());\r\n    }\r\n    logStep(step:string) {\r\n        logs.push(step + ': ' + (new Date().getTime() - logMark));\r\n    }\r\n\r\n    reload = async () => {\r\n        let waiting:Promise<void> = new Promise<void>((resolve, reject) => {\r\n            setTimeout(resolve, 100);\r\n        });\r\n\r\n        if ('serviceWorker' in navigator) {\r\n            let registration =await Promise.race([waiting, navigator.serviceWorker.ready]);\r\n            if (registration) registration.unregister();\r\n        }\r\n\t\twindow.document.location.reload();\r\n\t\t// dcloud hbuilder里面的app自动升级，需要清webview的缓存\r\n\t\tlet plus = (window as any).plus;\r\n\t\tif (plus) {\r\n\t\t\tlet webview = plus.webview;\r\n\t\t\tif (webview) {\r\n\t\t\t\tif (webview.reload) webview.reload(true);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet webView = plus.webView;\r\n\t\t\t\tif (webView) {\r\n\t\t\t\t\tif (webView.reload) webView.reload(true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//plus.webview.reload(true)\r\n\t\t}\r\n    }\r\n}\r\n","import { KeyValueRes, Res } from './res';\r\n\r\nexport interface ListRes extends KeyValueRes {\r\n    none: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const listRes:Res<ListRes> = {\r\n    _: {\r\n        none: '[none]',\r\n    },\r\n    zh: {\r\n        _: {\r\n            none: '[无]',\r\n        }\r\n    },\r\n}\r\n","// typescript version of krasimir/navigo\r\n\r\nexport type RouteFunc = (params?:string|{[name:string]:string}, query?:string) => void;\r\n\r\nexport interface NamedRoute {\r\n\tas: string;\r\n\tuses: RouteFunc;\r\n\thooks?: Hooks;\r\n}\r\nexport interface Hooks {\r\n\tbefore: (done:()=>void, params:object) => void;\r\n\tafter: (params:object) => void;\r\n\tleave: (params:object) => void;\r\n\talready: (params:object) => void;\r\n}\r\ninterface Handler {\r\n\thandler: RouteFunc;\r\n\thooks: Hooks;\r\n}\r\ninterface LastResolved {\r\n\turl: string;\r\n\tquery: string;\r\n\thooks: Hooks;\r\n\tparams?: {[name:string]:string};\r\n\tname?: string;\r\n}\r\ninterface Route {\r\n\troute: string|RegExp;\r\n\thandler: RouteFunc,\r\n\tname: string,\r\n\thooks: Hooks\r\n}\r\n\r\nexport class Navigo {\r\n\tprivate static PARAMETER_REGEXP = /([:*])(\\w+)/g;\r\n\tprivate static WILDCARD_REGEXP = /\\*/g;\r\n\tprivate static REPLACE_VARIABLE_REGEXP = '([^\\\\/]+)';   \t// 单\\，编译错误 ([^\\/]+)\r\n\tprivate static REPLACE_WILDCARD = `(?:.*)`;\r\n\tprivate static FOLLOWED_BY_SLASH_REGEXP = '(?:\\\\/$|$)';\t\t// 单\\，编译错误 (?:\\/$|$)\r\n\tprivate static MATCH_REGEXP_FLAGS = '';\r\n\r\n\tprivate static isPushStateAvailable() {\r\n\t\treturn !!(\r\n\t\t  typeof window !== 'undefined' &&\r\n\t\t  window.history &&\r\n\t\t  window.history.pushState\r\n\t\t);\r\n\t}\r\n\t\r\n\tprivate static clean(s:string|RegExp) {\r\n\t\tif (s instanceof RegExp) return s;\r\n\t\treturn Navigo.cleanUrl(s);\r\n\t}\r\n\tprivate static cleanUrl(s:string) {\r\n\t\treturn s.replace(/\\/+$/, '').replace(/^\\/+/, '^/');\r\n\t}\r\n\r\n\tprivate static regExpResultToParams(match:any[], names:string[]) {\r\n\t\tif (names.length === 0) return null;\r\n\t\tif (!match) return null;\r\n\t\treturn match\r\n\t\t  .slice(1, match.length)\r\n\t\t  .reduce((params, value, index) => {\r\n\t\t\t\tif (params === null) params = {};\r\n\t\t\t\tparams[names[index]] = decodeURIComponent(value);\r\n\t\t\t\treturn params;\r\n\t\t  }, null);\r\n\t}\r\n\t  \r\n\tprivate static replaceDynamicURLParts(route:string|RegExp) {\r\n\t\tlet paramNames:string[] = [], regexp:RegExp;\r\n\t  \r\n\t\tif (route instanceof RegExp) {\r\n\t\t\tregexp = route;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tregexp = new RegExp(\r\n\t\t\t\troute.replace(Navigo.PARAMETER_REGEXP, function (full, dots, name) {\r\n\t\t\t\t\t\tparamNames.push(name);\r\n\t\t\t\t\t\treturn Navigo.REPLACE_VARIABLE_REGEXP;\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.replace(Navigo.WILDCARD_REGEXP, Navigo.REPLACE_WILDCARD) + Navigo.FOLLOWED_BY_SLASH_REGEXP\r\n\t\t\t\t, Navigo.MATCH_REGEXP_FLAGS);\r\n\t\t}\r\n\t\treturn { regexp, paramNames };\r\n\t}\r\n\t  \r\n\tprivate static getUrlDepth(url:string):number {\r\n\t\treturn url.replace(/\\/$/, '').split('/').length;\r\n\t}\r\n\t  \r\n\tprivate static compareUrlDepth(urlA:string, urlB:string) {\r\n\t\treturn Navigo.getUrlDepth(urlB) - Navigo.getUrlDepth(urlA);\r\n\t}\r\n\t  \r\n\tprivate static findMatchedRoutes(url:string, routes:Route[] = []) {\r\n\t\treturn routes.map(route => {\r\n\t\t\tlet { regexp, paramNames } = Navigo.replaceDynamicURLParts(Navigo.clean(route.route));\r\n\t\t\tlet match = url.replace(/^\\/+/, '/').match(regexp);\r\n\t\t\tlet params = Navigo.regExpResultToParams(match, paramNames);\r\n\t\t\treturn match ? { match, route, params } : false;\r\n\t\t}).filter(m => m);\r\n\t}\r\n\t  \r\n\tprivate static match(url:string, routes:Route[]) {\r\n\t\treturn Navigo.findMatchedRoutes(url, routes)[0] || false;\r\n\t}\r\n\t  \r\n\tprivate static root(url:string, routes:Route[]) {\r\n\t\tconst colonExp = RegExp('\\\\/:\\\\D(\\\\w*)', 'g');\r\n\t\tconst exp = ''; // '($|\\\\/)';  // 单\\，编译报错 ($|\\/)\r\n\t\tlet matched = routes.map(\r\n\t\t\troute => {\r\n\t\t\t\tlet r = route.route;\r\n\t\t\t\tif (r === '' || r === '*') return url;\r\n\t\t\t\tif (typeof r === 'string') {\r\n\t\t\t\t\tr = r.replace(colonExp, '\\\\/(\\\\w|%|[\\u4E00-\\u9FCC])+');\r\n\t\t\t\t}\r\n\t\t\t\tlet routeExp = r + exp;\r\n\t\t\t\tlet ret = url.split(new RegExp(routeExp))[0];\r\n\t\t\t\treturn ret;\r\n\t\t\t}\r\n\t\t);\r\n\t\tlet fallbackURL = Navigo.cleanUrl(url);\r\n\t\tlet len = matched.length;\r\n\t\tif (len === 0) return fallbackURL;\r\n\t\tlet matched0 = matched[0];\r\n\t\tif (len === 1) return matched0;\r\n\t\treturn matched.reduce((result, url) => {\r\n\t\t\tif (result.length > url.length) result = url;\r\n\t\t\treturn result;\r\n\t\t}, matched0);\r\n\t}\r\n\t  \r\n\tprivate static isHashChangeAPIAvailable() {\r\n\t\treturn typeof window !== 'undefined' && 'onhashchange' in window;\r\n\t}\r\n\t  \r\n\tprivate static extractGETParameters(url:string):string {\r\n\t\treturn url.split(/\\?(.*)?$/).slice(1).join('');\r\n\t}\r\n\t  \r\n\tprivate static getOnlyURL(url:string, useHash:boolean, hash:string) {\r\n\t\tlet onlyURL = url, split:string[];\r\n\t\tvar cleanGETParam = (str:string) => str.split(/\\?(.*)?$/)[0];\r\n\t  \r\n\t\tif (typeof hash === 'undefined') {\r\n\t\t\t// To preserve BC\r\n\t\t\thash = '#';\r\n\t\t}\r\n\t  \r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t  \tonlyURL = cleanGETParam(url).split(hash)[0];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsplit = url.split(hash);\r\n\t\t\tonlyURL = split.length > 1 ? cleanGETParam(split[1]) : cleanGETParam(split[0]);\r\n\t\t}\r\n\t\treturn onlyURL;\r\n\t}\r\n\t  \r\n\tprivate static manageHooks(handler:RouteFunc, hooks:Hooks, params?:any, exHooks?:Hooks) {\r\n\t\tif (hooks && typeof hooks === 'object') {\r\n\t\t\tif (hooks.before) {\r\n\t\t\t\thooks.before((shouldRoute = true) => {\r\n\t\t\t\tif (!shouldRoute) return;\r\n\t\t\t\thandler();\r\n\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\t}, params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse if (hooks.after) {\r\n\t\t\t\thandler();\r\n\t\t\t\thooks.after && hooks.after(params);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\thandler();\r\n\t}\r\n\t  \r\n\tprivate static isHashedRoot(url:string, useHash:boolean, hash:string) {\r\n\t\tif (Navigo.isPushStateAvailable() && !useHash) {\r\n\t\t  return false;\r\n\t\t}\r\n\t  \r\n\t\tif (!url.match(hash)) {\r\n\t\t  return false;\r\n\t\t}\r\n\t  \r\n\t\tlet split = url.split(hash);\r\n\t  \r\n\t\treturn split.length < 2 || split[1] === '';\r\n\t}\r\n\t\r\n\tprivate root:string;\r\n\tprivate _routes:Route[] = [];\r\n\tprivate _useHash:boolean;\r\n\tprivate _hash:string;\r\n\tprivate _paused:boolean;\r\n\tprivate _destroyed:boolean;\r\n\tprivate _lastRouteResolved:LastResolved;\r\n\tprivate _notFoundHandler:Handler;\r\n\tprivate _defaultHandler:Handler;\r\n\tprivate _usePushState:boolean;\r\n\tprivate _genericHooks:Hooks;\r\n\tprivate _historyUpdateMethod: 'pushState' | 'replaceState'; // HistoryUpdateMethod;\r\n\tprivate timout: any; //NodeJS.Timeout;\r\n\r\n\tconstructor(r:string = null, useHash:boolean = false, hash:string = '#') {\r\n\t\tthis.root = null;\r\n\t\tthis._useHash = useHash;\r\n\t\tthis._hash = (!hash)? '#' : hash;\r\n\t\tthis._paused = false;\r\n\t\tthis._destroyed = false;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._notFoundHandler = null;\r\n\t\tthis._defaultHandler = null;\r\n\t\tthis._usePushState = !useHash && Navigo.isPushStateAvailable();\r\n\t\t//this._onLocationChange = this._onLocationChange.bind(this);\r\n\t\tthis._genericHooks = null;\r\n\t\tthis._historyUpdateMethod = 'pushState';\r\n\t\r\n\t\tif (r) {\r\n\t\t\tthis.root = useHash ? r.replace(/\\/$/, '/' + this._hash) : r.replace(/\\/$/, '');\r\n\t\t} else if (useHash) {\r\n\t\t\tthis.root = this._cLoc().split(this._hash)[0].replace(/\\/$/, '/' + this._hash);\r\n\t\t}\r\n\t\r\n\t\tthis._listen();\r\n\t\tthis.updatePageLinks();\r\n\t}\r\n  \r\n\tnavigate(path:string, absolute:boolean = false):Navigo {\r\n\t\tlet to:string;\r\n\t\tpath = path || '';\r\n\t\tif (this._usePushState) {\r\n\t\t\tto = (!absolute ? this._getRoot() + '/' : '') + path.replace(/^\\/+/, '/');\r\n\t\t\tto = to.replace(/([^:])(\\/{2,})/g, '$1/');\r\n\t\t\tto = to.replace('/#test/', '/');\r\n\t\t\tthis._historyUpdate({}, '', to);\r\n\t\t\tthis.resolve();\r\n\t\t}\r\n\t\telse if (typeof window !== 'undefined') {\r\n\t\t\tpath = path.replace(new RegExp('^' + this._hash), '');\r\n\t\t\tlet {location} = window;\r\n\t\t\tlocation.href = location.href\r\n\t\t\t\t.replace(/#$/, '')\r\n\t\t\t\t.replace(new RegExp(this._hash + '.*$'), '') + this._hash + path;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\ton(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\ton(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\ton(...args:any[]):Navigo {\r\n\t\tlet arg0 = args[0];\r\n\t\tlet arg1 = args[1];\r\n\t\tswitch (typeof arg0) {\r\n\t\t\tcase 'function':\r\n\t\t\t\tthis._defaultHandler = { handler: arg0, hooks: arg1 };\r\n\t\t\t\tif (!this._notFoundHandler) {\r\n\t\t\t\t\tthis._notFoundHandler = this._defaultHandler;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'object':\r\n\t\t\t\tlet orderedRoutes = Object.keys(arg0).sort(Navigo.compareUrlDepth);\r\n\t\t\t\torderedRoutes.forEach(route => this.on(route, arg0[route]));\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tif (args.length < 2) break;\r\n\t\t\t\tif (arg0 === '/') {\r\n\t\t\t\t\tthis._defaultHandler = { \r\n\t\t\t\t\t\thandler: typeof arg1 === 'object'? arg1.uses : arg1, \r\n\t\t\t\t\t\thooks: args[2],\r\n\t\t\t\t\t};\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tthis._add(arg0, arg1, args[2]);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\r\n\toff(handler:RouteFunc):Navigo {\r\n\t\tif (this._defaultHandler !== null && handler === this._defaultHandler.handler) {\r\n\t\t\tthis._defaultHandler = null;\r\n\t\t}\r\n\t\telse if (this._notFoundHandler !== null && handler === this._notFoundHandler.handler) {\r\n\t\t\tthis._notFoundHandler = null;\r\n\t\t}\r\n\t\tthis._routes = this._routes.reduce((result, r) => {\r\n\t\t\tif (r.handler !== handler) result.push(r);\r\n\t\t\treturn result;\r\n\t\t}, []);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tnotFound(handler:RouteFunc, hooks:Hooks):Navigo {\r\n\t\tthis._notFoundHandler = { handler, hooks };\r\n\t\treturn this;\r\n\t}\r\n\r\n\tresolve(current?:string) {\r\n\t\tlet c = current || this._cLoc();\r\n\t\tlet root = this._getRoot();\r\n\t\tlet url = c.replace(root, '');\r\n\t\r\n\t\tif (this._useHash) {\r\n\t\t\tconst exp = '^\\\\/';  // 单\\，编译报错 ^\\/\r\n\t\t\turl = url.replace(new RegExp(exp + this._hash), '/');\r\n\t\t}\r\n\t\r\n\t\tlet GETParameters = Navigo.extractGETParameters(current || this._cLoc());\r\n\t\tlet onlyURL = Navigo.getOnlyURL(url, this._useHash, this._hash);\r\n\t\tif (onlyURL.startsWith('/') === false) {\r\n\t\t\tonlyURL = '/' + onlyURL;\r\n\t\t}\r\n\t\r\n\t\tif (this._paused) return false;\r\n\t\r\n\t\tif (\r\n\t\t\tthis._lastRouteResolved &&\r\n\t\t\tonlyURL === this._lastRouteResolved.url &&\r\n\t\t\tGETParameters === this._lastRouteResolved.query\r\n\t\t) {\r\n\t\t\tif (this._lastRouteResolved.hooks && this._lastRouteResolved.hooks.already) {\r\n\t\t\t\tthis._lastRouteResolved.hooks.already(this._lastRouteResolved.params);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\r\n\t\tlet matched = Navigo.match(onlyURL, this._routes);\r\n\t\r\n\t\tlet manageHooks = (handler:Handler) => {\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\tquery: GETParameters, \r\n\t\t\t\t\t\thooks: handler.hooks\r\n\t\t\t\t\t};\r\n\t\t\t\t\thandler.handler(GETParameters);\r\n\t\t\t\t}, handler.hooks);\r\n\t\t\t}, this._genericHooks);\r\n\t\t}\r\n\r\n\t\tif (matched === false) {\r\n\t\t\tif (this._defaultHandler && (\r\n\t\t\t\tonlyURL === '' ||\r\n\t\t\t\tonlyURL === '/' ||\r\n\t\t\t\tonlyURL === this._hash ||\r\n\t\t\t\tNavigo.isHashedRoot(onlyURL, this._useHash, this._hash)\r\n\t\t\t)) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters, \r\n\t\t\t\t\t\t\thooks: this._defaultHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._defaultHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._defaultHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._defaultHandler);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\telse if (this._notFoundHandler) {\r\n\t\t\t\t/*\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\t\tthis._callLeave();\r\n\t\t\t\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\t\t\t\turl: onlyURL,\r\n\t\t\t\t\t\t\tquery: GETParameters,\r\n\t\t\t\t\t\t\thooks: this._notFoundHandler.hooks\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\tthis._notFoundHandler.handler(GETParameters);\r\n\t\t\t\t\t}, this._notFoundHandler.hooks);\r\n\t\t\t\t}, this._genericHooks);\r\n\t\t\t\t*/\r\n\t\t\t\tmanageHooks(this._notFoundHandler);\r\n\t\t\t}\r\n\t\t\treturn false;\t\r\n\t\t}\r\n\t\tlet m = matched;\r\n\t\tif (m) {\r\n\t\t\tthis._callLeave();\r\n\t\t\tthis._lastRouteResolved = {\r\n\t\t\t\turl: onlyURL,\r\n\t\t\t\tquery: GETParameters,\r\n\t\t\t\thooks: m.route.hooks,\r\n\t\t\t\tparams: m.params,\r\n\t\t\t\tname: m.route.name\r\n\t\t\t};\r\n\t\t\tlet handler = m.route.handler;\r\n\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\tNavigo.manageHooks(() => {\r\n\t\t\t\t\tm.route.route instanceof RegExp ?\r\n\t\t\t\t\thandler(...(m.match.slice(1, m.match.length))) :\r\n\t\t\t\t\thandler(m.params, GETParameters);\r\n\t\t\t\t}, m.route.hooks, m.params, this._genericHooks);\r\n\t\t\t}, this._genericHooks, m.params);\r\n\t\t\treturn m;\r\n\t\t}\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis._routes = [];\r\n\t\tthis._destroyed = true;\r\n\t\tthis._lastRouteResolved = null;\r\n\t\tthis._genericHooks = null;\r\n\t\tclearTimeout(this.timout);\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\twindow.removeEventListener('popstate', this._onLocationChange);\r\n\t\t\twindow.removeEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t}\r\n\r\n\tupdatePageLinks() {\r\n\t\t//var self = this;\r\n\t\tif (typeof document === 'undefined') return;\r\n\t\t\tthis._findLinks().forEach(link => {\r\n\t\t\tif (!link.hasListenerAttached) {\r\n\t\t\t\tlink.addEventListener('click', (e: any) => {\r\n\t\t\t\t\t// e: React.MouseEvent<HTMLElement>\r\n\t\t\t\t\tif((e.ctrlKey || e.metaKey) && e.currentTarget.tagName.toLowerCase() === 'a'){ return false; }\r\n\t\t\t\t\tvar location = this.getLinkPath(link);\r\n\t\t\r\n\t\t\t\t\tif (!this._destroyed) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tthis.navigate(location.replace(/\\/+$/, '').replace(/^\\/+/, '/'));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tlink.hasListenerAttached = true;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgenerate(name:string, data:any = {}) {\r\n\t\tlet result = this._routes.reduce((result, route) => {\r\n\t\t\tif (route.name === name) {\r\n\t\t\t\tresult = route.route.toString();\r\n\t\t\t\tfor (let key in data) {\r\n\t\t\t\t\tresult = result.replace(':' + key, data[key]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}, '');\r\n\t\r\n\t\treturn this._useHash ? this._hash + result : result;\r\n\t}\r\n\r\n\tlink(path:string) {\r\n\t\treturn this._getRoot() + path;\r\n\t}\r\n\r\n\tpause(status:boolean = true) {\r\n\t\tthis._paused = status;\r\n\t\tif (status) {\r\n\t\t\tthis._historyUpdateMethod = 'replaceState';\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis._historyUpdateMethod = 'pushState';\r\n\t\t}\r\n\t}\r\n\r\n\tresume() {\r\n\t\tthis.pause(false);\r\n\t}\r\n\r\n\thistoryAPIUpdateMethod(value:'pushState' | 'replaceState') {\r\n\t\tif (typeof value === 'undefined') return this._historyUpdateMethod;\r\n\t\tthis._historyUpdateMethod = value;\r\n\t\treturn value;\r\n\t}\r\n\r\n\tdisableIfAPINotAvailable() {\r\n\t\tif (!Navigo.isPushStateAvailable()) {\r\n\t\t\tthis.destroy();\r\n\t\t}\r\n\t}\r\n\r\n\tlastRouteResolved() {\r\n\t\treturn this._lastRouteResolved;\r\n\t}\r\n\r\n\tgetLinkPath(link:any) {\r\n\t\treturn link.getAttribute('href');\r\n\t}\r\n\r\n\thooks(hooks:Hooks) {\r\n\t\tthis._genericHooks = hooks;\r\n\t}\r\n\r\n\tprivate _add(route:string|RegExp, handler:RouteFunc|NamedRoute, hooks:Hooks) {\r\n\t\tif (typeof route === 'string') {\r\n\t\t\troute = encodeURI(route);\r\n\t\t}\r\n\t\tthis._routes.push(\r\n\t\t\ttypeof handler === 'object' ?\r\n\t\t\t{\r\n\t\t\t\troute,\r\n\t\t\t\thandler: handler.uses,\r\n\t\t\t\tname: handler.as,\r\n\t\t\t\thooks: hooks || handler.hooks\r\n\t\t\t} \r\n\t\t\t:\r\n\t\t\t{\r\n\t\t\t\troute,\r\n\t\t\t\thandler, \r\n\t\t\t\tname: undefined,\r\n\t\t\t\thooks,\r\n\t\t\t}\r\n\t\t);\r\n\t\treturn this._add;\r\n\t}\r\n\r\n\tprivate _historyUpdate(data:any, title:string, url?:string) {\r\n\t\tswitch (this._historyUpdateMethod) {\r\n\t\t\tdefault: throw Error('unknow history method ' + this._historyUpdateMethod);\r\n\t\t\tcase 'pushState': window.history.pushState(data, title, url); return;\r\n\t\t\tcase 'replaceState': window.history.replaceState(data, title, url); return;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _getRoot() {\r\n\t\tif (this.root === null) {\r\n\t\t\tlet cLoc = this._cLoc();\r\n\t\t\tlet cLocRoot = cLoc.split('?')[0];\r\n\t\t\tthis.root = Navigo.root(cLocRoot, this._routes);\r\n\t\t}\r\n\t\tlet root = this.root.replace('#test', '');\r\n\t\treturn root;\r\n\t}\r\n\r\n\tprivate _listen() {\r\n\t\tif (this._usePushState) {\r\n\t\t\twindow.addEventListener('popstate', this._onLocationChange);\r\n\t\t}\r\n\t\telse if (Navigo.isHashChangeAPIAvailable()) {\r\n\t\t\twindow.addEventListener('hashchange', this._onLocationChange);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet cached = this._cLoc();\r\n\t\r\n\t\t\tlet check = () => {\r\n\t\t\t\tlet current = this._cLoc();\r\n\t\t\t\tif (cached !== current) {\r\n\t\t\t\t\tcached = current;\r\n\t\t\t\t\tthis.resolve();\r\n\t\t\t\t}\r\n\t\t\t\tif (this.timout) clearTimeout(this.timout);\r\n\t\t\t\tthis.timout = setTimeout(check, 200);\r\n\t\t\t};\r\n\t\t\tcheck();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate _cLoc() {\r\n\t\tif (typeof window !== 'undefined') {\r\n\t\t\t//if (typeof window.__NAVIGO_WINDOW_LOCATION_MOCK__ !== 'undefined') {\r\n\t\t\t//\treturn window.__NAVIGO_WINDOW_LOCATION_MOCK__;\r\n\t\t\t//}\r\n\t\t\tlet {href} = window.location;\r\n\t\t\treturn Navigo.cleanUrl(href);\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\r\n\tprivate _findLinks() {\r\n\t\treturn [].slice.call(document.querySelectorAll('[data-navigo]'));\r\n\t}\r\n\r\n\tprivate _onLocationChange = () => {\r\n\t\tconsole.log('_onLocationChange');\r\n\t\tthis.resolve();\r\n\t}\r\n\r\n\tprivate _callLeave() {\r\n\t\tconst lastRouteResolved = this._lastRouteResolved;\t\r\n\t\tif (lastRouteResolved) {\r\n\t\t\tlet {params, hooks} = lastRouteResolved;\r\n\t\t\tif (hooks) {\r\n\t\t\t\tif (hooks.leave) {\r\n\t\t\t\t\thooks.leave(params);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","import jwtDecode from 'jwt-decode';\r\n\r\nexport interface Unit {\r\n    id: number;\r\n    name: string;\r\n}\r\n\r\nexport interface Guest {\r\n    id: number;             // id = 0\r\n    guest: number;\r\n    token: string;\r\n}\r\n\r\nexport interface User extends Guest {\r\n    id: number;\r\n    name: string;\r\n    nick?: string;\r\n\ticon?: string;\r\n\troles?: {[uq:string]: string[]}\r\n}\r\n\r\nexport function decodeUserToken(token: string): User {\r\n    let ret:any = jwtDecode(token);\r\n    let user: User = {\r\n        id: ret.id,\r\n        name: ret.name,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return user;\r\n}\r\n\r\nexport function decodeGuestToken(token: string): Guest {\r\n    let ret:any = jwtDecode(token);\r\n    let guest: Guest = {\r\n        id: 0,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return guest;\r\n}\r\n","const ALPHABET = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\nconst ID_LENGTH = 8;\r\n\r\nexport function uid():string {\r\n    let len = ALPHABET.length;\r\n    let rtn = '';\r\n    for (let i = 0; i < ID_LENGTH; i++) {\r\n        rtn += ALPHABET.charAt(Math.floor(Math.random() * len));\r\n    }\r\n    return rtn;\r\n}\r\n","import { env } from './env';\r\n\r\nexport class LocalData {\r\n    user = env.localDb.child('user');\r\n    guest = env.localDb.child('guest');\r\n    unit = env.localDb.child('unit');\r\n\r\n    private _user:string;\r\n    private _guest:string;\r\n    private _unit:string;\r\n    readToMemory() {\r\n        this._user = this.user.get();\r\n        this._guest = this.guest.get();\r\n        this._unit = this.unit.get();\r\n    }\r\n    saveToLocalStorage() {\r\n        this.user.set(this._user);\r\n        this.guest.set(this._guest);\r\n        this.unit.set(this._unit);\r\n    }\r\n\r\n    logoutClear() {\r\n        [\r\n            this.user,\r\n            this.unit,\r\n        ].forEach(d => d.remove());\r\n    }\r\n}\r\n","export function getObjPropIgnoreCase(obj:any, prop:string):any {\r\n\tif (!obj) return;\r\n\tif (!prop) return;\r\n\tlet keys = Object.keys(obj);\r\n\tprop = prop.toLowerCase();\r\n\tfor (let key of keys) {\r\n\t\tif (key.toLowerCase() === prop) return obj[key];\r\n\t}\r\n\treturn;\r\n}\r\n","import { env } from \"./env\";\r\n\r\nconst options:Intl.DateTimeFormatOptions = { \r\n\tweekday: 'long', \r\n\tyear: 'numeric', \r\n\tmonth: 'long', \r\n\tday: 'numeric' \r\n}\r\n\r\nexport function toLocaleDateString(date:Date) {\r\n\tif (!date) return '';\r\n\treturn date.toLocaleDateString('zh-cn', options);\r\n}\r\n\r\nexport const minute2020_01_01 = 26297280;  // 2020-1-1 到 1970-1-1 的毫秒数\r\nexport function dateFromMinuteId(id: number, timeZone?: number): Date {\r\n\tlet envTimezone = env.timeZone;\r\n\tlet m = (id / Math.pow(2, 20)) + (- envTimezone + (timeZone??envTimezone)) * 60;\r\n\treturn new Date((m + minute2020_01_01) * 60000);\r\n}\r\n\r\nexport function dateFromHourId(id: number, timeZone?: number): Date {\r\n\tlet envTimezone = env.timeZone;\r\n\tlet m = id + (- envTimezone + (timeZone??envTimezone));\r\n\treturn new Date((m + minute2020_01_01/60) * 60 * 60000);\r\n}\r\n","export function capitalCase(s:string):string {\r\n\tlet parts = s.split(/[-._]/);\r\n\treturn parts.map(v => firstCharUppercase(v)).join('_');\r\n}\r\n\r\nexport function camelCase(s:string):string {\r\n\tlet parts = s.split(/[-._]/);\r\n\tlet len = parts.length;\r\n\tparts[0] = firstCharLowercase(parts[0]);\r\n\tfor (let i=1; i<len; i++) {\r\n\t\tparts[1] = firstCharUppercase(parts[1]);\r\n\t}\r\n\treturn parts.join('_');\r\n}\r\n\r\nconst aCode = 'a'.charCodeAt(0);\r\nconst zCode = 'z'.charCodeAt(0);\r\nfunction firstCharUppercase(s:string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= aCode && c <= zCode) {\r\n\t\treturn String.fromCharCode(c - 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\nconst ACode = 'A'.charCodeAt(0);\r\nconst ZCode = 'Z'.charCodeAt(0);\r\nfunction firstCharLowercase(s:string) {\r\n\tif (!s) return '';\r\n\tlet c = s.charCodeAt(0);\r\n\tif (c >= ACode && c <= ZCode) {\r\n\t\treturn String.fromCharCode(c + 0x20) + s.substr(1);\r\n\t}\r\n\treturn s;\r\n}\r\n","\r\nexport const mobileRegex = /^[0-9]*$/;\r\nexport const emailRegex = /\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*/;\r\n// /^([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+\\.[a-zA-Z]{2,3}$/\r\n\r\nexport const EmailFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '电子邮件格式错误';\r\n}\r\n\r\nexport const MobileFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '手机格式错误';\r\n}\r\n","import _ from 'lodash';\r\nimport { resLang, inputRes, InputRes } from 'tonva-core';\r\n\r\nexport abstract class Rule {\r\n    abstract check(defy:string[], value:any):void;\r\n}\r\n\r\n//export type ContextRule = (context:Context)=>{[target:string]:string[]|string} | string[] | string;\r\nexport type FieldRule = (value:any) => string[] | string;\r\n\r\nconst defaultInputRes:InputRes = resLang<InputRes>(inputRes);\r\n\r\nexport class RuleCustom extends Rule {\r\n    private func: FieldRule;\r\n    constructor(func: FieldRule) {\r\n        super();\r\n        this.func = func;\r\n    }\r\n    check(defy:string[], value:any) {\r\n        let ret = this.func(value);\r\n        if (ret === undefined) return;\r\n        switch (typeof ret) {\r\n            case 'undefined': return;\r\n            case 'string': defy.push(ret as string); return;\r\n            default: defy.push(...ret); return;\r\n        }        \r\n    }\r\n}\r\n\r\nexport abstract class RulePredefined extends Rule {\r\n    protected res: InputRes;\r\n    constructor(res?: InputRes) {\r\n        super();\r\n        this.res = res ?? defaultInputRes;\r\n    }\r\n}\r\n\r\nexport class RuleRequired extends RulePredefined {\r\n    check(defy:string[], value:any) {\r\n        switch (typeof value) {\r\n            default:\r\n            case 'boolean': return;\r\n            case 'object':\r\n                if (value !== null) return;\r\n                break;\r\n            case 'string':\r\n                if ((value as string).trim().length > 0) return;\r\n                break;\r\n            case 'number':\r\n                if (isNaN(value as number) === false) return;\r\n                break;\r\n            case 'undefined':\r\n                break;\r\n        }\r\n        defy.push(this.res.required);\r\n    }\r\n}\r\n\r\nexport class RuleNum extends RulePredefined {\r\n    private minMsg: _.TemplateExecutor;\r\n    private maxMsg: _.TemplateExecutor;\r\n    protected min: number;\r\n    protected max: number\r\n    constructor(res: InputRes, min?: number, max?: number) {\r\n        super(res);\r\n        this.minMsg = _.template(this.res.min);\r\n        this.maxMsg = _.template(this.res.max);\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n    check(defy:string[], value:any) {\r\n        if (value === undefined || value === null) return;\r\n        let n = Number(value);\r\n        if (isNaN(n) === true) {\r\n            defy.push(this.res.number);\r\n        }\r\n        else {\r\n            this.checkMore(defy, n);\r\n        }\r\n    }\r\n\r\n    protected checkMore(defy:string[], value: number) {\r\n        if (this.min !== undefined && Number(value) < this.min) {\r\n            defy.push(this.minMsg({min:this.min}));\r\n        }\r\n        if (this.max !== undefined && Number(value) > this.max) {\r\n            defy.push(this.maxMsg({max:this.max}));\r\n        }\r\n    }\r\n}\r\n\r\nexport class RuleInt extends RuleNum {\r\n    protected checkMore(defy:string[], n: number) {\r\n        super.checkMore(defy, n);\r\n        if (Number.isInteger(n) === false) {\r\n            defy.push(this.res.integer);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiItem } from '../../schema';\r\nimport { ChangingHandler, ChangedHandler } from '../../../ui';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { ItemSchema } from '../../schema';\r\nimport { Rule, RuleRequired, RuleCustom, FieldRule } from '../../inputRules';\r\nimport { computed, makeObservable, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Widget {\r\n    name: string;\r\n    protected context: Context;\r\n    protected fieldProps:FieldProps;\r\n    protected children: React.ReactNode;\r\n    protected _itemSchema: ItemSchema;\r\n    protected _ui: UiItem;\r\n\tprotected defaultValue: any;\r\n    protected rules: Rule[];\r\n    protected readOnly:boolean;\r\n\t\r\n\tdisabled:boolean = false;\r\n    errors: string[] = [];\r\n    contextErrors: string[] = [];\r\n    get hasError():boolean {return (this.errors.length + this.contextErrors.length)>0}\r\n    visible:boolean = null;\r\n\tvalue: any = null;\r\n\r\n    constructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tmakeObservable(this, {\r\n\t\t\terrors: observable,\r\n\t\t\tcontextErrors: observable,\r\n\t\t\thasError: computed,\r\n\t\t\tvisible: observable,\r\n\t\t\tvalue: observable,\r\n\t\t\tdisabled: observable,\r\n\t\t\tisOk: computed,\r\n\t\t});\r\n        this.context = context;\r\n        let {name} = itemSchema;\r\n        this.name = name;\r\n        this._itemSchema = itemSchema;\r\n        this.fieldProps = fieldProps;\r\n        this.children = children;\r\n        this._ui = context.getUiItem(name);\r\n        if (this.ui === undefined) {\r\n            this.readOnly = false;\r\n            this.disabled = false;\r\n            this.visible = true;\r\n        }\r\n        else {\r\n            let {readOnly, disabled, visible} = this.ui;\r\n            this.readOnly = (readOnly === true);\r\n            this.disabled = (disabled === true);\r\n            this.visible = !(visible === false);\r\n        }\r\n        this.value = this.defaultValue =  context.getValue(name); //defaultValue;\r\n        // this.init();\r\n    }\r\n\r\n    protected get itemSchema(): ItemSchema {return this._itemSchema};\r\n    protected get ui(): UiItem {return this._ui};\r\n\r\n    init() {\r\n        this.rules = [];\r\n        if (this.itemSchema.required === true) {\r\n            this.rules.push(new RuleRequired(this.context.form.res));\r\n        }\r\n        this.buildRules();\r\n        if (this.ui === undefined) return;\r\n        let {rules} = this.ui;\r\n        if (rules === undefined) return;\r\n        if (Array.isArray(rules) === false) {\r\n            this.rules.push(new RuleCustom(rules as FieldRule));\r\n            return;\r\n        }\r\n        for (let rule of rules as FieldRule[]) {\r\n            this.rules.push(new RuleCustom(rule));\r\n        }\r\n    }\r\n\r\n    protected buildRules() {\r\n    }\r\n\r\n    checkRules() {\r\n        let defy:string[] = [];\r\n        for (let r of this.rules) r.check(defy, this.value);\r\n        if (defy.length === 0) {\r\n            this.context.removeErrorWidget(this);\r\n        }\r\n        else {\r\n            this.context.addErrorWidget(this);\r\n            this.errors.push(...defy);\r\n        }\r\n    }\r\n\r\n    get isOk() {\r\n        return this.errors.length ===0;\r\n    }\r\n\r\n    setError(err:string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.errors.push(err);\r\n        else this.errors.push(...err);\r\n    }\r\n\r\n    setContextError(err:string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.contextErrors.push(err);\r\n        else this.contextErrors.push(...err);\r\n    }\r\n\r\n    clearError() {\r\n        this.errors.splice(0);\r\n    }\r\n\r\n    clearContextError() {\r\n        this.contextErrors.splice(0);\r\n    }\r\n\r\n    protected parse(value:any):any {return value}\r\n\r\n    protected setElementValue(value:any) {}\r\n    protected setDataValue(value:any) {\r\n        if (this.isChanging === true) return;\r\n        this.context.initData[this.name] = this.value = this.parse(value);\r\n    }\r\n\r\n    setValue(value:any) {\r\n        if (this.isChanging === true) return;\r\n        this.changeValue(value, false);\r\n    }\r\n\r\n    getValue() {\r\n        return this.context.getValue(this.name);\r\n    }\r\n\r\n    getReadOnly():boolean {return this.readOnly}\r\n    getDisabled():boolean {return this.disabled}\r\n    getVisible():boolean {return this.visible}\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {\r\n\t\tthis.disabled = value;\r\n\t}\r\n    setVisible(value:boolean) {this.visible = value}\r\n\r\n    private isChanging: boolean;\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n\r\n    protected changeValue(newValue: any, fromElement: boolean) {\r\n        let prev = this.value;\r\n        let onChanging: ChangingHandler;\r\n        let onChanged: ChangedHandler;\r\n        if (this.ui !== undefined) {\r\n            onChanging = this.ui.onChanging;\r\n            onChanged = this.ui.onChanged;\r\n        }\r\n        let allowChange = true;\r\n        if (onChanging !== undefined) {\r\n            this.isChanging = true;\r\n            allowChange = onChanging(this.context, this.value, prev);\r\n            this.isChanging = false;\r\n        }\r\n        if (allowChange === true) {\r\n            this.setDataValue(newValue);\r\n            if (fromElement !== true) this.setElementValue(newValue);\r\n            if (onChanged !== undefined) {\r\n                this.isChanging = true;\r\n                onChanged(this.context, this.value, prev);\r\n                this.isChanging = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected get className():string {\r\n        let fieldClass:string;\r\n        if (this.context.inNode === false) fieldClass = 'form-control';\r\n        return classNames(fieldClass, this.context.form.FieldClass, this.ui && this.ui.className);\r\n    }\r\n\r\n    protected abstract render():JSX.Element;\r\n\r\n    protected renderBody():JSX.Element {\r\n        let elDiscription;\r\n        if (this.hasError === false && this.ui) {\r\n            let {discription, discriptionClassName} = this.ui;\r\n            if (discriptionClassName === undefined) discriptionClassName = 'small text-muted';\r\n            elDiscription = <span className={discriptionClassName}>\r\n                {discription}\r\n            </span>;\r\n        }\r\n        return <>\r\n            {this.render()}\r\n            {elDiscription}\r\n        </>;\r\n    }\r\n\r\n    container = observer(():JSX.Element => {\r\n        if (this.visible === false) return null;\r\n        let {form, inNode} = this.context;\r\n        if (inNode === true) return this.render();\r\n        let label:any = this.label;\r\n        if (this.itemSchema.required === true && form.props.requiredFlag !== false) {\r\n            if (label !== null) label = <>{label}&nbsp;<span className=\"text-danger\">*</span></>;\r\n        }\r\n        return form.FieldContainer(label, this.renderBody());\r\n    })\r\n\r\n    protected get label():string {\r\n        let label:any;\r\n        if (this.ui === undefined) {\r\n            label = this.name;\r\n        }\r\n        else {\r\n            let uiLabel = this.ui.label;\r\n            if (uiLabel === null) label = null;\r\n            else label = uiLabel || this.name;\r\n        }\r\n        return label;\r\n    }\r\n\r\n    protected renderTemplet():JSX.Element | undefined {\r\n        if (this.children !== undefined) {\r\n            return <>{this.children}</>;\r\n        }\r\n        if (this.ui === undefined) return undefined;\r\n        let {Templet} = this.ui;\r\n        if (typeof Templet === 'function') return Templet(this.value);\r\n        return Templet;\r\n    }\r\n\r\n    protected renderErrors() {\r\n        let errorList:string[] = [...this.errors, ...this.contextErrors];\r\n        if (errorList.length === 0) return null;\r\n        let {inNode} = this.context;\r\n        let tag = inNode === true? 'span' : 'div';\r\n        return errorList.map(err => React.createElement(tag, \r\n            {\r\n                key: err, \r\n                className: 'text-danger d-inline-block my-2 ms-3'\r\n            },\r\n            <><i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}</>\r\n        ));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { makeObservable, observable, runInAction } from 'mobx';\r\nimport { UiTextItem, StringSchema, ItemSchema } from '../../schema';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\nimport { Widget } from './widget';\r\n\r\nexport class TextWidget extends Widget {\r\n    protected inputType = 'text';\r\n    protected get ui(): UiTextItem {return this._ui as UiTextItem};\r\n    protected input: HTMLInputElement;\r\n    hasFocus: boolean = false;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\thasFocus: observable,\r\n\t\t})\r\n\t}\r\n\r\n    protected setElementValue(value:any) {\r\n        if (this.input === null) return;\r\n        this.input.value = value;\r\n    }\r\n    protected get placeholder() {\r\n\t\tif (this.ui) {\r\n\t\t\tlet {placeholder} = this.ui;\r\n\t\t\tif (placeholder) return placeholder;\r\n\t\t\tlet {label} = this.ui;\r\n\t\t\tif (label) return label;\r\n\t\t}\r\n\t\treturn this.name\r\n\t}\r\n    protected onKeyDown = async (evt:React.KeyboardEvent<HTMLInputElement>) => {\r\n        this.internalOnKeyDown(evt);\r\n        if (evt.keyCode !== 13) return;\r\n        let {onEnter} = this.context.form.props;\r\n        if (onEnter === undefined) return;\r\n\r\n        this.changeValue(evt.currentTarget.value, true);\r\n\r\n        //this.checkRules();\r\n        //this.context.checkContextRules();\r\n        this.input.blur();\r\n\r\n        let ret = await onEnter(this.name, this.context);\r\n        if (ret !== undefined) {\r\n            this.context.setError(this.name, ret);\r\n        }\r\n    }\r\n\r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n    }\r\n\r\n    protected onBlur = (evt: React.FocusEvent<any>) => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.onInputChange(evt);\r\n\t\t\tthis.checkRules();\r\n\t\t\tthis.context.checkContextRules();\r\n\t\t\tthis.hasFocus = false;\r\n\t\t});\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.context.removeErrorWidget(this);\r\n\t\t\tthis.context.clearErrors();\r\n\t\t\tthis.hasFocus = true;\r\n\t\t});\r\n\t\tsetTimeout(() => {\r\n\t\t\tconsole.log('focus and select');\r\n\t\t\tthis.input.focus();\r\n\t\t\tthis.input.select();\r\n\t\t}, 10)\r\n    }\r\n    protected onChange(evt: React.ChangeEvent<any>) {\r\n\t\tthis.onInputChange(evt);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.readOnly = this.readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.disabled = this.disabled = value;\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {\r\n            //'form-control': true,\r\n        };\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, cn)}\r\n            type={this.inputType}\r\n            defaultValue={this.value}\r\n            onChange={(evt: React.ChangeEvent<any>) => this.onChange(evt)}\r\n            placeholder={typeof this.placeholder === 'string'? this.placeholder : undefined}\r\n            readOnly={this.readOnly}\r\n            disabled={this.disabled}\r\n            onKeyDown = {this.onKeyDown}\r\n            onFocus = {this.onFocus}\r\n            onBlur={this.onBlur}\r\n            maxLength={(this.itemSchema as StringSchema).maxLength} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTextAreaItem } from '../../schema';\r\nimport { StringSchema } from '../../schema';\r\n\r\nexport class TextAreaWidget extends Widget {\r\n    protected get itemSchema(): StringSchema {return this._itemSchema as StringSchema};\r\n    protected input: HTMLTextAreaElement;\r\n    protected get ui(): UiTextAreaItem {return this._ui as UiTextAreaItem};\r\n\r\n    protected setElementValue(value:any) {this.input.value = value}\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.setValue(evt.currentTarget.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n\tprotected onBlur = (evt: React.FocusEvent<any>) => {\r\n        this.onInputChange(evt);\r\n        this.checkRules();\r\n        this.context.checkContextRules();\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n        this.clearError();\r\n        this.context.removeErrorWidget(this);\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {};\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <>\r\n\t\t\t<textarea ref={(input) => this.input=input}\r\n\t\t\t\tonBlur={this.onBlur} \r\n\t\t\t\tonFocus={this.onFocus}\r\n                className={classNames(this.className, cn)}\r\n                rows={this.ui && this.ui.rows}\r\n                maxLength={this.itemSchema.maxLength}\r\n                defaultValue={this.defaultValue} onChange={this.onInputChange} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class PasswordWidget extends TextWidget {\r\n    protected inputType = 'password';\r\n}\r\n\r\nexport class UrlWidget extends TextWidget {\r\n    protected inputType = 'url';\r\n}\r\n\r\nexport class EmailWidget extends TextWidget {\r\n    protected inputType = 'email';\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\nimport { NumBaseSchema } from '../../schema';\r\nimport { RuleInt, RuleNum } from '../../inputRules';\r\n\r\nexport class NumberWidget extends TextWidget {\r\n    protected inputType = 'number';\r\n    protected get itemSchema(): NumBaseSchema {return this._itemSchema as NumBaseSchema};\r\n\r\n    protected buildRules() {\r\n        super.buildRules();\r\n        let res = this.context.form.res;\r\n        let {min, max} = this.itemSchema;\r\n        this.rules.push(\r\n            this.itemSchema.type === 'integer'?\r\n            new RuleInt(res, min, max) :\r\n            new RuleNum(res, min, max)\r\n        );\r\n    }\r\n\r\n    protected parse(value:any):any {\r\n        switch (typeof value) {\r\n            default: return;\r\n            case 'undefined': return;\r\n            case 'number': return value;\r\n            case 'string':\r\n                if ((value as string).trim().length === 0) return;\r\n                return Number(value);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { NumberWidget } from './numberWidget';\r\n\r\nexport class UpdownWidget extends NumberWidget {\r\n    protected inputType = 'number';\r\n\r\n    protected isValidKey(key:number):boolean {\r\n        return key===46 || key===8 || key===37 || key===39\r\n            || (key>=48 && key<=57)\r\n            || (key>=96 && key<=105)\r\n            || key===109 || key===189;\r\n    }\r\n    \r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n        let key = evt.keyCode;\r\n        window.event.returnValue = this.isValidKey(key);\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class DateWidget extends TextWidget {\r\n    protected inputType = 'date';\r\n}\r\n\r\nexport class DateTimeWidget extends TextWidget {\r\n    protected inputType = 'datetime';\r\n}\r\n\r\nexport class TimeWidget extends TextWidget {\r\n    protected inputType = 'time';\r\n}\r\n\r\nexport class MonthWidget extends TextWidget {\r\n    protected inputType = 'month';\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiCheckItem } from '../../schema';\r\n\r\nexport class CheckBoxWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiCheckItem {return this._ui as UiCheckItem};\r\n    protected trueValue: any;\r\n    protected falseValue: any;\r\n\r\n    init() {\r\n        super.init();\r\n        if (this.ui !== undefined) {\r\n            let {trueValue, falseValue} = this.ui;\r\n            if (trueValue === undefined) this.trueValue = true;\r\n            else this.trueValue = trueValue;\r\n            if (falseValue === undefined) this.falseValue = false;\r\n            else this.falseValue = falseValue;\r\n        }\r\n        else {\r\n            this.trueValue = true;\r\n            this.falseValue = false;\r\n        }\r\n    }\r\n    protected setElementValue(value:any) {\r\n        this.input.checked = value === this.trueValue;\r\n    }\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let v = evt.target.checked === true? this.trueValue : this.falseValue;\r\n        this.setDataValue(v);\r\n    }\r\n\r\n    protected onClick = () => {\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let cn = classNames(this.className, 'form-check-inline p-0');\r\n        let input = <input\r\n            ref={(input)=>this.input = input}\r\n            className={'align-self-center'}\r\n            type=\"checkbox\"\r\n            defaultChecked={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            onClick={this.onClick} />;\r\n        if (this.context.inNode === true) {\r\n            return <label className={cn}>\r\n                {input} {(this.ui&&this.ui.label) || this.name}\r\n            </label>\r\n        }\r\n        else {\r\n            return <div className={cn}>\r\n                <label className=\"w-100 h-100 mb-0 d-flex justify-content-center\">{input}</label>\r\n            </div>;\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Widget } from './widget';\r\nimport { ItemSchema, UiSelect } from '../../schema';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\n\r\nexport class SelectWidget extends Widget {\r\n    protected select: HTMLSelectElement;\r\n    protected get ui(): UiSelect {return this._ui as UiSelect};\r\n    readOnly: boolean = false;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\treadOnly: observable,\r\n\t\t})\r\n\t}\r\n\r\n    protected setElementValue(value:any) {this.select.value = value}\r\n    protected onInputChange = (evt:React.ChangeEvent<HTMLSelectElement>) => {\r\n        this.setDataValue(evt.target.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.select.disabled = this.readOnly = !value}\r\n    setDisabled(value:boolean) {this.select.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        if (this.readOnly === true) {\r\n            let option = this.ui.list.find(v => v.value === this.value);\r\n            let title = (option === undefined)? '(???)' : option.title;\r\n            return <span className=\"form-control w-min-6c\">{title}</span>;\r\n        }\r\n        return <select\r\n            ref={(select)=>this.select = select}\r\n            className={classNames(this.className, 'form-control')}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}>\r\n            {this.ui.list.map((v,index) => {\r\n                let {title, value} = v;\r\n                let cn:string;\r\n                //if (value === undefined || value === null) cn = 'text-light small';\r\n                //else cn = 'text-danger';\r\n                return <option className={cn} key={index} value={value}>{title || value}</option>\r\n            })}\r\n        </select>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n//import { TextWidget } from './textWidget';\r\nimport { Widget } from './widget';\r\nimport { UiRadio } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\n\r\nconst radioStyle:React.CSSProperties = {height: 'auto'};\r\n\r\nexport class RadioWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiRadio {return this._ui as UiRadio};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n    }\r\n\r\n    /*\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n    */\r\n\r\n    render() {\r\n        let {defaultValue, list} = this.ui;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n        return <span className={cn} style={radioStyle}>\r\n                {list.map((v,index) => {\r\n                    let {value, title} = v;\r\n                    let name = this.name;\r\n                    if (rowKey !== undefined) name += '-' + rowKey;\r\n                    return <label key={index} className=\"form-radio-inline\">\r\n                        <input ref={input=>this.inputs[index]=input} type=\"radio\" name={name}\r\n                            value={value} defaultChecked={(this.defaultValue || defaultValue)===value}\r\n                            onChange={this.onInputChange} />\r\n                        {title || value}\r\n                    </label>;\r\n                    //</span>\r\n                })}\r\n            </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiRange } from '../../schema';\r\nimport { Widget } from './widget';\r\n\r\nexport class RangeWidget extends Widget {\r\n    protected inputType = 'range';\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiRange {return this._ui as UiRange};\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        let {min, max, step} = this.ui;\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, 'form-control', 'w-min-6c')}\r\n            type={this.inputType}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            max={max}\r\n            min={min}\r\n            step={step}\r\n            />\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiIdItem, TempletType } from '../../schema';\r\nimport { runInAction } from 'mobx';\r\n\r\nconst none = <small className=\"text-muted\">[无]</small>;\r\n\r\nexport class IdWidget extends Widget {\r\n    protected get ui(): UiIdItem {return this._ui as UiIdItem};\r\n\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {this.disabled = value}    \r\n\r\n    protected onClick = async () => {\r\n        let pickId = this.ui && this.ui.pickId;\r\n        if (pickId === undefined) {\r\n            alert('no pickId defined!');\r\n            return;\r\n        }\r\n\t\tlet id = await pickId(this.context, this.name, this.value);\r\n\t\trunInAction(() => {\r\n\t\t\tthis.setDataValue(id);\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.clearContextError();\r\n\t\t\tthis.checkRules();\t\r\n\t\t});\r\n    }\r\n\r\n\tsetValue(value:any) {\r\n\t\tsuper.setValue(value);\r\n\t}\r\n\r\n    render() {\r\n        let placeholder:string|JSX.Element, Templet: TempletType;\r\n        if (this.ui !== undefined) {\r\n            placeholder = this.ui.placeholder;\r\n            Templet = this.ui.Templet;\r\n        }\r\n        let cn:any = {\r\n            'form-control': true,\r\n            'required-item': this.itemSchema.required === true,\r\n            'cursor-pointer': true,\r\n            'is-invalid': this.hasError,\r\n        };\r\n        let content;\r\n        if (this.value === undefined || this.value === null) {\r\n            content = placeholder || none;\r\n            cn['text-muted'] = true;\r\n        }\r\n        else if (Templet === undefined) {\r\n            let c: any;\r\n            if (this.value === null) {\r\n                c = 'null';\r\n            }\r\n            else {\r\n                switch (typeof this.value) {\r\n                    case 'undefined': c = none; break;\r\n                    case 'object': c = (this.value as any).id; break;\r\n                    default: c = this.value; break;\r\n                }\r\n            }\r\n            content = <>{c}</>;\r\n        }\r\n        else if (typeof Templet === 'function') {\r\n            content = Templet(this.value);\r\n        }\r\n        else {\r\n            content = Templet;\r\n        }\r\n        return <>\r\n            <div className={classNames(cn)} onClick={this.onClick}>{content}</div>\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { DataType } from '../../schema';\r\nimport { UiType } from '../../schema';\r\n\r\nexport const Unknown = (dataType:DataType, uiType:UiType, dataTypes:DataType[]) => {\r\n    return <span className=\"text-danger\">!!data type {dataType} only support {(dataTypes || []).join(', ')}, can't use ui {uiType}!!</span>;\r\n};\r\n","import * as React from 'react';\r\nimport { UiButton, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { Widget } from './widget';\r\nimport { observer } from 'mobx-react';\r\nimport { runInAction } from 'mobx';\r\n\r\nexport class ButtonWidget extends Widget {\r\n    protected get ui(): UiButton {return this._ui as UiButton};\r\n\r\n    protected onClick = async () => {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.clearError();\r\n\t\t\tthis.clearContextError();\r\n\t\t})\r\n        let {name, type} = this.itemSchema;\r\n        if (type === 'submit') {\r\n\t\t\tawait this.context.submit(name);\r\n\t\t\treturn;\r\n        }\r\n        let {onButtonClick} = this.context.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${name} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(name, this.context);\r\n        if (ret === undefined) return;\r\n\t\trunInAction(() => {\r\n\t\t\tthis.context.setError(name, ret);\r\n\t\t});\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let {name, type} = this.itemSchema;\r\n        let Templet:TempletType, cn:string, caption:string|JSX.Element;\r\n        if (this.ui !== undefined) {\r\n            let {widget:widgetType} = this.ui;\r\n            if (widgetType !== 'button') return Unknown(type, widgetType, ['button']);\r\n            Templet = this.ui.Templet;\r\n            cn = this.ui.className;\r\n            caption = this.ui.label;\r\n        }\r\n        let {form, hasError} = this.context;\r\n        let context = this.context;\r\n        let disabled = (type==='submit' && hasError) || this.disabled;\r\n        let content:any;\r\n        if (this.children !== undefined) content = this.children;\r\n        else if (typeof Templet === 'function') content = Templet();\r\n        else if (Templet !== undefined) content = Templet;\r\n        else content = caption; \r\n        let button = <button \r\n            className={cn} \r\n            type=\"button\"\r\n            disabled={disabled}\r\n            onClick={this.onClick}>\r\n            {content || name}\r\n        </button>;\r\n        if (context.inNode === true) return <>{button}{this.renderErrors()}</>;\r\n        return <div className={form.ButtonClass}>\r\n            <div>{this.renderErrors()}</div>\r\n            {button}\r\n        </div>;\r\n    });\r\n    \r\n    protected get label():string {return null}\r\n\r\n    render() {\r\n        return React.createElement(this.observerRender);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Form } from './form';\r\nimport { UiSchema, UiArr, UiItem } from '../schema';\r\nimport { ArrSchema, ItemSchema } from '../schema';\r\nimport { Widget } from './widgets/widget';\r\n//import { ArrRow } from './arrRow';\r\nimport { observable, computed, makeObservable, runInAction } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport type ContextRule = (context:Context)=>{[target:string]:string[]|string} | string[] | string;\r\n\r\nexport abstract class Context {\r\n    private subContexts:{[name:string]:{[rowKey:string]:Context}};\r\n    readonly form: Form;\r\n    readonly uiSchema: UiSchema;\r\n    readonly initData: any;\r\n    readonly inNode: boolean;           // true: 在</> 流中定义Field\r\n    readonly widgets: {[name:string]: Widget} = {};\r\n    readonly rules: ContextRule[];\r\n\treadonly isRow: boolean;\r\n\t\r\n    errors: string[] = [];\r\n    errorWidgets:Widget[] = [];\r\n\r\n    constructor(form: Form, uiSchema: UiSchema, data: any, inNode: boolean, isRow: boolean) {\r\n\t\tmakeObservable(this, {\r\n\t\t\terrors: observable,\r\n\t\t\terrorWidgets: observable,\r\n\t\t\thasError: computed,\r\n\t\t});\r\n        this.form = form;\r\n        this.uiSchema = uiSchema;\r\n        this.initData = data;\r\n        this.inNode = inNode;\r\n        this.isRow = isRow;\r\n        if (uiSchema !== undefined) {\r\n            let {rules} = uiSchema;\r\n            if (rules !== undefined) {\r\n                this.rules = [];\r\n                if (Array.isArray(rules) === false)\r\n                    this.rules.push(rules as ContextRule);\r\n                else\r\n                    this.rules.push(...rules as ContextRule[]);\r\n            }\r\n        }\r\n    }\r\n\r\n    getArrRowContexts(arrName: string) {\r\n        if (this.subContexts === undefined) this.subContexts = {};\r\n        let arrRowContexts = this.subContexts[arrName];\r\n        if (arrRowContexts === undefined) this.subContexts[arrName] = arrRowContexts = {};\r\n        return arrRowContexts;\r\n    }\r\n\r\n    abstract get data():any;\r\n    abstract getItemSchema(itemName:string):ItemSchema;\r\n    abstract getUiItem(itemName:string):UiItem;\r\n    get arrName():string {return undefined}\r\n    getValue(itemName:string):any {return this.initData[itemName]}\r\n    setValue(itemName:string, value:any) {\r\n        this.initData[itemName] = value;\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setValue(value);\r\n    }\r\n    getDisabled(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) return widget.getDisabled();\r\n        return undefined;\r\n    }\r\n    setDisabled(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setDisabled(value);\r\n    }\r\n    getReadOnly(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getReadOnly();\r\n        return undefined;\r\n    }\r\n    setReadOnly(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setReadOnly(value);\r\n    }\r\n    getVisible(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getVisible();\r\n        return undefined;\r\n    }\r\n    setVisible(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setVisible(value);\r\n    }\r\n\r\n    async submit(buttonName: string) {\r\n        this.checkRules()\r\n        if (this.hasError === true) {\r\n            let err = '';\r\n            for (let ew of this.errorWidgets) {\r\n                err += ew.name + ':\\n' + ew.errors.join('\\n');\r\n            }\r\n            console.error(err);\r\n            return;\r\n        }\r\n        let {onButtonClick} = this.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${buttonName} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this);\r\n        if (ret === undefined) return;\r\n        this.setError(buttonName, ret);\r\n\r\n    }\r\n\r\n    checkFieldRules() {\r\n        for (let i in this.widgets) {\r\n            this.widgets[i].checkRules();\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                arrRowContexts[j].checkFieldRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    checkContextRules() {\r\n        this.clearErrors();\r\n        if (this.rules === undefined) return;\r\n        for (let rule of this.rules) {\r\n            let ret = rule(this);\r\n            if (ret === undefined) continue;\r\n            if (Array.isArray(ret) === true) {\r\n                this.errors.push(...ret as string[]);\r\n            }\r\n            else if (typeof ret === 'string') {\r\n                this.errors.push(ret as string);\r\n            }\r\n            else {\r\n                for (let i in ret as object) this.setError(i, (ret as any)[i]);\r\n            }\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                let rowContext = arrRowContexts[j];\r\n                rowContext.clearErrors();\r\n                rowContext.checkContextRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    setError(itemName:string, error:string) {\r\n\t\trunInAction(() => {\r\n\t\t\tlet widget = this.widgets[itemName];\r\n\t\t\tif (widget === undefined) return;\r\n\t\t\twidget.setContextError(error);\r\n\t\t\tthis.addErrorWidget(widget);\t\r\n\t\t})\r\n    }\r\n\r\n    clearContextErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tfor (let i in this.widgets) {\r\n\t\t\t\tlet widget = this.widgets[i];\r\n\t\t\t\tif (widget === undefined) continue;\r\n\t\t\t\twidget.clearContextError();\r\n\t\t\t}\t\r\n\t\t});\r\n    }\r\n\r\n    clearWidgetsErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tfor (let i in this.widgets) {\r\n\t\t\t\tlet widget = this.widgets[i];\r\n\t\t\t\tif (widget === undefined) continue;\r\n\t\t\t\twidget.clearError();\r\n\t\t\t}\t\r\n\t\t});\r\n    }\r\n\r\n    checkRules() {\r\n        this.clearErrors();\r\n        this.clearWidgetsErrors();\r\n        this.checkFieldRules();\r\n        if (this.hasError === true) return;\r\n        this.checkContextRules();\r\n    }\r\n\r\n    addErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos < 0) this.errorWidgets.push(widget);\r\n    }\r\n    removeErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos >= 0) this.errorWidgets.splice(pos, 1);\r\n    }\r\n\r\n    protected checkHasError():boolean {\r\n        let ret = (this.errorWidgets.length + this.errors.length) > 0;\r\n        if (ret === true) return true;\r\n        if (this.subContexts === undefined) return false;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                if (arrRowContexts[j].hasError === true) return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    get hasError():boolean {\r\n        return this.checkHasError();\r\n    };\r\n\r\n    clearErrors() {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.errors.splice(0);\r\n\t\t\tthis.errorWidgets.splice(0);\r\n\t\t\tthis.clearContextErrors();\t\r\n\t\t});\r\n    }\r\n\r\n    renderErrors = observer((): JSX.Element => {\r\n        let {errors} = this;\r\n        if (errors.length === 0) return null;\r\n        return <>\r\n            {errors.map(err => <span key={err} className=\"text-danger inline-block my-1 ms-3\">\r\n                <i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}\r\n            </span>)}\r\n        </>\r\n    });\r\n}\r\n\r\nlet rowKeySeed:number = 1;\r\nexport class RowContext extends Context {\r\n    readonly parentContext: Context;\r\n    readonly arrSchema: ArrSchema;\r\n    readonly rowKey: number;\r\n\treadonly data: any;\r\n    //readonly uiSchema: UiArr;\r\n\t\r\n    constructor(parentContext:Context, arrSchema: ArrSchema, data: any, inNode: boolean) {\r\n        let uiArr:UiArr;\r\n        let {uiSchema} = parentContext;\r\n        if (uiSchema !== undefined) {\r\n            let {items} = uiSchema;\r\n            if (items !== undefined) uiArr = items[arrSchema.name] as UiArr;\r\n        }\r\n        super(parentContext.form, uiArr, data, inNode, true);\r\n        this.parentContext = parentContext;\r\n        this.arrSchema = arrSchema;\r\n        this.rowKey = rowKeySeed++;\r\n        this.data = data;\r\n    }\r\n    getItemSchema(itemName:string):ItemSchema {return this.arrSchema.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        if (this.uiSchema === undefined) return undefined;\r\n        let {items} = this.uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName]\r\n    }\r\n    get arrName():string {return this.arrSchema.name}\r\n    clearErrors() {\r\n        super.clearErrors();\r\n        this.parentContext.clearErrors();\r\n    }\r\n\r\n    get parentData():any {return this.parentContext.data;}\r\n}\r\n\r\nexport class FormContext extends Context {\r\n    constructor(form:Form, inNode:boolean) {\r\n        super(form, form.uiSchema, form.data, inNode, false);\r\n    }\r\n    get data():any {return this.form.data}\r\n    getItemSchema(itemName:string):ItemSchema {return this.form.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        let {uiSchema} = this.form;\r\n        if (uiSchema === undefined) return undefined;\r\n        let {items} = uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName];\r\n    }\r\n}\r\n\r\nexport const ContextContainer = React.createContext<Context>({} as any);\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\n//import { ArrRow } from '../arrRow';\r\nimport { Context, RowContext, ContextContainer } from '../context';\r\nimport { ArrSchema } from '../../schema';\r\nimport { UiArr, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { factory } from './factory';\r\n\r\nexport const ArrComponent = observer((\r\n    {parentContext, arrSchema, children}:{parentContext: Context, arrSchema: ArrSchema, children: React.ReactNode}) => \r\n{\r\n    let {name, arr} = arrSchema;\r\n    let data = parentContext.initData[name] as any[];\r\n    let {form} = parentContext;\r\n    let arrRowContexts = parentContext.getArrRowContexts(name);\r\n\tlet ui = parentContext.getUiItem(name) as UiArr;\r\n\tlet {onDeleted, onRestored} = ui;\r\n    let arrLabel:string|JSX.Element = name;\r\n    let Templet:TempletType;\r\n    let selectable:boolean, deletable:boolean, restorable:boolean;\r\n    let {ArrContainer, RowContainer, RowSeperator, uiSchema} = form;\r\n    if (uiSchema !== undefined) {\r\n        let {selectable:formSelectable, deletable:formDeletable, restorable:formRestorable} = uiSchema;\r\n        if (selectable !== true) selectable = formSelectable;\r\n        if (deletable !== true) deletable = formDeletable;\r\n        if (restorable !== true) restorable = formRestorable;\r\n    }\r\n    if (ui !== undefined) {\r\n        let {widget:widgetType, label, \r\n            selectable:arrSelectable, deletable:arrDeletable, restorable:arrRestorable,\r\n            ArrContainer:ac, RowContainer:rc, RowSeperator:rs\r\n        } = ui;\r\n        if (arrSelectable !== undefined) selectable = arrSelectable;\r\n        if (arrDeletable !== undefined) deletable = arrDeletable;\r\n        if (arrRestorable !== undefined) restorable = arrRestorable;\r\n        if (ac !== undefined) ArrContainer = ac;\r\n        if (rc !== undefined) RowContainer = rc;\r\n        if (rs !== undefined) RowSeperator = rs;\r\n        Templet = ui.Templet;\r\n        if (widgetType !== 'arr') return Unknown(arrSchema.type, widgetType, ['arr']);\r\n        arrLabel = label || arrLabel;\r\n    }\r\n    let first = true;\r\n    return ArrContainer(arrLabel, <>\r\n        {data.map((row:any, index) => {\r\n            let rowContext: RowContext;\r\n            let rowContent: JSX.Element;\r\n            let sep = undefined;\r\n            if (first === false) sep = RowSeperator;\r\n            else first = false;\r\n            if (children !== undefined) {\r\n                rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                rowContent = <>{children}</>;\r\n            }\r\n            else {\r\n                let typeofTemplet = typeof Templet;\r\n                if (typeofTemplet === 'function') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = React.createElement(observer(Templet as React.StatelessComponent), row);\r\n                }\r\n                else if (typeofTemplet === 'object') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = Templet as JSX.Element;\r\n                }\r\n                else {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, false);\r\n                    rowContent = <>{\r\n                        arr.map((v, index) => {\r\n                            return <React.Fragment key={v.name}>\r\n                                {factory(rowContext, v, undefined)}\r\n                            </React.Fragment>\r\n                        })}\r\n                    </>;\r\n                }\r\n            }\r\n            let {rowKey} = rowContext;\r\n            arrRowContexts[rowKey] = rowContext;\r\n\r\n            let selectCheck:JSX.Element, deleteIcon:JSX.Element;\r\n            if (selectable === true) {\r\n                let onClick = (evt: React.MouseEvent<HTMLInputElement>)=>{\r\n                    let {checked} = (evt.target as HTMLInputElement);\r\n                    row.$isSelected = checked;\r\n                    let {$source} = row;\r\n                    if ($source !== undefined) $source.$isSelected = checked;\r\n                    rowContext.clearErrors();\r\n                }\r\n                selectCheck = <div className=\"form-row-checkbox\">\r\n                    <input type=\"checkbox\" onClick={onClick} defaultChecked={row.$isSelected} />\r\n                </div>;\r\n            }\r\n            let isDeleted = !(row.$isDeleted===undefined || row.$isDeleted===false);\r\n            if (deletable === true) {\r\n                let icon = isDeleted? 'fa-undo' : 'fa-trash';\r\n                let onDelClick = () => {\r\n                    if (restorable === true) {\r\n                        row.$isDeleted = !isDeleted;\r\n                        let {$source} = row;\r\n\t\t\t\t\t\tif ($source !== undefined) $source.$isDeleted = !isDeleted;\r\n\t\t\t\t\t\tif (onRestored) onRestored(row);\r\n                    }\r\n                    else {\r\n                        let p = data.indexOf(row);\r\n\t\t\t\t\t\tif (p>=0) data.splice(p, 1);\r\n\t\t\t\t\t\tif (onDeleted) onDeleted(row);\r\n                    }\r\n                    rowContext.clearErrors();\r\n                }\r\n                deleteIcon = <div className=\"form-row-edit text-info\" onClick={onDelClick}>\r\n                    <i className={classNames('fa', icon, 'fa-fw')} />\r\n                </div>;\r\n            }\r\n            let editContainer = selectable===true || deletable===true?\r\n                (content:any) => <fieldset disabled={isDeleted}><div className={classNames('d-flex', {'deleted':isDeleted, 'row-selected':row.$isSelected})}>\r\n                    {selectCheck}\r\n                    <div className={selectable===true && deletable===true? \"form-row-content\":\"form-row-content-1\"}>{content}</div>\r\n                    {deleteIcon}\r\n                </div></fieldset>\r\n                :\r\n                (content:any) => content;\r\n\r\n            return <ContextContainer.Provider key={rowKey} value={rowContext}>\r\n                {sep}\r\n                {RowContainer(editContainer(<><rowContext.renderErrors />{rowContent}</>))}\r\n            </ContextContainer.Provider>;\r\n        })}\r\n    </>);\r\n});\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { tonva } from 'tonva-core';\r\n//import { nav } from '../nav';\r\n\r\nexport interface ImageProps {\r\n    src: string;\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n    altImage?: string;\r\n}\r\n\r\n// src = .src, 表示fontawesome Icon\r\nexport function Image(props: ImageProps) {\r\n\tlet {className, style, src, altImage} = props;\r\n\tlet icon:string;\r\n    if (src) {\r\n\t\tif (src.indexOf('.') !== 0) {\r\n\t\t\tif (src.startsWith(':') === true) {\r\n\t\t\t\tsrc = tonva.resUrl + src.substr(1);\r\n\t\t\t}\r\n\t\t\treturn <img src={src} className={className} alt=\"img\"\r\n\t\t\t\tstyle={style}\r\n\t\t\t\tonError={evt=>{\r\n\t\t\t\t\tif (altImage) evt.currentTarget.src=altImage;\r\n\t\t\t\t\telse evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n\t\t\t\t}} />;\r\n\t\t}\r\n\t\ticon = src.substr(1);\r\n\t}\r\n\telse {\r\n\t\ticon = 'file-o'\r\n\t}\r\n\treturn <span className={classNames(className, 'image-none')} style={style}>\r\n\t\t<i className={'fa fa-' + icon} />\r\n\t</span>;\r\n}\r\n","export function Loading() {\r\n    return <div className=\"d-flex h-100 align-items-center justify-content-center\">\r\n        <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />\r\n    </div>;\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-badge.css';\r\n\r\nexport interface BadgeProps {\r\n    className?: string;\r\n    badge?: string|number;\r\n    size?: 'xs' | 'sm' | 'lg';\r\n    color?: 'secondary'|'success'|'danger'|'primary'|'info'|'warning';\r\n    badgeAlign?: 'left'|'center'|'right';\r\n    badgeVertical?: 'top'|'middle'|'bottom';\r\n}\r\n\r\n@observer\r\nexport class Badge extends React.Component<BadgeProps> {\r\n    render() {\r\n        let {className, badge, size, color, badgeAlign, badgeVertical, children} = this.props;\r\n        let cn = classNames(\r\n            className,\r\n            'va-badge',\r\n            size && 'va-badge-'+size,\r\n            'va-badge-' + (color||'secondary'),\r\n            badgeAlign && 'va-badg-'+badgeAlign,\r\n            badgeVertical && 'va-badg-'+badgeVertical,\r\n        );\r\n        let b;\r\n        if (badge) b = <b>{badge}</b>;\r\n        return <div className={cn}>\r\n            {children}\r\n            {b}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-lmr.css';\r\n\r\nexport interface LMRProps {\r\n    className?: string | string[];\r\n\tstyle?: React.CSSProperties,\r\n    left?: string|JSX.Element;\r\n    right?: string|JSX.Element;\r\n    onClick?: ()=>void;\r\n}\r\n\r\n@observer\r\nexport class LMR extends React.Component<LMRProps> {\r\n    render() {\r\n        let {className, style, left, children, right, onClick} = this.props;\r\n        let l, r;\r\n        if (left !== undefined) l = <header>{left}</header>;\r\n        if (right !== undefined) r = <footer>{right}</footer>;\r\n        let cursor;\r\n        if (onClick !== undefined) cursor = 'cursor-pointer';\r\n        return <div className={classNames('va-lmr', className, cursor)}\r\n\t\t\tstyle={style}\r\n\t\t\tonClick={onClick}>\r\n            {l}\r\n            <div>{children}</div>\r\n            {r}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface FAProps {\r\n    name: string;\r\n    className?: string;\r\n    size?: 'lg'|'2x'|'3x'|'4x'|'5x';\r\n    spin?: boolean;\r\n    fixWidth?: boolean;\r\n    border?: boolean;\r\n    pull?: 'left'|'right';\r\n    pulse?: boolean;\r\n    rotate?: 90|180|270;\r\n    flip?: 'horizontal'|'vertical';\r\n    inverse?: boolean;\r\n}\r\n\r\nexport class FA extends React.Component<FAProps> {\r\n    render() {\r\n        let {name, className, size, spin, fixWidth, border, pull, pulse, rotate, flip, inverse} = this.props;\r\n        let cn = classNames(className, 'fa',\r\n            name && ('fa-' + name),\r\n            size && 'fa-'+size,\r\n            fixWidth && 'fa-fw',\r\n            border && 'fa-border',\r\n            pull && 'fa-pull-' + pull,\r\n            spin && 'fa-spin',\r\n            pulse && 'fa-pulse',\r\n            rotate && 'fa-rotate-' + rotate,\r\n            flip && 'fa-flip-' + flip,\r\n            inverse && 'fa-inverse',\r\n        );\r\n        return <i className={cn} />\r\n    }\r\n}\r\n\r\nexport interface StackedFAProps {\r\n    className?: string;\r\n    size?: 'lg',\r\n}\r\nexport class StackedFA extends React.Component<StackedFAProps> {\r\n    render() {\r\n        let {className, size, children} = this.props;\r\n        let cn = classNames(\r\n            'fa-stack',\r\n            className,\r\n            size && 'fa-' + size);\r\n        return <span className={cn}>\r\n            {children}\r\n        </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {FA} from './FA';\r\n\r\nexport interface IconTextProps {\r\n    icon: string;\r\n    iconClass?: string;\r\n    text: string | JSX.Element;\r\n    textClass?: string;\r\n}\r\n\r\nexport class IconText extends React.Component<IconTextProps> {\r\n    render() {\r\n        let {icon, iconClass, text, textClass} = this.props;\r\n        return <div className=\"py-2\">\r\n            <FA className={iconClass} name={icon} fixWidth={true} />\r\n            <span className={textClass}>{text}</span>\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\n//import { nav } from '../nav';\r\nimport { Loading } from './loading';\r\nimport { Image as ImageControl } from './image';\r\nimport { Page } from './page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { LMR } from './simple';\r\nimport { tonva } from 'tonva-core';\r\n\r\nexport interface ResUploaderProps {\r\n    className?: string;\r\n    label?: string;\r\n    multiple?: boolean;\r\n    maxSize?: number;\r\n    onFilesChange?: (evt: React.ChangeEvent<HTMLInputElement>) => void;\r\n}\r\n\r\n@observer\r\nexport class ResUploader extends React.Component<ResUploaderProps> {\r\n    private fileInput: HTMLInputElement;\r\n\tfileName: string = null;\r\n\t\r\n\tconstructor(props: ResUploaderProps) {\r\n\t\tsuper(props);\r\n\t\tmakeObservable(this, {\r\n\t\t\tfileName: observable,\r\n\t\t});\r\n\t}\r\n\r\n    buildFormData():FormData {\r\n        let {maxSize} = this.props;\r\n        if (maxSize === undefined || maxSize <= 0) \r\n            maxSize = 100000000000;\r\n        else\r\n            maxSize = maxSize * 1024;\r\n        var files:FileList = this.fileInput.files;\r\n        var data = new FormData();\r\n        let len = files.length;\r\n        for (let i=0; i<len; i++) {\r\n            let file = files[i];\r\n            if (file.size > maxSize) return null;\r\n            data.append('files[]', file, file.name);\r\n        }\r\n    }\r\n\r\n    getFile0(): File {\r\n        return this.fileInput.files[0];\r\n    }\r\n\r\n    upload = async (formData?: FormData):Promise<string|{error:any}> => {\r\n        let resUrl = tonva.resUrl + 'upload';\r\n        if (!formData) formData = this.buildFormData();\r\n        try {\r\n            tonva.nav.startWait();\r\n            let headers = new Headers();\r\n            headers.append('Access-Control-Allow-Origin', '*');\r\n            //2019-12-18：因为 vivo按oppo某些版本不支持，暂时先不要 \r\n            //let abortController = new AbortController();\r\n            let res = await fetch(resUrl, {\r\n                method: \"POST\",\r\n                body: formData,\r\n                headers: headers,\r\n                //signal: abortController.signal,\r\n            });\r\n            let json = await res.json();\r\n            return ':' + json.res.id;\r\n        }\r\n        catch (err) {\r\n            console.error('%s %s', resUrl, err);\r\n            return {error:err};\r\n        }\r\n        finally {\r\n            tonva.nav.endWait();\r\n        }\r\n    }\r\n\r\n    private onFilesChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let {onFilesChange} = this.props;\r\n        if (onFilesChange) onFilesChange(evt);\r\n        let files = evt.target.files;\r\n        let len = files.length;\r\n        let names:string[] = [];\r\n        for (let i=0; i<len; i++) {\r\n            names.push(files.item(i).name);\r\n        }\r\n        this.fileName = names.join(', ');\r\n    }\r\n\r\n    render() {\r\n        let {className, multiple, label} = this.props;\r\n        return <div>\r\n                <label className=\"btn btn-outline-success\">\r\n                    {label || '选择文件'} \r\n                    <input \r\n                        className={className}\r\n                        ref={t=>this.fileInput=t} \r\n                        onChange={this.onFilesChange}\r\n                        type='file' name='file' \r\n                        multiple={multiple} style={{display:'none'}} />\r\n                </label>\r\n                &nbsp;\r\n                {this.fileName}\r\n            </div>\r\n    }\r\n}\r\n\r\nfunction formatSize(size:number, pointLength:number=2, units?:string[]) {\r\n    var unit;\r\n    units = units || [ 'B', 'K', 'M', 'G', 'TB' ];\r\n    while ( (unit = units.shift()) && size > 1024 ) {\r\n        size = size / 1024;\r\n    }\r\n    return (unit === 'B' ? size : size.toFixed( pointLength === undefined ? 2 : pointLength)) + unit;\r\n}\r\n\r\ninterface ImageUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw';\r\n\tonSaved?: (imageId:string) => Promise<void>;\r\n\timageTypes?: string[];\r\n}\r\n\r\nconst xlargeSize = 1600;\r\nconst largeSize = 800;\r\nconst mediumSize = 400;\r\nconst smallSize = 180;\r\n\r\n@observer\r\nexport class ImageUploader extends React.Component<ImageUploaderProps> {\r\n\tprivate static imageTypes = ['gif', 'jpg', 'jpeg', 'png', 'svg', 'apng', 'bmp', 'ico', 'cur', 'tiff', 'tif', 'webp'];\r\n\tprivate imgBaseSize: number;\r\n\tprivate imageTypes: string[];\r\n    private suffix: string;\r\n\tprivate resUploader: ResUploader;\r\n\t\r\n    file: File = null;\r\n    desImgWidth: number = null;\r\n    desImgHeight: number = null;\r\n    desImgSize: number = null;\r\n    srcImgWidth: number = null;\r\n    srcImgHeight: number = null;\r\n    isChanged: boolean = false;\r\n    resId: string = null;\r\n    enableUploadButton: boolean = false;\r\n    srcImage: string = null;\r\n    desImage: string = null;\r\n    fileError: string = null;\r\n    uploaded: boolean = false;\r\n\r\n    constructor(props: ImageUploaderProps) {\r\n\t\tsuper(props);\r\n\t\tmakeObservable(this, {\r\n\t\t\tfile: observable,\r\n\t\t\tdesImgWidth: observable,\r\n\t\t\tdesImgHeight: observable,\r\n\t\t\tdesImgSize: observable,\r\n\t\t\tsrcImgWidth: observable,\r\n\t\t\tsrcImgHeight: observable,\r\n\t\t\tisChanged: observable,\r\n\t\t\tresId: observable,\r\n\t\t\tenableUploadButton: observable,\r\n\t\t\tsrcImage: observable,\r\n\t\t\tdesImage: observable,\r\n\t\t\tfileError: observable,\r\n\t\t\tuploaded: observable,\r\n\t\t});\r\n\t\tthis.resId = props.id;\r\n\t\tthis.imageTypes = props.imageTypes || ImageUploader.imageTypes;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos+1).toLowerCase();\r\n            if(this.imageTypes.indexOf(this.suffix) < 0){\r\n                this.fileError = `图片类型必须是 ${this.imageTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n\t\t\t\tthis.srcImage = reader.result as string;\r\n\t\t\t\tswitch (this.suffix ) {\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tawait this.setSize(this.props.size);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'svg':\r\n\t\t\t\t\t\tthis.imgBaseSize = mediumSize;\r\n\t\t\t\t\t\tthis.desImgSize = this.srcImage.length;\r\n\t\t\t\t\t\tthis.desImage = this.srcImage;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n            };\r\n        }\r\n    }\r\n\r\n    private async setSize(size?: 'sm' | 'md' | 'lg' | 'xl' | 'raw') {\r\n        switch (size) {\r\n            default:\r\n            case 'sm':\r\n                this.imgBaseSize = smallSize; break;\r\n            case 'md':\r\n                this.imgBaseSize = mediumSize; break;\r\n            case 'lg':\r\n\t\t\t\tthis.imgBaseSize = largeSize; break;\r\n\t\t\tcase 'xl':\r\n\t\t\t\tthis.imgBaseSize = xlargeSize; break;\r\n\t\t\tcase 'raw':\r\n\t\t\t\tthis.imgBaseSize = -1; break;\r\n\t\t}\r\n\t\tthis.desImage = await this.compress();\r\n    }\r\n\r\n    private compress = ():Promise<string> => {\r\n        return new Promise<string>((resolve, reject) => {\r\n            var img = new Image();\r\n            img.src = this.srcImage;\r\n            img.onload = () => {\r\n                //var that = this;\r\n                // 默认按比例压缩\r\n                let {width, height} = img;\r\n                this.srcImgWidth = width;\r\n                this.srcImgHeight = height;\r\n                let scale = width / height;\r\n\t\t\t\tlet w:number, h:number;\r\n\t\t\t\tif (this.imgBaseSize < 0) {\r\n\t\t\t\t\tw = width;\r\n\t\t\t\t\th = height;\r\n\t\t\t\t}\r\n                else if (width <= this.imgBaseSize && height <= this.imgBaseSize) {\r\n                    w = width;\r\n                    h = height;\r\n                }\r\n                else if (scale < 0) {\r\n                    w = this.imgBaseSize;\r\n                    h = w / scale;\r\n                }\r\n                else {\r\n                    h = this.imgBaseSize;\r\n                    w = h * scale;\r\n                }\r\n                this.desImgWidth = Math.round(w);\r\n                this.desImgHeight = Math.round(h);\r\n                var quality = 0.7;  // 默认图片质量为0.7\r\n                //生成canvas\r\n                var canvas = document.createElement('canvas');\r\n                var ctx = canvas.getContext('2d');\r\n                // 创建属性节点\r\n                var anw = document.createAttribute(\"width\");\r\n                anw.nodeValue = String(w);\r\n                var anh = document.createAttribute(\"height\");\r\n                anh.nodeValue = String(h);\r\n                canvas.setAttributeNode(anw);\r\n                canvas.setAttributeNode(anh);\r\n                ctx.drawImage(img, 0, 0, w, h);\r\n                let base64 = canvas.toDataURL('image/' + this.suffix , quality);\r\n                let blob = this.convertBase64UrlToBlob(base64);\r\n                this.desImgSize = blob.size;\r\n                if (this.desImgSize > 3*1024*1024) {\r\n                    this.fileError = \"图片大于3M，无法上传\";\r\n                    this.enableUploadButton = false;\r\n                }\r\n                resolve(base64);\r\n            }\r\n        });\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string):Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while(n--){\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], {type:mime});\r\n    }\r\n\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.desImage);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let {error} = ret;\r\n            let type = typeof error;\r\n            let err:string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let {onSaved} = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    private showOrgImage = () => {\r\n        tonva.nav.push(<Page header=\"原图\">\r\n            <div className=\"p-3 text-center\">\r\n                <ImageControl className=\"h-min-4c\" style={{maxWidth:'100%'}} src={this.srcImage} />\r\n            </div>\r\n        </Page>);\r\n    }\r\n\r\n    private levelDiv() {\r\n        if (this.props.size) return;\r\n        let arr = [{caption:'小图', size:'sm'}];\r\n        if (this.srcImgHeight > mediumSize || this.srcImgWidth > mediumSize) {\r\n            arr.push({caption:'中图', size:'md'});\r\n        }\r\n        if (this.srcImgHeight > largeSize || this.srcImgWidth > largeSize) {\r\n            arr.push({caption:'大图', size:'lg'});\r\n        }\r\n        if (this.srcImgHeight > xlargeSize || this.srcImgWidth > xlargeSize) {\r\n\t\t\tarr.push({caption:'超大图', size:'xl'});\r\n\t\t\tarr.push({caption:'原图', size:'raw'});\r\n        }\r\n        if (arr.length < 2) return;\r\n        return <div>{arr.map((v, index) => {\r\n            let {caption, size} = v;\r\n            return <label key={index} className=\"me-3\"><input type=\"radio\" name=\"size\" \r\n                onChange={()=>this.setSize(size as any)}\r\n                defaultChecked={index===0} /> {caption}</label>;\r\n        })}</div>\r\n    }\r\n\r\n    render() {\r\n        let {label} = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改图片'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} \r\n                            multiple={false} maxSize={2048} \r\n                            label=\"选择图片文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {this.imageTypes.join(', ')} 格式图片。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                    <LMR left=\r\n                    {\r\n                        this.uploaded === true? \r\n                            <div className=\"text-success p-2\">上传成功！</div>\r\n                            :\r\n                            this.file && this.desImgSize > 0 && <div className=\"mb-3 d-flex align-items-end\">\r\n                                <div className=\"me-5\">\r\n                                    {this.levelDiv()}\r\n                                    <div>分辨率：{this.desImgWidth} x {this.desImgHeight}\r\n                                    &nbsp; &nbsp;\r\n                                    文件大小：{formatSize(this.desImgSize)}\r\n                                    </div>\r\n                                </div>\r\n                                <button className=\"btn btn-primary\" \r\n                                    disabled={!this.enableUploadButton}\r\n                                    onClick={this.upload}>上传</button>\r\n                            </div>\r\n                    }\r\n                    right={this.desImage && \r\n                        <button className=\"btn btn-link btn-sm text-right mb-3\" onClick={this.showOrgImage}>\r\n                            原图大小: {formatSize(this.file.size)}<br/>\r\n                            分辨率：{this.srcImgWidth} x {this.srcImgHeight}\r\n                        </button>\r\n                    }\r\n                    ></LMR>\r\n                </div>\r\n                <div className=\"text-center\" \r\n                    style={{\r\n                        border: (this.uploaded===true? '2px solid green' : '1px dotted gray'),\r\n                        padding: '8px'\r\n                    }}>\r\n                    <ImageControl className=\"h-min-4c\" style={{maxWidth:'100%'}} src={this.desImage} />\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface AudioUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    onSaved?: (imageId:string) => Promise<void>;\r\n}\r\n\r\n@observer\r\nexport class AudioUploader extends React.Component<AudioUploaderProps> {\r\n\tprivate static audioTypes = ['mp3', 'wav'];\r\n\r\n    private suffix: string;\r\n\tprivate resUploader: ResUploader;\r\n\r\n\tcontent: string = null;\r\n\tfile: File = null;\r\n\tfileSize: number = null;\r\n    isChanged: boolean = false;\r\n    resId: string = null;\r\n    enableUploadButton: boolean = false;\r\n    fileError: string = null;\r\n\tuploaded: boolean = false;\r\n\tuploading: boolean = false;\r\n\r\n    constructor(props: AudioUploaderProps) {\r\n\t\tsuper(props);\r\n\t\tmakeObservable(this, {\r\n\t\t\tcontent: observable,\r\n\t\t\tfile: observable,\r\n\t\t\tfileSize: observable,\r\n\t\t\r\n\t\t\tisChanged: observable,\r\n\t\t\tresId: observable,\r\n\t\t\tenableUploadButton: observable,\r\n\t\t\tfileError: observable,\r\n\t\t\tuploaded: observable,\r\n\t\t\tuploading: observable,\r\n\t\t});\r\n        this.resId = props.id;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos+1).toLowerCase();\r\n            if(AudioUploader.audioTypes.indexOf(this.suffix) < 0){\r\n                this.fileError = `音频类型必须是 ${AudioUploader.audioTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n\t\t\t\tthis.content = reader.result as string;\r\n\t\t\t\tthis.fileSize = this.content.length;\r\n            };\r\n        }\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string):Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while(n--){\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], {type:mime});\r\n    }\r\n\r\n    private upload = async () => {\r\n\t\tif (!this.resUploader) return;\r\n\t\tthis.uploading = true;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.content);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let {error} = ret;\r\n            let type = typeof error;\r\n            let err:string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let {onSaved} = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    render() {\r\n        let {label} = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改文件'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} \r\n                            multiple={false} maxSize={2048} \r\n                            label=\"选择音频文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {AudioUploader.audioTypes.join(', ')} 格式。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\t\t\t<LMR left=\r\n                    {\r\n                        this.uploaded === true? \r\n                            <div className=\"text-success p-2\">上传成功！</div>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\tthis.uploading === true?\r\n\t\t\t\t\t\t\t\t<div className=\"m-3\"><Loading /></div>\r\n\t\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t\tthis.file && this.content && <div className=\"m-3\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"mb-3\">\r\n\t\t\t\t\t\t\t\t\t\t文件大小：{formatSize(this.fileSize)}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<button className=\"btn btn-primary\" \r\n\t\t\t\t\t\t\t\t\t\tdisabled={!this.enableUploadButton}\r\n\t\t\t\t\t\t\t\t\t\tonClick={this.upload}>上传</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t/>\r\n        </Page>;\r\n    }\r\n}\r\n","import { ItemSchema, UiItem, UiSelectBase } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Image } from '../image';\r\nimport { Edit } from './edit';\r\nimport { FieldRule } from '../inputRules';\r\nimport { tonva } from 'tonva-core';\r\n\r\nexport abstract class ItemEdit {\r\n\tprotected edit: Edit;\r\n\tprotected name: string;\r\n\tprotected _itemSchema: ItemSchema;\r\n    get itemSchema(): ItemSchema {return this._itemSchema}\r\n    protected _uiItem:UiItem;\r\n    get uiItem():UiItem {return this._uiItem}\r\n    value: any;\r\n\tlabel: string|JSX.Element;\r\n\tget editInRow(): boolean {return false;}\r\n    protected newValue: any;\r\n\r\n    error: string = null;\r\n    isChanged: boolean = false;\r\n\r\n    constructor(edit:Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any) {\r\n\t\tmakeObservable(this, {\r\n\t\t\terror: observable,\r\n\t\t\tisChanged: observable,\r\n\t\t});\r\n\t\tthis.edit = edit;\r\n        this._itemSchema = itemSchema;\r\n        this._uiItem = uiItem\r\n        this.value = value;\r\n        let {name} = itemSchema;\r\n        this.name = name;\r\n        this.label = label;\r\n\t}\r\n\t\r\n\tinit() {\t\t\r\n\t}\r\n\r\n    async start():Promise<any> {\r\n        return await this.internalStart();\r\n    }\r\n\r\n    protected abstract internalStart():Promise<any>;\r\n\r\n    async end():Promise<any> {\r\n        await this.internalEnd()\r\n    }\r\n\r\n\trenderContent() {\r\n        let {name, type} = this._itemSchema;\r\n        let divValue:any;\r\n        let uiItem = this._uiItem;\r\n        let label:string|JSX.Element, labelHide:boolean;\r\n        if (uiItem === undefined) {\r\n            label = name;\r\n        }\r\n        else {\r\n\t\t\tlabel = uiItem.label;\r\n\t\t\tlabelHide = uiItem.labelHide;\r\n            let templet = uiItem.Templet;\r\n            if (templet !== undefined) {\r\n                if (typeof templet === 'function') {\r\n\t\t\t\t\tif (this.value !== undefined) divValue = templet(this.value);\r\n\t\t\t\t}\r\n                else {\r\n\t\t\t\t\tdivValue = {templet};\r\n\t\t\t\t}\r\n            }\r\n            else if (this.value !== undefined) {\r\n                switch (uiItem.widget) {\r\n                    case 'radio':\r\n                    case 'select':\r\n                        let {list} = uiItem as UiSelectBase;\r\n                        divValue = <b>{list.find(v => v.value === this.value).title}</b>;\r\n                        break;\r\n                    case 'id':\r\n                        divValue = <b>no templet for {name}={this.value}</b>\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        if (divValue === undefined) {\r\n            switch (type) {\r\n                default:\r\n                    divValue = this.value? \r\n\t\t\t\t\t\t<b>{this.value}</b> \r\n\t\t\t\t\t\t:\r\n\t\t\t\t\t\t<small className=\"text-muted\">[{labelHide===true? label:'无'}]</small>;\r\n                    break;\r\n                case 'image':\r\n                    divValue = <Image className=\"w-4c h-4c\" src={this.value} />;\r\n                    break;\r\n            }\r\n\t\t}\r\n\t\treturn divValue;\r\n\t}\r\n\r\n    protected async internalEnd():Promise<void> {tonva.nav.pop(1)}\r\n\r\n    protected verifyValue() {\r\n        if (this.uiItem === undefined) return;\r\n        let {rules} = this.uiItem;\r\n        if (rules === undefined) return;\r\n        let nv = this.newValue;\r\n        function verifyRule(rule:FieldRule, value: any):string {\r\n            let error = rule(nv);\r\n            if (error !== undefined) {\r\n                if (typeof error !== 'object')\r\n                    return error;\r\n                else\r\n                    return JSON.stringify(error);\r\n            }\r\n        }\r\n        if (Array.isArray(rules)) {\r\n            for (let rule of rules) {\r\n                let error = verifyRule(rule as FieldRule, nv);\r\n                if (error !== undefined) {\r\n                    this.error = error;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.error = verifyRule(rules as FieldRule, nv);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { ItemSchema, UiImageItem, UiItem } from '../schema';\r\nimport { ImageUploader } from '../resUploader';\r\n//import { nav } from '../../nav';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { Edit } from './edit';\r\nimport { tonva } from 'tonva-core';\r\n\r\nexport class ImageItemEdit extends ItemEdit {\r\n    get uiItem(): UiImageItem {return this._uiItem as UiImageItem}\r\n\tresId: string = null;\r\n\t\r\n\tconstructor(edit:Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any) {\r\n\t\tsuper(edit, itemSchema, uiItem, label, value);\r\n\t\tmakeObservable(this, {\r\n\t\t\tresId: observable\r\n\t\t})\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        this.resId = this.value;\r\n        return new Promise<any>((resolve, reject) => {\r\n            tonva.nav.push(React.createElement(this.page, {resolve:resolve, reject:reject}), ()=>reject());\r\n        });\r\n    }\r\n\r\n    /*\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let ret = await this.resUploader.upload();\r\n        if (ret === null) {\r\n            this.overSize = true;\r\n            env.setTimeout('imageItemEdit upload', () => this.overSize = false, 3000);\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.value);\r\n    }\r\n    */\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let size:any = this.uiItem && this.uiItem.size;\r\n\r\n        /*\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>resolve(this.resId)}>保存</button>;\r\n        let overSize:any;\r\n        if (this.overSize === true) {\r\n            overSize = <div className=\"text-danger\">\r\n                <i className=\"fa fa-times-circle\" /> 图片文件大小超过2M，无法上传\r\n            </div>;\r\n        }\r\n        */\r\n        return <ImageUploader \r\n            label={'更改' + this.label}\r\n            id={this.resId}\r\n            size={size}\r\n            onSaved={(resId):Promise<void>=>{resolve(resId); return;}} />;\r\n        /*\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div>上传图片：</div>\r\n                    <div className=\"my-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} multiple={false} maxSize={2048} />\r\n                    </div>\r\n                    <div>\r\n                        <button className=\"btn btn-primary\" onClick={this.upload}>上传</button>\r\n                    </div>\r\n                </div>\r\n                {overSize}\r\n                <div className=\"small muted my-4\">支持JPG、GIF、PNG格式图片，不超过2M。</div>\r\n                <div className=\"d-flex\">\r\n                    <div className=\"w-12c h-12c me-4\"\r\n                        style={{border: '1px dotted gray', padding: '8px'}}>\r\n                        <Image className=\"w-100 h-100\" src={this.resId} />\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"small\">图片预览</div>\r\n                        <Image className=\"w-4c h-4c mt-3\" src={this.resId} />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n        */\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { ItemSchema, UiImageItem } from '../../schema';\r\nimport { Image } from '../../image';\r\nimport { ImageItemEdit } from '../../edit/imageItemEdit';\r\nimport { observer } from 'mobx-react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Context } from '../context';\r\nimport { FieldProps } from '../field';\r\n\r\nexport class ImageWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiImageItem {return this._ui as UiImageItem};\r\n\r\n\timageSrc: string = null;\r\n\r\n\tconstructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n\t\tsuper(context, itemSchema, fieldProps, children);\r\n\t\tmakeObservable(this, {\r\n\t\t\timageSrc: observable,\r\n\t\t})\r\n\t}\r\n\r\n    init() {\r\n        super.init();\r\n        this.imageSrc = this.value;\r\n    }\r\n\r\n    protected onClick = async () => {\r\n        let edit = new ImageItemEdit(undefined, this.itemSchema, this.ui, this.ui.label, this.value);\r\n        let ret = await edit.start();\r\n        if (ret !== null) {\r\n            this.setValue(ret);\r\n            this.imageSrc = ret;\r\n        }\r\n        await edit.end();\r\n    }\r\n\r\n    render() {\r\n        return React.createElement(this.observerRender);\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let cn = [\r\n            'bg-white p-1 d-flex justify-content-center',\r\n        ];\r\n        let onClick: any;\r\n        if (!this.readOnly && !this.disabled) {\r\n            cn.push('cursor-pointer');\r\n            onClick = this.onClick;\r\n        }\r\n        return <div className={classNames(cn)} onClick={onClick}>\r\n            <Image src={this.imageSrc} className=\"w-4c h-4c\"/>\r\n        </div>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTag, IValuesViewRenderOptions } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\nabstract class TagWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiTag {return this._ui as UiTag};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n\t}\r\n\t\r\n\tabstract render():JSX.Element;\r\n}\r\n\r\nexport class TagSingleWidget extends TagWidget {\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet name = this.name;\r\n\t\tif (rowKey !== undefined) name += '-' + rowKey;\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputName: name,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderRadios(this.defaultValue, options);\r\n    }\r\n}\r\n\r\nexport class TagMultiWidget extends TagWidget {\r\n\tprivate defaultArr:number[];\r\n\tinit() {\r\n\t\tsuper.init();\r\n\t\tlet def = this.defaultValue;\r\n\t\tswitch (typeof def) {\r\n\t\t\tdefault:\r\n\t\t\t\tthis.defaultArr = [];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'string':\r\n\t\t\t\tthis.defaultArr = def.split('|').map(v => Number(v));\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.changeValue(values.join('|'), true);\r\n\t}\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputs: this.inputs,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderChecks(this.defaultValue, options);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { ArrSchema, DataType, ItemSchema } from '../../schema';\r\nimport { TypeWidget, UiCustom } from '../../schema';\r\nimport { TextWidget } from './textWidget';\r\nimport { TextAreaWidget } from './textareaWidget';\r\nimport { PasswordWidget, UrlWidget, EmailWidget } from './passwordWidget';\r\nimport { UpdownWidget } from './updownWidget';\r\nimport { NumberWidget } from './numberWidget';\r\nimport { DateWidget, DateTimeWidget, TimeWidget, MonthWidget } from './dateWidget';\r\nimport { CheckBoxWidget } from './checkBoxWidget';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { SelectWidget } from './selectWidget';\r\nimport { RadioWidget } from './radioWidget';\r\nimport { RangeWidget } from './rangeWidget';\r\nimport { IdWidget } from './idWidget';\r\nimport { ButtonWidget } from './buttonWidget';\r\nimport { ArrComponent } from './arrComponent';\r\nimport { ImageWidget } from './imageWidget';\r\nimport { TagSingleWidget, TagMultiWidget } from './tagWidget';\r\n\r\ninterface WidgetFactory {\r\n\twidget?: TypeWidget;\r\n\tdataTypes?: DataType[];\r\n};\r\n\r\nconst stringWidget: WidgetFactory = {\r\n\tdataTypes: ['integer', 'number', 'string'],\r\n\twidget: TextWidget\r\n};\r\n\r\nconst widgetFactories: {[type: string]: WidgetFactory} = {\r\n    id: {\r\n        dataTypes: ['id'],\r\n        widget: IdWidget,\r\n    },\r\n    text: stringWidget,\r\n\tstring: stringWidget,\r\n    textarea: {\r\n        dataTypes: ['string'],\r\n        widget: TextAreaWidget\r\n    },\r\n    password: {\r\n        dataTypes: ['string'],\r\n        widget: PasswordWidget\r\n    },\r\n    date: {\r\n        dataTypes: ['date'],\r\n        widget: DateWidget\r\n    },\r\n    datetime: {\r\n        dataTypes: ['date'],\r\n        widget: DateTimeWidget\r\n    },\r\n    time: {\r\n        dataTypes: ['date'],\r\n        widget: TimeWidget\r\n    },\r\n    month: {\r\n        dataTypes: ['date'],\r\n        widget: MonthWidget\r\n    },\r\n    select: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: SelectWidget\r\n    },\r\n    url: {\r\n        dataTypes: ['string'],\r\n        widget: UrlWidget\r\n    },\r\n    email: {\r\n        dataTypes: ['string'],\r\n        widget: EmailWidget\r\n    },\r\n    number: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: NumberWidget\r\n    },\r\n    updown: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: UpdownWidget\r\n    },\r\n    color: {\r\n\r\n    },\r\n    checkbox: {\r\n        dataTypes: ['boolean', 'integer', 'number'],\r\n        widget: CheckBoxWidget\r\n    },\r\n    image: {\r\n        dataTypes: ['string'],\r\n        widget: ImageWidget,\r\n    },\r\n    checkboxes: {\r\n\r\n    },\r\n    radio: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: RadioWidget\r\n\t},\r\n\ttagSingle: {\r\n\t\tdataTypes: ['integer'],\r\n\t\twidget: TagSingleWidget\r\n\t},\r\n\ttagMulti: {\r\n\t\tdataTypes: ['string'],\r\n\t\twidget: TagMultiWidget\r\n\t},\r\n    range: {\r\n        dataTypes: ['integer'],\r\n        widget: RangeWidget,\r\n    },\r\n    button: {\r\n        dataTypes: ['button', 'submit'],\r\n        widget: ButtonWidget,\r\n    }\r\n}\r\n\r\nexport function factory(context: Context, itemSchema: ItemSchema, children:React.ReactNode, fieldProps?: FieldProps):JSX.Element {\r\n    if (context === undefined) {\r\n        debugger;\r\n        return null;\r\n    }\r\n    if (itemSchema === undefined) return undefined;\r\n    let {name, type} = itemSchema;\r\n    switch (type) {\r\n    case 'arr':\r\n        let arrSchema = context.getItemSchema(name) as ArrSchema;\r\n        return <ArrComponent parentContext={context} arrSchema={arrSchema} children={children} />;\r\n    default:\r\n        break;\r\n    }\r\n\r\n    let typeWidget: TypeWidget;\r\n    let ui = context.getUiItem(name);\t\r\n    function getTypeWidget(t:DataType): TypeWidget {\r\n        switch(t) {\r\n        default: return TextWidget; \r\n        case 'id': return IdWidget;\r\n        case 'integer': return UpdownWidget;\r\n        case 'number': return NumberWidget; \r\n        case 'string': return TextWidget; \r\n        case 'date': return DateWidget; \r\n        case 'boolean': return CheckBoxWidget; \r\n        case 'button':\r\n        case 'submit': return ButtonWidget;\r\n        }\r\n    }\r\n    if (ui === undefined) { \r\n        typeWidget = getTypeWidget(type);\r\n    }\r\n    else {\r\n        let {widget:widgetType, hiden} = ui;\r\n\t\tif (hiden === true) return null;\r\n        switch (widgetType) {\r\n        default:\r\n            if (widgetType !== undefined) {\r\n                let widgetFactory = widgetFactories[widgetType];\r\n\t\t\t\tif (!widgetFactory) {\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t\tthrow new Error(`unknown widget ${widgetType}`);\r\n\t\t\t\t}\r\n                typeWidget = widgetFactory.widget;\r\n            }\r\n            if (typeWidget === undefined) typeWidget = getTypeWidget(type);\r\n            break;\r\n        case 'custom':\r\n            typeWidget = (ui as UiCustom).WidgetClass;\r\n            break;\r\n        case 'group':\r\n            return <span>impletment group</span>;\r\n        }\r\n        //label = uiLabel || name;\r\n    }\r\n    \r\n\tlet {widgets} = context;\r\n\tlet widget = widgets[name];\r\n\tif (!widget) {\r\n\t\twidget = new typeWidget(context, itemSchema, fieldProps, children);\r\n\t\twidget.init();\r\n\t\twidgets[name] = widget;\r\n\t}\r\n\r\n    return <widget.container />;\r\n    /*\r\n    if (isRow === false) {\r\n        let WidgetElement = observer(() => widget.container());\r\n        return <WidgetElement />;\r\n    }\r\n    else {\r\n        let widgetElement = widget.container();\r\n        return widgetElement;\r\n    }\r\n    */\r\n}\r\n\r\n","import * as React from 'react';\r\nimport {observable, IReactionDisposer, autorun} from 'mobx';\r\nimport classNames from 'classnames';\r\nimport { InputRes, inputRes, resLang } from 'tonva-core';\r\nimport { Schema, ItemSchema, ArrSchema, UiSchema, TempletType } from '../schema';\r\nimport { factory } from './widgets';\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport { ContextContainer, FormContext, Context } from './context';\r\n\r\nexport type FormButtonClick = (name:string, context: Context) => Promise<any>;\r\nexport type InputEnter = (name:string, context: Context) => Promise<any>;\r\n\r\nexport interface FormProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    uiSchema?: UiSchema;\r\n    formData?: any;\r\n    onButtonClick?: FormButtonClick;\r\n    onEnter?: InputEnter;\r\n    fieldLabelSize?: number;            // col-sm-2 for label\r\n\tfieldLabelAlign?: 'left'|'center'|'right';\r\n    requiredFlag?: boolean;             // default=true\r\n    beforeShow?: (formContext:FormContext) => void;\r\n    res?: InputRes;\r\n\r\n    Container?: (content:JSX.Element) => JSX.Element;\r\n    FieldContainer?: (label:string|JSX.Element, content:JSX.Element) => JSX.Element;\r\n    FieldClass?: string;\r\n    ButtonClass?: string;\r\n}\r\n\r\nexport class Form extends React.Component<FormProps> {\r\n    readonly schema: Schema;\r\n    readonly itemSchemas: {[name:string]: ItemSchema};\r\n    readonly uiSchema: UiSchema;\r\n    readonly res?: InputRes;\r\n    formContext: FormContext;\r\n    private disposer: IReactionDisposer;\r\n    readonly data:any;\r\n\r\n    readonly Container: (content:JSX.Element) => JSX.Element;\r\n    readonly FieldContainer: (label:any, content:JSX.Element) => JSX.Element;\r\n    readonly FieldClass: string;\r\n    readonly ButtonClass: string;\r\n    \r\n    constructor(props:FormProps) {\r\n        super(props);\r\n        let {schema, uiSchema, \r\n            Container, FieldContainer, FieldClass, \r\n            ButtonClass, res,\r\n\t\t} = props;\r\n        this.Container = Container || this.DefaultContainer;\r\n        this.FieldContainer = FieldContainer || this.DefaultFieldContainer;\r\n        this.FieldClass = FieldClass!==undefined && FieldClass!==''&&FieldClass!==null? FieldClass : this.DefaultFieldClass;\r\n        this.res = res || this.DefaultRes;\r\n        this.ButtonClass = ButtonClass || this.DefaultButtonClass;\r\n\r\n        this.schema = schema;\r\n        this.itemSchemas = {};\r\n        for (let itemSchema of this.schema) {\r\n            this.itemSchemas[itemSchema.name] = itemSchema;\r\n        }\r\n        this.uiSchema = uiSchema;\r\n\r\n        this.disposer = autorun(this.watch);\r\n        this.data = {};\r\n    }\r\n\r\n    private renderContent():any {\r\n        this.initData(this.props.formData);\r\n        let {children} = this.props;\r\n        if (children !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return <>{children}</>;\r\n        }\r\n\r\n        let Templet: TempletType;\r\n        if (this.uiSchema !== undefined) {\r\n            Templet = this.uiSchema.Templet;\r\n        }\r\n        if (Templet !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return typeof(Templet) === 'function'? Templet(this.data) : Templet;\r\n        }\r\n\r\n\t\tif (!this.formContext) {\r\n\t\t\tthis.formContext = new FormContext(this, false);\r\n\t\t}\r\n        return <>{this.schema.map((v, index) => {\r\n            return <React.Fragment key={index}>{factory(this.formContext, v, children)}</React.Fragment>\r\n        })}</>;\r\n    }\r\n\r\n    private initData(formData: any) {\r\n        if (formData === undefined) formData = {};\r\n        if (this.uiSchema !== undefined) {\r\n            let {items} = this.uiSchema;\r\n            if (items !== undefined) {\r\n                for (let i in items) {\r\n                    let ui = items[i];\r\n                    let dv = ui.defaultValue;\r\n                    if (dv !== undefined) {\r\n                        if (formData[i] === undefined) {\r\n                            formData[i] = dv;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        for (let itemSchema of this.schema) {\r\n            this.initDataItem(itemSchema, this.data, formData);\r\n        }\r\n    }\r\n\r\n    private initDataItem(itemSchema: ItemSchema, data:any, formData: any):any {\r\n        let {name, type} = itemSchema;\r\n        if (type === 'button') return;\r\n        if (type !== 'arr') {\r\n            data[name] = formData[name];\r\n            return;\r\n        }\r\n\r\n        let arrItem:ArrSchema = itemSchema as ArrSchema;\r\n        let {arr:arrItems} = arrItem;\r\n        if (arrItems === undefined) return;\r\n        let arrDict:any = arrItem.itemSchemas = {};\r\n        for (let item of arrItems) {\r\n            arrDict[item.name] = item;\r\n        }\r\n        let val:any[] = formData[name];\r\n        if (val === undefined) val = [];\r\n        else if (Array.isArray(val) === false) val = [val];\r\n        let arr:any[] = [];\r\n        for (let row of val) {\r\n            let {$isSelected, $isDeleted} = row;\r\n            let r = {\r\n                $source: row,\r\n                $isSelected: $isSelected,\r\n                $isDeleted: $isDeleted,\r\n            };\r\n            for (let item of arrItems) {\r\n                this.initDataItem(item, r, row);\r\n            }\r\n            arr.push(r);\r\n        }\r\n        // 如果没有observable，行删除标志点击不管用\r\n        // 不知道这里为什么要去掉observable。有可能会有别的问题\r\n        data[name] = observable(arr);\r\n        //data[name] = arr;\r\n        return;\r\n    }\r\n\r\n    private watch = () => {\r\n        let {formData} = this.props;\r\n        if (formData === undefined) return;\r\n        //this.initData(formData);\r\n        this.calcSelectOrDelete();\r\n    }\r\n    private calcSelectOrDelete() {\r\n        for (let itemSchema of this.schema) {\r\n            this.arrItemOperated(itemSchema);\r\n        }\r\n    }\r\n\r\n    private arrItemOperated(itemSchema: ItemSchema) {\r\n        let {name, type} = itemSchema;\r\n        if (type !== 'arr') return;\r\n        if (this.data === undefined) return;\r\n        let formArrVal = this.data[name];\r\n        if (formArrVal === undefined) return;\r\n        let {arr: arrItems} = itemSchema as ArrSchema;\r\n        for (let row of formArrVal) {\r\n            let {$source} = row;\r\n            if ($source === undefined) continue;\r\n            let {$isSelected, $isDeleted} = $source;\r\n            row.$isSelected = $isSelected;\r\n            row.$isDeleted = $isDeleted;\r\n            //console.log($isSelected, $isDeleted);\r\n            for (let item of arrItems) {\r\n                this.arrItemOperated(item);\r\n            }\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        let {beforeShow} = this.props;\r\n        if (beforeShow !== undefined) beforeShow(this.formContext);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        if (this.disposer !== undefined) this.disposer();\r\n    }\r\n\r\n    render() {\r\n        let content = this.renderContent();\r\n        return <ContextContainer.Provider value={this.formContext}>\r\n            {React.createElement(this.formContext.renderErrors)}\r\n            {this.Container(content)}\r\n        </ContextContainer.Provider>;\r\n    }\r\n\r\n    async buttonClick(buttonName:string) {\r\n        this.formContext.checkRules()\r\n        if (this.formContext.hasError === true) return;\r\n\r\n        let {onButtonClick} = this.formContext.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this.formContext);\r\n        if (ret === undefined) return;\r\n        this.formContext.setError(buttonName, ret);\r\n    }\r\n\r\n    protected DefaultContainer = (content:JSX.Element): JSX.Element => {\r\n        return <form className={classNames(this.props.className)} onSubmit={e=>e.preventDefault()}>\r\n            {content}\r\n        </form>;\r\n    }\r\n    protected DefaultFieldContainer = (label:string|JSX.Element, content:JSX.Element): JSX.Element => {\r\n        let {fieldLabelSize, fieldLabelAlign} = this.props;\r\n\r\n        if (fieldLabelSize > 0) {\r\n            let labelView:any;\r\n            if (label === null) {\r\n                fieldLabelSize = 0;\r\n            }\r\n            else {\r\n\t\t\t\tlet cnAlign: string;\r\n\t\t\t\tswitch (fieldLabelAlign) {\r\n\t\t\t\t\tcase 'right': cnAlign = 'text-sm-right'; break;\r\n\t\t\t\t\tcase 'center': cnAlign = 'text-sm-center'; break;\r\n\t\t\t\t}\r\n                labelView = <label className={classNames('col-sm-' + fieldLabelSize, 'col-form-label', cnAlign)}>{label}</label>\r\n            }\r\n            let fieldCol = 'col-sm-' + (12 - fieldLabelSize);\r\n            return <div className=\"mb-3 row\">\r\n                {labelView}\r\n                <div className={fieldCol}>{content}</div>\r\n            </div>;\r\n        }\r\n        return <div className=\"mb-3\">\r\n            {label===null? null:<label className=\"col-form-label\">{label}</label>}\r\n            {content}\r\n        </div>;\r\n    }\r\n    protected DefaultFieldClass:string = undefined;\r\n    protected DefaultButtonClass = 'text-center py-2';\r\n    protected DefaultRes:InputRes = resLang<InputRes>(inputRes);\r\n\r\n    ArrContainer = (label:any, content:JSX.Element): JSX.Element => {\r\n        return <div>\r\n            <div className={classNames('small text-muted text-center bg-light py-1 px-3 mt-4 mb-1')}>{label}</div>\r\n            {content}\r\n        </div>;\r\n    }\r\n    RowContainer = (content:JSX.Element): JSX.Element => {\r\n        let cn = classNames({\r\n            'py-3': true\r\n        });\r\n        return <div className={cn}>{content}</div>\r\n    }\r\n    RowSeperator = <div className=\"border border-gray border-top\" />;\r\n}\r\n","import * as React from 'react';\r\nimport { factory } from './widgets';\r\nimport { ContextContainer, Context } from './context';\r\n\r\nexport interface FieldProps {\r\n    name: string;\r\n}\r\n\r\nexport class FormField extends React.Component<FieldProps> {\r\n    static contextType = ContextContainer;\r\n    render() {\r\n        let {name, children } = this.props;\r\n        let context:Context = this.context;\r\n        if (context === undefined) return <span className=\"text-danger\">!only in Form!</span>;\r\n        let itemSchema = context.getItemSchema(name);\r\n        let content = factory(context, itemSchema, children, this.props);\r\n        if (content === undefined) {\r\n            return <span className=\"text-danger\">!!{name} is not defined!!</span>;\r\n        }\r\n        return content;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { tonva } from 'tonva-core';\r\n\r\nexport interface InputOptions {\r\n\ttype: string;\r\n\tmin?: number;\r\n\tmax?: number;\r\n\tstep?: number;\r\n}\r\n\r\nexport class StringItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem {return this._uiItem as UiTextItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve, reject});\r\n            tonva.nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n\t}\r\n\t\r\n\tprotected inputOptions():InputOptions {\r\n\t\treturn {\r\n\t\t\ttype: 'text',\r\n\t\t}\r\n\t}\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n\t\tlet {resolve} = props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (!this.error) {\r\n\t\t\t\tlet val = this.newValue;\r\n\t\t\t\tresolve(val);\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>;\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\t\tif (evt.keyCode === 13) onSave();\r\n\t\t}\r\n\t\tlet {type, max, min, step} = this.inputOptions();\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n\t\t\t\t<input type={type}\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\" \r\n                    defaultValue={this.value} min={min} max={max} step={step} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiRadio } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { tonva } from 'tonva-core';\r\n\r\nexport class RadioItemEdit extends ItemEdit {\r\n    get uiItem(): UiRadio {return this._uiItem as UiRadio}\r\n\r\n\tinit() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem===undefined? undefined : this._uiItem.defaultValue;\r\n        }\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            tonva.nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value: any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let {name} = this.itemSchema;\r\n        let {list} = this.uiItem;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>{\r\n                this.verifyValue();\r\n                if (!this.error) resolve(this.newValue);\r\n            }}>保存</button>;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input name={name} type=\"radio\" value={value} \r\n                        onClick={()=>this.onChange(value)} \r\n                        defaultChecked={value === this.value} /> {title || value} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"m-3\">\r\n\t\t\t\t<div className=\"row row-cols-2 row-cols-sm-3 row-cols-md-4\">{content}</div>\r\n\t\t\t</div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiSelect } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { tonva } from 'tonva-core';\r\n\r\nexport class SelectItemEdit extends ItemEdit {\r\n    get uiItem(): UiSelect {return this._uiItem as UiSelect}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            tonva.nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value:any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiIdItem } from '../schema';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class IdItemEdit extends ItemEdit {\r\n    get uiItem(): UiIdItem {return this._uiItem as UiIdItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            //let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            //nav.push(element,reject);\r\n\r\n            let {pickId} = this.uiItem;\r\n            if (pickId === undefined) {\r\n                alert('IdItemEdit.pickId = undefined');\r\n                return;\r\n            }\r\n            let boxId = await pickId(undefined, undefined, this.value);\r\n            //if (typeof id === 'object') {\r\n            //    id = (id as any).id;\r\n            //}\r\n            this.onChange(boxId.id);\r\n            resolve(boxId);\r\n            //this.newValue = id;\r\n        });\r\n    }\r\n\r\n    protected async internalEnd():Promise<void> {}\r\n\r\n    private onChange = (value:any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        /*\r\n        let {resolve, reject} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n        */\r\n        return <Page header={'更改' + this.label}>\r\n            ddd\r\n        </Page>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiTag } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { tonva } from 'tonva-core';\r\n\r\nabstract class TagItemEdit extends ItemEdit {\r\n\tprotected inputs: {[index:number]: HTMLInputElement} = {};\r\n\tprotected inputType: 'checkbox' | 'radio';\r\n    get uiItem(): UiTag {return this._uiItem as UiTag};\r\n\r\n\tinit() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem===undefined? undefined : this._uiItem.defaultValue;\r\n        }\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            tonva.nav.push(element,reject);\r\n        });\r\n\t}\r\n\t\r\n\trenderContent() {\r\n\t\tlet valuesView = this.uiItem.valuesView;\r\n\t\tif (valuesView === undefined) return super.renderContent();\r\n\t\treturn valuesView.render(this.value);\r\n\t}\r\n\r\n\tprotected abstract renderInputs():JSX.Element;\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>{\r\n                this.verifyValue();\r\n                if (!this.error) resolve(this.newValue);\r\n\t\t\t}}>保存</button>;\r\n\t\t/*\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {name:itemName, id} = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input ref={input=>this.inputs[id] = input} name={name} type={this.inputType} value={id} \r\n\t\t\t\t\t\tonClick={(e)=>this.onChange(e.currentTarget.checked, id)}\r\n                        defaultChecked={this.defaultChecked(id)} /> {itemName} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n\t\t\t<>no list defined</>;\r\n\t\t*/\r\n        return <Page header={'更改' + this.label} right={right}>\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t\t{this.renderInputs()}\r\n\t\t\t</div>\r\n        </Page>;\r\n    })\r\n}\r\n\r\nexport class TagSingleItemEdit extends TagItemEdit {\r\n\tprotected inputType:'radio'|'checkbox' = 'radio';\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet {currentTarget} = evt;\r\n\t\tif (currentTarget.checked === false) return;\r\n        this.newValue = Number(currentTarget.value);\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\t\r\n\tprotected renderInputs():JSX.Element {\r\n\t\tlet {valuesView} = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange,\r\n\t\t};\r\n\t\treturn valuesView.renderRadios(this.value, options);\r\n\t}\r\n}\r\n\r\nexport class TagMultiItemEdit extends TagItemEdit {\r\n\t//private arr:number[];\r\n\tprotected inputType:'radio'|'checkbox' = 'checkbox';\r\n\r\n\tprivate onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.newValue = values.join('|');\r\n        //this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\tprotected renderInputs():JSX.Element {\r\n\t\tlet {valuesView} = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t};\r\n\t\treturn valuesView.renderChecks(this.value, options);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\n//import { nav } from '../../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { tonva } from 'tonva-core';\r\n\r\nexport class TextAreaItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem {return this._uiItem as UiTextItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve, reject});\r\n            tonva.nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n\t\tlet {resolve} = props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (!this.error) {\r\n\t\t\t\tlet val = this.newValue;\r\n\t\t\t\tresolve(val);\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>;\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLTextAreaElement>) => {\r\n\t\t\t// if (evt.keyCode === 13) onSave();\r\n\t\t}\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <textarea\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\" \r\n\t\t\t\t\tdefaultValue={this.value}\r\n\t\t\t\t\trows={6} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import { UiCheckItem } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class CheckBoxItemEdit extends ItemEdit {\r\n\tprivate input: HTMLInputElement;\r\n    get uiItem(): UiCheckItem {return this._uiItem as UiCheckItem}\r\n\tget editInRow(): boolean {return true;}\r\n    protected async internalStart():Promise<any> {\r\n\t\tif (!this.input) return;\r\n\t\tlet uiItem = this.uiItem;\r\n\t\tif (uiItem === undefined) return this.input.checked;\r\n\t\tlet {checked} = this.input;\r\n\t\treturn this.getValue(checked);\r\n    }\r\n\tasync end():Promise<any> {}\r\n\trenderContent() {\r\n\t\tlet {readOnly} = this.uiItem;\r\n\t\tlet disabled = readOnly === true;\r\n\t\tlet onChange:any;\r\n\t\tif (readOnly !== true) onChange = this.onChange;\r\n\t\treturn <input ref={r => this.input=r} type=\"checkbox\" \r\n\t\t\tdefaultChecked={this.value} disabled={disabled}\r\n\t\t\tonChange={onChange} />\r\n\t}\r\n\r\n\tprivate getValue(checked: boolean) {\r\n\t\tlet {trueValue, falseValue} = this.uiItem;\r\n        return checked === true? (trueValue??true) : (falseValue??false);\r\n\t}\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = this.getValue(evt.target.checked);\r\n        let preValue = this.value;\r\n\t\tthis.isChanged = (this.newValue !== preValue);\r\n\t\tthis.edit.onItemChanged(this, this.newValue);\r\n    }\r\n}\r\n","import { UiRange } from \"../schema\";\r\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\r\n\r\nexport class RangeItemEdit extends StringItemEdit {\r\n\tprotected inputOptions():InputOptions {\r\n\t\tlet min:number, max:number, step:number;\r\n\t\tif (this._uiItem) {\r\n\t\t\tmin = (this._uiItem as UiRange).min\r\n\t\t\tmax = (this._uiItem as UiRange).max\r\n\t\t\tstep = (this._uiItem as UiRange).step\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: 'range',\r\n\t\t\tmin, max, step\r\n\t\t}\r\n\t}\r\n}\r\n","import { UiNumberItem } from \"../schema\";\r\nimport { InputOptions, StringItemEdit } from \"./stringItemEdit\";\r\n\r\nexport class NumberItemEdit extends StringItemEdit {\r\n\tprotected inputOptions():InputOptions {\r\n\t\tlet min:number, max:number, step:number;\r\n\t\tif (this._uiItem) {\r\n\t\t\tmin = (this._uiItem as UiNumberItem).min\r\n\t\t\tmax = (this._uiItem as UiNumberItem).max\r\n\t\t\tstep = (this._uiItem as UiNumberItem).step\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttype: 'number',\r\n\t\t\tmin, max, step\r\n\t\t}\r\n\t}\r\n}\r\n","import * as React from 'react';\r\n//import _ from 'lodash';\r\nimport { observer } from 'mobx-react';\r\nimport { Schema, UiSchema, ItemSchema, UiItem, UiRadio, UiTagSingle, UiTagMulti } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { StringItemEdit } from './stringItemEdit';\r\nimport { ImageItemEdit } from './imageItemEdit';\r\nimport { RadioItemEdit } from './radioItemEdit';\r\nimport { SelectItemEdit } from './selectItemEdit';\r\nimport { IdItemEdit } from './idItemEdit';\r\nimport { TagSingleItemEdit, TagMultiItemEdit } from './tagItemEdit';\r\nimport { TextAreaItemEdit } from './textAreaItemEdit';\r\nimport { CheckBoxItemEdit } from './checkBoxItemEdit';\r\nimport { RangeItemEdit } from './rangeItemEdit';\r\nimport { NumberItemEdit } from './numberItemEdit';\r\n\r\nexport interface EditProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    data: any;\r\n    onItemClick?: (itemSchema: ItemSchema, uiItem: UiItem, value: any) => Promise<void>;\r\n    onItemChanged?: (itemSchema: ItemSchema, newValue:any, preValue:any) => Promise<void>;\r\n    stopEdit?: boolean;\r\n    uiSchema?: UiSchema;\r\n    sepClassName?: string;\r\n    topBorderClassName?: string;\r\n    bottomBorderClassName?: string;\r\n    rowContainerClassName?: string;\r\n}\r\n\r\n@observer\r\nexport class Edit extends React.Component<EditProps> {\r\n    private defaultSepClassName = 'border-top edit-sep-light-gray';\r\n    private defaultRowContainerClassName = 'd-flex px-3 py-2 bg-white align-items-center';\r\n    private topBorder:JSX.Element;\r\n    private bottomBorder:JSX.Element;\r\n    private rowContainerClassName?: string;\r\n    private sep:JSX.Element;\r\n\tprivate uiSchema: {[name:string]: UiItem};\r\n\r\n    constructor(props: EditProps) {\r\n        super(props);\r\n        let {topBorderClassName, bottomBorderClassName, sepClassName, rowContainerClassName, uiSchema} = props;\r\n        this.topBorder = <div className={topBorderClassName || this.defaultSepClassName} />;\r\n        this.bottomBorder = <div className={bottomBorderClassName || this.defaultSepClassName} />;\r\n        this.rowContainerClassName = rowContainerClassName || this.defaultRowContainerClassName;\r\n        //if (stopEdit !== true) this.rowContainerClassName += ' cursor-pointer';\r\n        this.sep = <div className={sepClassName || this.defaultSepClassName} />;\r\n\t\tthis.uiSchema = (uiSchema && uiSchema.items) || {};\r\n    }\r\n\r\n    render() {\r\n        let {schema} = this.props;\r\n\t\tlet sep:any;\r\n        return <div>\r\n\t\t\t{this.topBorder}\r\n            {schema.map((itemSchema, index) => {\r\n\t\t\t\tlet {stopEdit} = this.props;\r\n\t\t\t\tlet {name} = itemSchema;\r\n\t\t\t\tlet uiItem = this.uiSchema===undefined? undefined : this.uiSchema[name];\r\n\t\t\t\tlet label:string|JSX.Element, labelHide:any;\r\n\t\t\t\tif (uiItem !== undefined) {\r\n\t\t\t\t\tlabel = uiItem.label || name;\r\n\t\t\t\t\tlabelHide = uiItem.labelHide;\r\n\t\t\t\t};\r\n\t\t\t\tlet value = this.props.data[name];\r\n\t\t\t\tlet itemEdit = createItemEdit(this, itemSchema, uiItem, label, value);\r\n\t\t\t\tlet rowContainerClassName = this.rowContainerClassName;\r\n\t\t\t\tlet {editInRow} = itemEdit;\r\n\t\t\t\tif (editInRow === false) {\r\n\t\t\t\t\tif (stopEdit !== true) editInRow = false;\r\n\t\t\t\t}\r\n\t\t\t\tif (editInRow === false) rowContainerClassName += ' cursor-pointer';\r\n\r\n\t\t\t\tlet {required} = itemSchema;\r\n\t\t\t\tlet requireFlag = required===true && <span className=\"text-danger\">*</span>;\r\n\t\t\t\tlet divLabel:any, cn:string = 'flex-fill d-flex ';\r\n\t\t\t\tif (labelHide === true) {\r\n\t\t\t\t\tdivLabel = undefined;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tdivLabel = <div>{label} {requireFlag}</div>;\r\n\t\t\t\t\tcn += 'justify-content-end';\r\n\t\t\t\t}\r\n\t\t\t\tlet ret = <React.Fragment key={index}>\r\n\t\t\t\t\t{sep}\r\n\t\t\t\t\t<div className={'d-flex align-items-center' + rowContainerClassName} \r\n\t\t\t\t\t\tonClick={async ()=>await this.rowClick(itemEdit)}>\r\n\t\t\t\t\t\t{divLabel}\r\n\t\t\t\t\t\t<div className={cn}>{\r\n\t\t\t\t\t\t\titemEdit===undefined? undefined: itemEdit.renderContent()\r\n\t\t\t\t\t\t}</div>\r\n\t\t\t\t\t\t{editInRow === false && <div className=\"w-2c text-right\"><i className=\"fa fa-angle-right\" /></div>}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</React.Fragment>;\r\n\t\t\t\tsep = this.sep;\r\n\t\t\t\treturn ret;\r\n\t\t\t})}\r\n\t\t\t{this.bottomBorder}\r\n\t\t</div>;\r\n    }\r\n\r\n\tasync onItemChanged(itemEdit:ItemEdit, newValue:any) {\r\n\t\tlet {itemSchema, uiItem, value} = itemEdit;\r\n\t\tthis.props.data[itemSchema.name] = newValue;\r\n        let {onItemChanged, stopEdit} = this.props;\r\n\t\tif (stopEdit === true) return;\r\n\t\tif (uiItem?.readOnly === true) return;\r\n\t\tif (onItemChanged === undefined) {\r\n\t\t\talert(`${itemSchema.name} value changed, new: ${newValue}, pre: ${value}`);\r\n\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\r\n\t\t\t//this.props.data[itemSchema.name] = changeValue;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tawait onItemChanged(itemSchema, newValue, value);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate rowClick = async (itemEdit:ItemEdit) => {\r\n\t\tif (itemEdit === undefined) {\r\n\t\t\talert('item has no edit');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet {itemSchema, uiItem, value, editInRow} = itemEdit;\r\n\t\tif (editInRow === true) return;\r\n        let {onItemChanged, onItemClick, stopEdit} = this.props;\r\n\t\tif (stopEdit === true) return;\r\n\t\tif (uiItem?.readOnly === true) return;\r\n        let changeValue:any;\r\n        if (onItemClick !== undefined) {\r\n            await onItemClick(itemSchema, uiItem, value);\r\n            return;\r\n        }\r\n        //let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);\r\n        if (itemEdit === undefined) {\r\n            alert('undefined: let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);');\r\n            return;\r\n        }\r\n        try {\r\n            changeValue = await itemEdit.start();\r\n            if (changeValue !== value) {\r\n\t\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以移到这里来\r\n\t\t\t\tthis.props.data[itemSchema.name] = changeValue;\r\n                if (onItemChanged === undefined) {\r\n                    alert(`${itemSchema.name} value changed, new: ${changeValue}, pre: ${value}`);\r\n\t\t\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\r\n                    //this.props.data[itemSchema.name] = changeValue;\r\n                }\r\n                else {\r\n                    await onItemChanged(itemSchema, changeValue, value);\r\n                }\r\n            }\r\n            await itemEdit.end();\r\n        }\r\n        catch (err) {\r\n            // 如果直接back，会触发reject，就到这里了\r\n\t\t\tconsole.log('no value changed');\r\n\t\t\tconsole.error(err);\r\n        }\r\n    }\r\n}\r\n\r\ntype NewItemEdit = new (edit: Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any) => ItemEdit;\r\n\r\nfunction createItemEdit(edit: Edit, itemSchema: ItemSchema, uiItem:UiItem, label:string|JSX.Element, value: any):ItemEdit {\r\n\tlet ie: ItemEdit;\r\n    let itemEdit: NewItemEdit;\r\n    if (uiItem !== undefined) {\r\n        switch (uiItem.widget) {\r\n            default: break;\r\n            case 'id': itemEdit = IdItemEdit; break;\r\n\t\t\tcase 'text': itemEdit = StringItemEdit; break;\r\n\t\t\tcase 'textarea': itemEdit = TextAreaItemEdit; break;\r\n            case 'image': itemEdit = ImageItemEdit; break;\r\n\t\t\tcase 'select': itemEdit = SelectItemEdit; break;\r\n\t\t\tcase 'range': itemEdit = RangeItemEdit; break;\r\n\t\t\tcase 'number':\r\n\t\t\tcase 'updown': itemEdit = NumberItemEdit; break;\r\n\t\t\tcase 'checkbox': itemEdit = CheckBoxItemEdit; break;\r\n            case 'radio': \r\n\t\t\t\tie = new RadioItemEdit(edit, itemSchema, uiItem as UiRadio, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tagSingle':\r\n\t\t\t\tie = new TagSingleItemEdit(edit, itemSchema, uiItem as UiTagSingle, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tagMulti':\r\n\t\t\t\tie = new TagMultiItemEdit(edit, itemSchema, uiItem as UiTagMulti, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t}\r\n\tif (ie === undefined) {\r\n\t\tif (itemEdit === undefined) {\r\n\t\t\tswitch (itemSchema.type) {\r\n\t\t\t\tcase 'string': itemEdit = StringItemEdit; break;\r\n\t\t\t\tcase 'image': itemEdit = ImageItemEdit; break;\r\n\t\t\t\tcase 'boolean': itemEdit = CheckBoxItemEdit; break;\r\n\t\t\t\tcase 'number':\r\n\t\t\t\tcase 'integer': itemEdit = RangeItemEdit; break;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (itemEdit === undefined) return;\r\n\t\tie = new itemEdit(edit, itemSchema, uiItem, label, value);\r\n\t}\r\n\tie.init();\r\n\treturn ie;\r\n}\r\n","import { IObservableArray, computed, makeObservable } from 'mobx';\r\nimport { IPageItems } from '../../tool/IPageItems';\r\nimport { List } from './index';\r\n\r\nexport abstract class ListBase {\r\n    protected list: List;\r\n    constructor(list: List) {\r\n        this.list = list;\r\n\t\tmakeObservable(this, {\r\n\t\t\tloading: computed,\r\n\t\t});\r\n    }\r\n    get isPaged():boolean {\r\n        let items = this.list.props.items;\r\n        return (items !== null && items !== undefined && Array.isArray(items) === false);\r\n    }\r\n    get items():any[]|IObservableArray<any> {\r\n        let items = this.list.props.items;\r\n        if (items === null) return null;\r\n        if (items === undefined) return undefined;\r\n        if (Array.isArray(items) === true)\r\n            return items as IObservableArray<any>;\r\n        else\r\n            return (items as IPageItems<any>).items;\r\n    }\r\n    get loading():boolean {\r\n        let items = this.list.props.items;\r\n        if (items === null) return false;\r\n        if (items === undefined) return true;\r\n        let pageItems = items as IPageItems<any>;\r\n        if (pageItems.items === undefined) return false;\r\n        return pageItems.loading;\r\n    }\r\n    get selectedItems():any[] { return undefined; }\r\n    //updateProps(nextProps:any) {}\r\n    dispose() {};\r\n    abstract render: (item:any, index:number) => JSX.Element;\r\n    protected renderContent(item:any, index:number) {\r\n        let {render} = this.list.props.item;\r\n        if (render === undefined) return <div className=\"px-3 py-2\">{JSON.stringify(item)}</div>;\r\n        return render(item, index);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {ListBase} from './base';\r\n\r\nexport class Clickable extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key, onClick} = this.list.props.item;\r\n        return <li key={key===undefined?index:key(item)} className={classNames('va-row-clickable', className)} onClick={()=>onClick && onClick(item)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import classNames from 'classnames';\r\nimport { uid } from 'tonva-core';\r\nimport { ListBase } from './base';\r\n\r\nexport class Static extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key} = this.list.props.item;\r\n        if (typeof item === 'string') {\r\n            let cn = classNames('va-list-gap', 'px-3', 'pt-1');\r\n            return <li key={uid()} className={cn}>{item}</li>;\r\n        }\r\n        return <li key={key===undefined?index:key(item)} className={classNames(className)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observable, IObservableArray, isObservableArray, observe, makeObservable} from 'mobx';\r\nimport classNames from 'classnames';\r\nimport { uid } from 'tonva-core';\r\nimport {ListBase} from './base';\r\nimport { List } from './index';\r\nimport { IPageItems } from '../../tool';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport interface SelectableItem {\r\n    selected: boolean;\r\n    item: any;\r\n    labelId: string;\r\n}\r\n\r\nexport class Selectable extends ListBase {\r\n    _items: SelectableItem[] = null;\r\n    private inputItems:{[uid:string]: HTMLInputElement} = {};\r\n\r\n    constructor(list: List) {\r\n\t\tsuper(list);\r\n\t\tmakeObservable(this, {\r\n\t\t\t_items: observable\r\n\t\t})\r\n        this.buildItems();\r\n        this.listenArraySplice();\r\n    }    \r\n\r\n    private listenArraySplice() {\r\n        let {items} = this.list.props;\r\n        if (items === undefined) return;\r\n        if (items === null) return;\r\n        let itemsArray:any;\r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as IPageItems<any>).items;\r\n        }\r\n        if (isObservableArray(items) === true) {\r\n            observe(itemsArray as IObservableArray<any>, (change) => {                \r\n                if (change.type === 'splice') {\r\n                    let {index, removedCount, added} = change;\r\n                    let _added = added && added.map(v => {\r\n                        return {\r\n                            selected: false, \r\n                            item: v, \r\n                            labelId:uid()\r\n                        }\r\n                    });\r\n                    this._items.splice(index, removedCount, ..._added);\r\n                    this.buildItems();\r\n                }\r\n            }, true);\r\n        }\r\n    }\r\n\r\n    private buildItems = () => {\r\n        let {items, isItemSelected, selectedItems, compare} = this.list.props;\r\n        let itemsArray:any[] | IObservableArray<any>;\r\n        if (items === undefined) {\r\n            this._items = undefined;\r\n            return;\r\n        }\r\n        if (items === null) {\r\n            this._items = null;\r\n            return;\r\n        }\r\n        \r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as IPageItems<any>).items;\r\n        }\r\n\r\n\t\tif (isItemSelected) {\r\n\t\t\tlet retItems = itemsArray.map(v => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tselected: isItemSelected(v),\r\n\t\t\t\t\titem: v, \r\n\t\t\t\t\tlabelId:uid()\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tthis._items = retItems;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet comp: ((item:any, selectItem:any)=>boolean);\r\n\t\t\tif (compare === undefined) {\r\n\t\t\t\tcomp = (item:any, selectItem:any) => item === selectItem;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcomp = compare;\r\n\t\t\t}\r\n\t\t\tlet retItems = itemsArray.map(v => {\r\n\t\t\t\t//let isObserved = isObservable(v);\r\n\t\t\t\t//let obj = isObserved === true? toJS(v) : v;\r\n\t\t\t\t//let obj = v;\r\n\t\t\t\tlet selected = selectedItems === undefined?\r\n\t\t\t\t\tfalse\r\n\t\t\t\t\t: selectedItems.find(si => comp(v, si)) !== undefined;\r\n\t\t\t\treturn {\r\n\t\t\t\t\tselected: selected, \r\n\t\t\t\t\titem: v, \r\n\t\t\t\t\tlabelId:uid()\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t\tthis._items = retItems;\r\n\t\t}\r\n    }\r\n\r\n    get items() {\r\n        //if (this._items === undefined) \r\n        //this.buildItems();\r\n        return this._items;\r\n    }\r\n    private checkAll(on: boolean) {\r\n        for (let i in this.inputItems) this.inputItems[i].checked = on;\r\n        for (let item of this._items) item.selected = on;\r\n    }\r\n    selectAll() {\r\n        //if (this._items) this._items.forEach(v => v.selected = true);\r\n        this.checkAll(true);\r\n        this.list.props.item.onSelect(undefined, true, this.anySelected);\r\n    }\r\n    unselectAll() {\r\n        this.checkAll(false);\r\n        this.list.props.item.onSelect(undefined, false, this.anySelected);\r\n    }\r\n\r\n\tprivate get anySelected():boolean {return this._items.some(v => v.selected)}\r\n    private onSelect(item:SelectableItem, selected:boolean) {\r\n        item.selected = selected;\r\n        this.list.props.item.onSelect(item.item, selected, this.anySelected);\r\n    }\r\n    \r\n    get selectedItems():any[] {\r\n        return this._items.filter(v => v.selected === true).map(v => v.item);\r\n    }\r\n\r\n\trender = (item:SelectableItem, index:number):JSX.Element => {\r\n        let {key} = this.list.props.item;\r\n\t\treturn React.createElement(this.row, {item, index, key:key===undefined?index:key(item)});\r\n    }\r\n\r\n    private row = observer((props: {item:SelectableItem, index:number}):JSX.Element => {\r\n        let {item, index} = props;\r\n        let {className} = this.list.props.item;\r\n        let {labelId, selected, item:obItem} = item;\r\n        return <li className={classNames(className)}>\r\n            <div className=\"d-flex align-items-center px-3\">\r\n                <input ref={input=>{if (input) this.inputItems[labelId] = input;}}\r\n                    className=\"\" type=\"checkbox\" value=\"\" id={labelId}\r\n                    defaultChecked={selected}\r\n                    onChange={(e)=>{\r\n                        this.onSelect(item, e.target.checked)} \r\n                    }/>\r\n                <label className=\"\" style={{flex:1, marginBottom:0}} htmlFor={labelId}>\r\n                    {this.renderContent(obItem, index)}\r\n                </label>\r\n            </div>\r\n        </li>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport { resLang } from 'tonva-core';\r\nimport { ListRes, listRes } from 'tonva-core';\r\nimport _ from 'lodash';\r\nimport {ListBase} from './base';\r\nimport {Clickable} from './clickable';\r\nimport {Static} from './static';\r\nimport {Selectable} from './selectable';\r\nimport '../../css/va-list.css';\r\nimport { IObservableArray } from 'mobx';\r\nimport { IPageItems } from '../../tool';\r\n\r\ntype StaticRow = string|JSX.Element|(()=>string|JSX.Element);\r\ninterface ItemProps {\r\n\tclassName?: string|string[];\r\n\trender?: (item:any, index:number) => JSX.Element;\r\n\tonSelect?: (item:any, isSelected:boolean, anySelected:boolean)=>void;\r\n\tonClick?: (item:any)=>void;\r\n\tkey?: (item:any)=>string|number;\r\n}\r\n\r\nexport interface ListProps {\r\n    className?: string|string[];\r\n    items: any[] | IObservableArray<any> | IPageItems<any>;\r\n    item: ItemProps;\r\n\tisItemSelected?: (item:any) => boolean;\r\n    compare?: (item:any, selectItem:any) => boolean;\r\n\tselectedItems?:any[];\r\n    header?: StaticRow;\r\n    footer?: StaticRow;\r\n    before?: StaticRow;\r\n    loading?: StaticRow;\r\n\tnone?: StaticRow;\r\n\tonFocus?: (evt: React.FocusEvent<HTMLUListElement>)=>void;\r\n}\r\n\r\n@observer\r\nexport class List extends React.Component<ListProps> {\r\n\tprivate static res:ListRes = resLang<ListRes>(listRes);\r\n\r\n\tprivate listBase: ListBase;\r\n\tprivate selectable: Selectable;\r\n    constructor(props:ListProps) {\r\n\t\tsuper(props);\r\n        this.buildBase();\r\n    }\r\n    _$scroll = (direct: 'top'|'bottom') => {\r\n        console.log('############### items scroll to ' + direct);\r\n    }\r\n    private buildBase() {\r\n        let {item} = this.props;\r\n        let {onClick, onSelect} = item;\r\n        if (onSelect !== undefined)\r\n            this.selectable = this.listBase = new Selectable(this);\r\n        else if (onClick !== undefined)\r\n            this.listBase = new Clickable(this);\r\n        else\r\n            this.listBase = new Static(this);\r\n\t}\r\n\tcomponentDidUpdate(prevProps: Readonly<ListProps>, prevState: Readonly<any>) {\r\n\t\tif (_.isEqual(this.props.item, prevProps.item) === false) {\r\n\t\t\tthis.buildBase();\r\n\t\t\tthis.forceUpdate();\r\n\t\t}\r\n\t}\r\n    componentWillUnmount() {\r\n        this.listBase.dispose();\r\n    }\r\n    selectAll() {\r\n        if (this.selectable) this.selectable.selectAll();\r\n    }\r\n    unselectAll() {\r\n        if (this.selectable) this.selectable.unselectAll();\r\n    }\r\n    get selectedItems():any[] {\r\n        return this.listBase.selectedItems;\r\n    }\r\n    render() {\r\n        let {className, header, footer, before, loading, none, onFocus} = this.props;\r\n        if (before === undefined) before = '-';\r\n        if (loading === undefined) loading = () => <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />;\r\n        if (none === undefined) none = List.res.none;\r\n        let {items, loading:isLoading} = this.listBase;\r\n        function staticRow(row:StaticRow, type:string) {\r\n            if (!row) return;\r\n            switch (typeof row) {\r\n                default:\r\n                case 'string': return <li className={\"va-list-\"+type}>{row}</li>;\r\n                case 'function': return <li className={\"va-list-\"+type}>{(row as ()=>string|JSX.Element)()}</li>;\r\n                case 'object': return <li>{row}</li>\r\n            } \r\n        }\r\n        let content:any, waitingMore:any;\r\n        if (items === null)\r\n            content = staticRow(before, 'before');\r\n        else if (items === undefined)\r\n            content = staticRow(loading, 'loading');\r\n        else if (items.length === 0)\r\n            content = staticRow(none, 'none');\r\n        else {\r\n            content = items.map((item, index) => {\r\n                return this.listBase.render(item, index);\r\n            });\r\n        }\r\n        if (isLoading === true && items) {\r\n            waitingMore = staticRow(loading, 'loading');\r\n\t\t}\r\n\t\tlet tabIndex:number;\r\n\t\tif (onFocus !== undefined) tabIndex = -1;\r\n        return <ul className={classNames('va-list', className)} onFocus={onFocus} tabIndex={tabIndex}>\r\n            {staticRow(header, 'header')}\r\n            {content}\r\n            {waitingMore}\r\n            {staticRow(footer, 'footer')}\r\n        </ul>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { setRes } from 'tonva-core';\r\n\r\nexport interface EasyDateProps {\r\n    date: Date | number;\r\n\ttimeZone?: number;\r\n}\r\n\r\n//type YMD = (year:number, month:number, date:number) => string;\r\n//type MD = (month:number, date:number) => string;\r\n\r\nconst timeRes:{[prop:string]:any} = {\r\n\tmd: (month:number, date:number) => `${month}-${date}`,\r\n\tymd: (year:number, month:number, date:number) => `${year}-${month}-${date}`,\r\n\tyesterday: 'Yday',\r\n\ttoday: 'Today',\r\n\ttomorrow: 'Tmw',\r\n\t$zh: {\r\n\t\tmd: (month:number, date:number) => `${month}月${date}日`,\r\n\t\tymd: (year:number, month:number, date:number) => `${year}年${month}月${date}日`,\r\n\t\tyesterday: '昨天',\r\n\t\ttoday: '今天',\r\n\t\ttomorrow: '明天',\r\n\t},\r\n\t$en: {\r\n\t\tmd: (month:number, date:number) => `${month}-${date}`,\r\n\t\tymd: (year:number, month:number, date:number) => `${year}-${month}-${date}`,\r\n\t\tyesterday: 'Yday',\r\n\t\ttoday: 'Today',\r\n\t\ttomorrow: 'Tmw',\r\n\t}\r\n}\r\n\r\nsetRes(timeRes, timeRes);\r\n\r\nfunction tt(str:string):any {\r\n\treturn timeRes[str];\r\n}\r\n\r\nfunction renderDate(vDate:Date|number, withTime:boolean, always:boolean = false) {\r\n    if (!vDate) return null;\r\n    let date: Date;\r\n    switch (typeof vDate) {\r\n        default: date = vDate as Date; break;\r\n        case 'string': date = new Date(vDate); break;\r\n        case 'number': date = new Date((vDate as number)*1000); break;\r\n    }\r\n\r\n    let now = new Date();\r\n    let tick:number, nDate:number, _date:number, month:number, year:number, nowYear:number;\r\n    let d = date;\r\n    tick = now.getTime() - d.getTime();\r\n    let hour=d.getHours(), minute=d.getMinutes();\r\n    nDate=now.getDate();\r\n    _date=d.getDate();\r\n    month=d.getMonth()+1;\r\n    year=d.getFullYear();\r\n\tnowYear = now.getFullYear();\r\n\r\n\tlet appendTime:boolean = false;\r\n\tlet dPart:string = (function() {\r\n\t\tif (tick < -24*3600*1000) {\r\n\t\t\tif (year === nowYear) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('md')(month, _date);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt('ymd')(year, month, _date);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (tick < 24*3600*1000) {\r\n\t\t\tif (_date!==nDate) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn tt(tick < 0? 'tomorrow' : 'yesterday');\r\n\t\t\t}\r\n\t\t\tif (withTime===true) {\r\n\t\t\t\tappendTime = true;\r\n\t\t\t\treturn '';\r\n\t\t\t}\r\n\t\t\treturn tt('today');\r\n\t\t}\r\n\t\tif (year === nowYear) {\r\n\t\t\treturn tt('md')(month, _date);\r\n\t\t}\r\n\t\treturn tt('ymd')(year, month, _date);\r\n\t})();\r\n\r\n\tlet hm = hour + ((minute<10?':0':':') + minute);\r\n\r\n\t/*\r\n    if (tick < -24*3600*1000) {\r\n        if (year === nowYear)\r\n            return tt('md')(month, _date) + ' ' + hm;\r\n        else\r\n            return tt('ymd')(year, month, _date) + ' ' + hm;\r\n    }\r\n    if (always === true || tick < 24*3600*1000) {\r\n        return _date!==nDate? \r\n            tt(tick < 0? 'tomorrow' : 'yesterday') + ' ' + hm \r\n            : withTime===true? hm : tt('today');\r\n    }\r\n    if (year === nowYear) {\r\n        return tt('md')(month, _date);\r\n    }\r\n\treturn tt('ymd')(year, month, _date);\r\n\t*/\r\n\tif (appendTime === true || always === true) {\r\n\t\treturn dPart + ' ' + hm;\r\n\t}\r\n\treturn dPart;\r\n}\r\n\r\n\r\nexport class EasyDate extends React.Component<EasyDateProps> {\r\n    render() {\r\n        return renderDate(this.props.date, false);\r\n    }\r\n}\r\n\r\ninterface EasyTimeProps extends EasyDateProps {\r\n\talways?: boolean;\r\n}\r\nexport class EasyTime extends React.Component<EasyTimeProps> {\r\n    render() {\r\n\t\tlet {date, always} = this.props;\r\n        return renderDate(date, true, always);\r\n    }\r\n}\r\n\r\ninterface DateProps {\r\n\tdate: Date;\r\n\thideTime?: boolean;\r\n\thideSameYear?: boolean;\r\n}\r\nexport const VDate: React.FunctionComponent<DateProps> = (props) => {\r\n\tlet {date, hideTime, hideSameYear} = props;\r\n\tlet year = date.getFullYear();\r\n\tlet vTime:any;\r\n\tif (hideTime !== true) {\r\n\t\tvTime = <>{date.getHours()}:{String(100 + date.getMinutes()).substr(1,2)}</>;\r\n\t}\r\n\tlet vDate = <>{date.getMonth()+1}-{date.getDate()}</>;\r\n\tif (hideSameYear === true && year === new Date().getFullYear()) {\r\n\t}\r\n\telse {\r\n\t\tvDate = <>{year}-{vDate}</>;\r\n\t}\r\n\treturn <>\r\n\t\t{vDate} {vTime}\r\n\t</>;\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface DropdownAction {\r\n    icon?: string;\r\n    caption?: string;\r\n\taction?: () => void;\r\n\ticonClass?: string;\r\n\tcaptionClass?: string;\r\n}\r\n\r\nexport interface DropdownActionsProps {\r\n    icon?: string;\r\n\tcontent?: string|JSX.Element;\r\n    actions: DropdownAction[];\r\n    isRight?: boolean;\r\n\tclassName?: string;\r\n\tcontainerClass?: string;\r\n\titemIconClass?: string;\r\n\titemCaptionClass?: string;\r\n}\r\n\r\nexport interface DropdownActionsState {\r\n    dropdownOpen: boolean;\r\n}\r\n\r\nexport class DropdownActions extends React.Component<DropdownActionsProps, DropdownActionsState> {\r\n    private menu: HTMLDivElement;\r\n    private button: HTMLElement;\r\n    constructor(props:DropdownActionsProps) {\r\n        super(props);\r\n        this.state = {\r\n            dropdownOpen: false\r\n        };\r\n    }\r\n\r\n\t/*\r\n    componentDidMount() {\r\n        document.addEventListener('click', this.handleDocumentClick);\r\n        document.addEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        document.removeEventListener('click', this.handleDocumentClick);\r\n        document.removeEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\t*/\r\n\r\n    private handleDocumentClick = (evt:any) => {\r\n\t\tdocument.removeEventListener('click', this.handleDocumentClick);\r\n\t\tdocument.removeEventListener('touchstart', this.handleDocumentClick);\r\n\t\tif (this.state.dropdownOpen === false) return;\r\n        //if (this.button && this.button.contains(evt.target)) return;\r\n        if (!this.menu) return;\r\n        //if (!this.menu.contains(evt.target)) \r\n        this.toggle();\r\n    }\r\n\r\n    private toggle = () => {\r\n\t\tlet {dropdownOpen} = this.state;\r\n\t\tdropdownOpen = !dropdownOpen;\r\n        this.setState({dropdownOpen});\r\n\t\tif (dropdownOpen === true) {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tdocument.addEventListener('click', this.handleDocumentClick);\r\n\t\t\t\tdocument.addEventListener('touchstart', this.handleDocumentClick);\t\r\n\t\t\t},10)\r\n\t\t}\r\n    }\r\n\r\n    render() {\r\n        let {icon, content, actions, isRight, className, containerClass, itemIconClass, itemCaptionClass} = this.props;\r\n        if (isRight === undefined) isRight = true;\r\n        let hasIcon = actions.some(v => {\r\n\t\t\tif (!v) return false;\r\n\t\t\treturn v.icon !== undefined\r\n\t\t});\r\n        let {dropdownOpen} = this.state;\r\n\t\t//isOpen={this.state.dropdownOpen} toggle={this.toggle}\r\n\t\tlet cn = className || 'cursor-pointer dropdown-toggle btn btn-sm';\r\n\t\t//if (className) cn += className;\r\n        return <div className={classNames('dropdown', containerClass)}>\r\n\t\t\t<button ref={v=>this.button=v} \r\n\t\t\t\tclassName={cn}\r\n                data-toggle=\"dropdown\"\r\n                aria-expanded={dropdownOpen}\r\n                onClick={this.toggle}>\r\n                {icon!==null && <i className={classNames('fa fa-fw ', 'fa-'+(icon||'ellipsis-v'))} />}\r\n\t\t\t\t{content && <span className=\"ms-1\">{content}</span>}\r\n            </button>\r\n            <div ref={v => this.menu=v} className={classNames({\"dropdown-menu\":true, \"dropdown-menu-right\":isRight, \"show\":dropdownOpen})}>\r\n                {\r\n                    actions.map((v,index) => {\r\n\t\t\t\t\t\tif (!v) {\r\n                            return <div className=\"dropdown-divider\" key={index}/>;\r\n\t\t\t\t\t\t}\r\n                        let {icon, caption, action, iconClass, captionClass} = v;\r\n                        if (icon === undefined && caption === undefined) \r\n                            return <div className=\"dropdown-divider\" />;\r\n                        let i:any;\r\n                        if (hasIcon === true) {\r\n                            if (icon !== undefined) icon = 'fa-' + icon;\r\n\t\t\t\t\t\t\tif (!iconClass) iconClass = 'text-info';\r\n\t\t\t\t\t\t\ti = <i className={classNames('me-2', 'fa', icon, 'fa-fw', iconClass || itemIconClass)}\r\n\t\t\t\t\t\t\t\taria-hidden={true}></i>;\r\n                        }\r\n                        if (action === undefined) \r\n                            return <h6 className=\"dropdown-header\">{i} {caption}</h6>;\r\n                        let onMenuItemClick = (evt:React.MouseEvent<HTMLAnchorElement>)=>{\r\n                            evt.preventDefault();\r\n                            action();\r\n                        }\r\n                        let onTouchStart = (evt: React.TouchEvent<HTMLAnchorElement>) => {\r\n                            action();\r\n                        }\r\n                            // eslint-disable-next-line\r\n                        return <a className=\"dropdown-item\" key={index} href=\"#/\" \r\n                            onClick={onMenuItemClick} onTouchStart={onTouchStart}\r\n                            >{i} <span className={captionClass || itemCaptionClass}>{caption}</span></a>\r\n                    })\r\n                }\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport className from 'classnames';\r\nimport {PropGridProps} from './PropGrid';\r\nimport {LabeledProp, StringProp, NumberProp, ListProp, ComponentProp} from './propView';\r\n\r\nexport abstract class PropRow {\r\n    setValues(values: any) {}\r\n    abstract render(key:string): any;\r\n}\r\n\r\nexport class PropBorder extends PropRow {\r\n    render(key:string): JSX.Element {\r\n        return <div key={'_b_' + key} className=\"\">\r\n            <div className=\"w-100\">\r\n                <div style={{borderTop: '1px solid #f0f0f0'}} />\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class PropGap extends PropRow {\r\n    private param: string;\r\n    constructor(param?: string) {\r\n        super();\r\n        this.param = param;\r\n    }\r\n    render(key:string): JSX.Element {\r\n        let w: string;\r\n        switch (this.param) {\r\n            default: w = 'py-2'; break;\r\n            case '=': w = 'py-1'; break;\r\n            case '-': w = 'pb-1'; break;\r\n        }\r\n        let cn = className(w);\r\n        return <div key={'_g_' + key} className={cn} />;\r\n    }\r\n}\r\n\r\nconst valueAlignStart = 'justify-content-start';\r\nconst valueAlignCenter = 'justify-content-center';\r\nconst valueAlignEnd = 'justify-content-end';\r\nexport abstract class LabeledPropRow extends PropRow {\r\n    protected gridProps: PropGridProps;\r\n    protected _prop: LabeledProp;\r\n    protected get prop():LabeledProp {return this._prop}\r\n    protected content: any;\r\n    protected col: string;\r\n    //protected values: any;\r\n    constructor(gridProps:PropGridProps, prop: LabeledProp) {\r\n        super();\r\n        this.gridProps = gridProps;\r\n        this._prop = prop;\r\n        this.col = gridProps.labelFixLeft === true? 'col' : 'col-sm';\r\n        //this.values = values;\r\n    }\r\n    render(key:string):any {\r\n        let {onClick, bk} = this.prop;\r\n        let cn = className({\r\n            \"cursor-pointer\": onClick !== undefined,\r\n            \"bg-white\": bk === undefined, \r\n            \"row\": true\r\n        });\r\n        return <div key={key} className={cn} onClick={onClick}>\r\n            {this.renderLabel()}\r\n            {this.renderProp()}\r\n        </div>;\r\n    }\r\n    protected renderLabel():any {\r\n        let {label} = this.prop;\r\n        if (label === undefined) return null;\r\n        return <label className={this.col + '-3 col-form-label'}>\r\n            {label}\r\n        </label>;\r\n    }\r\n    protected renderProp():any {\r\n        let {label} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string = this.col + (label===undefined? '-12':'-9');\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n    protected renderPropBody():any {\r\n        return <div className=\"form-control-plaintext\">\r\n            {this.renderPropContent()}\r\n        </div>;\r\n    }\r\n    protected renderPropContent():any {\r\n        return this.content;\r\n    }\r\n}\r\n\r\nexport class StringPropRow extends LabeledPropRow {\r\n    protected get prop(): StringProp {return this._prop as StringProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class NumberPropRow extends LabeledPropRow {\r\n    protected get prop(): NumberProp {return this._prop as NumberProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class ListPropRow extends LabeledPropRow {\r\n    protected get prop(): ListProp {return this._prop as ListProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else {\r\n            let list = this.prop.list;\r\n            if (typeof list === 'string') this.content = values[list];\r\n            else this.content = undefined;\r\n        }\r\n    }\r\n    protected renderPropBody() {\r\n        let {list, row} = this.prop;\r\n        let items:any[] = typeof list === 'string'? this.content : list;\r\n        if (items === undefined) return <div/>;\r\n        // new row(item)\r\n        return <div className=\"w-100\">\r\n            {\r\n                items.map((item, index) => <React.Fragment key={index}>\r\n                    {index===0? null: <div style={{width:'100%', borderBottom:'1px solid #f0f0f0'}} />}\r\n                    {React.createElement(row, item)}\r\n                </React.Fragment>)\r\n            }\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class ComponentPropRow extends LabeledPropRow {\r\n    protected get prop(): ComponentProp {return this._prop as ComponentProp;}\r\n    protected renderPropBody() {\r\n        let {component} = this.prop;\r\n        return component;\r\n    }\r\n    protected renderProp():any {\r\n        let {label, full} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string;\r\n        if (full !== true)\r\n            col = this.col + (label===undefined? '-12':'-9');\r\n        else\r\n            col = 'w-100';\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n}\r\n","import { PropGridProps } from './PropGrid';\r\nimport {\r\n    PropRow, PropBorder, PropGap, \r\n    StringPropRow, NumberPropRow, ListPropRow, ComponentPropRow\r\n} from './row';\r\n\r\nexport interface Format {\r\n\r\n}\r\n\r\nexport interface PropBase {\r\n    onClick?: () => void;\r\n}\r\n\r\nexport interface LabeledProp extends PropBase {\r\n    label?: string;\r\n    bk?: string;\r\n    vAlign?: 'top' | 'bottom' | 'center' | 'stretch';\r\n}\r\n\r\nexport interface StringProp extends LabeledProp {\r\n    type: 'string';\r\n    name: string;\r\n}\r\n\r\nexport interface NumberProp extends LabeledProp {\r\n    type: 'number';\r\n    name: string;\r\n\tisInt: boolean;\t\t// 整数\r\n\ttime: boolean;\t\t// 字段log的time可以客户端输入\r\n}\r\n\r\nexport interface FormatProp extends LabeledProp {\r\n    type: 'format';\r\n    format: Format;\r\n}\r\n\r\nexport interface ListProp extends LabeledProp {\r\n    type: 'list';\r\n    list: string | any[];  // string 表示名字，否则就是值\r\n    row: new (props: any) => React.Component;\r\n}\r\n\r\nexport interface ComponentProp extends LabeledProp {\r\n    type: 'component';\r\n    full?: boolean;\r\n    component: any; //JSX.Element;\r\n}\r\n\r\nexport type Prop = StringProp | NumberProp | FormatProp | ListProp | ComponentProp | string;\r\n\r\nexport class PropView {\r\n    private gridProps: PropGridProps\r\n    private props: Prop[];\r\n    //private values:any;\r\n    private rows: PropRow[];\r\n\r\n    constructor(gridProps: PropGridProps, props: Prop[]) {\r\n        this.gridProps = gridProps;\r\n        this.props = props;\r\n        //this.values = values;\r\n        this.buildRows();\r\n    }\r\n\r\n    private buildRows() {\r\n        this.rows = [];\r\n        let isGap: boolean = true;\r\n        for (let prop of this.props) {\r\n            if (typeof prop === 'string') {\r\n                this.rows.push(new PropGap(prop));\r\n                isGap = true;\r\n            }\r\n            else {\r\n                if (!isGap) this.rows.push(new PropBorder());\r\n                let row;\r\n                switch (prop.type) {\r\n                    default: continue;\r\n                    case 'string': row = new StringPropRow(this.gridProps, prop); break;\r\n                    case 'number': row = new NumberPropRow(this.gridProps, prop); break;\r\n                    case 'list': row = new ListPropRow(this.gridProps, prop); break;\r\n                    case 'component': row = new ComponentPropRow(this.gridProps, prop); break;\r\n                }\r\n                this.rows.push(row);\r\n                isGap = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    setValues(values: any) {\r\n        for (let r of this.rows) r.setValues(values);\r\n    }\r\n\r\n    render() {\r\n        return this.rows.map((row, index) => row.render(String(index)));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, PropView} from './propView';\r\n\r\nexport interface PropGridProps {\r\n    className?: string;\r\n    rows: Prop[];\r\n    values: any;\r\n    alignValue?: 'left'|'center'|'right';\r\n    labelFixLeft?: boolean;\r\n}\r\n\r\n@observer\r\nexport class PropGrid extends React.Component<PropGridProps> {\r\n    render() {\r\n        let {className, rows, values} = this.props;\r\n        let propView = new PropView(this.props, rows);\r\n        propView.setValues(values);\r\n        let cn = classNames('container-fluid', className);\r\n        return <div className={cn}>\r\n            {propView.render()}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Image } from './image';\r\n\r\nexport interface MediaProps {\r\n    icon: string;\r\n    main: string|JSX.Element;\r\n    discription?: string | JSX.Element;\r\n    px?: number;\r\n    py?: number;\r\n}\r\n\r\nexport class Media extends React.Component<MediaProps> {\r\n    render() {\r\n        let {icon, main, discription, px, py} = this.props;\r\n        let disp:any;\r\n        if (typeof discription === 'string')\r\n            disp = <div>{discription}</div>;\r\n        else\r\n            disp = discription;\r\n        let cn = classNames(\r\n            'media', \r\n            px===undefined? 'px-0':'px-'+px, \r\n            py===undefined? 'py-2':'py-'+py);\r\n        return <div className={cn}>\r\n            <Image className=\"me-3 w-4c h-4c\" src={icon} />\r\n            <div className=\"media-body\">\r\n                <h5 className=\"mt-0\">{main}</h5>\r\n                {disp}\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { env } from 'tonva-core';\r\n\r\nexport interface SearchBoxProps {\r\n    className?: string;\r\n    label?: string;\r\n    initKey?: string;\r\n    placeholder?: string;\r\n    buttonText?: string;\r\n    maxLength?: number;\r\n    size?: 'sm' | 'md' | 'lg';\r\n    inputClassName?: string;\r\n    onSearch: (key:string)=>Promise<void>;\r\n    onFocus?: ()=>void;\r\n    allowEmptySearch?: boolean;\r\n}\r\n\r\n/*\r\nexport interface SearchBoxState {\r\n    disabled: boolean;\r\n}*/\r\n\r\nexport class SearchBox extends React.Component<SearchBoxProps> { //}, SearchBoxState> {\r\n    private input: HTMLInputElement;\r\n\tprivate button: HTMLButtonElement;\r\n    private key: string = null;\r\n\t\r\n    private onChange = (evt: React.ChangeEvent<any>) => {\r\n        this.key = evt.target.value;\r\n        if (this.key !== undefined) {\r\n            this.key = this.key.trim();\r\n            if (this.key === '') this.key = undefined;\r\n        }\r\n\t\tconsole.log('key = ' + this.key);\r\n        if (this.props.allowEmptySearch === true) {\r\n\t\t}\r\n\t\telse {\r\n            this.button.disabled = this.key === undefined || this.key.length === 0;\r\n        }\r\n    }\r\n    private onSubmit = async (evt: React.FormEvent<any>) => {\r\n        evt.preventDefault();\r\n        if (this.key === null) this.key = this.props.initKey || '';\r\n        if (this.props.allowEmptySearch !== true) {\r\n            if (!this.key) return;\r\n            if (this.input) this.input.disabled = true;\r\n\t\t\tif (this.button) this.button.disabled = true;\r\n        }\r\n        await this.props.onSearch(this.key);\r\n        if (this.input) this.input.disabled = false;\r\n\t\tif (this.button) this.button.disabled = false;\r\n    }\r\n    clear() {\r\n        if (this.input) this.input.value = '';\r\n    }\r\n    render() {\r\n\t\tlet {className, inputClassName, onFocus,\r\n\t\t\tlabel, placeholder, buttonText, maxLength, size} = this.props;\r\n\t\tlet inputSize:string;\r\n\t\tswitch (size) {\r\n\t\t\tdefault:\r\n\t\t\tcase 'sm': inputSize = 'input-group-sm'; break;\r\n\t\t\tcase 'md': inputSize = 'input-group-md'; break;\r\n\t\t\tcase 'lg': inputSize = 'input-group-lg'; break;\r\n\t\t}\r\n\t\tlet autoComplete:string;\r\n\t\tif (env.isMobile === true) autoComplete = 'off';\r\n\t\treturn <form className={className} onSubmit={this.onSubmit} autoComplete={autoComplete}>\r\n\t\t\t<div className={classNames(\"input-group\", inputSize)}>\r\n\t\t\t\t{label && <div className=\"input-group-addon align-self-center me-2\">{label}</div>}\r\n\t\t\t\t<input ref={v=>this.input=v} onChange={this.onChange}\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tname=\"key\"\r\n\t\t\t\t\tonFocus={onFocus}\r\n\t\t\t\t\tclassName={classNames('form-control', inputClassName || 'border-primary')}\r\n\t\t\t\t\tplaceholder={placeholder}\r\n\t\t\t\t\tdefaultValue={this.props.initKey}\r\n\t\t\t\t\tmaxLength={maxLength} />\r\n\t\t\t\t<div className=\"input-group-append\">\r\n\t\t\t\t\t<button ref={v=>this.button=v} className=\"btn btn-primary\"\r\n\t\t\t\t\t\ttype=\"submit\"\r\n\t\t\t\t\t\tdisabled={this.props.allowEmptySearch !== true}>\r\n\t\t\t\t\t\t<i className='fa fa-search' />\r\n\t\t\t\t\t\t<i className=\"fa\"/>\r\n\t\t\t\t\t\t{buttonText}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</form>;\t\r\n    }\r\n}\r\n","import React from \"react\";\r\nimport classNames from 'classnames';\r\nimport { tonva } from \"tonva-core\";\r\n// import { nav } from \"../../nav\";\r\n\r\nexport interface AxProps extends React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement> {\r\n\t//children: React.ReactNode;\r\n\t//href: string;\r\n\t//onClick?: (event:React.MouseEvent) => void;\r\n\t//className?: string;\r\n\taClassName?: string;\r\n\tnaClassName?: string;\r\n\t//target?: string;\r\n\t//props?: any;\r\n}\r\n\r\n// 如果是web方式，用webNav方式route网页\r\n// 如果是app方式，用click方式压栈页面\r\nexport const Ax = (axProps: AxProps) => {\r\n\tlet {href, children, className, onClick} = axProps;\r\n\tif (tonva.nav.isWebNav === true) {\r\n\t\tlet {aClassName } = axProps;\r\n\t\tif (!href) return <span className=\"text-danger\">Error: href not defined in Ax</span>;\r\n\t\tlet onAxClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\t\tevt.preventDefault();\r\n\t\t\tlet ret:boolean;\r\n\t\t\tif (onClick) {\r\n\t\t\t\tret = onClick(evt) as unknown as boolean;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttonva.navigate(href);\r\n\t\t\t\tret = false;\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\treturn <a {...axProps} className={classNames(className, aClassName)} onClick={onAxClick}>{children}</a>;\r\n\t}\r\n\telse {\r\n\t\tlet {naClassName} = axProps;\r\n\t\tif (!onClick) {\r\n\t\t\tonClick = () => {\r\n\t\t\t\tif (tonva.openSysPage(href) === false) {\r\n\t\t\t\t\ttonva.navigate(href);\r\n\t\t\t   };\r\n\t\t\t   return false;\r\n\t\t   }\r\n\t\t}\r\n\t\treturn <span className={classNames(className, 'cursor-pointer', naClassName)} onClick={onClick}>{children}</span>;\r\n\t}\r\n}\r\n\r\n// 同普通的a tag\r\n// 会自动处理href，处理生产版跟测试版之间的不同\r\nexport const A = (props: React.DetailedHTMLProps<React.AnchorHTMLAttributes<HTMLAnchorElement>, HTMLAnchorElement>) => {\r\n\tlet {children} = props;\r\n\tif (tonva.nav.isWebNav === false) {\r\n\t\treturn <a {...props}>{children}</a>;\r\n\t}\r\n\tlet {href} = props;\r\n\t//if (nav.testing === true) href += '#test';\r\n\tlet onClick = (evt: React.MouseEvent<HTMLAnchorElement>) => {\r\n\t\tevt.preventDefault();\r\n\t\ttonva.navigate(href);\r\n\t\treturn false;\r\n\t}\r\n\treturn <a {...props} href={href} onClick={onClick}>{children}</a>;\r\n}\r\n","import { action, makeObservable, observable } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\nimport React, { Component } from \"react\";\r\nimport { Rule, RuleCustom, RuleRequired } from \"../inputRules\";\r\n\r\nexport interface InputProps {\r\n    className?: string;\r\n    defaultValue?: any;\r\n    disabled?: boolean;\r\n    onValueChange?: (newValue:any, preValue:any, ruleMessage:string) => void;\r\n    required?: boolean;\r\n    containerClassName?: string;\r\n    ruleClassName?: string;\r\n    requiredFlagElement?: JSX.Element;\r\n    rules?: ((value:any) => string[] | string)[];\r\n}\r\n\r\nexport abstract class Input<P extends InputProps, V> extends Component<P> {\r\n    static defaultRequiredFlagElement = <span className=\"mx-2 text-danger\">*</span>;\r\n    static defaultRuleClassName = ' mx-2 text-danger ';\r\n    protected readonly rules: Rule[] = [];\r\n    protected value: V = null;\r\n    protected input: HTMLInputElement;\r\n    protected abstract get type(): 'text' | 'number' | 'checkbox' | 'radio';\r\n    protected get placeholder(): string {return undefined;}\r\n    protected get max(): number {return undefined;}\r\n    protected get min(): number {return undefined;}\r\n    protected get maxLength(): number {return undefined;}\r\n    protected get className(): string {return this.props.className}\r\n    protected requiredFlagElement?: JSX.Element;\r\n    ruleMessage: string = null;\r\n    constructor(props: P) {\r\n        super(props);\r\n        makeObservable(this, {\r\n            ruleMessage: observable,\r\n            onChange: action,\r\n            onFocus: action,\r\n            onBlur: action,\r\n        });\r\n        this.init();\r\n    }\r\n\r\n    private init() {\r\n        let {required, rules, requiredFlagElement, defaultValue} = this.props;\r\n        if (required === true) {\r\n            if (requiredFlagElement === undefined) requiredFlagElement = Input.defaultRequiredFlagElement;\r\n            this.requiredFlagElement = requiredFlagElement;\r\n            this.rules.push(new RuleRequired());\r\n        }\r\n        this.buildRules();\r\n        if (rules) {\r\n            for (let rule of rules) {this.rules.push(new RuleCustom(rule))};\r\n        }\r\n        this.value = defaultValue;\r\n    }\r\n\r\n    protected buildRules() {\r\n    }\r\n\r\n    getValue(): V {return this.value;}\r\n    setValue(v: V) {\r\n        let p = this.value;\r\n        this.value = v;\r\n        this.checkRules();\r\n        let {onValueChange} = this.props;\r\n        if (!onValueChange) return;\r\n        if (v !== p) onValueChange(v, p, this.ruleMessage);\r\n    }\r\n\r\n    render(): JSX.Element {\r\n        let {defaultValue, disabled, required} = this.props;\r\n        let content = <input ref={inp => this.input = inp}\r\n            className={this.className} type={this.type}\r\n            placeholder={this.placeholder}\r\n            defaultValue={defaultValue}\r\n            defaultChecked={defaultValue}\r\n            maxLength={this.maxLength}\r\n            max={this.max}\r\n            min={this.min}\r\n            disabled={disabled}\r\n            onChange={() => this.onChange()}\r\n            onBlur={() => this.onBlur()}\r\n            onFocus={() => this.onFocus()} />;\r\n        if (this.rules.length === 0) return content;\r\n        let {containerClassName, ruleClassName} = this.props;\r\n        return <span className={containerClassName}>\r\n            {required===true && this.requiredFlagElement}\r\n            {content}\r\n            {\r\n                React.createElement(observer(() => {\r\n                    return <span className={ruleClassName ?? Input.defaultRuleClassName}>{this.ruleMessage}</span>\r\n                }))\r\n            }\r\n        </span>;\r\n    }\r\n\r\n    onChange() {\r\n        let preValue = this.value;\r\n        let value = this.value = this.valueFromInput();\r\n        this.checkRules();\r\n        let {onValueChange} = this.props;\r\n        if (!onValueChange) return;\r\n        if (value !== preValue) onValueChange(value, preValue, this.ruleMessage);\r\n    }\r\n\r\n    protected valueFromInput():V {return;}\r\n\r\n    protected checkRules() {\r\n        let defy:string[] = [];\r\n        for (let rule of this.rules) {\r\n            rule.check(defy, this.value);\r\n        }\r\n        if (defy.length === 0) {\r\n            this.ruleMessage = null;\r\n        }\r\n        else {\r\n            this.ruleMessage = defy[0];\r\n        }\r\n    }\r\n\r\n    onBlur() {\r\n        this.checkRules();\r\n    }\r\n\r\n    onFocus() {\r\n        this.ruleMessage = null;\r\n    }\r\n}\r\n","import { RuleInt, RuleNum } from \"../../inputRules\";\r\nimport { Input, InputProps } from \"./../input\";\r\n\r\ninterface InputNumberProps extends InputProps {\r\n    placeholder?: string;\r\n    max?: number;\r\n    min?: number;\r\n}\r\n\r\nexport class InputNumber<P extends InputNumberProps> extends Input<P, number> {\r\n    static defaultClassName = 'form-control w-8c d-inline text-right';\r\n\r\n    protected get type(): 'text' | 'number' | 'checkbox' | 'radio' {return 'number'}\r\n    protected get max(): number {return this.props.max;}\r\n    protected get min(): number {return this.props.min;}\r\n    protected get className(): string {\r\n        let {className} = this.props;\r\n        if (className === null) return null;\r\n        if (!className) return InputNumber.defaultClassName;\r\n        return className;\r\n    }\r\n\r\n    protected buildRules() {\r\n        let {max, min} = this.props;\r\n        this.rules.push(new RuleNum(undefined, min, max));\r\n    }\r\n\r\n    protected parseValue(): number {\r\n        return Number.parseFloat(this.input.value);\r\n    }\r\n\r\n    protected valueFromInput(): number {\r\n        let v = this.parseValue();\r\n        if (isNaN(v) === true) return undefined;\r\n        return v;\r\n    }\r\n}\r\n\r\nexport interface InputIntegerProps extends InputNumberProps {\r\n}\r\n\r\nexport class InputInteger<P extends InputIntegerProps> extends InputNumber<P> {\r\n    protected buildRules() {\r\n        let {max, min} = this.props;\r\n        this.rules.push(new RuleInt(undefined, min, max));\r\n    }\r\n\r\n    protected parseValue(): number {\r\n        return Number.parseInt(this.input.value);\r\n    }\r\n}\r\n","import { Input, InputProps } from \"../input\";\r\n\r\nexport interface InputCheckBoxProps extends InputProps {\r\n}\r\n\r\nexport class InputCheckBox extends Input<InputCheckBoxProps, boolean> {\r\n    static defaultClassName = 'form-check-input p-2';\r\n\r\n    protected get type(): 'text' | 'number' | 'checkbox' | 'radio' {return 'checkbox'}\r\n    protected get className(): string {\r\n        let {className} = this.props;\r\n        if (className === null) return null;\r\n        if (!className) return InputCheckBox.defaultClassName;\r\n        return className;\r\n    }\r\n\r\n    protected valueFromInput(): boolean {\r\n        return this.input.checked;\r\n    }\r\n    onBlur() {}\r\n    onFocus() {}\r\n    setValue(v: boolean) {\r\n        super.setValue(v);\r\n        this.input.checked = v;\r\n    }\r\n}\r\n","import fs from 'fs';\r\nimport { capitalCase } from \"../tool\";\r\nimport { UqMan } from \"../uqCore\";\r\nimport { UqBuildContext } from './UqBuildContext';\r\n\r\nexport const red = '\\x1b[41m%s\\x1b[0m';\r\nexport let lastBuildTime:number = 0;\r\n//export const uqTsSrcPath = 'src/UqApp';\r\n\r\nexport function saveSrcTsFileIfNotExists(context:UqBuildContext, fileName:string, suffix:string, content:string) {\r\n\tlet tsFilePath = `${context.uqTsSrcPath}/${fileName}.${suffix}`;\r\n\tsaveTsFileIfNotExists(tsFilePath, content);\r\n\t//if (fs.existsSync(tsFile) === true) return;\r\n\t//saveTsFile(fileName, content, suffix);\r\n}\r\nexport function saveTsFile(context:UqBuildContext, fileName:string, content:string, suffix:string = 'ts') {\r\n\tlet {uqTsSrcPath} = context;\r\n\tlet srcFile = `${uqTsSrcPath}/${fileName}.${suffix}.txt`;\r\n\tlet tsFile = `${uqTsSrcPath}/${fileName}.${suffix}`;\r\n\tif (!fs.existsSync(srcFile)) {\r\n\t\tif (fs.existsSync(tsFile)) {\r\n\t\t\tfs.renameSync(tsFile, srcFile);\r\n\t\t}\r\n\t}\r\n\tfs.writeFileSync(tsFile, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${tsFile} is built`);\r\n}\r\nexport function overrideTsFile(path:string, content:string) {\r\n\t//let tsFile = `${path}/${fileName}.${suffix}`;\r\n\tfs.writeFileSync(path, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${path} is built`);\r\n}\r\n//fileName:string, \r\n//, suffix:string = 'ts'\r\nexport function saveTsFileIfNotExists(tsFilePath:string, content:string) {\r\n\t//let tsFilePath = `${path}/${fileName}.${suffix}`;\r\n\tif (fs.existsSync(tsFilePath) === true) return;\r\n\toverrideTsFile(tsFilePath, content);\r\n}\r\n\r\n/*\r\nfunction createTsFile(path:string, fileName:string, content:string, suffix:string = 'ts') {\r\n\tlet tsFile = `${path}/${fileName}.${suffix}`;\r\n\tif (fs.existsSync(tsFile) === true) return;\r\n\tfs.writeFileSync(tsFile, content);\r\n\tlastBuildTime = Date.now();\r\n\tconsole.log(red, `${tsFile} is built`);\r\n}\r\n*/\r\nexport function entityName(s:string):string {\r\n\treturn capitalCase(s);\r\n}\r\n\r\nexport function getNameFromUq(uqMan:UqMan):{devName:string; uqName:string} {\r\n\tlet {config} = uqMan;\r\n\tlet devPart:string, uqPart:string;\r\n\tif (config) {\r\n\t\tlet {dev, name, alias} = config;\r\n\t\tlet {name:devName, alias:devAlias} = dev;\r\n\t\tdevPart = devAlias || devName;\r\n\t\tuqPart = alias || name;\r\n\t}\r\n\telse {\r\n\t\tlet {uqOwner, uqName} = uqMan;\r\n\t\tdevPart = uqOwner;\r\n\t\tuqPart = uqName;\r\n\t}\r\n\treturn {\r\n\t\tdevName: capitalCase(devPart),\r\n\t\tuqName: capitalCase(uqPart),\r\n\t};\r\n}\r\n","import { Tonva, User, Web } from \"tonva-core\";\r\nimport { VPage } from \"./VPage\";\r\nimport { Controller, WebNav } from \"./Controller\";\r\n\r\nexport abstract class ControllerWithWeb extends Controller {\r\n    readonly web: Web;\r\n    constructor(tonva: Tonva) {\r\n        super(tonva);\r\n        this.web = tonva.web;\r\n    }\r\n\r\n    private receiveHandlerId:number;\r\n    //private disposer:()=>void;\r\n\r\n    protected dispose = () => {\r\n        // message listener的清理\r\n\t\t//nav.unregisterReceiveHandler(this.receiveHandlerId);\r\n\t\tthis.web.messageHub.unregisterReceiveHandler(this.receiveHandlerId);\r\n        this.onDispose();\r\n    }\r\n\r\n    protected onDispose() {\r\n\t}\r\n\t\r\n    protected async internalStart(param?:any, ...params:any[]):Promise<void> {\r\n        return;\r\n    }\r\n\r\n    get user():User {return this.tonva.user}\r\n    get isLogined():boolean {\r\n        let {user} = this.tonva;\r\n        if (!user) return false;\r\n        return user.id > 0;\r\n    }\r\n\r\n\tget webNav(): WebNav<any> {return undefined;}\r\n\r\n\tgetWebNav(): WebNav<any> {return this.webNav;}\r\n\r\n\tget isWebNav(): boolean {return this.nav.isWebNav}\r\n\tnavigate(url:string) {\r\n\t\tthis.navigate(url);\r\n\t}\r\n\t\r\n\tisMe(id:any):boolean {\r\n\t\tif (id === null) return false;\r\n\t\tlet {user} = this;\r\n\t\tlet userId = user.id;\r\n\t\tswitch (typeof id) {\r\n\t\t\tdefault: return false;\r\n\t\t\tcase 'string': return Number(id) === userId;\r\n\t\t\tcase 'number': return id === userId;\r\n\t\t\tcase 'object': return id.id === userId;\r\n\t\t}\r\n\t}\r\n\r\n    protected onMessage(message:any):Promise<void> {\r\n        return;\r\n    }\r\n\r\n    private onMessageReceive = async (message:any):Promise<void> => {\r\n        await this.onMessage(message);\r\n    }\r\n\r\n    protected async beforeStart():Promise<boolean> {\r\n        return true;\r\n\t}\r\n\tprotected async afterStart():Promise<void> {\r\n\t}\r\n    protected registerReceiveHandler() {\r\n        this.receiveHandlerId = this.web.messageHub.registerReceiveHandler(this.onMessageReceive);\r\n    }\r\n\r\n    async start(param?:any, ...params:any[]):Promise<void> {\r\n\t\tthis.registerReceiveHandler();\r\n        let ret = await this.beforeStart();\r\n        if (ret === false) return;\r\n\t\tawait this.internalStart(param, ...params);\r\n\t\tawait this.afterStart();\r\n    }\r\n\r\n    get isCalling():boolean {return this._resolve_$ !== undefined}\r\n\r\n    private _resolve_$:((value:any) => void)[];\r\n    async call<T>(param?:any, ...params:any[]):Promise<T> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<T> (async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await this.start(param, ...params);\r\n        });\r\n    }\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any):Promise<any> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<any> (async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await (new vp(this as any)).open(param);\r\n        });\r\n    }\r\n\r\n    returnCall(value:any) {\r\n        if (this._resolve_$ === undefined) return;\r\n        let resolve = this._resolve_$.pop();\r\n        if (resolve === undefined) {\r\n            alert('the Controller call already returned, or not called');\r\n            return;\r\n        }\r\n        resolve(value);\r\n    }\r\n\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { Page } from '../components';\r\nimport { env, Nav, Tonva } from 'tonva-core';\r\nimport { Controller } from './Controller';\r\nimport { VPage } from './VPage';\r\n\r\nexport abstract class View<C extends Controller> {\r\n    protected readonly tonva: Tonva;\r\n    protected readonly controller: C;\r\n    protected readonly nav: Nav;\r\n    protected readonly res: any;\r\n\tprotected readonly x: any;\r\n\tprotected readonly t: (str:string)=>any;\r\n\r\n    constructor(controller: C) {\r\n        let tonva = controller.getTonva();\r\n        this.tonva = tonva;\r\n        this.controller = controller;\r\n        this.nav = tonva.nav;\r\n\t\tthis.t = controller.t;\r\n    }\r\n\r\n\tprotected get isDev() {return  env.isDevelopment}\r\n\tget isWebNav(): boolean {return this.nav.isWebNav}\r\n\tnavigate(url:string) {this.tonva.navigate(url)}\r\n\t//protected isMe(id:any) {return this.controller.isMe(id)}\r\n    abstract render(param?:any): JSX.Element;\r\n\r\n    protected react(func: () => JSX.Element):JSX.Element {\r\n        let V = observer(func.bind(this));\r\n        return <V />;\r\n    }\r\n\r\n    protected renderVm(vm: new (controller: C)=>View<C>, param?:any) {\r\n        return (new vm(this.controller)).render(param);\r\n    }\r\n\r\n    protected async openVPage(vp: new (controller: C)=>VPage<C>, param?:any, afterBack?:()=>Promise<void>):Promise<void> {\r\n        await (new vp(this.controller)).open(param, afterBack);\r\n    }\r\n\r\n    protected async event(type:string, value?:any) {\r\n        await this.controller.event(type, value);\r\n\t}\r\n\t\r\n\tprotected go(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tthis.controller.go(showPage, url, absolute);\r\n\t}\r\n    /*\r\n    async vCall<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any):Promise<any> {\r\n        return await this.controller.vCall(vp, param);\r\n    }\r\n\r\n    protected returnCall(value:any) {\r\n        this.controller.returnCall(value);\r\n    }\r\n\r\n\tprotected renderUser(user:any, imageClassName?:string, textClassName?:string) {\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick, icon} = user;\r\n\t\t\treturn <>\r\n\t\t\t\t<Image src={icon} className={imageClassName || 'w-1c h-1c me-2'} />\r\n\t\t\t\t<span className={textClassName}>{nick || name}</span>\r\n\t\t\t</>;\r\n\t\t}\r\n\t\treturn <UserView user={user} render={renderUser} />\r\n\t}\r\n\r\n\tprotected renderUserText(user:any) {\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {name, nick} = user;\r\n\t\t\treturn <>{nick || name}</>;\r\n\t\t}\r\n\t\treturn <UserView user={user} render={renderUser} />\r\n\t}\r\n\r\n\tprotected renderMe(imageClassName?:string, textClassName?:string) {\r\n\t\tlet {user} = this.controller;\r\n\t\tif (!user) return;\r\n\t\treturn this.renderUser(user.id, imageClassName, textClassName);\r\n\t}\r\n    */\r\n    protected openPage(view: React.StatelessComponent<any>, param?:any, onClosePage?:(ret:any)=>void) {\r\n        let type = typeof param;\r\n        if (type === 'object' || type === 'undefined') {\r\n            this.controller.openPage(React.createElement(view, param), onClosePage);\r\n        }\r\n        else {\r\n            this.controller.openPage(<Page header=\"param type error\">\r\n                View.openPage param must be object, but here is {type}\r\n            </Page>, onClosePage);\r\n        }\r\n    }\r\n\r\n    protected replacePage(view: React.StatelessComponent<any>, param?:any) {\r\n        this.controller.replacePage(React.createElement(view, param));\r\n    }\r\n\r\n    protected openPageElement(page: JSX.Element, onClosePage?: ()=>void) {\r\n        this.controller.openPage(page, onClosePage);\r\n    }\r\n\r\n    protected replacePageElement(page: JSX.Element, onClosePage?: ()=>void) {\r\n        this.controller.replacePage(page, onClosePage);\r\n    }\r\n\r\n    protected backPage() {\r\n        this.controller.backPage();\r\n    }\r\n\r\n    protected closePage(level?:number) {\r\n        this.controller.closePage(level);\r\n    }\r\n\r\n    protected ceasePage(level?:number) {\r\n        this.controller.ceasePage(level);\r\n    }\r\n\r\n    protected removeCeased() {\r\n        this.controller.removeCeased();\r\n    }\r\n\r\n    protected regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        this.controller.regConfirmClose(confirmClose);\r\n\t}\r\n\r\n\tprotected popToTopPage() {\r\n\t\tthis.controller.popToTopPage();\r\n\t}\r\n}\r\n","import { Page, Scroller, TabsProps } from \"../components\";\r\nimport { View } from \"./View\";\r\nimport { Controller } from \"./Controller\";\r\n\r\nexport abstract class VPage<C extends Controller> extends View<C> {\r\n\tprotected retOnClosePage: any;\r\n\r\n    open(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.openPageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n    replaceOpen(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.replacePageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n\trender(param?:any):JSX.Element {\r\n\t\tthis.init(param);\r\n\t\treturn this.renderPage();\r\n\t}\r\n\r\n\tinit(param?:any):void {return;}\r\n\r\n\theader():string|boolean|JSX.Element {return null;}\r\n\tright():JSX.Element {return null;}\r\n\tcontent():JSX.Element {return null;}\r\n\tfooter():JSX.Element {return null;}\r\n\tlogout(): boolean | (()=>Promise<void>) {return false;}\r\n\tprotected renderPage():JSX.Element {\r\n\t\tlet header = this.header();\r\n\t\tif (!header) header = false;\r\n\t\tlet logout = this.logout();\r\n\t\treturn <Page\r\n\t\t\theader={header} right={this.right()} footer={this.footer()}\r\n\t\t\tonScroll={(e:any)=>this.onPageScroll(e)}\r\n\t\t\tonScrollTop={(scroller: Scroller) => this.onPageScrollTop(scroller)}\r\n\t\t\tonScrollBottom={(scroller: Scroller) => this.onPageScrollBottom(scroller)}\r\n\t\t\tback={this.back}\r\n\t\t\theaderClassName={this.headerClassName}\r\n\t\t\tclassName={this.className}\r\n\t\t\tafterBack={()=>this.afterBack()}\r\n\t\t\ttabsProps={this.tabsProps}\r\n\t\t\tlogout={logout}\r\n\t\t\twebNav={this.controller.pageWebNav}\r\n\t\t>\r\n\t\t\t{this.content()}\r\n\t\t</Page>;\r\n\t}\r\n\r\n\tprotected onPageScroll(e:any) {}\r\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {return false;}\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<void> {return;}\r\n\tprotected afterBack():void {}\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'back'}\r\n\tprotected get headerClassName(): string {return null;}\r\n\tprotected get className(): string {return null;}\r\n\tprotected get tabsProps(): TabsProps {return null;}\r\n}\r\n","import React from 'react';\r\nimport { FA, Page } from '../../components';\r\nimport { Controller } from \"../Controller\";\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { tonva } from 'tonva-core';\r\n\r\nexport interface CStringEditProps {\r\n\tlabel?: string;\r\n\tplaceholder?: string;\r\n\tmaxLength?: number;\r\n\tonValueChange?: (value: string) => Promise<void>;\r\n}\r\n\r\nexport class CStringEdit extends Controller {\r\n\tprivate props: CStringEditProps = {\r\n\t\tlabel: '编辑'\r\n\t}\r\n\tvalue: string = null;\r\n\tnewValue: string = null;\r\n\tisChanged: boolean = null;\r\n\terror: string = null;\r\n\r\n\tconstructor() {\r\n\t\tsuper(tonva);\r\n\t\tmakeObservable(this, {\r\n\t\t\tvalue: observable,\r\n\t\t\tnewValue: observable,\r\n\t\t\tisChanged: observable,\r\n\t\t\terror: observable,\r\n\t\t});\r\n\t}\r\n\r\n\tprotected async internalStart() {}\r\n\trender(value:string, props?:CStringEditProps) {\r\n\t\tthis.value = value;\r\n\t\tif (props) Object.assign(this.props, props);\r\n\t\treturn React.createElement(observer(()=><>{this.renderValue()}{this.renderPencil()}</>))\r\n\t}\r\n\r\n\tprotected renderValue() {return <>{this.value}</>}\r\n\tprotected renderPencil() {\r\n\t\treturn <span onClick={this.onEdit} className=\"cursor-pointer\">\r\n\t\t\t&nbsp; <FA className=\"text-info\" name=\"pencil-square-o\" /> &nbsp;\r\n\t\t</span>;\r\n\t}\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.verifyValue();\r\n\t}\r\n\t\r\n\tprotected verifyValue() {}\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n\t}\r\n\t\r\n\tprivate onEdit = () => {\r\n\t\tlet {label, maxLength, placeholder, onValueChange} = this.props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (this.error === undefined) {\r\n\t\t\t\tthis.value = this.newValue;\r\n\t\t\t\tthis.closePage();\r\n\t\t\t\tif (onValueChange) onValueChange(this.value);\r\n\t\t\t}\r\n\t\t}\r\n        let right = React.createElement(observer(() => <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>));\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\t\tif (evt.keyCode === 13) onSave();\r\n\t\t}\r\n\t\tthis.openPage(<Page header={label} right={right}>\r\n            <div className=\"m-3\">\r\n\t\t\t\t<input type=\"text\"\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n\t\t\t\t\tclassName=\"form-control\"\r\n\t\t\t\t\tdefaultValue={this.value}\r\n\t\t\t\t\tmaxLength={maxLength} />\r\n                {\r\n\t\t\t\t\tReact.createElement(observer(()=> placeholder && <div className=\"small muted m-2\">{placeholder}</div>))                    \r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n\t\t</Page>);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { renderPageHeader} from './pageHeader';\r\nimport { TabsProps, TabsView } from './tabs';\r\nimport { ScrollProps, ScrollView, WebNavScrollView } from './scrollView';\r\nimport { PageHeaderProps, PageWebNav, tonva } from 'tonva-core';\r\n//import { nav } from '../../nav';\r\n\r\nexport interface IVPage {\r\n\tcontent():JSX.Element;\r\n\theader():JSX.Element|string;\r\n\tfooter():JSX.Element;\r\n}\r\n\r\nexport interface PageProps extends ScrollProps {\r\n    back?: 'close' | 'back' | 'none';\r\n    header?: boolean | string | JSX.Element;\r\n    right?: JSX.Element;\r\n    footer?: JSX.Element;\r\n    logout?: boolean | (()=>Promise<void>);\r\n\theaderClassName?: string;\r\n\tclassName?: string;\r\n\tafterBack?: () => void;\r\n\ttabsProps?: TabsProps;\r\n\twebNav?: PageWebNav<JSX.Element>;\r\n}\r\n\r\n@observer\r\nexport class Page extends React.Component<PageProps> {\r\n\tprivate tabsView: TabsView;\r\n    constructor(props: PageProps) {\r\n\t\tsuper(props);\r\n\t\tlet {tabsProps} = props;\r\n\t\tif (tabsProps) {\r\n\t\t\tthis.tabsView = new TabsView(tabsProps);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate renderHeader(webNav?: PageWebNav) {\r\n\t\tconst {back, header, right, headerClassName, afterBack, logout} = this.props;\r\n\t\tif (header === false) return;\r\n\t\t//const {webNav} = this.props;\r\n\t\tlet inWebNav = false;\r\n\t\tlet pageHeaderProps:PageHeaderProps<JSX.Element> = {\r\n\t\t\tback,\r\n\t\t\tcenter: header as any,\r\n\t\t\tright,\r\n\t\t\tlogout,\r\n\t\t\tclassName: headerClassName,\r\n\t\t\tafterBack,\r\n\t\t};\r\n\t\tif (webNav !== undefined) {\r\n\t\t\tinWebNav = true;\r\n\t\t\tlet {renderPageHeader: rph} = webNav;\r\n\t\t\tif (rph) return rph(pageHeaderProps);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tinWebNav = false;\r\n\t\t}\r\n\t\treturn renderPageHeader(pageHeaderProps, inWebNav);\r\n\t\t/*\r\n\t\tlet pageHeader = header !== false && <PageHeader \r\n\t\t\tback={back} \r\n\t\t\tcenter={header as any}\r\n\t\t\tright={right}\r\n\t\t\tlogout={this.props.logout}\r\n\t\t\tclassName={headerClassName}\r\n\t\t\tafterBack={afterBack}\r\n\t\t\t/>;\r\n\t\treturn pageHeader;\r\n\t\t*/\r\n\t}\r\n\r\n\tprivate renderFooter(webNav?: PageWebNav) {\r\n\t\tconst {footer} = this.props;\r\n\t\tif (!footer) return;\r\n\t\tlet elFooter = <footer>{footer}</footer>;\r\n\t\tif (webNav) return elFooter;\r\n\t\treturn <>\r\n\t\t\t<section className=\"tv-page-footer\">{elFooter}</section>\r\n\t\t\t{elFooter}\r\n\t\t</>;\r\n\t}\r\n\r\n\tcomponentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\r\n\t\t// You can also log the error to an error reporting service\r\n\t\t//logErrorToMyService(error, errorInfo);\r\n\t\tdebugger;\r\n\t}\r\n\t\r\n    render() {\r\n\t\tif (this.tabsView) {\r\n\t\t\treturn React.createElement(this.tabsView.content);\r\n\t\t}\r\n\t\tconst {onScroll, onScrollTop, onScrollBottom, children, className, webNav} = this.props;\r\n\t\tlet pageWebNav:PageWebNav;\r\n\t\tif (!webNav) {\r\n\t\t\tpageWebNav = tonva.nav.pageWebNav;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tpageWebNav = webNav;\r\n\t\t}\r\n\t\tlet content = <>\r\n\t\t\t{this.renderHeader(pageWebNav)}\r\n\t\t\t<main>{children}</main>\r\n\t\t\t{this.renderFooter(pageWebNav)}\r\n\t\t</>;\r\n\t\tif (pageWebNav) {\r\n\t\t\treturn <WebNavScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t\twebNav={pageWebNav}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</WebNavScrollView>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn <ScrollView\r\n\t\t\t\tonScroll={onScroll}\r\n\t\t\t\tonScrollTop={onScrollTop}\r\n\t\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\t\tclassName={className}\r\n\t\t\t>\r\n\t\t\t\t{content}\r\n\t\t\t</ScrollView>;\r\n\t\t}\r\n\t}\r\n}\r\n","import { from62 } from './62';\r\nimport { LocalMap } from './localDb';\r\n\r\nexport const env = (function () {\r\n\tlet {unit, testing, buildingUq, params, lang, district, timeZone, isMobile} = initEnv();\r\n    return {\r\n\t\tunit,\r\n\t\ttesting,\r\n\t\tbuildingUq, \r\n\t\tparams,\r\n\t\tlang, \r\n\t\tdistrict,\r\n\t\ttimeZone,\r\n\t\tbrowser: detectBrowser(), \r\n        isDevelopment: process.env.NODE_ENV === 'development',\r\n\t\tisMobile,\r\n        localDb: new LocalMap(testing===true? '$$':'$'),\r\n        setTimeout: (tag:string, callback: (...args: any[]) => void, ms: number, ...args: any[]):NodeJS.Timer => {\r\n            return global.setTimeout(callback, ms, ...args);\r\n        },\r\n        clearTimeout: (handle:NodeJS.Timer):void => {\r\n            global.clearTimeout(handle);\r\n        },\r\n        setInterval: (callback: (...args: any[]) => void, ms: number, ...args: any[]): NodeJS.Timer => {\r\n            return global.setInterval(callback, ms, ...args);\r\n        },\r\n        clearInterval: (handle:NodeJS.Timer):void => {\r\n            global.clearInterval(handle);\r\n        }\r\n    }\r\n}());\r\n\r\nfunction initEnv(): {\r\n\tunit: number; \r\n\ttesting: boolean; \r\n\tbuildingUq: boolean;\r\n\tparams: {[key:string]: string}; \r\n\tlang: string; \r\n\tdistrict: string;\r\n\ttimeZone: number;\r\n\tisMobile: boolean;\r\n}\r\n{\r\n\tlet pl     = /\\+/g,  // Regex for replacing addition symbol with a space\r\n        search = /([^&=]+)=?([^&]*)/g,\r\n        decode = function (s:any) { return decodeURIComponent(s.replace(pl, \" \")); },\r\n        query  = window.location.search.substring(1);\r\n    let params:{[key:string]:string} = {};\r\n    for (;;) {\r\n\t   let match = search.exec(query);\r\n\t   if (!match) break;\r\n       params[decode(match[1])] = decode(match[2]);\t\r\n\t}\r\n\r\n\tlet testing:boolean; // = isTesting();\r\n\tlet unit:number;\r\n\r\n\tlet sUnit = params['u'] || params['unit'];\r\n\tif (sUnit) {\r\n\t\tlet p = sUnit.indexOf('-');\t\t\r\n\t\tif (p>=0) {\r\n\t\t\tlet tc = sUnit.charCodeAt(p+1);\r\n\t\t\tconst tt = 'tT';\r\n\t\t\ttesting = tc === tt.charCodeAt(0) || tc === tt.charCodeAt(1);\r\n\t\t\tsUnit = sUnit.substr(0, p);\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttesting = false;\r\n\t\t}\r\n\t\tif (sUnit[0] === '0') {\r\n\t\t\tunit = Number(sUnit);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tunit = from62(sUnit);\r\n\t\t}\r\n\t\tif (isNaN(unit) === true) unit = undefined;\r\n\t}\r\n\telse {\r\n\t\t// 下面都是为了兼容以前的操作。\r\n\t\t// 整个url上，只要有test作为独立的字符串出现，就是testing\r\n\t\ttesting = /(\\btest\\b)/i.test(document.location.href);\r\n\t\tlet unitName:string;\r\n\t\tlet el = document.getElementById('unit');\r\n\t\tif (el) {\r\n\t\t\tunitName = el.innerText;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tel = document.getElementById('unit.json');\r\n\t\t\tif (el) {\r\n\t\t\t\tlet json = el.innerHTML;\r\n\t\t\t\tif (json) {\r\n\t\t\t\t\tlet res = JSON.parse(json);\r\n\t\t\t\t\tunitName = res?.unit;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!unitName) {\r\n\t\t\tunitName = process.env.REACT_APP_UNIT;\r\n\t\t}\r\n\r\n\t\tif (unitName) {\r\n\t\t\tunit = Number.parseInt(unitName);\r\n\t\t\tif (Number.isInteger(unit) === false) {\r\n\t\t\t\tif (unitName === '百灵威') {\r\n\t\t\t\t\tunit = 24;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!unit) unit = 0;\r\n\t}\r\n    let lang: string, district: string;\r\n    let language = (navigator.languages && navigator.languages[0])  // Chrome / Firefox\r\n        || navigator.language; // ||   // All browsers\r\n    //navigator.userLanguage; // IE <= 10\r\n    if (!language) {\r\n        lang = 'zh';\r\n        district = 'CN';\r\n    }\r\n    else {\r\n        let parts = language.split('-');\r\n        lang = parts[0];\r\n        if (parts.length > 1) district = parts[1].toUpperCase();\r\n    }\r\n\tlet timeZone = -new Date().getTimezoneOffset() / 60;\r\n\tconst regEx = new RegExp('Android|webOS|iPhone|iPad|' +\r\n    'BlackBerry|Windows Phone|'  +\r\n    'Opera Mini|IEMobile|Mobile' , \r\n    'i');\r\n\tconst isMobile = regEx.test(navigator.userAgent);\r\n\treturn {unit, testing, buildingUq:false, params, lang, district, timeZone, isMobile};\r\n}\r\n\r\nfunction detectBrowser() { \r\n    if((navigator.userAgent.indexOf(\"Opera\") || navigator.userAgent.indexOf('OPR')) >= 0 )\r\n        return 'Opera';\r\n\tif(navigator.userAgent.indexOf(\"Chrome\") >= 0 )\r\n        return 'Chrome';\r\n\tif(navigator.userAgent.indexOf(\"Safari\") >= 0)\r\n        return 'Safari';\r\n\tif(navigator.userAgent.indexOf(\"Firefox\") >= 0 )\r\n        return 'Firefox';\r\n\tif((navigator.userAgent.indexOf(\"MSIE\") >= 0 ) || (!!(document as any).documentMode === true ))\r\n        return 'IE'; //crap\r\n    return 'Unknown';\r\n}\r\n","import { env, resOptions, PageHeaderProps, PageWebNav, Tonva, Nav } from 'tonva-core';\r\nimport { t } from '../ui';\r\nimport { Page } from '../components';\r\n//import { nav } from '../nav';\r\nimport { VPage } from './VPage';\r\nimport { View } from './View';\r\nimport { AnnotationsMap, makeObservable, observable, runInAction } from 'mobx';\r\n// import { messageHub } from 'tonva-core';\r\n\r\nexport interface ConfirmOptions {\r\n    caption?: string;\r\n    message: string | JSX.Element;\r\n    classNames?: string;\r\n    ok?: string;\r\n    yes?: string;\r\n    no?: string;\r\n}\r\n\r\nexport interface WebNav<C extends Controller> {\r\n\tVNavHeader?: new (controller: C) => View<C>;\r\n\tVNavRawHeader?: new (controller: C) => View<C>;\r\n\tVNavFooter?: new (controller: C) => View<C>;\r\n\tVNavRawFooter?: new (controller: C) => View<C>;\r\n\trenderPageHeader?: (props: PageHeaderProps<JSX.Element>) => JSX.Element;\r\n}\r\n\r\nexport abstract class Controller {\r\n    protected readonly tonva: Tonva;\r\n    protected nav: Nav;\r\n\tprotected res: any = {};\r\n\tt = (str: string): string|JSX.Element => this.internalT(str) || str;\r\n    icon: string|JSX.Element;\r\n    label:string|JSX.Element;\r\n\treadonly isDev:boolean = env.isDevelopment;\r\n\tpageWebNav: PageWebNav<JSX.Element>;\r\n\r\n    constructor(tonva: Tonva) {\r\n        this.tonva = tonva;\r\n        this.nav = tonva.nav;\r\n    }\r\n\r\n    shallow<T extends object>(data: T) {\r\n        let ret = makeObservable(data, this.buildReactiveProps(data, observable.shallow));\r\n        return ret;\r\n    }\r\n\r\n    deep<T extends object>(data: T) {\r\n        let ret = makeObservable(data, this.buildReactiveProps(data, observable));\r\n        return ret;\r\n    }\r\n\r\n    private buildReactiveProps<T extends object>(data: T, ob: any): AnnotationsMap<T, never> {\r\n        let ret: AnnotationsMap<T, never> = {};\r\n        for (let i in data) {\r\n            let v = data[i];\r\n            switch (typeof v) {\r\n                default:\r\n                    ob = observable;\r\n                    break;\r\n                case 'object':\r\n                case 'function':\r\n                    break;\r\n            }\r\n            (ret as any)[i] = ob;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    runInAction<T>(fn: () => T): T {\r\n        return runInAction(fn);\r\n    }\r\n\r\n    getTonva() {return this.tonva;}\r\n\r\n\tprotected beforeInit() {}\r\n\tprotected afterInit() {}\r\n\r\n    internalInit(...param: any[]) {\r\n\t\tthis.beforeInit();\r\n        this.init(...param);\r\n\t\tthis.pageWebNav = this.getPageWebNav();\r\n\t\tthis.afterInit();\r\n    }\r\n\r\n\tinit(...param: any[]) {\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\treturn this.res?.[str] ?? t(str);\r\n\t}\r\n\r\n    getPageWebNav(): PageWebNav {return undefined;}\r\n\r\n\tsetRes(res: any) {\r\n\t\tif (res === undefined) return;\r\n\t\tlet {$lang, $district} = resOptions;\r\n\t\tObject.assign(this.res, res);\r\n\t\tif ($lang !== undefined) {\r\n\t\t\tlet l = res[$lang];\r\n\t\t\tif (l !== undefined) {\r\n\t\t\t\tObject.assign(this.res, l);\r\n\t\t\t\tlet d = l[$district];\r\n\t\t\t\tif (d !== undefined) {\r\n\t\t\t\t\tObject.assign(this.res, d);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t}\r\n\tgetRes():any {return this.res;}\r\n\r\n    protected async openVPage<C extends Controller, P extends VPage<C>>(vp: new (controller: C)=>P, param?:any, afterBack?:(ret:any)=>void):Promise<P> {\r\n\t\tlet ret = new vp((this as any) as C);\r\n\t\tawait ret.open(param, afterBack);\r\n\t\treturn ret;\r\n    }\r\n\r\n    protected async replaceVPage<C extends Controller, P extends VPage<C>>(vp: new (controller: C)=>P, param?:any, afterBack?:(ret:any)=>void):Promise<P> {\r\n\t\tlet ret = new vp((this as any) as C);\r\n\t\tawait ret.replaceOpen(param, afterBack);\r\n\t\treturn ret;\r\n    }\r\n\r\n    protected renderView<C extends Controller, V extends View<C>>(view: new (controller: C)=>V, param?:any):JSX.Element {\r\n\t\tlet v = new view((this as any) as C);\r\n\t\treturn v.render(param);\r\n    }\r\n\r\n    async event(type:string, value:any) {\r\n        await this.onEvent(type, value);\r\n    }\r\n\r\n    protected async onEvent(type:string, value:any) {\r\n    }\r\n\r\n    protected msg(text:string) {\r\n        alert(text);\r\n    }\r\n    protected errorPage(header:string, err:any) {\r\n        this.openPage(<Page header=\"App error!\">\r\n            <pre>\r\n                {typeof err === 'string'? err : err.message}\r\n            </pre>\r\n        </Page>);\r\n    }\r\n\r\n    openPage(page:JSX.Element, onClosePage?: (ret:any)=>void) {\r\n\t\tlet disposer: ()=>void;\r\n\t\tif (onClosePage !== undefined) {\r\n\t\t\tdisposer = () => {\r\n\t\t\t\t//if (this.disposer) this.disposer();\r\n\t\t\t\tonClosePage(undefined);\r\n\t\t\t}\r\n\t\t}\r\n\r\n        this.nav.push(page, disposer);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    replacePage(page:JSX.Element, onClosePage?: ()=>void) {\r\n        this.nav.replace(page, onClosePage);\r\n        //this.disposer = undefined;\r\n    }\r\n\r\n    backPage() {\r\n        this.nav.back(false);\r\n    }\r\n\r\n    closePage(level?:number) {\r\n        this.nav.pop(level);\r\n    }\r\n\r\n    ceasePage(level?:number) {\r\n        this.nav.ceaseTop(level);\r\n\t}\r\n\t\r\n\tgo(showPage:()=>void, url:string, absolute?:boolean) {\r\n\t\tthis.go(showPage, url, absolute);\r\n\t}\r\n\r\n    removeCeased() {\r\n        this.nav.removeCeased();\r\n    }\r\n\r\n    regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        this.nav.regConfirmClose(confirmClose);\r\n\t}\r\n\r\n\tprivate topPageKey:any;\r\n\tprotected startAction() {\r\n\t\tthis.topPageKey = this.nav.topKey();\r\n    }\r\n    get TopKey() {\r\n        return this.topPageKey;\r\n    }\r\n    SetTopKey(key:any) {\r\n        this.topPageKey = key;\r\n    }\r\n\tpublic popToTopPage() {\r\n\t\tthis.nav.popTo(this.topPageKey);\r\n\t}\r\n\r\n    async confirm(options: ConfirmOptions): Promise<'ok'|'yes'|'no'|undefined> {\r\n        return new Promise<'ok'|'yes'|'no'|undefined> (async (resolve, reject) => {\r\n            let {caption, message, ok, yes, no, classNames} = options;\r\n            let close = (res:'ok'|'yes'|'no'|undefined) => {\r\n                this.closePage();\r\n                resolve(res);\r\n            }\r\n            let buttons:any[] = [];\r\n            if (ok !== undefined) {\r\n                buttons.push(<button key=\"ok\" className=\"btn btn-primary me-3\" onClick={()=>close('ok')}>{ok}</button>);\r\n            }\r\n            if (yes !== undefined) {\r\n                buttons.push(<button key=\"yes\" className=\"btn btn-success me-3\" onClick={()=>close('yes')}>{yes}</button>);\r\n            }\r\n            if (no !== undefined) {\r\n                buttons.push(<button key=\"no\" className=\"btn btn-outline-danger me-3\" onClick={()=>close('no')}>{no}</button>);\r\n            }\r\n            this.openPage(<Page header={caption || '请确认'} back=\"close\">\r\n                <div className={classNames || \"rounded bg-white m-5 p-3 border\"}>\r\n                    <div className=\"d-flex align-items-center justify-content-center\">\r\n                        {message}\r\n                    </div>\r\n                    <div className=\"mt-3 d-flex align-items-center justify-content-center\">\r\n                        {buttons}\r\n                    </div>\r\n                </div>\r\n            </Page>);\r\n            this.nav.regConfirmClose(async ():Promise<boolean> => {\r\n                resolve(undefined);\r\n                return true;\r\n            });\r\n        });\r\n    }\r\n}\r\n","import React from 'react';\r\nimport { PageWebNav } from 'tonva-core';\r\n//import { PageHeaderProps } from './pageHeader';\r\n\r\nconst scrollAfter = 20; // 20ms之后，scroll执行\r\nexport class Scroller {\r\n    private el: HTMLBaseElement;\r\n    constructor(el: HTMLBaseElement) {\r\n        this.el = el;\r\n    }\r\n\r\n    scrollToTop():void {\r\n        setTimeout(() => this.el.scrollTo(0, 0), scrollAfter);\r\n    }\r\n    scrollToBottom():void {\r\n        setTimeout(() => this.el.scrollTo(0, this.el.scrollTop + this.el.offsetHeight), scrollAfter);\r\n    }\r\n}\r\n\r\nexport interface ScrollProps {\r\n    onScroll?: (e:any) => void;\r\n    onScrollTop?: (scroller: Scroller) => Promise<boolean>;\r\n\tonScrollBottom?: (scroller: Scroller) => Promise<void>;\r\n\tclassName?: string;\r\n}\r\ninterface ScrollViewProps extends ScrollProps {\r\n\tclassName?: string;\r\n\tstyle?: React.CSSProperties;\r\n}\r\nconst scrollTimeGap = 100;\r\nconst scrollEdgeGap = 30;\r\nabstract class ScrollViewBase<T extends ScrollViewProps> extends React.Component<T, null> {\r\n    private bottomTime:number = 0;\r\n\tprivate topTime:number = 0;\r\n\tprivate div: HTMLDivElement;\r\n\r\n\tprotected refDiv = (div:HTMLDivElement) => {\r\n\t\tif (!div) {\r\n\t\t\tif (this.div) {\r\n\t\t\t\tthis.div.removeEventListener('resize', this.onResize)\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.div = div;\r\n\t\tthis.div.addEventListener('resize', this.onResize);\r\n\t}\r\n\r\n\tprivate onResize = (ev:UIEvent) => {\r\n\t\tconsole.error('div resize');\r\n\t};\r\n\r\n    protected onScroll = async (e:any) => {\r\n        let {onScroll, onScrollTop, onScrollBottom} = this.props;\r\n        if (onScroll) onScroll(e);\r\n        let el = e.target as HTMLBaseElement;\r\n        let scroller = new Scroller(el);\r\n        if (el.scrollTop < scrollEdgeGap) {\r\n            if (onScrollTop !== undefined) {\r\n                let topTime = new Date().getTime();\r\n                if (topTime-this.topTime > scrollTimeGap) {\r\n                    this.topTime = topTime;\r\n\t\t\t\t\tonScrollTop(scroller).then(ret => {\r\n\t\t\t\t\t\t // has more\r\n\t\t\t\t\t\tif (ret === true) {\r\n\t\t\t\t\t\t\tlet sh = el.scrollHeight;\r\n\t\t\t\t\t\t\tlet top = 200;\r\n\t\t\t\t\t\t\tif (top > sh) top = sh;\r\n\t\t\t\t\t\t\tel.scrollTop = top;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n                }\r\n            }\r\n        }\r\n        if (el.scrollTop + el.offsetHeight > el.scrollHeight - scrollEdgeGap) {\r\n            if (onScrollBottom !== undefined) {\r\n                let bottomTime = new Date().getTime();\r\n                if (bottomTime - this.bottomTime > scrollTimeGap) {\r\n                    this.bottomTime = bottomTime;\r\n                    onScrollBottom(scroller);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    private eachChild(c:any, direct:'top'|'bottom') {\r\n        let { props } = c;\r\n        if (props === undefined)\r\n            return;\r\n        let { children } = props;\r\n        if (children === undefined)\r\n            return;\r\n        React.Children.forEach(children, (child, index) => {\r\n            let {_$scroll} = child as any;\r\n            if (_$scroll) _$scroll(direct);\r\n            console.log(child.toString());\r\n            this.eachChild(child, direct);\r\n        });\r\n\t}\r\n}\r\n\r\nexport class ScrollView extends ScrollViewBase<ScrollViewProps> {\r\n    render() {\r\n\t\tlet {className, style} = this.props;\r\n\t\treturn <div ref={this.refDiv} className=\"tv-page\"\r\n\t\t\tonScroll={this.onScroll} style={style}>\r\n\t\t\t<article className={className}>\r\n\t\t\t\t{this.props.children}\r\n\t\t\t</article>\r\n\t\t</div>;\r\n    }\r\n}\r\n\r\ninterface WebNavScrollViewProps extends ScrollViewProps {\r\n\twebNav: PageWebNav<JSX.Element>;\r\n}\r\n\r\nexport class WebNavScrollView extends ScrollViewBase<WebNavScrollViewProps> {\r\n    render() {\r\n\t\tlet {className, style, webNav} = this.props;\r\n\t\tlet {navHeader, navRawHeader, navFooter, navRawFooter} = webNav;\r\n\t\tlet vHeader:any, vFooter:any;\r\n\t\tif (navRawHeader) vHeader = navRawHeader;\r\n\t\telse if (navHeader) vHeader = <header><main>{navHeader}</main></header>\r\n\t\tif (navRawFooter) vFooter = navRawFooter;\r\n\t\telse if (navFooter) vFooter = <footer><main>{navFooter}</main></footer>\r\n\r\n\t\treturn <div ref={this.refDiv} className=\"tv-page-webnav\"\r\n\t\t\tonScroll={this.onScroll} style={style}>\r\n\t\t\t{vHeader}\r\n\t\t\t<article className={className}>\r\n\t\t\t\t{this.props.children}\r\n\t\t\t</article>\r\n\t\t\t{vFooter}\r\n\t\t</div>;\r\n    }\r\n}\r\n","class _LocalStorage {\r\n    getItem(key:string) {\r\n        return localStorage.getItem(key)\r\n    }\r\n    setItem(key:string, value:string) {\r\n        localStorage.setItem(key, value);\r\n    }\r\n    removeItem(key:string) {\r\n        localStorage.removeItem(key);\r\n    }\r\n}\r\n\r\nconst __ls = new _LocalStorage(); // new Ls;\r\n\r\nexport class LocalCache {\r\n    private readonly local: Local;\r\n    //private value: T;\r\n    readonly key: string|number;\r\n\r\n    constructor(local:Local, key:string|number) {\r\n        this.local = local;\r\n        this.key = key;\r\n    }\r\n    get():any {\r\n        try {\r\n            // 下面缓冲的内容不能有，可能会被修改，造成circular引用\r\n            //if (this.value !== undefined) return this.value;\r\n            let text = this.local.getItem(this.key);\r\n            if (text === null) return;\r\n            if (text === undefined) return undefined;\r\n            //return this.value = \r\n            return JSON.parse(text);\r\n        }\r\n        catch (err) {\r\n            this.local.removeItem(this.key);\r\n            return;\r\n        }\r\n    }\r\n    set(value:any) {\r\n\t\tlet t = JSON.stringify(value, (key, value) => {\r\n\t\t\tif (key !== '_tuid') return value;\r\n\t\t});\r\n\t\tthis.local.setItem(this.key, t);\r\n    }\r\n    remove(local?:Local) {\r\n        if (local === undefined) {\r\n            this.local.removeItem(this.key);\r\n        }\r\n        else {\r\n            this.local.removeLocal(local);\r\n        }\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        return this.local.child(key);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        return this.local.arr(key);\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        return this.local.map(key);\r\n    }\r\n}\r\n\r\nabstract class Local {\r\n    private readonly caches: {[key:string]:LocalCache};\r\n    private readonly locals: {[key:string]:Local};\r\n    protected readonly name: string;\r\n    constructor(name: string) {\r\n        this.name = name;\r\n        this.caches = {};\r\n        this.locals = {};\r\n    }\r\n\r\n    protected abstract keyForGet(key:string|number):string;\r\n    protected abstract keyForSet(key:string|number):string;\r\n    protected abstract keyForRemove(key:string|number):string;\r\n    abstract removeAll():void;\r\n    getItem(key:string|number):string {\r\n        let k = this.keyForGet(key);\r\n        if (k === undefined) return;\r\n        return __ls.getItem(k);\r\n    }\r\n    setItem(key:string|number, value: string):void {\r\n        let k = this.keyForSet(key);\r\n        __ls.setItem(k, value);\r\n    }\r\n    removeItem(key:string|number):void {\r\n        let k = this.keyForSet(key);\r\n        if (k === undefined) return;\r\n        localStorage.removeItem(k);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        let sk = String(key);\r\n        let arr = this.locals[sk] as LocalArr;\r\n        if (arr === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = arr = new LocalArr(k);\r\n        }\r\n        return arr;\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        let sk = String(key);\r\n        let map = this.locals[sk] as LocalMap;\r\n        if (map === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = map = new LocalMap(k);\r\n        }\r\n        return map;\r\n    }\r\n    removeLocal(local:Local) {\r\n        let sk = local.name;\r\n        let k = this.keyForRemove(sk);\r\n        if (k === undefined) return;\r\n        let arr = this.locals[sk];\r\n        if (arr === undefined) arr = new LocalArr(k);\r\n        else this.locals[sk] = undefined;\r\n        arr.removeAll();\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        let ks = String(key);\r\n        let ret = this.caches[ks];\r\n        if (ret !== undefined) return ret;\r\n        return this.caches[ks] =ret = new LocalCache(this, key);\r\n    }\r\n}\r\n\r\nconst maxArrSize = 500;\r\nexport class LocalArr extends Local {\r\n    private readonly index: number[];\r\n    constructor(name: string) {\r\n        super(name);\r\n        let index = __ls.getItem(this.name);\r\n        this.index = index === null? [] : index.split('\\n').map(v => Number(v));\r\n    }\r\n    private saveIndex() {\r\n        __ls.setItem(this.name, this.index.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = this.index.indexOf(key);\r\n        if (i < 0) return undefined;\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = this.index.indexOf(key);\r\n        if (i<0) {\r\n            this.index.unshift(key);\r\n            if (this.index.length > maxArrSize) this.index.pop();\r\n        }\r\n        else {\r\n            this.index.splice(i, 1);\r\n            this.index.unshift(key)\r\n        }\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForRemove(key:number):string {\r\n        let i = this.index.indexOf(key);\r\n        if (i<0) return;\r\n        this.index.splice(i, 1);\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i of this.index) {\r\n            __ls.removeItem(`${this.name}.${i}`);\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.index.splice(0);\r\n    }\r\n    item(index:number):LocalCache {\r\n        return this.child(index);\r\n    }\r\n}\r\n\r\nexport class LocalMap extends Local {\r\n    private readonly index: {[key:string]:number};\r\n    private max: number;\r\n    constructor(name: string) {\r\n        super(name);\r\n        this.max = 0;\r\n        this.index = {};\r\n        let index = __ls.getItem(this.name);\r\n        if (index !== null) {\r\n            let ls = index.split('\\n');\r\n            ls.forEach(l => {\r\n                let p = l.indexOf('\\t');\r\n                if (p<0) return;\r\n                let key = l.substr(0, p);\r\n                let i = Number(l.substr(p+1));\r\n                if (isNaN(i) === true) return;\r\n                this.index[key] = i;\r\n                if (i>this.max) this.max = i;\r\n            });\r\n        }\r\n    }\r\n    private saveIndex() {\r\n        let ls:string[] = [];\r\n        for (let k in this.index) {\r\n            let v = this.index[k];\r\n            if (v === undefined) continue;\r\n            ls.push(`${k}\\t${v}`);\r\n        }\r\n        __ls.setItem(this.name, ls.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) return undefined;\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) {\r\n            ++this.max;\r\n            i = this.max;\r\n            this.index[key] = i;\r\n            this.saveIndex();\r\n        }\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForRemove(key:string|number):string {\r\n        let i = this.index[key];\r\n        if (i===undefined) return;\r\n        this.index[key] = undefined;\r\n        this.saveIndex();\r\n        return `${this.name}.${i}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i in this.index) {\r\n            __ls.removeItem(`${this.name}.${this.index[i]}`);\r\n            this.index[i] = undefined;\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.max = 0;\r\n    }\r\n    item(key:string):LocalCache {\r\n        return this.child(key);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { env, FetchError, PageWebNav } from 'tonva-core';\r\nimport { Loading } from '../components';\r\nimport FetchErrorView from './FetchErrorView';\r\nimport { FA } from '../components';\r\n\r\nexport interface Props\r\n{\r\n    onLogined: (isUserLogin?:boolean)=>Promise<void>;\r\n    notLogined?: ()=>Promise<void>;\r\n\tuserPassword?: () => Promise<{user:string; password:string}>;\r\n};\r\nlet stackKey = 1;\r\nexport interface StackItem {\r\n    key: number;\r\n    view: JSX.Element;\r\n    ceased: boolean;\r\n    confirmClose?: ()=>Promise<boolean>;\r\n    disposer?: ()=>void;\r\n}\r\nexport interface NavViewState {\r\n\tnotSupportedBrowser: boolean;\r\n    stack: StackItem[];\r\n    wait: 0|1|2;\r\n    fetchError: FetchError;\r\n}\r\n\r\nconst notSupportedBrowsers = ['IE'];\r\n\r\nexport class NavView extends React.Component<Props, NavViewState> {\r\n    private stack: StackItem[];\r\n    private waitCount: number = 0;\r\n    private waitTimeHandler?: NodeJS.Timer;\r\n    isWebNav: boolean = false;\r\n\r\n    constructor(props:Props) {\r\n        super(props);\r\n        this.stack = [];\r\n\t\tlet {browser} = env;\r\n\t\tlet notSupportedBrowser = notSupportedBrowsers.findIndex(v => v === browser) >= 0;\r\n        this.state = {\r\n\t\t\tnotSupportedBrowser,\r\n            stack: this.stack,\r\n            wait: 0,\r\n            fetchError: undefined\r\n        };\r\n        //nav.set(this);\r\n    }\r\n    async componentDidMount()\r\n    {\r\n\t\tif (this.state.notSupportedBrowser === true) return;\r\n\t\twindow.addEventListener('popstate', this.navBack);\r\n    }\r\n\r\n    get level(): number {\r\n        return this.stack.length;\r\n    }\r\n\r\n    startWait() {\r\n        if (this.waitCount === 0) {\r\n            this.setState({wait: 1});\r\n            this.waitTimeHandler = env.setTimeout(\r\n                'NavView.startWait',\r\n                () => {\r\n                    this.waitTimeHandler = undefined;\r\n                    this.setState({wait: 2});\r\n                },\r\n                1000) as NodeJS.Timer;\r\n        }\r\n        ++this.waitCount;\r\n        this.setState({\r\n            fetchError: undefined,\r\n        });\r\n    }\r\n\r\n    endWait() {\r\n        env.setTimeout(\r\n            undefined, //'NavView.endWait',\r\n            () => {\r\n            /*\r\n            this.setState({\r\n                fetchError: undefined,\r\n            });*/\r\n            --this.waitCount;\r\n            if (this.waitCount === 0) {\r\n                if (this.waitTimeHandler !== undefined) {\r\n                    env.clearTimeout(this.waitTimeHandler);\r\n                    this.waitTimeHandler = undefined;\r\n                }\r\n                this.setState({wait: 0});\r\n            }\r\n        },100);\r\n    }\r\n\r\n    show(view: JSX.Element, disposer?: ()=>void): number {\r\n        this.clear();\r\n        return this.push(view, disposer);\r\n    }\r\n\r\n    push(view: JSX.Element, disposer?: ()=>void): number {\r\n        this.removeCeased();\r\n        if (this.stack.length > 0) {\r\n            window.history.pushState('forward', null, null);\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key,\r\n            view: view, \r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        this.refresh();\r\n        //console.log('push: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    replace(view: JSX.Element, disposer?: ()=>void): number {\r\n        let item:StackItem = undefined;\r\n        let stack = this.stack;\r\n        if (stack.length > 0) {\r\n            item = stack.pop();\r\n            //this.popAndDispose();\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key, \r\n            view: view, \r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        if (item !== undefined) this.dispose(item.disposer);\r\n        this.refresh();\r\n        //console.log('replace: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    ceaseTop(level:number = 1) {\r\n        let p = this.stack.length - 1;\r\n        for (let i=0; i<level; i++, p--) {\r\n            if (p < 0) break;\r\n            let item = this.stack[p];\r\n            item.ceased = true;\r\n        }\r\n    }\r\n\r\n    pop(level:number = 1) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        //console.log('pop start: %s pages level=%s', len, level);\r\n        if (level <= 0 || len <= 1) return;\r\n        if (len < level) level = len;\r\n        let backLevel = 0;\r\n        for (let i = 0; i < level; i++) {\r\n            if (stack.length === 0) break;\r\n            //stack.pop();\r\n            this.popAndDispose();\r\n            ++backLevel;\r\n        }\r\n        if (backLevel >= len) backLevel--;\r\n        this.refresh();\r\n        if (this.isHistoryBack !== true) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(backLevel);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n        //console.log('pop: %s pages', stack.length);\r\n    }\r\n\r\n    popTo(key: number) {\r\n        if (key === undefined) return;\r\n        if (this.stack.find(v => v.key === key) === undefined) return;\r\n        while (this.stack.length >0) {\r\n            let len = this.stack.length;\r\n            let top = this.stack[len-1];\r\n            if (top.key === key) break;\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    topKey():number {\r\n        let len = this.stack.length;\r\n        if (len === 0) return undefined;\r\n        return this.stack[len-1].key;\r\n    }\r\n\r\n    removeCeased() {\r\n        for (;;) {\r\n            let p=this.stack.length-1;\r\n            if (p < 0) break;\r\n            let top = this.stack[p];\r\n            if (top.ceased === false) break;\r\n            let item = this.stack.pop();\r\n            let {disposer} = item;\r\n            this.dispose(disposer);\r\n        }\r\n        this.refresh();\r\n    }\r\n\r\n    private popAndDispose() {\r\n        this.removeCeased();\r\n        let item = this.stack.pop();\r\n\t\tif (item === undefined) return;\r\n\t\t//if (nav.isRouting) {\r\n\t\t//\twindow.history.back();\r\n\t\t//}\r\n        let {disposer} = item;\r\n        this.dispose(disposer);\r\n        this.removeCeased();\r\n        return item;\r\n    }\r\n\r\n    private dispose(disposer:()=>void) {\r\n        if (disposer === undefined) return;\r\n        let item = this.stack.find(v => v.disposer === disposer);\r\n        if (item === undefined) disposer();\r\n    }\r\n\r\n    clear() {\r\n        let len = this.stack.length;\r\n        while (this.stack.length > 0) this.popAndDispose();\r\n        //this.refresh();\r\n        if (len > 1) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(len-1);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n    }\r\n\r\n    regConfirmClose(confirmClose:()=>Promise<boolean>) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        let top = stack[len-1];\r\n        top.confirmClose = confirmClose;\r\n    }\r\n\r\n    private isHistoryBack:boolean = false;\r\n    navBack = () => {\r\n        //nav.log('backbutton pressed - nav level: ' + this.stack.length);\r\n        let tick = Date.now();\r\n        this.isHistoryBack = true;\r\n        this.back(true);\r\n        this.isHistoryBack = false;\r\n        console.log(`///\\\\\\\\ ${Date.now()-tick}ms backbutton pressed - nav level: ${this.stack.length}`);\r\n    }\r\n\r\n    back = async (confirm:boolean = true) => {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        if (len === 1) {\r\n            if (window.self !== window.top) {\r\n                window.top.postMessage({type:'pop-app'}, '*');\r\n            }\r\n            return;\r\n        }\r\n        let top = stack[len-1];\r\n        if (confirm===true && top.confirmClose) {\r\n            if (await top.confirmClose()===true) this.pop();\r\n        }\r\n        else {\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    confirmBox(message?:string): boolean {\r\n        return window.confirm(message);\r\n    }\r\n    clearError = () => {\r\n        this.setState({fetchError: undefined});\r\n    }\r\n    render() {\r\n        const {notSupportedBrowser, wait, fetchError} = this.state;\r\n\t\tif (notSupportedBrowser === true) {\r\n\t\t\treturn <div className=\"p-3 text-danger\">\r\n\t\t\t\t{env.browser} not supported !\r\n\t\t\t</div>;\r\n\t\t}\r\n        let {stack} = this.state;\r\n        let top = stack.length - 1;\r\n        let elWait = null, elError = null;\r\n        switch (wait) {\r\n            case 1:\r\n                elWait = <div className=\"va-wait va-wait1\">\r\n                </div>;\r\n                break;\r\n            case 2:\r\n                elWait = <div className=\"va-wait va-wait2\">\r\n                    <Loading />\r\n                </div>;\r\n                break;\r\n        }\r\n        if (fetchError) {\r\n            elError = <FetchErrorView clearError={this.clearError} {...fetchError} />;\r\n\t\t\t++top;\r\n\t\t}\r\n        let test = env.testing===true && \r\n\t\t\t<span className=\"cursor-pointer position-fixed\" style={{top:0,left:'0.2rem',zIndex:90001}}>\r\n                <FA className=\"text-warning\" name=\"info-circle\" />\r\n\t\t\t</span>;\r\n        return <>\r\n\t\t\t{stack.map((item, index) => {\r\n\t\t\t\tlet {key, view} = item;\r\n\t\t\t\treturn <div key={key} style={index<top? {visibility: 'hidden', position: 'absolute'}:undefined}>\r\n\t\t\t\t\t{view}\r\n\t\t\t\t</div>\r\n\t\t\t})}\r\n\t\t\t{elWait}\r\n\t\t\t{elError}\r\n\t\t\t{test}\r\n\t\t</>;\r\n    }\r\n\r\n    private refresh() {\r\n        this.setState({stack: this.stack });\r\n    }\r\n\r\n    backIcon = <i className=\"fa fa-angle-left\" />;\r\n\tcloseIcon = <i className=\"fa fa-close\" />;\r\n\r\n    setIsWebNav(): void {\r\n\t\tthis.isWebNav = true;\r\n\t\tthis.backIcon = <i className=\"fa fa-arrow-left\" />;\r\n\t\tthis.closeIcon = <i className=\"fa fa-close\" />;\r\n    }\r\n\r\n    pageWebNav: PageWebNav<JSX.Element>;\r\n\r\n    renderNavView(onLogined:any, onNotLogined?:any): JSX.Element {\r\n        throw new Error('renderNavView');\r\n    }\r\n}\r\n","import { resGlobal } from 'tonva-core';\r\n\r\nexport function t(str:string):string|JSX.Element {\r\n\treturn resGlobal[str] || str;\r\n}\r\nexport type TFunc = (str:string|JSX.Element) => string|JSX.Element;\r\n","import { Tonva, User } from 'tonva-core';\r\n\r\nexport interface Login {\r\n\tshowLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean):void;\r\n\tshowLogout(callback?: ()=>Promise<void>):void\r\n\t//showRegister():void\r\n\t//showForget():void\r\n\tshowChangePassword():void;\r\n\tshowUserQuit():void;\r\n}\r\n\r\nexport async function createLogin(tonva: Tonva):Promise<Login> {\r\n\tlet importCLogin = await import('../auth/CLogin');\r\n\treturn new importCLogin.CLogin(tonva);\r\n}\r\n\r\nexport async function showRegister(tonva: Tonva):Promise<void> {\r\n\tlet importCRegister = await import('../auth/register/CRegister');\r\n\tlet c = new importCRegister.CRegister(tonva);\r\n\tc.start();\r\n}\r\n\r\nexport async function showForget(tonva: Tonva):Promise<void> {\r\n\tlet importCRegister = await import('../auth/register/CRegister');\r\n\tlet c = new importCRegister.CForget(tonva);\r\n\tc.start();\r\n}\r\n","const digits = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\r\nconst c0 = digits.charCodeAt(0);\r\nconst c9 = digits.charCodeAt(9);\r\nconst A = digits.charCodeAt(10);\r\nconst Z = digits.charCodeAt(35);\r\nconst a = digits.charCodeAt(36);\r\nconst z = digits.charCodeAt(61);\r\nexport function from62(v:string):number {\r\n\tif (v === null) return null;\r\n\tif (v === undefined) return undefined;\r\n\tif (typeof v !== 'string') return Number.NaN;\r\n\tlet len = v.length;\r\n\tif (len === 0) return Number.NaN;\r\n\tlet ret = 0;\r\n\tfor (let i=0; i<len; i++) {\r\n\t\tlet c = v.charCodeAt(i);\r\n\t\tlet n:number;\r\n\t\tif (c < c0) return Number.NaN;\r\n\t\tif (c <= c9) {\r\n\t\t\tn = c - c0;\r\n\t\t}\r\n\t\telse if (c < A) {\r\n\t\t\treturn Number.NaN;\r\n\t\t} \r\n\t\telse if (c <= Z) {\r\n\t\t\tn = c - A + 10;\r\n\t\t}\r\n\t\telse if (c < a) {\r\n\t\t\treturn Number.NaN;\r\n\t\t}\r\n\t\telse if (c <= z) {\r\n\t\t\tn = c - a + 36;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn Number.NaN;\r\n\t\t}\r\n\t\tret *= 62;\r\n\t\tret += n;\r\n\t}\r\n\treturn ret;\r\n}\r\n\r\nexport function to62(v:number):string {\r\n\tif (v === null) return null;\r\n\tif (v === undefined) return undefined;\r\n\tif (typeof v !== 'number') return '';\r\n\tif (v < 0) return '';\r\n\tlet ret = '';\r\n\tfor (;;) {\r\n\t\tret = digits[v % 62] + ret;\r\n\t\tv = Math.floor(v / 62);\r\n\t\tif (v === 0) break;\r\n\t}\r\n\treturn ret;\r\n}\r\n","import * as React from 'react';\r\nimport { PageHeaderProps, tonva } from 'tonva-core';\r\n//import {nav} from '../../nav';\r\n\r\nexport function renderPageHeader(props: PageHeaderProps<JSX.Element>, inWebNav?: boolean) {\r\n    let onBack = async () => {\r\n        await tonva.nav.back(false); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet {afterBack} = props;\r\n\t\tif (afterBack) afterBack();\r\n    }\r\n    let onLogoutClick = () => {\r\n\t\tlet logout = async () => {\r\n\t\t\tlet {logout} = props;\r\n\t\t\tif (typeof logout === 'function') {\r\n\t\t\t\tawait logout(); \r\n\t\t\t}\r\n\t\t\tawait tonva.logout(undefined);\r\n\t\t}\r\n\t\ttonva.showLogout(logout);\r\n    }\r\n\r\n\tlet b = tonva.nav.level > 1 || window.self !== window.top;\r\n\tlet {back, right, center, logout, className, ex} = props;\r\n\tif (inWebNav === true &&  !back && !right && !center) return;\r\n\tlet vBack:any, debugLogout:any;\r\n\tif (logout !== undefined && window.self === window.top) {\r\n\t\tif ((typeof logout === 'boolean' && logout === true)\r\n\t\t\t|| typeof logout === 'function')\r\n\t\t{\r\n\t\t\tlet {user} = tonva;\r\n\t\t\tif (user !== undefined) {\r\n\t\t\t\tlet {nick, name} = user;\r\n\t\t\t\tdebugLogout = <div className=\"d-flex align-items-center\">\r\n\t\t\t\t\t<small className=\"text-light\">{nick || name}</small>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t// eslint-disable-next-line\r\n\t\t\t\t\t\t<div className=\"ms-2 py-2 px-3 cursor-pointer\"\r\n\t\t\t\t\t\t\trole=\"button\"\r\n\t\t\t\t\t\t\tonClick={onLogoutClick}>\r\n\t\t\t\t\t\t\t<i className=\"fa fa-sign-out fa-lg\" />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tif (b) {\r\n\t\tswitch (props.back) {\r\n\t\t\tcase 'none':\r\n\t\t\t\tvBack = undefined;\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\tcase 'back':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{tonva.nav.backIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'close':\r\n\t\t\t\tvBack = <nav onClick={onBack}>{tonva.nav.closeIcon}</nav>;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (window.self !== window.top) {\r\n\t\tconsole.log(document.location.href);\r\n\t\t// pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n\t}\r\n\tif (vBack === undefined && typeof center === 'string') {\r\n\t\tcenter = <div className=\"px-3\">{center}</div>;\r\n\t}\r\n\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\tlet header = <header className={className}>\r\n\t\t<nav>\r\n\t\t\t{vBack}\r\n\t\t\t{/*pop 弹出window暂时停止作用 */}\r\n\t\t\t<div>{center}</div>\r\n\t\t\t{rightView}\r\n\t\t</nav>\r\n\t\t{ex}\r\n\t</header>;\r\n\tif (inWebNav === true) return header;\r\n\treturn <>\r\n\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t{header}\r\n\t</>;\r\n}\r\n\r\nexport class PageHeader extends React.Component<PageHeaderProps<JSX.Element>> {\r\n\trender() {return renderPageHeader(this.props)}\r\n\t/*\r\n    private back = async () => {\r\n        await nav.back(); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet {afterBack} = this.props;\r\n\t\tif (afterBack) afterBack();\r\n    }\r\n    openWindow() {\r\n        window.open(document.location.href);\r\n    }\r\n    private logoutClick = () => {\r\n        nav.showLogout(this.logout);\r\n    }\r\n    private logout = async () => {\r\n        let {logout} = this.props;\r\n        if (typeof logout === 'function') {\r\n            await logout(); \r\n        }\r\n        await nav.logout(undefined);\r\n    }\r\n    render() {\r\n        let b = nav.level > 1 || window.self !== window.top;\r\n        let {right, center, logout, className, ex} = this.props;\r\n        let back:any, debugLogout:any;\r\n        if (logout !== undefined && window.self === window.top) {\r\n            if ((typeof logout === 'boolean' && logout === true)\r\n                || typeof logout === 'function')\r\n            {\r\n                let {user} = nav;\r\n                if (user !== undefined) {\r\n                    let {nick, name} = user;\r\n                    debugLogout = <div className=\"d-flex align-items-center\">\r\n                        <small className=\"text-light\">{nick || name}</small>\r\n                        {\r\n                            // eslint-disable-next-line\r\n                            <div className=\"ms-2 py-2 px-3 cursor-pointer\"\r\n                                role=\"button\"\r\n                                onClick={this.logoutClick}>\r\n                                <i className=\"fa fa-sign-out fa-lg\" />\r\n                            </div>\r\n                        }\r\n                    </div>;\r\n                }\r\n            }\r\n        }\r\n        if (b) {\r\n            switch (this.props.back) {\r\n                case 'none':\r\n                    back = undefined;\r\n                    break;\r\n                default:\r\n                case 'back':\r\n                    back = <nav onClick={this.back}><i className=\"fa fa-angle-left\" /></nav>;\r\n                    break;\r\n                case 'close':\r\n                    back = <nav onClick={this.back}><i className=\"fa fa-close\" /></nav>;\r\n                    break;\r\n            }\r\n        }\r\n        if (window.self !== window.top) {\r\n            console.log(document.location.href);\r\n            // pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n        }\r\n        if (back === undefined && typeof center === 'string') {\r\n            center = <div className=\"px-3\">{center}</div>;\r\n        }\r\n\t\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\t\tlet header = <header className={className}>\r\n\t\t\t<nav>\r\n\t\t\t\t{back}\r\n\t\t\t\t<div>{center}</div>\r\n\t\t\t\t{rightView}\r\n\t\t\t</nav>\r\n\t\t\t{ex}\r\n\t\t</header>;\r\n        return <>\r\n\t\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t\t{header}\r\n\t\t</>;\r\n\t}\r\n\t*/\r\n}\r\n","import * as React from 'react';\r\nimport { makeObservable, observable, runInAction } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport { IVPage } from './page';\r\nimport { IObservableValue } from 'mobx';\r\nimport '../../css/va-tab.css';\r\nimport { ScrollView } from './scrollView';\r\n\r\nexport type TabCaption = (selected:boolean) => JSX.Element;\r\n\r\nexport interface TabProp {\r\n    name: string;\r\n    caption: TabCaption;\r\n\tcontent?: () => JSX.Element;\r\n\tpage?: IVPage;\r\n    notify?: IObservableValue<number> | number;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tisSelected?: boolean;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n}\r\n\r\nexport interface TabsProps {\r\n    tabs: TabProp[];\r\n    tabPosition?: 'top' | 'bottom';\r\n    size?: 'sm' | 'lg' | 'md';\r\n    tabBg?: string;\r\n    contentBg?: string;\r\n    sep?: string;\r\n    selected?: string;\r\n    borderColor?: string;\r\n    borderWidth?: string;\r\n}\r\n\r\nclass Tab {\r\n\tloaded: boolean = false;\r\n\tselected: boolean = false;\r\n\t\r\n    name: string;\r\n    caption: TabCaption;\r\n\tcontentBuilder: ()=>JSX.Element;\r\n\tpage: IVPage;\r\n    notify: IObservableValue<number> | number;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<void>;\r\n\tclassName?: string;\r\n\r\n\tprivate _content: JSX.Element;\r\n\t\r\n\tconstructor() {\r\n\t\tmakeObservable(this, {\r\n\t\t\tloaded: observable, \r\n\t\t\tselected: observable, \r\n\t\t});\r\n\t}\r\n    \r\n    get content(): JSX.Element {\r\n\t\tif (this.load && this.loaded === false) return null;\r\n\t\tif (this.selected === false) return this._content;\r\n\t\tif (!this._content) {\r\n\t\t\tif (this.contentBuilder !== undefined) {\r\n\t\t\t\tthis._content = this.contentBuilder();\r\n\t\t\t}\r\n\t\t\telse if (this.page !== undefined) {\r\n\t\t\t\tthis._content = this.page.content();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._content = <div className=\"p-5\">tab 应该定义content或者page</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._content;\r\n    }\r\n\r\n    async shown() {\r\n        if (this.onShown !== undefined) {\r\n            await this.onShown();\r\n        }\r\n        if (this.load !== undefined) {\r\n\t\t\tif (this.loaded === false) {\r\n\t\t\t\tawait this.load();\r\n\t\t\t\trunInAction(() => {\r\n\t\t\t\t\tthis.loaded = true;\r\n\t\t\t\t});\r\n\t\t\t}\r\n        }\r\n    }\r\n}\r\n\r\nexport const TabCaptionComponent = (label:string|JSX.Element, icon:string, color:string) => <div \r\n    className={'d-flex justify-content-center align-items-center flex-column cursor-pointer ' + color}>\r\n    <div><i className={'fa fa-lg fa-' + icon} /></div>\r\n    <small>{label}</small>\r\n</div>;\r\n\r\n//export const TabCaption = TabCaptionComponent;\r\n\r\nexport class TabsView {\r\n\tprivate props: TabsProps;\r\n    private size: string;\r\n    private tabBg: string;\r\n    private sep: string;\r\n    selectedTab: Tab;\r\n    tabArr: Tab[];\r\n\r\n    constructor(props: TabsProps) {\r\n\t\tthis.props = props;\r\n\t\tlet {size, tabs, tabBg: tabBack, sep, selected} = props;\r\n\t\tthis.size = size || 'md';\r\n        this.tabArr = tabs.map(v => {\r\n            let tab = new Tab();\r\n            let {name, caption, content, page, notify, load, onShown, isSelected, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\ttab.name = name;\r\n\t\t\tif (isSelected === true || name === selected) {\r\n\t\t\t\tthis.selectedTab = tab;\r\n\t\t\t}\r\n\t\t\ttab.selected = false;\r\n\t\t\ttab.caption = caption;\r\n\t\t\tif (content !== undefined) {\r\n\t\t\t\ttab.contentBuilder = content;\r\n\t\t\t}\r\n\t\t\telse if (page !== undefined) {\r\n\t\t\t\ttab.page = page;\r\n\t\t\t\t//contentBuilder = () => {return page.content()};\r\n\t\t\t}\r\n            tab.notify = notify;\r\n            tab.load = load;\r\n\t\t\ttab.onShown = onShown;\r\n\t\t\ttab.onScroll = onScroll;\r\n\t\t\ttab.onScrollTop = onScrollTop;\r\n\t\t\ttab.onScrollBottom = onScrollBottom;\r\n\t\t\ttab.className = className;\r\n            return tab;\r\n        });\r\n        this.tabBg = tabBack;\r\n        //this.contentBg = contentBack;\r\n        this.sep = sep;\r\n        if (this.selectedTab === undefined) {\r\n\t\t\tthis.selectedTab = this.tabArr[0];\r\n\t\t}\r\n        this.selectedTab.selected = true;\r\n\t\tmakeObservable(this, {\r\n\t\t\tselectedTab: observable, \r\n\t\t\ttabArr: observable,\r\n\t\t});\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabClick(this.selectedTab);\r\n\t\t}, 100);\t\t\r\n    }\r\n\r\n    tabClick = async (tab:Tab) => {\r\n\t\tif (!tab) {\r\n\t\t\ttab = this.selectedTab;\r\n\t\t\tif (tab === undefined) {\r\n\t\t\t\tif (this.tabArr === undefined) return;\r\n\t\t\t\tif (this.tabArr.length === 0) return;\r\n\t\t\t\ttab = this.tabArr[0];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\trunInAction(() => {\r\n\t\t\tthis.selectedTab.selected = false;\r\n\t\t\ttab.selected = true;\r\n\t\t\tthis.selectedTab = tab;\r\n\t\t});\r\n\t\t\r\n\t\tawait tab.shown();\r\n    }\r\n\r\n\tprivate tabs = observer(() => {\r\n        let {tabPosition, borderColor} = this.props;\r\n        let bsCur:React.CSSProperties, bsTab:React.CSSProperties\r\n        if (borderColor) {\r\n            bsCur = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderLeftWidth: 1,\r\n                borderRightWidth: 1,\r\n                borderBottomWidth: 1,\r\n            }\r\n            bsTab = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderBottomWidth: 1,\r\n                borderLeftWidth: 0,\r\n                borderRightWidth: 0,\r\n\t\t\t\tcursor: 'pointer',\r\n            }\r\n            if (tabPosition === 'top') {\r\n                bsCur.borderBottomWidth = 0;\r\n                bsCur.borderTopLeftRadius = 10;\r\n                bsCur.borderTopRightRadius = 10;\r\n                bsTab.borderTopWidth = 0;\r\n            }\r\n            else {\r\n                bsCur.borderTopWidth = 0;\r\n                bsCur.borderBottomLeftRadius = 10;\r\n                bsCur.borderBottomRightRadius = 10;\r\n                bsTab.borderBottomWidth = 0;\r\n            }\r\n        }\r\n\t\tlet cn = classNames('tv-tabs', this.tabBg, this.sep, 'tv-tabs-' + this.size);\r\n\t\tlet tabs = <div className={cn}>\r\n            {this.tabArr.map((v,index) => {\r\n                let {selected, caption, notify} = v;\r\n                let notifyCircle:any;\r\n                if (notify !== undefined) {\r\n                    let num = typeof notify === 'number'? notify : notify.get();\r\n                    if (num !== undefined) {\r\n                        if (num > 0) notifyCircle = <u>{num>99?'99+':num}</u>;\r\n                        else if (num < 0) notifyCircle = <u className=\"dot\" />;\r\n                    }\r\n                }\r\n                return <div key={index} onClick={()=>this.tabClick(v)} \r\n\t\t\t\t\tstyle={selected===true? bsCur:bsTab}>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t{notifyCircle}\r\n\t\t\t\t\t{caption(selected)}\r\n\t\t\t\t\t</div>\r\n                </div>\r\n            })}\r\n\t\t</div>;\r\n\t\treturn tabs;\r\n\t});\r\n\r\n\tcontent = observer(() => {\r\n\t\tlet displayNone:React.CSSProperties = {visibility: 'hidden'};\r\n\t\treturn <>\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet {tabPosition} = this.props;\r\n\t\t\t\tlet {content, page, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\t\tlet tabs = React.createElement(this.tabs);\r\n\t\t\t\tlet pageHeader:any, pageFooter:any;\r\n\t\t\t\tif (page !== undefined) {\r\n\t\t\t\t\tpageHeader = page.header();\r\n\t\t\t\t\tpageFooter = page.footer();\r\n\t\t\t\t}\r\n\t\t\t\tlet header:any, footer:any;\r\n\t\t\t\tlet visibility:React.CSSProperties = {visibility:'hidden'};\r\n\t\t\t\tif (tabPosition === 'top') {\r\n\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t<section className=\"tv-page-header\">\r\n\t\t\t\t\t\t\t<header>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<header style={visibility}>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t\tif (pageFooter !== undefined) {\r\n\t\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t\t<footer style={visibility}>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t<section className=\"tv-page-footer\">\r\n\t\t\t\t\t\t\t\t<footer>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pageHeader !== undefined) {\r\n\t\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t\t<section className='tv-page-header'>\r\n\t\t\t\t\t\t\t\t<header>{pageHeader}</header>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t\t<header style={visibility}>{pageHeader}</header>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t<footer style={visibility}>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t<section className='tv-page-footer'>\r\n\t\t\t\t\t\t\t<footer>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = displayNone;\r\n\t\t\t\treturn <ScrollView key={index} className={className}\r\n\t\t\t\t\tstyle={style}\r\n\t\t\t\t\tonScroll={onScroll} onScrollTop={onScrollTop} onScrollBottom={onScrollBottom}>\r\n\t\t\t\t\t{header}\r\n\t\t\t\t\t{content}\r\n\t\t\t\t\t{footer}\r\n\t\t\t\t</ScrollView>;\r\n\t\t\t})}\r\n\t\t</>;\r\n\t});\r\n\r\n    render() {\r\n\t\tlet {tabPosition} = this.props;\r\n\t\tlet tabs = React.createElement(this.tabs);\r\n\t\tlet header:any, footer:any;\r\n\t\tlet visibility:React.CSSProperties = {display:'none'};\r\n\t\tif (tabPosition === 'top') {\r\n\t\t\theader = <header>{tabs}</header>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfooter = <footer>{tabs}</footer>;\r\n\t\t}\r\n\t\treturn <>\r\n\t\t\t{header}\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = visibility;\r\n\t\t\t\treturn <div key={index} className={classNames(v.className)} style={style}>\r\n\t\t\t\t\t{v.content}\r\n\t\t\t\t</div>;\r\n\t\t\t})}\r\n\t\t\t{footer}\r\n\t\t</>;\r\n    }\r\n};\r\n\r\n@observer export class Tabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n\t\t*/\r\n    }\r\n\r\n    render() {\r\n\t\treturn this.tabsView.render();\r\n    }\r\n};\r\n\r\n@observer export class RootTabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n\t\t*/\r\n    }\r\n\r\n    render() {\r\n\t\treturn React.createElement(this.tabsView.content);\r\n    }\r\n};\r\n","import * as React from 'react';\r\nimport { FetchError, refetchApi } from 'tonva-core';\r\nimport { Page } from '../components';\r\n\r\nexport interface FetchErrorProps extends FetchError {\r\n    clearError: ()=>void\r\n}\r\n\r\nexport default class FetchErrorView extends React.Component<FetchErrorProps, null> {\r\n    private reApi = async () => {\r\n        this.props.clearError();\r\n        const {channel, url, options, resolve, reject} = this.props;\r\n        await refetchApi(channel, url, options, resolve, reject);\r\n    }\r\n    private close = async () => {\r\n        this.props.clearError();\r\n    }\r\n    render() {\r\n        let {error, url} = this.props;\r\n        let errContent:any;\r\n        if (typeof error === 'object') {\r\n            let err = [];\r\n            for (let i in error) {\r\n                err.push(<li key={i}><label>{i}</label><div style={{wordWrap:\"break-word\"}}>{error[i]}</div></li>);\r\n            }\r\n            errContent = <ul>{err}</ul>;\r\n        }\r\n        else {\r\n            errContent = <div>{error}</div>;\r\n        }\r\n        return <div className=\"tv-page\">\r\n            <article>\r\n\t\t\t\t<main className=\"va-error p-3\">\r\n\t\t\t\t\t<div>网络出现问题</div>\r\n\t\t\t\t\t<div>点击重新访问</div>\r\n\t\t\t\t\t<div style={{wordWrap:\"break-word\"}}>url: {url}</div>\r\n\t\t\t\t\t{errContent}\r\n\t\t\t\t\t<div className=\"p-3 text-center\">\r\n\t\t\t\t\t<button className=\"btn btn-primary me-3\" type='button' onClick={this.close}>关闭</button>\r\n\t\t\t\t\t\t<button className=\"btn btn-outline-primary\" type='button' onClick={this.reApi}>重试</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</main>\r\n            </article>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport const SystemNotifyPage = ({message}:{message:string}):JSX.Element => {\r\n    return <Page header=\"系统提醒\">\r\n        <div className=\"px-3\">{message}</div>\r\n    </Page>;\r\n}","import { capitalCase } from \"../tool\";\r\n//import { FieldItem, FieldUIType } from \"../../tonva-react/ui\";\r\n\r\nexport function buildFieldItem(field:any, isKey:boolean):any/*FieldItem*/ {\r\n\tlet $FieldItemType: string, fieldItemType: string, widget:any/*FieldUIType*/;\r\n\tlet {name, type} = field;\r\n\tswitch (type) {\r\n\t\tcase 'id':\r\n\t\t\t$FieldItemType = 'FieldItemId';\r\n\t\t\tfieldItemType = 'id';\r\n\t\t\tbreak;\r\n\t\tcase 'char':\r\n\t\t\t$FieldItemType = 'FieldItemString';\r\n\t\t\tfieldItemType = 'string';\r\n\t\t\twidget = 'string';\r\n\t\t\tbreak;\r\n\t\tcase 'smallint':\r\n\t\tcase 'int':\r\n\t\tcase 'bigint':\r\n\t\t\t$FieldItemType = 'FieldItemInt';\r\n\t\t\tfieldItemType = 'integer';\r\n\t\t\twidget = 'updown';\r\n\t\t\tbreak;\r\n\t\tcase 'dec':\r\n\t\tcase 'float':\r\n\t\tcase 'double':\r\n\t\t\t$FieldItemType = 'FieldItemNumber';\r\n\t\t\tfieldItemType = 'number';\r\n\t\t\twidget = 'number';\r\n\t\t\tbreak;\r\n\t}\r\n\treturn {\r\n\t\tname,\r\n\t\ttype: fieldItemType,\r\n\t\tisKey,\r\n\t\twidget,\r\n\t\tlabel: capitalCase(name),\r\n\t\t$FieldItemType,\r\n\t} /*as FieldItem*/;\r\n}\r\n","import { VPage } from '../vm';\r\nimport { CLogin } from './CLogin';\r\n\r\nexport class VLogout extends VPage<CLogin> {\r\n\tprivate onLogout: ()=>void;\r\n\r\n\tinit(param: any) {\r\n\t\tthis.onLogout = param;\r\n\t}\r\n\theader() {return this.isWebNav === true? false : '安全退出';}\r\n\tfooter() {\r\n\t\treturn <div className=\"mt-5 text-center justify-content-center\">\r\n\t\t\t<button className=\"btn btn-outline-warning\" onClick={this.tonva.resetAll}>升级软件</button>\r\n\t\t</div>;\r\n\t}\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'close'}\r\n\tcontent() {\r\n\t\treturn <div className=\"m-5 border border-info bg-white rounded-3 p-5 text-center\">\r\n\t\t\t<div>退出当前账号不会删除任何历史数据，下次登录依然可以使用本账号</div>\r\n\t\t\t<div className=\"mt-5 text-center\">\r\n\t\t\t\t<button className=\"btn btn-danger\" onClick={this.onLogout}>安全退出</button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { Form, Schema, UiSchema, UiTextItem, UiPasswordItem, Context, UiButton, StringSchema, Ax } from '../components';\r\nimport { defaultLoginTop, getSender } from './tools';\r\nimport { CLogin } from './CLogin';\r\nimport { VPage } from '../vm';\r\nimport { tonva } from 'tonva-core';\r\n\r\nconst schema: Schema = [\r\n    {name: 'username', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n    {name: 'password', type: 'string', required: true, maxLength: 100} as StringSchema,\r\n    {name: 'login', type: 'submit'},\r\n];\r\n\r\nexport class VLogin extends VPage<CLogin> {\r\n    private onLogin: (un:string, pwd:string) => Promise<boolean>;\r\n    private withBack: boolean;\r\n\r\n\tinit({onLogin, withBack}:{onLogin: (un:string, pwd:string) => Promise<boolean>; withBack: boolean;}) {\r\n\t\tthis.onLogin = onLogin;\r\n\t\tthis.withBack = withBack;\r\n\t}\r\n\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            username: {placeholder: '手机/邮箱/用户名', label: '登录账号'} as UiTextItem,\r\n            password: {widget: 'password', placeholder: '密码', label: '密码'} as UiPasswordItem,\r\n            login: {widget: 'button', className: 'btn btn-primary btn-block mt-3', label: '登录'} as UiButton,\r\n        }\r\n    }\r\n\r\n    private onSubmit = async (name:string, context:Context):Promise<string> => {\r\n        let values = context.form.data;\r\n        let un = values['username'];\r\n        let pwd = values['password'];\r\n        if (pwd === undefined) {\r\n            return 'something wrong, pwd is undefined';\r\n\t\t}\r\n\t\tlet ret = await this.onLogin(un, pwd);\r\n\t\tif (ret === true) return;\r\n\r\n\t\tlet sender = getSender(un);\r\n\t\tlet type:string = sender !== undefined? sender.caption : '用户名';\r\n\t\treturn type + '或密码错！';\r\n    }\r\n    private onEnter = async (name:string, context:Context):Promise<string> => {\r\n        if (name === 'password') {\r\n            return await this.onSubmit('login', context);\r\n        }\r\n\t}\r\n\r\n\theader() {\r\n        if (this.withBack === true) {\r\n            return '登录';\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tcontent() {\r\n        return <div className=\"d-flex p-5 flex-column justify-content-center align-items-center\">\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t\t<div className=\"w-20c\">\r\n\t\t\t\t{this.tonva.loginTop(defaultLoginTop)}\r\n\t\t\t\t<div className=\"h-2c\" />\r\n\t\t\t\t<Form schema={schema} uiSchema={this.uiSchema} \r\n\t\t\t\t\tonButtonClick={this.onSubmit} \r\n\t\t\t\t\tonEnter={this.onEnter}\r\n\t\t\t\t\trequiredFlag={false} />\r\n\t\t\t\t<div className=\"text-center\">\r\n\t\t\t\t\t<Ax className=\"btn btn-link\" href=\"/forget\">\r\n\t\t\t\t\t\t忘记密码\r\n\t\t\t\t\t</Ax>\r\n\t\t\t\t\t<Ax href=\"/register\" className=\"btn btn-link\">\r\n\t\t\t\t\t\t注册账号\r\n\t\t\t\t\t</Ax>\r\n\t\t\t\t</div>\r\n\t\t\t\t{tonva.privacyEntry()}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t\t<div className=\"flex-fill\" />\r\n\t\t</div>;\r\n    }\r\n}\r\n","import { VPage } from '../vm';\r\nimport { Page, Form, ItemSchema, UiSchema, StringSchema, UiPasswordItem, Context, ButtonSchema, UiButton } from '../components';\r\n//import { CenterAppApi } from '../net';\r\nimport { CLogin } from './CLogin';\r\nimport { tonva } from 'tonva-core';\r\n\r\nexport class VChangePassword extends VPage<CLogin> {\r\n    private schema: ItemSchema[] = [\r\n        {name:'orgPassword', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'newPassword', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'newPassword1', type: 'string', maxLength: 60, required: true} as StringSchema,\r\n        {name:'submit', type: 'submit'} as ButtonSchema\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            orgPassword: {\r\n                widget: 'password',\r\n                label: '原密码',\r\n                placeholder: '输入原来的密码'\r\n            } as UiPasswordItem,\r\n            newPassword: {\r\n                widget: 'password',\r\n                label: '新密码',\r\n                placeholder: '输入新设的密码'\r\n            } as UiPasswordItem,\r\n            newPassword1: {\r\n                widget: 'password',\r\n                label: '确认密码', \r\n                placeholder: '再次输入新设密码'\r\n            } as UiPasswordItem,\r\n            submit: {\r\n                widget: 'button',\r\n                label: '提交',\r\n                className: 'btn btn-primary'\r\n            } as UiButton,\r\n        }\r\n\t};\r\n\t\r\n\tprivate onChange: (orgPassword:string, newPassword:string) => Promise<boolean>\r\n\tinit(onChange: (orgPassword:string, newPassword:string) => Promise<boolean>) {\r\n\t\tthis.onChange = onChange;\r\n\t}\r\n\r\n    private onSubmit = async (name:string, context: Context):Promise<any> => {\r\n        let {orgPassword, newPassword, newPassword1} = context.data;\r\n        if (newPassword !== newPassword1) {\r\n            context.setError('newPassword1', '新密码错误，请重新输入');\r\n            return;\r\n        }\r\n        //let centerAppApi = new CenterAppApi('tv/', undefined);\r\n\t\t//let ret = await centerAppApi.changePassword({orgPassword, newPassword});\r\n\t\tlet ret = await this.onChange(orgPassword, newPassword);\r\n        if (ret === false) {\r\n            context.setError('orgPassword', '原密码错误');\r\n            return;\r\n        }\r\n        tonva.nav.replace(<Page header=\"修改密码\" back=\"close\">\r\n            <div className=\"m-3  text-success\">\r\n                密码修改成功！\r\n            </div>\r\n        </Page>);\r\n        return;\r\n    }\r\n\r\n\theader() {return '修改密码'}\r\n\r\n    content() {\r\n        return <Form\r\n\t\t\tclassName=\"m-3\" \r\n\t\t\tschema={this.schema}\r\n\t\t\tuiSchema={this.uiSchema}\r\n\t\t\tonButtonClick={this.onSubmit}\r\n\t\t\tfieldLabelSize={2} />\r\n    }\r\n}\r\n","import { CLogin } from \"./CLogin\";\r\nimport { VPage } from \"../vm\";\r\nimport { CenterAppApi } from \"tonva-core\";\r\n\r\nconst waitingTime = '一小时';\r\n\r\nabstract class VUserQuitBase extends VPage<CLogin> {\r\n    protected abstract get note(): any;\r\n    protected get button1Caption(): string {return undefined;}\r\n    protected get button2Caption(): string {return undefined;}\r\n    protected renderButton1():JSX.Element {\r\n        let caption = this.button1Caption;\r\n        if (caption === null) return null;\r\n        return <button className=\"btn btn-primary\" onClick={() => this.onClickButton1()}>\r\n            {caption??'不注销'}\r\n        </button>;\r\n    }\r\n    protected renderButton2():JSX.Element {\r\n        let caption = this.button2Caption;\r\n        if (caption === null) return null;\r\n        return <button className=\"btn btn-outline-info ms-3\" onClick={() => this.onClickButton2()}>\r\n            {caption??'确认注销'}\r\n        </button>;\r\n    }\r\n    header() {return '注销账号'}\r\n    content() {\r\n        return <div className=\"border border-danger rounded mx-auto m-3 w-max-30c bg-white \">\r\n            <div className=\"p-4 border-bottom\">{this.note}</div>\r\n            <div className=\"p-3 text-center\">\r\n                {this.renderButton1()}\r\n                {this.renderButton2()}\r\n            </div>\r\n        </div>\r\n    }\r\n\r\n    protected onClickButton1() {\r\n        this.closePage();\r\n    }\r\n\r\n    protected onClickButton2() {\r\n    }\r\n}\r\n\r\nexport class VUserQuit extends VUserQuitBase {\r\n    protected get note(): any {\r\n        return <>\r\n        注意：账号注销后，账号绑定手机、邮件等相关信息将被释放。账号无法将登录。<br/>\r\n        请确认！\r\n        </>;\r\n    }\r\n    protected get button2Caption(): string {return '我已了解，仍然注销';}\r\n\r\n    protected onClickButton2() {\r\n        this.openVPage(VQuitConfirm);\r\n    }\r\n}\r\n\r\nclass VQuitConfirm extends VUserQuitBase {\r\n    protected get note(): any {\r\n        return <>\r\n        账号注销后，如果在{waitingTime}内容重新登录账号，账号自动恢复。\r\n        {waitingTime}之后，账号绑定手机、邮件等相关信息将被释放。账号无法将登录。<br/>\r\n        请再次确认！\r\n        </>;\r\n    }\r\n    protected get button2Caption(): string {return '确认注销';}\r\n\r\n    protected onClickButton1() {\r\n        this.closePage(2);\r\n    }\r\n\r\n    protected async onClickButton2() {\r\n        let centerAppApi = new CenterAppApi(this.controller.web, 'tv/', undefined);\r\n        await centerAppApi.userQuit();\r\n        this.openVPage(VQuitDone);\r\n    }\r\n}\r\n\r\nclass VQuitDone extends VUserQuitBase {\r\n    header() {return '注销已账号'}\r\n    protected get back(): 'close' | 'back' | 'none' {return 'none'}\r\n    protected get note(): any {\r\n        return <>\r\n        账号将在{waitingTime}后彻底注销。<br/>\r\n        如果在{waitingTime}内容重新登录账号，注销操作自动取消。\r\n        {waitingTime}之后，账号绑定手机、邮件等相关信息将被释放。账号无法将登录。\r\n        </>;\r\n    }\r\n    protected get button1Caption(): string {return '退出';}\r\n    protected get button2Caption(): string {return null;}\r\n    protected onClickButton1() {\r\n        this.tonva.logout();\r\n    }\r\n}\r\n","import { User, CenterAppApi } from 'tonva-core';\r\nimport { Login } from '../components';\r\nimport { ControllerWithWeb, VPage } from \"../vm\";\r\nimport { VLogout } from './VLogout';\r\nimport { VLogin } from './VLogin';\r\nimport { VChangePassword } from './VChangePassword';\r\nimport { VUserQuit } from './VUserQuit';\r\n\r\nexport class CLogin extends ControllerWithWeb implements Login {\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\tasync showLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean):Promise<void> {\r\n\t\tlet onLogin = async (un:string, pwd:string):Promise<boolean> => {\r\n\t\t\tlet user = await this.web.userApi.login({\r\n\t\t\t\tuser: un,\r\n\t\t\t\tpwd: pwd,\r\n\t\t\t\tguest: this.tonva.guest,\r\n\t\t\t});\r\n\t\r\n\t\t\tif (user === undefined) return false;\r\n\t\t\tconsole.log(\"onLoginSubmit: user=%s pwd:%s\", user.name, user.token);\r\n\t\t\tawait this.tonva.userLogined(user, callback);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tthis.openVPage(VLogin, {onLogin, withBack});\r\n    }\r\n\r\n    async showLogout(callback?: ()=>Promise<void>) {\r\n\t\tthis.openVPage(VLogout, () => {\r\n\t\t\tthis.tonva.logout(callback);\r\n\t\t});\r\n\t}\r\n\t/*\r\n\tasync showRegister() {\r\n\t\tlet cRegister = new (await import('./register')).CRegister(this.res);\r\n\t\tawait cRegister.start();\r\n\t}\r\n\r\n\tasync showForget() {\r\n\t\tlet cForget = new (await import('./register')).CForget(this.res);\r\n\t\tawait cForget.start();\r\n\t}\r\n\t*/\r\n\r\n\tprotected getVChangePassword():new (cLogin:CLogin) => VPage<CLogin> {\r\n\t\treturn VChangePassword;\r\n\t}\r\n\tasync showChangePassword() {\r\n\t\tlet vPage = this.getVChangePassword();\r\n\t\tthis.openVPage(vPage, async (orgPassword:string, newPassword:string):Promise<boolean> => {\r\n\t\t\tlet centerAppApi = new CenterAppApi(this.web, 'tv/', undefined);\r\n\t\t\tlet ret = await centerAppApi.changePassword({orgPassword, newPassword});\r\n\t\t\treturn ret;\r\n\t\t});\r\n    }\r\n\r\n\tasync showUserQuit():Promise<void> {\r\n\t\tthis.openVPage(VUserQuit);\r\n\t}\r\n}\r\n","export default __webpack_public_path__ + \"static/media/logo.2d27ead7.svg\";","import { mobileRegex, emailRegex } from 'tonva-core';\r\nimport logo from '../img/logo.svg';\r\n\r\nexport const defaultLoginTop = <div className=\"d-flex align-items-center position-relative\">\r\n    <img className=\"App-logo h-3c position-absolute\" src={logo} alt=\"img\" />\r\n    <div className=\"h3 flex-fill text-center\"><span className=\"text-primary me-3\">同</span>\r\n        <span className=\"text-danger\">花</span>\r\n    </div>\r\n</div>;\r\n\r\ninterface Sender {\r\n    type: string;\r\n    caption: string;\r\n    regex: RegExp;\r\n}\r\n\r\nconst senders:Sender[] = [\r\n    {type:'mobile', caption:'手机号', regex: mobileRegex},\r\n    {type:'email', caption:'邮箱', regex: emailRegex}\r\n];\r\n\r\nexport function getSender(un: string):Sender {\r\n    let sender = senders.find(v => v.regex.test(un) === true);\r\n    return sender;\r\n}","import fs from \"fs\";\r\nimport { capitalCase } from \"../tool\";\r\nimport { Entity, ID, IDX, IX, UqMan } from \"../uqCore\";\r\nimport { TsUQ } from \"./TsUQ\";\r\nimport { buildFieldItem } from \"./buildFieldItem\";\r\nimport { overrideTsFile, saveTsFileIfNotExists } from \"./tools\";\r\nimport { UqBuildContext } from \"./UqBuildContext\";\r\n\r\ninterface FieldItem {\r\n\tname: string;\r\n};\r\n\r\ninterface ReplaceSection {\r\n\tbegin: string;\r\n\tend: string;\r\n\tcontent: string;\r\n};\r\n\r\nconst fieldItemReplaceProps = ['label', 'placeholder', 'widget', 'type'];\r\n\r\nexport class TsUqFolder {\r\n\tprivate buildContext: UqBuildContext;\r\n\tprivate readonly uq: UqMan;\r\n\tprivate readonly uqsFolder:string;\r\n\tprivate readonly uqAlias:string;\r\n\r\n\tconstructor(buildContext: UqBuildContext, uq: UqMan, uqsFolder:string, uqAlias:string) {\r\n\t\tthis.buildContext = buildContext;\r\n\t\tthis.uq = uq;\r\n\t\tthis.uqsFolder = uqsFolder;\r\n\t\tthis.uqAlias = uqAlias;\r\n\t}\r\n\r\n\tbuild() {\r\n\t\tlet uqFolder = this.uqsFolder + '/' + this.uqAlias;\r\n\t\tif (fs.existsSync(uqFolder) === false) {\r\n\t\t\tfs.mkdirSync(uqFolder);\r\n\t\t}\r\n\t\tlet tsUq = this.buildContext.tsTemplate.tsHeader;\r\n\t\tlet tsUqBuilder = new TsUQ(this.buildContext, this.uq, this.uqAlias);\r\n\t\t//tsUq += buildUQ(this.uq, this.uqAlias);\r\n\t\ttsUq += tsUqBuilder.build();\r\n\t\toverrideTsFile(`${uqFolder}/${this.uqAlias}.ts`, tsUq);\r\n\t\tthis.saveTuidAndIDTsIndexAndRender(uqFolder);\r\n\t}\r\n\t\r\n\tprivate saveTuidAndIDTsIndexAndRender(uqFolder:string) {\r\n\t\tlet imports = '', sets = '';\r\n\t\tlet {idArr, idxArr, ixArr, tuidArr} = this.uq;\r\n\t\tlet coll:{[name:string]: Entity} = {};\r\n\t\r\n\t\tfor (let i of tuidArr) {\r\n\t\t\tlet {sName} = i;\r\n\t\t\tcoll[sName.toLowerCase()] = i;\r\n\t\t\tlet cName = capitalCase(sName);\t\t\r\n\t\t\tif (cName[0] === '$') continue;\r\n\t\t\timports += `\\nimport * as ${cName} from './${cName}.ui';`;\r\n\t\t\tsets += `\\n\tassign(uq, '${cName}', ${cName});`;\r\n\t\r\n\t\t\tlet tsUI = `/* eslint-disable */\r\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\timport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonva-${this.buildContext.uiPlatform}';\r\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\timport { Res, uqStringify, setRes } from \"tonva-core\";\r\n\timport { Tuid${cName} } from \"./${this.uqAlias}\";\r\n\t\r\n\tconst resRaw: Res<any> = {\r\n\t\t$zh: {\r\n\t\t},\r\n\t\t$en: {\r\n\t\t}\r\n\t};\r\n\tconst res: any = {};\r\n\tsetRes(res, resRaw);\r\n\t\r\n\texport const t:TFunc = (str:string|${this.buildContext.element}): string|${this.buildContext.element} => {\r\n\t\treturn res[str as string] ?? str;\r\n\t}\r\n\t\r\n\texport function render(item: Tuid${cName}):${this.buildContext.element} {\r\n\t\treturn <>{uqStringify(item)}</>;\r\n\t};\r\n\t`;\r\n\t\r\n\t\t\tlet path = `${uqFolder}/${cName}.ui.tsx`;\r\n\t\t\tsaveTsFileIfNotExists(path, tsUI);\r\n\t\t}\r\n\t\r\n\t\tfor (let i of [...idArr, ...idxArr, ...ixArr]) {\r\n\t\t\tlet {sName} = i;\r\n\t\t\t//coll[sName.toLowerCase()] = i;\r\n\t\t\tlet cName = capitalCase(sName);\r\n\t\t\tif (cName[0] === '$') continue;\r\n\t\t\tcoll[cName.toLocaleLowerCase()] = i;\r\n\t\t\timports += `\\nimport * as ${cName} from './${cName}.ui';`;\r\n\t\t\tsets += `\\n\tassign(uq, '${cName}', ${cName});`;\r\n\t\r\n\t\t\tlet tsUI = `// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\timport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from 'tonva-${this.buildContext.uiPlatform}';\r\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\timport { Res, uqStringify, setRes } from \"tonva-core\";\r\n\timport { ${cName} } from \"./${this.uqAlias}\";\r\n\t\r\n\t/*--fields--*/\r\n\tconst fields = {\r\n\t};\r\n\t/*==fields==*/\r\n\t\r\n\tconst fieldArr: FieldItem[] = [\r\n\t];\r\n\t\r\n\texport const ui: UI = {\r\n\t\tlabel: \"${cName}\",\r\n\t\tfieldArr,\r\n\t\tfields,\r\n\t};\r\n\t\r\n\tconst resRaw: Res<any> = {\r\n\t\t$zh: {\r\n\t\t},\r\n\t\t$en: {\r\n\t\t}\r\n\t};\r\n\tconst res: any = {};\r\n\tsetRes(res, resRaw);\r\n\t\r\n\texport const t:TFunc = (str:string|${this.buildContext.element}): string|${this.buildContext.element} => {\r\n\t\treturn res[str as string] ?? str;\r\n\t}\r\n\t\r\n\texport function render(item: ${cName}):${this.buildContext.element} {\r\n\t\treturn <>{uqStringify(item)}</>;\r\n\t};\r\n\t`;\r\n\t\r\n\t\t\tlet path = `${uqFolder}/${cName}.ui.tsx`;\r\n\t\t\tsaveTsFileIfNotExists(path, tsUI);\r\n\t\r\n\t\t\tlet fields = this.buildFields(i);\r\n\t\t\tlet tsFieldArr:string = this.buildFieldArr(i);\r\n\t\r\n\t\t\tthis.replaceTsFileFields(path, fields);\r\n\t\t\tlet tsImportFieldItemsBegin = 'import { FieldItem, ';\r\n\t\t\tlet tsImportFieldItemsEnd = ` } from \"tonva-${this.buildContext.uiPlatform}\";`;\r\n\t\t\tlet tsImportFieldItems = 'FieldItemInt, FieldItemNumber, FieldItemString, FieldItemId';\r\n\t\t\tthis.replaceTsFileString(path, \r\n\t\t\t\t{\r\n\t\t\t\t\tbegin: tsImportFieldItemsBegin, \r\n\t\t\t\t\tend: tsImportFieldItemsEnd, \r\n\t\t\t\t\tcontent: tsImportFieldItemsBegin + tsImportFieldItems + tsImportFieldItemsEnd,\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t\tthis.replaceTsFileString(path, \r\n\t\t\t\t{begin:'\\nconst fieldArr: FieldItem[] = [\\n', end: '\\n];\\n', content:tsFieldArr}\r\n\t\t\t);\r\n\t\t}\r\n\t\r\n\t\tlet tsIndex = `import { UqExt as Uq, assign } from './${this.uqAlias}';${imports}\r\n\t\t\r\n\texport function setUI(uq: Uq) {${sets}\r\n\t}\r\n\texport * from './${this.uqAlias}';\r\n\t`;\r\n\t\toverrideTsFile(`${uqFolder}/index.ts`, tsIndex);\r\n\t\r\n\t\tlet files = fs.readdirSync(uqFolder);\r\n\t\tconst suffix = '.ui.tsx';\r\n\t\tfor (let file of files) {\r\n\t\t\tif (file.endsWith(suffix) === false) continue;\r\n\t\t\tlet from = file.length - suffix.length;\r\n\t\t\tlet fileEntityName = file.substring(0, from);\r\n\t\t\tlet entity = coll[fileEntityName.toLocaleLowerCase()];\r\n\t\t\tif (entity === undefined || fileEntityName[0] === '$') {\r\n\t\t\t\tlet unFile = `${uqFolder}/${file}`;\r\n\t\t\t\tfs.unlinkSync(unFile);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate buildFields(i:ID|IDX|IX):{[name:string]:FieldItem} {\r\n\t\tswitch (i.typeName) {\r\n\t\t\tcase 'id': return this.buildIDFields(i as ID);\r\n\t\t\tcase 'idx': return this.buildIDXFields(i);\r\n\t\t\tcase 'ix': return this.buildIXFields(i);\r\n\t\t}\r\n\t};\r\n\t\r\n\tprivate buildIDFields(ID:ID):{[name:string]:FieldItem} {\r\n\t\tlet ret:{[name:string]:FieldItem} = {};\r\n\t\tlet {schema} = ID;\r\n\t\tlet {keys, fields} = schema;\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet {name} = f;\r\n\t\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\t\tret[name] = buildFieldItem(f, isKey);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate buildIDXFields(IDX:IDX):{[name:string]:FieldItem} {\r\n\t\tlet ret:{[name:string]:FieldItem} = {};\r\n\t\tlet {schema} = IDX;\r\n\t\tlet {keys, fields} = schema;\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet {name} = f;\r\n\t\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\t\tret[name] = buildFieldItem(f, isKey);\r\n\t\t}\r\n\t\treturn ret;\r\n\t};\r\n\t\r\n\tprivate buildIXFields(IX:IX):{[name:string]:FieldItem} {\r\n\t\tlet ret:{[name:string]:FieldItem} = {};\r\n\t\tlet {schema} = IX;\r\n\t\tlet {keys, fields} = schema;\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet {name} = f;\r\n\t\t\tlet isKey = (keys as any[])?.findIndex(v => v.name === name) >= 0;\r\n\t\t\tret[name] = buildFieldItem(f, isKey);\r\n\t\t}\r\n\t\treturn ret;\r\n\t};\r\n\t\r\n\tprivate buildFieldArr(i:ID|IDX|IX):string {\r\n\t\tlet ts = '\\nconst fieldArr: FieldItem[] = [\\n\\t';\r\n\t\tswitch (i.typeName) {\r\n\t\t\tcase 'id': ts += this.buildIDFieldArr(i as ID); break;\r\n\t\t\tcase 'idx': ts += this.buildIDXFieldArr(i); break;\r\n\t\t\tcase 'ix': ts += this.buildIXFieldArr(i); break;\r\n\t\t}\r\n\t\treturn ts += '\\n];\\n';\r\n\t}\r\n\r\n\tprivate buildIDFieldArr(i:ID):string {\r\n\t\tlet {schema} = i;\r\n\t\tlet ts = '';\r\n\t\tfor (let f of schema.fields) {\r\n\t\t\tlet {name} = f;\r\n\t\t\tif (name === 'id') continue;\r\n\t\t\tts += `fields.${name}, `;\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\t\r\n\tprivate buildIDXFieldArr(i:IDX):string {\r\n\t\tlet {schema} = i;\r\n\t\tlet ts = '';\r\n\t\tfor (let f of schema.fields) {\r\n\t\t\tlet {name} = f;\r\n\t\t\tif (name === 'id') continue;\r\n\t\t\tts += `fields.${name}, `;\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\t\r\n\tprivate buildIXFieldArr(i:IX):string {\r\n\t\tlet {schema} = i;\r\n\t\tlet ts = '';\r\n\t\tfor (let f of schema.fields) {\r\n\t\t\tlet {name} = f;\r\n\t\t\tif (name === 'ix') continue;\r\n\t\t\tif (name === 'id') continue;\r\n\t\t\tts += `fields.${name}, `;\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\t\r\n\tprivate replaceTsFileFields(path: string, fields:{[name:string]:FieldItem}) {\r\n\t\tlet text = fs.readFileSync(path).toString();\r\n\t\tlet startStr = '\\n/*--fields--*/';\r\n\t\tlet endStr = '\\n/*==fields==*/\\n';\r\n\t\tlet start = text.indexOf(startStr);\r\n\t\tif (start > 0) {\r\n\t\t\tlet end = text.indexOf(endStr, start + startStr.length);\r\n\t\t\tif (end > 0) {\r\n\t\t\t\tlet lBrace = text.indexOf('{', start + startStr.length);\r\n\t\t\t\tlet rBrace = text.lastIndexOf('}', end);\r\n\t\t\t\tlet oldText = text.substring(lBrace, rBrace+1);\r\n\t\t\t\tlet fieldsText = this.buildFieldsFromOldText(fields, oldText);\r\n\t\t\t\ttext = text.substring(0, start)\r\n\t\t\t\t\t+ startStr + '\\nconst fields = {'\r\n\t\t\t\t\t+ fieldsText\r\n\t\t\t\t\t+ '\\n};'\r\n\t\t\t\t\t+ text.substring(end);\r\n\t\t\t\tfs.writeFileSync(path, text);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate buildFieldsFromOldText(fields:{[name:string]:FieldItem}, oldText:string):string {\r\n\t\tlet ret = '';\r\n\t\tfor (let i in fields) {\r\n\t\t\tlet field = fields[i];\r\n\t\t\tthis.setFieldOldProp(field, oldText);\r\n\t\t\tret += this.buildFieldText(field);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\t\r\n\tprivate setFieldOldProp(field:FieldItem, text:string) {\r\n\t\tlet fieldStart = field.name + ':';\r\n\t\tlet start = text.indexOf('\\t' + fieldStart);\r\n\t\tif (start < 0) start = text.indexOf('\\n' + fieldStart);\r\n\t\tif (start < 0) start = text.indexOf(' ' + fieldStart);\r\n\t\tif (start < 0) return;\r\n\t\t++start;\r\n\t\tlet end = text.indexOf('}', start + fieldStart.length);\r\n\t\tif (end < 0) return;\r\n\t\tlet fieldText = text.substring(start + fieldStart.length, end + 1);\r\n\t\t/* eslint no-eval: 0 */\r\n\t\tlet obj = eval('(' + fieldText + ')');\r\n\t\tfieldItemReplaceProps.forEach(v => {\r\n\t\t\tlet prop = obj[v];\r\n\t\t\tif (!prop) return;\r\n\t\t\tif (v === 'type') return; // 这个是由新的schema决定的\r\n\t\t\t(field as any)[v] = prop;\r\n\t\t});\r\n\t}\r\n\t\r\n\tprivate buildFieldText(field:FieldItem):string {\r\n\t\tlet {$FieldItemType} = field as any;\r\n\t\tdelete (field as any).$FieldItemType;\r\n\t\tlet ret = '\\n\\t' + field.name + ': ';\r\n\t\tlet json = JSON.stringify(field, null, '\\t\\t');\r\n\t\tjson = json.replace('}', '\\t}');\r\n\t\tret += json;\r\n\t\treturn ret + ' as ' + $FieldItemType + ',';\r\n\t}\r\n\t\r\n\tprivate replaceTsFileString(path:string, sec:ReplaceSection) {\r\n\t\tlet text = fs.readFileSync(path).toString();\r\n\t\tlet {begin, end, content} = sec;\r\n\t\tlet b = text.indexOf(begin);\r\n\t\tif (b < 0) return;\r\n\t\tlet e = text.indexOf(end, b + begin.length - 1);\r\n\t\tif (e < 0) return;\r\n\t\ttext = text.substring(0, b) + content + text.substr(e + end.length);\r\n\t\tfs.writeFileSync(path, text);\r\n\t}\r\n}\r\n","import { UqBuildContext } from \"./UqBuildContext\";\r\nimport { camelCase, capitalCase } from \"../tool\";\r\nimport { UqMan, Action, Book, Query, Sheet\r\n\t, Tuid, UqEnum, Map, History, Pending\r\n\t, Entity, ID, IX, IDX, ArrFields, Field } from '../uqCore';\r\nimport { entityName } from \"./tools\";\r\n\r\nconst fieldTypeMap:{[type:string]:string} = {\r\n\t\"char\": \"string\",\r\n\t\"text\": \"string\",\r\n\t\"id\": \"number\",\r\n\t\"textid\": \"string\",\r\n\t\"int\": \"number\",\r\n\t\"bigint\": \"number\",\r\n\t\"smallint\": \"number\",\r\n\t\"tinyint\": \"number\",\r\n\t\"dec\": \"number\",\r\n\t\"float\": \"number\",\r\n\t\"double\": \"number\",\r\n};\r\nconst sysFields = ['id', 'main', 'row', 'no', '$create', '$update', '$owner'];\r\n\r\nexport class TsUQ {\r\n\tprivate buildContext:UqBuildContext;\r\n\tprivate readonly uq:UqMan;\r\n\tprivate readonly uqAlias:string;\r\n\r\n\tconstructor(buildContext:UqBuildContext, uq:UqMan, uqAlias:string) {\r\n\t\tthis.buildContext = buildContext;\r\n\t\tthis.uq = uq;\r\n\t\tthis.uqAlias = uqAlias;\r\n\t}\r\n\t\r\n\tbuild() {\r\n\t\tlet tsImport = `\r\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\timport { IDXValue, Uq`;\r\n\t\tlet ts:string = `\\n\\n`;\r\n\t\tts += '\\n//===============================';\r\n\t\tts += `\\n//======= UQ ${this.uq.name} ========`;\r\n\t\tts += '\\n//===============================';\r\n\t\tts += '\\n';\r\n\t\t\r\n\t\tlet { enumArr, tuidArr, actionArr, sheetArr\r\n\t\t\t, queryArr, bookArr, mapArr, historyArr\r\n\t\t\t, pendingArr, idArr, idxArr, ixArr\r\n\t\t} = this.uq;\r\n\t\tenumArr.forEach(v => ts += this.uqEntityInterface<UqEnum>(v, this.buildEnumInterface));\r\n\t\ttuidArr.forEach(v => ts += this.uqEntityInterface<Tuid>(v, this.buildTuidInterface));\r\n\t\tactionArr.forEach(v => ts += this.uqEntityInterface<Action>(v, this.buildActionInterface));\r\n\t\tsheetArr.forEach(v => ts += this.uqEntityInterface<Sheet>(v, this.buildSheetInterface));\r\n\t\tqueryArr.forEach(v => ts += this.uqEntityInterface<Query>(v, this.buildQueryInterface));\r\n\t\tbookArr.forEach(v => ts += this.uqEntityInterface<Book>(v, this.buildBookInterface));\r\n\t\tmapArr.forEach(v => ts += this.uqEntityInterface<Map>(v, this.buildMapInterface));\r\n\t\thistoryArr.forEach(v => ts += this.uqEntityInterface<History>(v, this.buildHistoryInterface));\r\n\t\tpendingArr.forEach(v => ts += this.uqEntityInterface<Pending>(v, this.buildPendingInterface));\r\n\t\tidArr.forEach(v => ts += this.uqEntityInterface<ID>(v, this.buildIDInterface));\r\n\t\tidxArr.forEach(v => ts += this.uqEntityInterface<IDX>(v, this.buildIDXInterface));\r\n\t\tidxArr.forEach(v => ts += this.uqEntityInterface<IDX>(v, this.buildIDXActParamInterface));\t\r\n\t\tixArr.forEach(v => ts += this.uqEntityInterface<IX>(v, this.buildIXInterface));\r\n\r\n\t\tts += this.buildActsInterface(this.uq);\r\n\r\n\t\tts += `\r\n\t\\nexport interface UqExt extends Uq {\r\n\t\tActs(param:ParamActs): Promise<any>;\r\n\t`;\r\n\t\tfunction appendArr<T extends Entity>(arr:T[], type:string, tsBuild: (v:T) => string) {\r\n\t\t\tif (arr.length === 0) return;\r\n\t\t\tlet tsLen = ts.length;\r\n\t\t\tarr.forEach(v => ts += tsBuild(v));\r\n\t\t\tif (ts.length - tsLen > 0) {\r\n\t\t\t\ttsImport += ', Uq' + type;\r\n\t\t\t}\r\n\t\t}\r\n\t\tappendArr<Tuid>(tuidArr, 'Tuid', v => this.uqBlock<Tuid>(v, this.buildTuid));\r\n\t\tappendArr<Action>(actionArr, 'Action', v => this.uqBlock<Action>(v, this.buildAction));\r\n\t\tappendArr<Sheet>(sheetArr, 'Sheet', v => this.uqBlock<Sheet>(v, this.buildSheet));\r\n\t\tappendArr<Book>(bookArr, 'Book', v => this.uqBlock<Book>(v, this.buildBook));\r\n\t\tappendArr<Query>(queryArr, 'Query', v => this.uqBlock<Query>(v, this.buildQuery));\r\n\t\tappendArr<Map>(mapArr, 'Map', v => this.uqBlock<Map>(v, this.buildMap));\r\n\t\tappendArr<History>(historyArr, 'History', v => this.uqBlock<History>(v, this.buildHistory));\r\n\t\tappendArr<Pending>(pendingArr, 'Pending', v => this.uqBlock<Pending>(v, this.buildPending));\r\n\t\tappendArr<ID>(idArr, 'ID', v => this.uqBlock<ID>(v, this.buildID));\r\n\t\tappendArr<IDX>(idxArr, 'IDX', v => this.uqBlock<IDX>(v, this.buildIDX));\r\n\t\tappendArr<IX>(ixArr, 'IX', v => this.uqBlock<IX>(v, this.buildIX));\r\n\t\tts += '\\n}\\n';\r\n\t\tts += `\r\n\texport function assign(uq: any, to:string, from:any): void {\r\n\t\tlet hasEntity = uq.hasEntity(to);\r\n\t\tif (hasEntity === false) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tObject.assign((uq as any)[to], from);\r\n\t}\r\n\t`;\r\n\t\t\r\n\t\ttsImport += ` } from \"tonva-core\";\r\n\t\timport { Render } from \"tonva-${this.buildContext.uiPlatform}\";`;\r\n\r\n\t\treturn tsImport + ts;\r\n\t}\r\n\r\n\tprivate uqEntityInterface<T extends Entity>(entity: T, buildInterface: (entity: T)=>string) {\r\n\t\tlet {name} = entity;\r\n\t\tif (name.indexOf('$') > 0) return '';\r\n\t\tlet entityCode = buildInterface(entity);\r\n\t\tif (!entityCode) return '';\r\n\t\treturn '\\n' + entityCode + '\\n';\r\n\t}\r\n\r\n\tprivate uqBlock<T extends Entity>(entity: T, build: (entity: T)=>string) {\r\n\t\tlet {name} = entity;\r\n\t\tif (name.indexOf('$') > 0) return '';\r\n\t\tlet entityCode = build(entity);\r\n\t\tif (!entityCode) return '';\r\n\t\treturn '\\n' + entityCode;\r\n\t}\r\n\r\n\tprivate buildFields(fields: Field[], isInID:boolean = false, indent:number = 1) {\r\n\t\tif (!fields) return '';\r\n\t\tlet ts = '';\r\n\t\tfor (let f of fields) {\r\n\t\t\tts += this.buildField(f, isInID, indent);\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildField(field: Field, isInID:boolean, indent:number = 1) {\r\n\t\tlet {name, type} = field;\r\n\t\tlet s = fieldTypeMap[type];\r\n\t\tif (!s) s = 'any';\r\n\t\tlet q:string = (isInID === true && sysFields.indexOf(name) >= 0)? '?' : '';\r\n\t\treturn `\\n${'\\t'.repeat(indent)}${name}${q}: ${s};`;\r\n\t}\r\n\r\n\tprivate buildArrs(arrFields: ArrFields[]):string {\r\n\t\tif (!arrFields) return '';\r\n\t\tlet ts = '\\n';\r\n\t\tfor (let af of arrFields) {\r\n\t\t\tts += `\\t${camelCase(af.name)}: {`;\r\n\t\t\tts += this.buildFields(af.fields, false, 2);\r\n\t\t\tts += '\\n\\t}[];\\n';\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildReturns(entity:Entity, returns:ArrFields[]):string {\r\n\t\tif (!returns) return;\r\n\t\t//let {typeName} = entity;\r\n\t\t//let type = typeMap[typeName] || typeName;\r\n\t\tlet {sName} = entity;\r\n\t\tsName = capitalCase(sName);\r\n\t\tlet ts = '';\r\n\t\tfor (let ret of returns) {\r\n\t\t\tlet retName = capitalCase(ret.name);\r\n\t\t\tts += `export interface Return${sName}${retName} {`;\r\n\t\t\tts += this.buildFields(ret.fields);\r\n\t\t\tts += '\\n}\\n';\r\n\t\t}\r\n\r\n\t\tts += `export interface Result${sName} {\\n`;\r\n\t\tfor (let ret of returns) {\r\n\t\t\tlet retName = capitalCase(ret.name);\r\n\t\t\tts += `\\t${ret.name}: Return${sName}${retName}[];\\n`;\r\n\t\t}\r\n\t\tts += '}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildTuid = (tuid: Tuid) => {\r\n\t\tlet ts = `\\t${entityName(tuid.sName)}: UqTuid<Tuid${capitalCase(tuid.sName)}>&{tv:(id:number, render?:Render<any>)=>${this.buildContext.element}};`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildTuidInterface = (tuid: Tuid) => {\r\n\t\tlet ts = `export interface Tuid${capitalCase(tuid.sName)} {`;\r\n\t\tts += `\\n\\tid?: number;`;\r\n\t\tts += this.buildFields(tuid.fields);\r\n\t\tts += '\\n}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildAction = (action: Action) => {\r\n\t\tlet ts = `\\t${entityName(action.sName)}: UqAction<Param${capitalCase(action.sName)}, Result${capitalCase(action.sName)}>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildActionInterface = (action: Action) => {\r\n\t\tlet ts = `export interface Param${capitalCase(action.sName)} {`;\r\n\t\tts += this.buildFields(action.fields);\r\n\t\tts += this.buildArrs(action.arrFields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += this.buildReturns(action, action.returns);\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildEnumInterface = (enm: UqEnum) => {\r\n\t\tlet {schema} = enm;\r\n\t\tif (!schema) return;\r\n\t\tlet {values} = schema;\r\n\t\tlet ts = `export enum ${capitalCase(enm.sName)} {`;\r\n\t\tlet first:boolean = true;\r\n\t\tfor (let i in values) {\r\n\t\t\tif (first === false) {\r\n\t\t\t\tts += ',';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfirst = false;\r\n\t\t\t}\r\n\t\t\tlet v = values[i];\r\n\t\t\tts += '\\n\\t' + i + ' = ';\r\n\t\t\tif (typeof v === 'string') {\r\n\t\t\t\tts += '\"' + v + '\"';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tts += v;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ts += '\\n}'\r\n\t}\r\n\r\n\tprivate buildQuery = (query: Query) => {\r\n\t\tlet {sName} = query;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqQuery<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildQueryInterface = (query: Query) => {\r\n\t\tlet ts = `export interface Param${capitalCase(query.sName)} {`;\r\n\t\tts += this.buildFields(query.fields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += this.buildReturns(query, query.returns);\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildSheet = (sheet: Sheet) => {\r\n\t\tlet {sName, verify} = sheet;\r\n\t\tlet cName = capitalCase(sName);\r\n\t\tlet v = verify? `Verify${cName}` : 'any';\r\n\t\tlet ts = `\\t${entityName(sName)}: UqSheet<Sheet${cName}, ${v}>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildSheetInterface = (sheet: Sheet) => {\r\n\t\tlet {sName, fields, arrFields, verify} = sheet;\r\n\t\tlet ts = `export interface Sheet${capitalCase(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += this.buildArrs(arrFields);\r\n\t\tts += '}';\r\n\r\n\t\tif (verify) {\r\n\t\t\tlet {returns} = verify;\r\n\t\t\tts += `\\nexport interface Verify${capitalCase(sName)} {`;\r\n\t\t\tfor (let item of returns) {\r\n\t\t\t\tlet {name:arrName, fields} = item;\r\n\t\t\t\tts += '\\n\\t' + arrName + ': {';\r\n\t\t\t\tts += this.buildFields(fields, false, 2);\r\n\t\t\t\tts += '\\n\\t}[];';\r\n\t\t\t}\r\n\t\t\tts += '\\n}';\r\n\t\t}\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildBook = (book: Book):string => {\r\n\t\tlet {sName} = book;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqBook<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildBookInterface = (book: Book):string => {\r\n\t\tlet {sName, fields, returns} = book;\r\n\t\tlet ts = `export interface Param${capitalCase(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += this.buildReturns(book, returns);\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildMap = (map: Map):string => {\r\n\t\tlet {sName} = map;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqMap;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildMapInterface = (map: Map):string => {\r\n\t\t/*\r\n\t\tlet {sName, fields, returns} = map;\r\n\t\tlet ts = `export interface Param${capitalCaseString(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += buildReturns(map, returns);\r\n\t\treturn ts;\r\n\t\t*/\r\n\t\treturn '';\r\n\t}\r\n\r\n\tprivate buildHistory = (history: History):string => {\r\n\t\tlet {sName} = history;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqHistory<Param${capitalCase(sName)}, Result${capitalCase(sName)}>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildHistoryInterface = (history: History):string => {\r\n\t\tlet {sName, fields, returns} = history;\r\n\t\tlet ts = `export interface Param${capitalCase(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += this.buildReturns(history, returns);\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildPending = (pending: Pending):string => {\r\n\t\tlet {sName} = pending;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqPending<any, any>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildPendingInterface = (pending: Pending):string => {\r\n\t\t/*\r\n\t\tlet {sName, fields, returns} = pending;\r\n\t\tlet ts = `export interface Param${capitalCaseString(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += '\\n}\\n';\r\n\t\tts += buildReturns(pending, returns);\r\n\t\treturn ts;\r\n\t\t*/\r\n\t\treturn '';\r\n\t}\r\n\r\n\tprivate buildID = (id: ID):string => {\r\n\t\tlet {sName} = id;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqID<any>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIDX = (idx: IDX):string => {\r\n\t\tlet {sName} = idx;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqIDX<any>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIX = (ix: IX):string => {\r\n\t\tlet {sName} = ix;\r\n\t\tlet ts = `\\t${entityName(sName)}: UqIX<any>;`;\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIDInterface = (idEntity: ID):string => {\r\n\t\tlet {sName, fields, schema} = idEntity;\r\n\t\tlet {keys:schemaKeys} = schema;\r\n\t\tlet keys:Field[] = [], others:Field[] = [];\r\n\t\tfor (let f of fields) {\r\n\t\t\tlet {name} = f;\r\n\t\t\tif (name === 'id') continue;\r\n\t\t\tif ((schemaKeys as any[]).find(v => v.name === name)) keys.push(f);\r\n\t\t\telse others.push(f);\r\n\t\t}\r\n\t\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\t\tts += `\\n\\tid?: number;`;\r\n\t\tts += this.buildFields(keys, true);\r\n\t\tts += this.buildFields(others, true);\r\n\t\tts += '\\n}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIDXInterface = (idx: IDX):string => {\r\n\t\tlet {sName, fields, schema} = idx;\r\n\t\tlet {exFields} = schema;\r\n\t\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\t\tlet indent = 1;\r\n\t\tfor (let field of fields) {\r\n\t\t\tlet {name, type} = field;\r\n\t\t\tlet s = fieldTypeMap[type];\r\n\t\t\tif (!s) s = 'any';\r\n\t\t\tts += `\\n${'\\t'.repeat(indent)}${name}`;\r\n\t\t\tif (name !== 'id') ts += '?';\r\n\t\t\tts += `: ${s};`;\r\n\t\t}\r\n\r\n\t\tts += `\\n\\t$act?: number;`;\r\n\r\n\t\tlet hasTrack:boolean = false;\r\n\t\tlet hasMemo:boolean = false;\r\n\t\tif (exFields) {\r\n\t\t\tfor (let exField of exFields) {\r\n\t\t\t\tlet {track, memo} = exField;\r\n\t\t\t\tif (track === true) hasTrack = true;\r\n\t\t\t\tif (memo === true) hasMemo = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (hasTrack === true) {\r\n\t\t\tts += `\\n\\t$track?: number;`;\r\n\t\t}\r\n\t\tif (hasMemo === true) {\r\n\t\t\tts += `\\n\\t$memo?: string;`;\r\n\t\t}\r\n\t\tts += '\\n}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIDXActParamInterface = (idx: IDX):string => {\r\n\t\tlet {sName, fields, schema} = idx;\r\n\t\tlet {exFields} = schema;\r\n\t\tlet ts = `export interface ActParam${capitalCase(sName)} {`;\r\n\t\tlet indent = 1;\r\n\t\tfor (let field of fields) {\r\n\t\t\tlet {name, type} = field;\r\n\t\t\tlet s = fieldTypeMap[type];\r\n\t\t\tif (!s) s = 'any';\r\n\t\t\tts += `\\n${'\\t'.repeat(indent)}${name}`;\r\n\t\t\tif (name !== 'id') ts += '?';\r\n\t\t\tts += `: ${s}|IDXValue;`;\r\n\t\t}\r\n\r\n\t\tts += `\\n\\t$act?: number;`;\r\n\r\n\t\tlet hasTrack:boolean = false;\r\n\t\tlet hasMemo:boolean = false;\r\n\t\tif (exFields) {\r\n\t\t\tfor (let exField of exFields) {\r\n\t\t\t\tlet {track, memo} = exField;\r\n\t\t\t\tif (track === true) hasTrack = true;\r\n\t\t\t\tif (memo === true) hasMemo = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (hasTrack === true) {\r\n\t\t\tts += `\\n\\t$track?: number;`;\r\n\t\t}\r\n\t\tif (hasMemo === true) {\r\n\t\t\tts += `\\n\\t$memo?: string;`;\r\n\t\t}\r\n\t\tts += '\\n}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildIXInterface = (ix: IX):string => {\r\n\t\tlet {sName, fields} = ix;\r\n\t\tlet ts = `export interface ${capitalCase(sName)} {`;\r\n\t\tts += this.buildFields(fields);\r\n\t\tts += '\\n}';\r\n\t\treturn ts;\r\n\t}\r\n\r\n\tprivate buildActsInterface(uq: UqMan) {\r\n\t\tlet ts = `\\nexport interface ParamActs {`;\r\n\t\tuq.idArr.forEach(v => {\r\n\t\t\tlet {sName} = v;\r\n\t\t\tts += `\\n\\t${camelCase(sName)}?: ${capitalCase(sName)}[];`;\r\n\t\t});\r\n\t\tuq.idxArr.forEach(v => {\r\n\t\t\tlet {sName} = v;\r\n\t\t\tts += `\\n\\t${camelCase(sName)}?: ActParam${capitalCase(sName)}[];`;\r\n\t\t});\r\n\t\tuq.ixArr.forEach(v => {\r\n\t\t\tlet {sName} = v;\r\n\t\t\tts += `\\n\\t${camelCase(sName)}?: ${capitalCase(sName)}[];`;\r\n\t\t});\r\n\t\tts += '\\n}\\n';\r\n\t\treturn ts;\r\n\t}\r\n}","import * as React from 'react';\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { Page, ItemSchema, UiSchema, StringSchema, UiTextItem, Edit, ImageSchema, UiImageItem } from '../components';\r\nimport { tonva } from 'tonva-core';\r\n\r\nexport class EditMeInfo extends React.Component {\r\n    private schema:ItemSchema[] = [\r\n        {name:'nick', type:'string'} as StringSchema,\r\n        {name:'icon', type:'image'} as ImageSchema\r\n    ];\r\n    private uiSchema:UiSchema = {\r\n        items: {\r\n            nick: {widget:'text', label:'别名', placeholder:'好的别名更方便记忆'} as UiTextItem,\r\n            icon: {widget:'image', label:'头像'} as UiImageItem,\r\n        }\r\n    }\r\n    data:any;\r\n\r\n    constructor(props:any) {\r\n        super(props);\r\n\t\tmakeObservable(this, {\r\n\t\t\tdata: observable,\r\n\t\t})\r\n        let {nick, icon} = tonva.user;\r\n        this.data = {\r\n            nick: nick,\r\n            icon: icon,\r\n        }\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema:ItemSchema, newValue:any, preValue:any) => {\r\n        //let {name} = itemSchema;        \r\n        //await userApi.userSetProp(name, newValue);\r\n        throw new Error('await userApi.userSetProp(name, newValue);');\r\n        /*\r\n        this.data[name] = newValue;\r\n        let user:any = nav.user;\r\n        user[name] = newValue;\r\n        nav.saveLocalUser();\r\n        */\r\n    }\r\n\r\n    render() {\r\n        return <Page header=\"个人信息\">\r\n            <Edit schema={this.schema} uiSchema={this.uiSchema}\r\n                data={this.data}\r\n                onItemChanged={this.onItemChanged} />\r\n        </Page>;\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { Page, LMR } from \"../components\";\r\nimport { VPage } from '../vm';\r\n//import { appInFrame } from '../net';\r\nimport { CAppBase } from \"./CAppBase\";\r\n//import { UQsMan } from '../uq';\r\n\r\n/*\r\nexport class VAppMain extends VPage<CMainBase> {\r\n    async open(param?:any) {\r\n        this.openPage(this.appPage);\r\n    }\r\n\r\n    render(param?:any) {\r\n        return this.appContent();\r\n    }\r\n\r\n    protected appPage = () => {\r\n        let {caption} = this.controller;\r\n        return <Page header={caption} logout={async()=>{appInFrame.unit = undefined}}>\r\n            {this.appContent()}\r\n        </Page>;\r\n    }\r\n\r\n    protected appContent = () => {\r\n        let {cUqArr} = this.controller;\r\n        let content:any;\r\n        if (cUqArr.length === 0) {\r\n            content = <div className=\"text-danger\">\r\n                <FA name=\"\" /> 此APP没有绑定任何的UQ\r\n            </div>;\r\n        }\r\n        else {\r\n            content = cUqArr.map((v,i) => <div key={i}>{v.render()}</div>);\r\n        }\r\n        return <>{content}</>;\r\n    };\r\n}\r\n*/\r\nexport class VUnsupportedUnit extends VPage<CAppBase<any>> {\r\n\tprivate params: {predefinedUnit:number, uqsLoadErrors:string[]};\r\n    async open(params: {predefinedUnit:number, uqsLoadErrors:string[]}) {\r\n\t\tthis.params = params;\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = () => {\r\n\t\tlet {predefinedUnit, uqsLoadErrors} = this.params;\r\n        let {user} = this.tonva;\r\n\t\tlet userName:string = user? user.name : '[未登录]';\r\n\t\t//let {appOwner, appName} = UQsMan.value;\r\n        return <Page header=\"APP无法运行\" logout={true}>\r\n            <div className=\"m-3 text-danger container\">\r\n                <div className=\"mb-3 row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">登录用户</div>\r\n                    <div className=\"col-sm text-body\">{userName}</div>\r\n                </div>\r\n                <div className=\"mb-3 row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">预设小号</div>\r\n                    <div className=\"col-sm text-body\">{predefinedUnit || <small className=\"\">[无预设小号]</small>}</div>\r\n                </div>\r\n\t\t\t\t{\r\n\t\t\t\t\tuqsLoadErrors && uqsLoadErrors.map(v => {\r\n\t\t\t\t\t\treturn <div className=\"mb-3 row\">\r\n\t\t\t\t\t\t\t<div className=\"col-sm-3 font-weight-bold\">App</div>\r\n\t\t\t\t\t\t\t<div className=\"col-sm text-body\">{v}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n                <div className=\"mb-3 row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">小号{predefinedUnit}</div>\r\n                    <div className=\"col-sm text-body\">\r\n                        预设小号定义在 public/unit.json 文件中。\r\n                        定义了这个文件的程序，只能由url直接启动。\r\n                        用户第一次访问app之后，会缓存在localStorage里。<br/>\r\n                        如果要删去缓存的预定义Unit，logout然后再login。\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\t\t</Page>;\t\t\r\n\t}\r\n\t/*\r\n\t<div className=\"mb-3 row\">\r\n\t\t<div className=\"col-sm-3 font-weight-bold\">\r\n\t\t\t可能原因<FA name=\"exclamation-triangle\" />\r\n\t\t</div>\r\n\t\t<div className=\"col-sm text-body\">\r\n\t\t\t<ul className=\"p-0\">\r\n\t\t\t\t<li>没有小号运行 {appName}</li>\r\n\t\t\t\t<li>用户 <b>{userName}</b> 没有加入任何一个运行{appName}的小号</li>\r\n\t\t\t\t{\r\n\t\t\t\t\tpredefinedUnit && \r\n\t\t\t\t\t<li>预设小号 <b>{predefinedUnit}</b> 没有运行App {appName}</li>\r\n\t\t\t\t}\r\n\t\t\t</ul>\r\n\t\t</div>\r\n\t</div>\r\n\t*/\r\n}\r\n\r\nexport class VUnitSelect extends VPage<CAppBase<any>> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderRow = (item: any, index: number):JSX.Element => {\r\n        let {id, nick, name} = item;\r\n        return <LMR className=\"px-3 py-2\" right={'id: ' + id}>\r\n            <div>{nick || name}</div>\r\n        </LMR>;\r\n    }\r\n    private onRowClick = async (appUnit: any) => {\r\n\t\t//appInFrame.unit = appUnit.id; // 25;\r\n\t\t//this.controller.setAppUnit(appUnit);\r\n        await this.controller.start();\r\n    }\r\n\r\n    private page = () => {\r\n        return <Page header=\"选择小号\" logout={true}>\r\n\t\t\t<div>this.controller.appUnits appUnits removed</div>\r\n        </Page>\r\n        // <List items={this.controller.appUnits} item={{render: this.renderRow, onClick: this.onRowClick}}/>\r\n\t}\r\n}\r\n\r\nexport class VErrorsPage extends VPage<CAppBase<any>> {\r\n    async open(errors:string[]) {\r\n        this.openPage(this.page, {errors:errors});\r\n    }\r\n\r\n    private page = (errors:{errors:string[]}) => {\r\n        return <Page header=\"ERROR\">\r\n            <div className=\"m-3\">\r\n\t\t\t\t<div className=\"p-3 d-flex justify-content-center align-items-center\">\r\n\t\t\t\t\t<button className=\"btn btn-danger\" onClick={this.tonva.resetAll}>重启网页</button>\r\n\t\t\t\t</div>\r\n\r\n                <div>Load Uqs 发生错误：</div>\r\n                {errors.errors.map((r, i) => <div key={i}>{r}</div>)}\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class VStartError extends VPage<CAppBase<any>> {\r\n    async open(error:any) {\r\n        this.openPage(this.page, {error});\r\n    }\r\n\r\n    private page = ({error}:{error:any}) => {\r\n        return <Page header=\"App start error!\">\r\n            <pre>\r\n                {typeof error === 'string'? error : error.message}\r\n            </pre>\r\n        </Page>;\r\n    }\r\n}","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { /*ParamActDetail, ParamActDetail2, ParamActDetail3, ParamActIX\r\n    , ParamActIXSort, ParamID, ParamIDDetailGet, ParamIDinIX, ParamIDLog\r\n    , ParamIDNO, ParamIDSum, ParamIDTree, ParamIDxID, ParamIX, ParamKeyID\r\n    , ParamKeyIX, ParamQueryID, RetActDetail, RetActDetail2, RetActDetail3\r\n    , Uq, */UqMan } from \"tonva-core\";\r\n\r\nexport class Uq {\r\n    private $_uqMan: UqMan;\r\n    constructor(uqMan: UqMan) {\r\n        this.$_uqMan = uqMan;\r\n    }\r\n\r\n    $_createProxy() {\r\n\t\tlet ret = new Proxy(this.$_uqMan.entities, {\r\n\t\t\tget: (target, key, receiver) => {\r\n\t\t\t\tlet lk = (key as string).toLowerCase();\r\n\t\t\t\tif (lk === '$') {\r\n\t\t\t\t\treturn this;\r\n\t\t\t\t}\r\n\t\t\t\tlet ret = target[lk];\r\n\t\t\t\tif (ret !== undefined) return ret;\r\n\t\t\t\tlet func = (this.$_uqMan as any)[key];\r\n\t\t\t\tif (func !== undefined) return func;\r\n\t\t\t\tlet err = `entity ${this.$_uqMan.name}.${String(key)} not defined`;\r\n\t\t\t\tconsole.error('UQ错误：' + err);\r\n\t\t\t\tthis.showReload('服务器正在更新');\r\n\t\t\t\treturn undefined;\r\n\t\t\t}\r\n\t\t});\r\n\t\t//this.proxy = ret;\r\n\t\t//this.idCache = new IDCache(this.proxy);\r\n\t\treturn ret;\r\n    }\r\n\r\n    private showReload(msg: string) {\r\n        console.error('uq proxy error name', msg);\r\n        /*\r\n\t\tlet cache = this.localMap.child('$reload-tick');\r\n\t\tlet reloadTick = cache.get();\r\n\t\tif (!reloadTick) reloadTick = 0;\r\n\t\tconsole.error(msg);\r\n\t\tthis.localMap.removeAll();\r\n\t\tlet tick = Date.now();\r\n\t\tcache.set(tick);\r\n\t\tif (tick - reloadTick  < 10*1000)  {\r\n\t\t\tthis.web.showReloadPage(msg);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.web.reload();\r\n\t\t}\r\n        */\r\n    }\r\n\r\n\t/*\r\n    IDTv(ids: number[]): Promise<any[]> {\r\n        return this.$_uqMan.IDTv(ids);\r\n    }\r\n\t*/\r\n\t\r\n\tprotected IDRender = (id: number, render?:(value:any) => JSX.Element): JSX.Element => {\r\n\t\treturn React.createElement(observer(() => {\r\n\t\t\tlet ret = this.$_uqMan.idCache.getValue(id);\r\n\t\t\tif (ret === undefined) {\r\n\t\t\t\treturn React.createElement('span', {props:{className: 'text-muted'},  children: ['id='+id]});\r\n\t\t\t}\r\n\t\t\tlet {$type} = ret as any;\r\n\t\t\tif (!$type) return this.renderIDUnknownType(id);\r\n\t\t\tlet IDType = this.$_uqMan.ids[$type];\r\n\t\t\tif (!IDType) return this.renderIDUnknownType(id);\r\n\t\t\treturn (render ?? (IDType as any).render)(ret);\r\n\t\t}));\r\n\t}\r\n\r\n\tprotected IDV = <T extends object>(id: number): T => {\r\n\t\tlet ret = this.$_uqMan.idCache.getValue(id);\r\n\t\treturn ret as T;\r\n\t}\r\n\r\n\tprivate renderIDUnknownType(id: number) {\r\n\t\treturn React.createElement('span', {props:{className: 'text-muted'},  children: [`id=${id} type undefined`]});\r\n\t}\r\n\t/*\r\n\tIDLocalTv(ids: number[]): Promise<any[]> {\r\n\t\treturn this.IDTv(ids.map(v => -v));\r\n\t}\r\n\t*/\r\n\tprotected IDLocalV = <T extends object>(id: number): T => {\r\n\t\treturn this.IDV(-id);\r\n\t}\r\n\r\n\tprotected IDLocalRender = (id: number, render?:(value:any) => JSX.Element): JSX.Element => {\r\n\t\treturn this.IDRender(-id, render);\r\n\t}\r\n}","import { observer } from \"mobx-react\";\r\nimport { UQsMan, TuidInner, uqStringify, TuidImport } from \"tonva-core\";\r\nimport { Render } from \"../ui\";\r\nimport { Uq } from \"./Uq\";\r\n\r\nexport function createUQsProxy(uqsMan: UQsMan) {\r\n    buildTuidTv();\r\n    const uqReacts: {[key:string]:any} = {};\r\n    function setUq(uqKey: string, proxy: any):void {\r\n        if (!uqKey) return;\r\n        let lower = uqKey.toLowerCase();\r\n        uqReacts[uqKey] = proxy;\r\n        if (lower !== uqKey) uqReacts[lower] = proxy;\r\n    }\r\n    for (let uqMan of uqsMan.uqMans) {\r\n        let uqReact = new Uq(uqMan);\r\n        let proxy = uqReact.$_createProxy();\r\n        setUq(uqMan.getUqKey(), proxy);\r\n        setUq(uqMan.getUqKeyWithConfig(), proxy);\r\n    }\r\n    function onUqProxyError(key: string) {\r\n\t\tfor (let i in uqReacts) {\r\n\t\t\tlet uqReact = uqReacts[i];\r\n            uqReact.localMap.removeAll();\r\n\t\t}\r\n        //this.web.showReloadPage(msg);\r\n        console.error(`uq proxy ${key} error`);\r\n    }\r\n    return new Proxy(uqReacts, {\r\n        get: (target, key, receiver) => {\r\n            let lk = (key as string).toLowerCase();\r\n            let ret = target[lk];\r\n            if (ret !== undefined) return ret;\r\n            debugger;\r\n            console.error(`controller.uqs.${String(key)} undefined`);\r\n            onUqProxyError(String(key));\r\n            return undefined;\r\n        },\r\n    });\r\n}\r\n\r\nfunction buildTuidTv() {\r\n    (TuidInner.prototype as any).tv = function(this:any, id:number, render?:Render<any>):JSX.Element {\r\n        const TuidView = observer(() => {\r\n\t\t\tlet obj = this.valueFromId(id);\r\n\t\t\tif (obj === undefined) {\r\n\t\t\t\tthis.useId(id);\r\n\t\t\t\treturn <>{this.sName}:{id}</>;\r\n\t\t\t}\r\n            let r: Render<any>;\r\n            if (render) {\r\n                r = render;\r\n            }\r\n            else if (this.render) {\r\n                r = this.render;\r\n            }\r\n            else {\r\n                console.log('render', render, 'this.render', this.render);\r\n                r = (item:any) => {\r\n                    return <>{this.sName}:{uqStringify(item)}</>;\r\n                };\r\n            }\r\n\t\t\treturn r(obj);\r\n\t\t});\r\n\t\treturn <><TuidView /></>;\r\n\t};\r\n\r\n    (TuidImport.prototype as any).tv = function(this:any, id:number, render?:Render<any>):JSX.Element {\r\n\t\treturn this.tuidLocal?.tv(id, render);\r\n    };\r\n}\r\n","import { /*centerApi, logoutApis, */AppConfig as AppConfigCore, Tonva, Web } from \"tonva-core\";\r\nimport { User, UqsConfig as UqsConfigCore  } from 'tonva-core';\r\nimport { RouteFunc, Hooks, Navigo, NamedRoute } from \"tonva-core\";\r\nimport { UQsLoader, UQsMan } from \"tonva-core\";\r\nimport { setGlobalRes } from 'tonva-core';\r\nimport { ControllerWithWeb } from '../vm';\r\nimport { VErrorsPage, VStartError } from \"./vMain\";\r\nimport { createUQsProxy } from \"../uq\";\r\nimport { t } from \"../ui\";\r\n\r\nexport interface IConstructor<T> {\r\n    new (...args: any[]): T;\r\n}\r\n/*\r\nexport interface DevConfig {\r\n\tname: string;\r\n\talias?: string;\r\n\tmemo?: string;\r\n}\r\n\r\nexport interface UqConfig {\r\n\tdev: DevConfig;\r\n\tname: string;\r\n\talias?: string;\t\r\n\tversion?: string;\r\n\tmemo?: string;\r\n}\r\n\r\nexport interface UqsConfig {\r\n\tapp?: {\r\n\t\tdev: DevConfig;\r\n\t\tname: string;\r\n\t\tversion?: string;\r\n\t};\r\n\tuqs?: UqConfig[];\r\n}\r\n*/\r\n\r\nexport type UqsConfig = UqsConfigCore;\r\nexport interface AppConfig extends AppConfigCore /*UqsConfig*/ {\r\n\t/*\r\n\tapp?: {\r\n\t\tname: string;\r\n\t\tversion: string;\r\n\t\townerMap?: {[key:string]: string};\r\n\t};\r\n\t*/\r\n    //appName: string;        // 格式: owner/appName\r\n    version: string;        // 版本变化，缓存的uqs才会重载\r\n    //tvs?: TVs;\r\n    //uqNameMap?: {[uqName:string]: string};      // uqName='owner/uq' 映射到内存简单名字：uq, 可以注明映射，也可以自动。有可能重\r\n    loginTop?: JSX.Element;\r\n    oem?: string;               // 用户注册发送验证码的oem厂家，默认同花\r\n\tprivacy?: string;\r\n\tnoUnit?: boolean;\t\t\t// app的运行，不跟unit绑定\r\n\thtmlTitle?: string;\r\n}\r\n\r\nexport interface Elements {\r\n\t[id:string]: (element: HTMLElement)=>void,\r\n}\r\n\r\nexport abstract class CAppBase<U> extends ControllerWithWeb {\r\n\tprivate appConfig: AppConfig;\r\n\tprivate uqsMan: UQsMan;\r\n    protected _uqs: U;\r\n\treadonly web: Web;\r\n\t//readonly nav: Nav;\r\n\ttimezone: number;\r\n\tunitTimezone: number;\r\n\r\n    constructor(tonva: Tonva, config?: AppConfig) {\r\n\t\tsuper(tonva);\r\n\t\tthis.web = tonva.web;\r\n\t\t//this.nav = new Nav(tonva); // nav;\r\n\t\tthis.appConfig = config || (tonva.navSettings as AppConfig);\r\n\t\tif (this.appConfig) {\r\n\t\t\tlet {app, uqs} = this.appConfig;\r\n\t\t\tif (app === undefined && uqs === undefined) {\r\n\t\t\t\tthrow new Error('app or uqs must be defined in AppConfig');\r\n\t\t\t}\r\n\t\t}\r\n    }\r\n\r\n    get uqs(): U {return this._uqs;}\r\n\r\n\tinternalT(str:string):any {\r\n\t\treturn t(str);\r\n\t}\r\n\t\r\n\tsetRes(res:any) {\r\n\t\tsetGlobalRes(res);\r\n\t}\r\n\tprotected afterBuiltUQs(uqs: any) {}\r\n\r\n\tprivate uqsUser: any = '';\r\n\tprotected async initUQs():Promise<any> {\r\n\t\tif (!this.appConfig) return;\r\n\t\tlet {user} = this.tonva;\r\n\t\tif (user === this.uqsUser) return;\r\n\t\tthis.uqsUser = user;\r\n\t\tthis.web.logoutApis();\r\n\t\tlet uqsLoader = new UQsLoader(this.tonva, this.appConfig);\r\n\t\tlet retErrors = await uqsLoader.build();\r\n\t\tthis.uqsMan = uqsLoader.uqsMan;\r\n\t\tthis._uqs = createUQsProxy(uqsLoader.uqsMan) as any; //  this.uqsMan.proxy;\r\n\t\tthis.afterBuiltUQs(this._uqs);\r\n\t\treturn retErrors;\r\n\t}\r\n\r\n    protected async beforeStart():Promise<boolean> {\r\n        try {\r\n\t\t\tthis.onNavRoutes();\r\n\t\t\tlet retErrors = await this.initUQs();\r\n            if (retErrors !== undefined) {\r\n                this.openVPage(VErrorsPage, retErrors);\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n        catch (err) {\r\n            this.openVPage(VStartError, err);\r\n            return false;\r\n        }\r\n    }\r\n\tprotected async afterStart():Promise<void> {\r\n\t\tthis.tonva.resolveRoute();\r\n\t\tthis.tonva.onChangeLogin = (user:User) => this.onChangeLogin(user);\r\n\t\tthis.onChangeLogin(this.user);\r\n\t}\r\n\r\n    async userFromId(userId:number):Promise<any> {\r\n        return await this.web.centerApi.userFromId(userId);\r\n    }\r\n\r\n\tprotected on(routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(url:string, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(regex:RegExp, routeFunc:RouteFunc, hooks?:Hooks):Navigo;\r\n\tprotected on(options: {[url:string]: RouteFunc|NamedRoute}):Navigo;\r\n\tprotected on(...args:any[]):Navigo {\r\n\t\treturn this.tonva.on(args[0], args[1], args[2]);\r\n\t}\r\n\r\n\tprotected onNavRoutes() {return;}\r\n\r\n\tasync getUqRoles(uqName:string):Promise<string[]> {\r\n\t\tlet {user} = this.tonva;\r\n\t\tif (!user) return null;\r\n\t\tlet {roles:userRoles} = user;\r\n\t\tlet uq = uqName.toLowerCase();\r\n\t\tlet roles:string[];\r\n\t\tif (userRoles) {\r\n\t\t\troles = userRoles[uq];\r\n\t\t}\r\n\t\tif (roles) return roles;\r\n\r\n\t\troles = await this.uqsMan.getUqUserRoles(uq);\r\n\t\tif (!roles) roles = null;\r\n\t\tthis.tonva.setUqRoles(uq, roles);\r\n\t\treturn roles;\r\n\t}\r\n\r\n\tisAdmin(roles:string[]):boolean {\r\n\t\treturn this.isRole(roles, '$');\r\n\t}\r\n\r\n\tisRole(roles:string[], role:string):boolean {\r\n\t\tif (!roles) return false;\r\n\t\trole = role.toLowerCase();\r\n\t\treturn roles.indexOf(role) >= 0;\r\n\t}\r\n\r\n\tprotected onChangeLogin(user: User):Promise<void> {\r\n\t\treturn;\r\n\t}\r\n}\r\n","import { Tonva } from 'tonva-core';\r\nimport { AppConfig, CAppBase } from './CAppBase';\r\n\r\nexport async function start(CApp: new (tonva: Tonva, config: AppConfig) => CAppBase<any>, tonva: Tonva, appConfig: AppConfig, isUserLogin?:boolean) {\r\n\tif (appConfig) {\r\n\t\tlet {htmlTitle} = appConfig;\r\n\t\tif (htmlTitle) {\r\n\t\t\tdocument.title = htmlTitle;\r\n\t\t}\r\n\t\tlet html = document.getElementsByTagName('html');\r\n\t\tlet html0 = html[0];\r\n\t\tif (html0) {\r\n\t\t\tlet version = html0?.getAttribute('data-version');\r\n\t\t\tif (version) {\r\n\t\t\t\t//appConfig.version = version;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tlet cApp = new CApp(tonva, appConfig);\r\n    await cApp.start(isUserLogin);\r\n}\r\n","import { Web } from 'tonva-core';\r\nimport { ControllerWithWeb, WebNav } from \"../vm\";\r\nimport { CAppBase, IConstructor } from \"./CAppBase\";\r\n\r\nexport abstract class CBase<A extends CAppBase<U>, U> extends ControllerWithWeb {\r\n    constructor(cApp: A) {\r\n        super(cApp.getTonva());\r\n        this.cApp = cApp;\r\n\t\tif (cApp) {\r\n\t\t\tlet {uqs, web} = cApp;\r\n\t\t\tthis.uqs = uqs;\r\n\t\t\tthis.web = web;\r\n\t\t\t//this.nav = nav;\r\n\t\t}\r\n\t}\r\n\r\n    readonly cApp: A;\r\n    readonly uqs: U;\r\n\treadonly web: Web;\r\n\t//readonly nav: Nav;\r\n    //get uqs(): U {return this._uqs}\r\n\t//get cApp(): A {return this._cApp}\r\n\tget timezone():number {return this.cApp.timezone;}\r\n\tget unitTimezone():number {return this.cApp.unitTimezone;}\r\n\tasync getUqRoles(uqName:string):Promise<string[]> {\r\n\t\treturn this.cApp?.getUqRoles(uqName);\r\n\t}\r\n\r\n\tprotected async internalStart(param?:any, ...params:any[]):Promise<void> {}\r\n\r\n\tinternalT(str:string):any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r!==undefined) return r;\r\n\t\treturn this.cApp.internalT(str);\r\n\t}\r\n\r\n    protected newC<T extends CBase<A,U>>(type: IConstructor<T>, ...param:any[]):T {\r\n\t\tlet c = new type(this.cApp);\r\n\t\tc.internalInit(...param);\r\n\t\treturn c;\r\n    }\r\n\r\n    newSub<O extends CBase<A,U>, T extends CSub<A,U,O>>(type: IConstructor<T>, ...param:any[]):T {\r\n\t\tlet s = new type(this);\r\n\t\ts.internalInit(...param);\r\n\t\treturn s;\r\n\t}\r\n\t\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this.cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ret = Object.assign({}, wn);\r\n\t\tObject.assign(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\nexport abstract class CSub<A extends CAppBase<U>, U, T extends CBase<A, U>> extends CBase<A,U> {\r\n    protected _owner: T;\r\n\r\n    constructor(owner: T) {\r\n        super(owner.cApp);\r\n        this._owner = owner;\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r!==undefined) return r;\r\n\t\treturn this._owner.internalT(str);\r\n\t}\r\n\r\n    protected get owner(): T {return this._owner}\r\n\t\r\n\tgetWebNav(): WebNav<any> {\r\n\t\tlet wn = this.cApp?.getWebNav();\r\n\t\tif (wn === undefined) return;\r\n\t\tlet ownerWNs:WebNav<any>[] = [];\r\n\t\tfor (let p = this.owner; p!==undefined; p = (p as any)?.owner) {\r\n\t\t\townerWNs.push(p.webNav);\r\n\t\t}\r\n\t\tlet ret = Object.assign({}, wn);\r\n\t\tfor (;;) {\r\n\t\t\tlet own = ownerWNs.pop();\r\n\t\t\tif (own === undefined) break;\r\n\t\t\tObject.assign(ret, own);\r\n\t\t}\r\n\t\tObject.assign(ret, this.webNav);\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import { Web } from \"tonva-core\";\r\n//import { nav } from '../nav';\r\n\r\nexport class WebReact extends Web {\r\n    /*\r\n    async navInit(): Promise<void> {\r\n        await nav.init();\r\n    }\r\n    */\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n//import { nav } from '../nav';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { tonva, User, Web } from 'tonva-core';\r\n\r\nexport type UserLoader = (userId:number)=>Promise<any>;\r\n\r\nexport class UserCache<T> {\r\n\tprivate readonly web:Web;\r\n\tprivate readonly loader: UserLoader;\r\n\tprivate onLoaded: (user:User) => void;\r\n\tprivate map = observable(new Map<number, T|number>());\r\n\r\n\tconstructor(web:Web, loader: UserLoader) {\r\n\t\tthis.web = web;\r\n\t\tif (loader === undefined) loader = (userId:number)=> this.web.userApi.user(userId);\r\n\t\tthis.loader = loader;\r\n\t}\r\n\r\n\tuse(id:number|any, onLoaded?:(user:User)=>void) {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tif (!id) return;\r\n\t\tthis.onLoaded = onLoaded;\r\n\t\tid = Number(id);\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (ret === undefined) {\r\n\t\t\tthis.map.set(id, id);\r\n\t\t}\r\n\t}\r\n\r\n\tgetValue(id:number|any):any {\r\n\t\tif (!id) return;\r\n\t\tswitch (typeof(id)) {\r\n\t\t\tcase 'object': \r\n\t\t\t\tid = id.id; \r\n\t\t\t\tif (!id) return;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (!ret) return;\r\n\t\tswitch (typeof(ret)) {\r\n\t\tdefault:\r\n\t\t\treturn ret;\r\n\t\tcase 'number':\r\n\t\t\tif (ret < 0) return id;\r\n\t\t\tthis.map.set(id, -id);\r\n\t\t\tthis.loader(id).then(v => {\r\n\t\t\t\tif (!v) v = null;\r\n\t\t\t\tthis.map.set(id, v);\r\n\t\t\t\tif (this.onLoaded) this.onLoaded(v);\r\n\t\t\t}).catch(reason => {\r\n\t\t\t\tconsole.error(reason);\r\n\t\t\t});\r\n\t\t\treturn id;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nlet staticUserCache: UserCache<any>;\r\nfunction getUserCache(web: Web) {\r\n\tif (staticUserCache === undefined) {\r\n\t\tstaticUserCache = new UserCache(web, undefined);\r\n\t}\r\n\treturn staticUserCache;\r\n}\r\n\r\nexport interface UserIconProps {\r\n\tweb: Web;\r\n    id: number;\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n    altImage?: string;\r\n    noneImage?: any;\r\n}\r\n\r\nexport const UserIcon = observer((props: UserIconProps):JSX.Element => {\r\n    let {className, style, id, altImage, noneImage} = props;\r\n\tlet userCache = getUserCache(props.web);\r\n    let user = userCache.getValue(id);\r\n    switch (typeof user) {\r\n\tcase 'undefined':\r\n\tcase 'number':\r\n        return <div className={classNames(className, 'image-none')} style={style}>\r\n            {noneImage || <i className=\"fa fa-file-o\" />}\r\n        </div>;\r\n    }\r\n    let {icon} = user;\r\n    if (!icon) {\r\n        return <div className={classNames(className, 'image-none')} style={style}>\r\n            <i className=\"fa fa-file-o\" />\r\n        </div>;\r\n    }\r\n    if (icon.startsWith(':') === true) {\r\n        icon = tonva.resUrl + icon.substr(1);\r\n    }\r\n    return <img src={icon} className={className} alt=\"img\"\r\n        style={style}\r\n        onError={evt=>{\r\n            if (altImage) evt.currentTarget.src=altImage;\r\n            else evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n        }} />;\r\n});\r\n\r\nexport interface UserViewProps {\r\n\tweb: Web;\r\n\tid?: number;\r\n\tuser?: number|User;\r\n\trender: (user:User) => JSX.Element;\r\n\tonLoaded?: (user:User) => void\r\n}\r\n\r\nexport const UserView = observer((props: UserViewProps):JSX.Element => {\r\n\tlet {web, id:idProp, user, render, onLoaded} = props;\r\n\tif (user === null) return <>null</>;\r\n\tlet userCache = getUserCache(web);\r\n\tswitch (typeof user) {\r\n\t\tcase 'undefined': \r\n\t\t\tuser = userCache.getValue(idProp);\r\n\t\t\tbreak;\r\n\t\tcase 'object': \r\n\t\t\tlet {/*obj, */id} = user as any;\r\n\t\t\t//if (typeof obj !== 'object') {\r\n\t\t\t\tuseUser(web, id, onLoaded);\r\n\t\t\t\tuser = userCache.getValue(id);\r\n\t\t\t//}\r\n\t\t\tbreak;\r\n\t\tcase 'number':\r\n\t\t\tuseUser(web, user as number, onLoaded);\r\n\t\t\tuser = userCache.getValue(user as number);\r\n\t\t\tbreak;\r\n\t\tcase 'string':\r\n\t\t\tuseUser(web, Number(user), onLoaded);\r\n\t\t\tuser = userCache.getValue(Number(user));\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tuser = undefined;\r\n\t\t\tbreak;\r\n\t}\r\n    switch (typeof user) {\r\n\t\tcase 'undefined':\r\n\t\tcase 'number':\r\n        \treturn <>{user}</>;\r\n    }\r\n    return render(user);\r\n});\r\n\r\nexport function useUser(web: Web, id: number|object, onLoaded?: (user:User)=>void) {\r\n\tif (!id) return;\r\n\tif (typeof(id) === 'object') {\r\n\t\tid = (id as any).id;\r\n\t}\r\n\tlet userCache = getUserCache(web);\r\n\tuserCache.use(id, onLoaded);\r\n}\r\n","import { UqBuildContext } from \"tonva-core\";\r\n\r\nexport class UqBuildContextUI extends UqBuildContext {\r\n\tget uiPlatform():string {return 'react'};\r\n\tget uiPlatformUpper():string {return 'REACT'};\r\n\tget uiPlatformCamel():string {return 'React'}\r\n    get element(): string {return 'JSX.Element'}\r\n}\r\n","import React from 'react';\r\nimport { FA, Page } from './components';\r\nimport { Controller } from \"./vm/Controller\";\r\nimport { makeObservable, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport { tonva } from 'tonva-core';\r\n\r\nexport interface CStringEditProps {\r\n\tlabel?: string;\r\n\tplaceholder?: string;\r\n\tmaxLength?: number;\r\n\tonValueChange?: (value: string) => Promise<void>;\r\n}\r\n\r\nexport class CStringEdit extends Controller {\r\n\tprivate props: CStringEditProps = {\r\n\t\tlabel: '编辑'\r\n\t}\r\n\tvalue: string = null;\r\n\tnewValue: string = null;\r\n\tisChanged: boolean = null;\r\n\terror: string = null;\r\n\r\n\tconstructor() {\r\n\t\tsuper(tonva);\r\n\t\tmakeObservable(this, {\r\n\t\t\tvalue: observable,\r\n\t\t\tnewValue: observable,\r\n\t\t\tisChanged: observable,\r\n\t\t\terror: observable,\r\n\t\t});\r\n\t}\r\n\r\n\tprotected async internalStart() {}\r\n\trender(value:string, props?:CStringEditProps) {\r\n\t\tthis.value = value;\r\n\t\tif (props) Object.assign(this.props, props);\r\n\t\treturn React.createElement(observer(()=><>{this.renderValue()}{this.renderPencil()}</>))\r\n\t}\r\n\r\n\tprotected renderValue() {return <>{this.value}</>}\r\n\tprotected renderPencil() {\r\n\t\treturn <span onClick={this.onEdit} className=\"cursor-pointer\">\r\n\t\t\t&nbsp; <FA className=\"text-info\" name=\"pencil-square-o\" /> &nbsp;\r\n\t\t</span>;\r\n\t}\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.verifyValue();\r\n\t}\r\n\t\r\n\tprotected verifyValue() {}\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n\t}\r\n\t\r\n\tprivate onEdit = () => {\r\n\t\tlet {label, maxLength, placeholder, onValueChange} = this.props;\r\n\t\tlet onSave = () => {\r\n\t\t\tthis.verifyValue();\r\n\t\t\tif (this.error === undefined) {\r\n\t\t\t\tthis.value = this.newValue;\r\n\t\t\t\tthis.closePage();\r\n\t\t\t\tif (onValueChange) onValueChange(this.value);\r\n\t\t\t}\r\n\t\t}\r\n        let right = React.createElement(observer(() => <button\r\n            className=\"btn btn-sm btn-success align-self-center me-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={onSave}>保存</button>));\r\n\t\tlet onKeyDown = (evt: React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\t\tif (evt.keyCode === 13) onSave();\r\n\t\t}\r\n\t\tthis.openPage(<Page header={label} right={right}>\r\n            <div className=\"m-3\">\r\n\t\t\t\t<input type=\"text\"\r\n\t\t\t\t\tonChange={this.onChange}\r\n\t\t\t\t\tonKeyDown={onKeyDown}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n\t\t\t\t\tclassName=\"form-control\"\r\n\t\t\t\t\tdefaultValue={this.value}\r\n\t\t\t\t\tmaxLength={maxLength} />\r\n                {\r\n\t\t\t\t\tReact.createElement(observer(()=> placeholder && <div className=\"small muted m-2\">{placeholder}</div>))                    \r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n\t\t</Page>);\r\n\t}\r\n}\r\n","import {makeObservable, observable} from 'mobx';\r\n\r\nexport interface Id {\r\n    id: number;\r\n}\r\n\r\nexport abstract class CacheIds<T extends Id> {\r\n    constructor(maxCount:number = 100) {\r\n\t\tmakeObservable(this, {\r\n\t\t\tdict: observable,\r\n\t\t})\r\n        this.maxCount = maxCount;\r\n    }\r\n    private maxCount:number;\r\n    private arr:T[] = [];\r\n    dict = new Map<number, T>();\r\n\r\n    loadIds(ids:number[]) {\r\n        let arr:number[] = [];\r\n        for (let id of ids) {\r\n            if (id === null) continue;\r\n            let item = this.dict.get(id);\r\n            if (item === undefined) {\r\n                arr.push(id);\r\n                item = {id:id} as T;\r\n                this.dict.set(id, item);\r\n            }\r\n        }                \r\n        this.loadId(arr);\r\n    }\r\n\r\n    get(id:number):T {\r\n        if (id === undefined || id === null) return null;\r\n        let item = this.dict.get(id);\r\n        if (item === undefined) {\r\n            this.dict.set(id, {id:id} as T);\r\n            this.loadId([id]);\r\n            item = this.dict.get(id);\r\n        }\r\n        return item;\r\n    }\r\n    private setItem(id:number, item:T) {\r\n        if (item === undefined) {\r\n            this.dict.set(id, null);\r\n            this.arr.push({id: id} as T);\r\n        }\r\n        else {\r\n            this.dict.set(id, item);\r\n            this.arr.push(item);\r\n        }\r\n        if (this.arr.length > this.maxCount) {\r\n            item = this.arr.shift();\r\n            this.dict.delete(item.id);\r\n        }\r\n    }\r\n    private async loadId(ids:number[]) {\r\n        let items = await this._loadIds(ids);\r\n        if (items === undefined) {\r\n            for (let id of ids) {\r\n                if (id === null) continue;\r\n                let item = await this._loadId(id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n        else {\r\n            for (let id of ids) {\r\n                let item = items.find(v => v.id === id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected abstract _loadIds(ids:number[]):Promise<T[]>;\r\n    protected abstract _loadId(id:number):Promise<T>;\r\n}\r\n","import _ from 'lodash';\r\nimport {observable, IObservableArray, computed, makeObservable, runInAction} from 'mobx';\r\nimport { IPageItems } from './IPageItems';\r\n//import { Tonva } from '../Tonva';\r\n\r\nexport abstract class PageItems<T> implements IPageItems<T> {\r\n\t//protected tonva: Tonva;\r\n    loading: boolean = false;\r\n    beforeLoad: boolean = true;\r\n    loaded: boolean = false;\r\n    _items:IObservableArray<T> = null;\r\n    allLoaded: boolean = false;\r\n    get items():IObservableArray<T> {\r\n        if (this.beforeLoad === true) return null;\r\n        if (this.loaded === false) return undefined;\r\n        return this._items;\r\n\t}\r\n    topDiv:string = '$$top';\r\n\tbottomDiv:string = '$$bottom';\r\n\r\n    constructor(itemObservable:boolean = false) {\r\n\t\t//this.tonva = tonva;\r\n\t\tmakeObservable(this, {\r\n\t\t\tloading: observable,\r\n\t\t\tbeforeLoad: observable,\r\n\t\t\tloaded: observable,\r\n\t\t\t_items: observable,\r\n\t\t\tallLoaded: observable,\r\n\t\t\titems: computed,\r\n\t\t\ttopDiv: observable,\r\n\t\t\tbottomDiv: observable,\r\n\t\t});\r\n\t\tif (itemObservable === undefined) itemObservable = false;\r\n        this._items = observable.array<T>([], {deep:itemObservable});\r\n    }\r\n\tprivate isFirst: boolean = true;\r\n\tprivate pageItemAction: (item:T, results:{[name:string]:any[]}) => void;\r\n\tprivate itemConverter: (item:any, queryResults:{[name:string]:any[]}) => T;\r\n\r\n\tsetEachPageItem(pageItemAction: (item:T, results:{[name:string]:any[]}) => void) {\r\n\t\tthis.pageItemAction = pageItemAction;\r\n\t}\r\n\r\n\tsetItemConverter(itemConverter: (item:any, queryResults:{[name:string]:any[]}) => T) {\r\n\t\tthis.itemConverter = itemConverter;\r\n\t}\r\n\r\n    scrollToTop = () => {\r\n\t\tthis.scrollIntoView(this.topDiv);\r\n\t\t//let id = '$$top'+uid();\r\n\t\t//this.topDiv = id;\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(this.topDiv);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t\t*/\r\n    }\r\n    scrollToBottom = () => {\r\n\t\tthis.scrollIntoView(this.bottomDiv);\r\n\t\t//let id = '$$bottom'+uid();\r\n\t\t//this.bottomDiv = id;\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(this.bottomDiv);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t\t*/\r\n\t}\r\n\tprivate scrollIntoView(divId:string) {\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(divId);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t}\r\n\r\n    protected param: any;\r\n    protected firstSize = 100;\r\n    protected pageStart:any = undefined;\r\n    protected pageSize = 30;\r\n    protected appendPosition:'head'|'tail' = 'tail';\r\n\r\n\tprotected sortOrder:'asc'|'desc';\r\n\tprotected abstract loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}>;\r\n\tprotected getPageId(item:T):any {return;}\r\n\tprotected setPageStart(item:T) {\r\n\t\tthis.pageStart = this.getPageId(item);\r\n\t}\r\n\t\r\n\tprotected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n\t\tlet results = await this.loadResults(param, pageStart, pageSize);\r\n\t\tlet pageList = results.$page;\r\n\t\tif (this.itemConverter) {\r\n\t\t\tlet ret:T[] = [];\r\n\t\t\tlet len = pageList.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet item = this.itemConverter(pageList[i], results);\r\n\t\t\t\tret.push(item);\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\tif (this.pageItemAction !== undefined) {\r\n\t\t\tlet len = pageList.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tthis.pageItemAction(pageList[i], results);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn pageList;\r\n\t}\r\n\r\n    reset() {\r\n\t\trunInAction(() => {\r\n\t\t\tthis.isFirst = true;\r\n\t\t\tthis.beforeLoad = true;\r\n\t\t\tthis.loaded = false;\r\n\t\t\tthis.param = undefined;\r\n\t\t\tthis.allLoaded = false;\r\n\t\t\tthis.pageStart = undefined;\r\n\t\t\tthis._items.clear();\r\n\t\t\t//this.setPageStart(undefined);\r\n\t\t});\r\n    }\r\n\r\n    append(item:T) {\r\n        if (this.appendPosition === 'tail')\r\n            this._items.unshift(item);\r\n        else\r\n            this._items.push(item);\r\n    }\r\n\r\n    async first(param:any):Promise<void> {\r\n        this.reset();\r\n        this.beforeLoad = false;\r\n        this.param = param;\r\n        await this.more();\r\n\t}\r\n\r\n\tprivate changing = false;\r\n\tasync attach(): Promise<void> {\r\n\t\tif (this.sortOrder === undefined) {\r\n\t\t\tconsole.error('没有定义增减序，无法attach');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.changing === true) return;\r\n\t\tthis.changing = true;\r\n\t\tlet items = this._items;\r\n\t\tlet isAsc = this.sortOrder === 'asc';\r\n\t\t//let isTail:boolean, \r\n\t\tlet endItem:T;\r\n\t\tlet scrollToEnd:() => void;\r\n\t\tlet pushItem:(item:T) => void;\r\n\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t//isTail = true;\r\n\t\t\tendItem = items[0];\r\n\t\t\tscrollToEnd = this.scrollToTop;\r\n\t\t\tpushItem = (item:T) => items.unshift(item);\r\n\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//isTail = false;\r\n\t\t\tlet endIndex = items.length;\r\n\t\t\tendItem = items[endIndex-1];\r\n\t\t\tscrollToEnd = this.scrollToBottom;\r\n\t\t\tpushItem = (item:T) => items.splice(endIndex, 0, item);\r\n\t\t}\r\n\t\tlet startId = this.getPageId(endItem);\r\n\t\tlet pid = undefined;\r\n\t\tlet sum = 0, max = 50;\r\n\t\tfor (;sum < max;) {\r\n\t\t\tlet ret = await this.load(this.param, pid, 3);\r\n\t\t\tlet len = ret.length;\r\n\t\t\tif (len === 0) break;\r\n\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet item = ret[i];\r\n\t\t\t\tpid = this.getPageId(item);\r\n\t\t\t\tif (isAsc === true) {\r\n\t\t\t\t\tif (pid >= startId) {\r\n\t\t\t\t\t\tmax = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pid <= startId) {\r\n\t\t\t\t\t\tmax = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tpushItem(item);\r\n\t\t\t\t/*\r\n\t\t\t\tif (isTail === true) {\r\n\t\t\t\t\tthis._items.unshift(item);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._items.push(item);\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t\t++sum;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.changing = false;\r\n\t\tif (sum > 0) {\r\n\t\t\tscrollToEnd();\r\n\t\t\t/*\r\n\t\t\tif (isTail === true) this.scrollToTop();\r\n\t\t\telse this.scrollToBottom();\r\n\t\t\t*/\r\n\t\t}\r\n\t}\r\n\r\n\tasync refresh(): Promise<void> {\r\n\t\tif (this.changing === true) return;\r\n\t\tthis.changing = true;\r\n\t\tlet ret = await this.load(this.param, undefined, this.firstSize>this.pageSize? this.firstSize:this.pageSize);\r\n\t\tthis._items.clear();\r\n\t\tthis.setLoaded(ret);\r\n\t\t/*\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet item = ret[i];\r\n\t\t\tlet pid = this.getRefreshPageId(item);\r\n\t\t\tlet index = this._items.findIndex(v => this.getRefreshPageId(v) === pid);\r\n\t\t\t//let index = _.sortedIndexBy(this._items, item, v=>this.getRefreshPageId(v));\r\n\t\t\t//let oldItem = this._items[index];\r\n\t\t\t//let oid = this.getRefreshPageId(oldItem);\r\n\t\t\tif (index >= 0) {\r\n\t\t\t\t_.merge(this._items[index], item);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.splice(0, 0, item);\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t\tthis.changing = false;\r\n\t}\r\n\r\n\tprotected getRefreshPageId(item:T) {\r\n\t\treturn this.getPageId(item);\r\n\t}\r\n\r\n    protected async onLoad(): Promise<void> {}\r\n    protected async onLoaded(): Promise<void> {}\r\n\r\n    async more():Promise<boolean> {\r\n        if (this.allLoaded === true) return false;\r\n\t\tif (this.loading === true) return true;\r\n\t\tif (this.changing === true) return true;\r\n\t\trunInAction(() => {\r\n\t\t\tthis.loading = true;\r\n\t\t\tthis.changing = true;\r\n\t\t});\r\n        await this.onLoad();\r\n        if (this.pageStart === undefined) this.setPageStart(undefined);\r\n        let pageSize = this.pageSize + 1;\r\n        if (this.isFirst === true) {\r\n            if (this.firstSize > this.pageSize) pageSize = this.firstSize+1;\r\n        }\r\n        let ret = await this.load(\r\n                this.param, \r\n                this.pageStart,\r\n\t\t\t\tpageSize);\r\n\t\tlet len = ret.length;\r\n\t\tlet allLoaded:boolean;\r\n        if ((this.isFirst===true && len>this.firstSize) ||\r\n            (this.isFirst===false && len>this.pageSize))\r\n        {\r\n            allLoaded = false;\r\n            --len;\r\n            ret.splice(len, 1);\r\n        }\r\n        else {\r\n            allLoaded = true;\r\n\t\t}\r\n\t\tthis.setLoaded(ret);\r\n\t\tthis.onLoaded();\r\n\t\trunInAction(() => {\r\n\t\t\tthis.loaded = true;\r\n\t\t\tthis.allLoaded = allLoaded;\r\n\t\t\tthis.isFirst = false;\r\n\t\t\tthis.changing = false;\r\n\t\t\tthis.loading = false;\r\n\t\t});\r\n\t\treturn !this.allLoaded;\r\n\t}\r\n\t\r\n\tprivate setLoaded(data:any[]) {\r\n\t\tlet len = data.length;\r\n        if (len === 0) {\r\n\t\t\tthis.setPageStart(undefined);\r\n            this._items.clear();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.setPageStart(data[len-1]);\r\n\t\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t\tthis._items.push(...data);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.unshift(...data.reverse());\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfindItem(item:any):T {\r\n\t\tlet pid = this.getPageId(item);\r\n\t\tlet index = _.findIndex(this._items, v => this.getPageId(v) === pid);\r\n\t\tif (index < 0) return;\r\n\t\treturn this._items[index];\r\n\t}\r\n\r\n\tremoveItem(item:any):T {\r\n\t\tlet pid = this.getPageId(item);\r\n\t\tlet index = _.findIndex(this._items, v => this.getPageId(v) === pid);\r\n\t\tif (index < 0) return;\r\n\t\tlet ret = this._items.splice(index, 1);\r\n\t\treturn ret[0];\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { tonva } from 'tonva-core';\r\n// import { nav } from '../nav';\r\nimport { Page } from './page/page';\r\n\r\ninterface Props {\r\n    message: string,\r\n    seconds: number\r\n}\r\n\r\ninterface State {\r\n    seconds: number\r\n}\r\n\r\nexport class ReloadPage extends React.Component<Props, State> {\r\n    private timerHandler:any;\r\n    constructor(props:Props) {\r\n\t\tsuper(props);\r\n\t\tlet {seconds} = props;\r\n\t\tif (seconds===undefined) return;\r\n        this.state = {seconds};\r\n\t\tif (seconds <= 0) return;\r\n        this.timerHandler = setInterval(() => {\r\n\t\t\tlet {seconds} = this.state;\r\n            seconds--;\r\n            if (seconds <= 0) {\r\n                this.reload();\r\n            }\r\n            else {\r\n                this.setState({seconds: seconds});\r\n            }\r\n        }, 1000);\r\n    }\r\n    private reload = () => {\r\n        clearInterval(this.timerHandler);\r\n        tonva.reload();\r\n    }\r\n    render() {\r\n\t\tlet {seconds} = this.state;\r\n\t\tlet title:string, msg:string;\t\t\r\n\t\tif (seconds > 0) {\r\n\t\t\ttitle = '程序升级中...';\r\n\t\t\tmsg = this.state.seconds + '秒钟之后自动重启动';\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttitle = '程序需要升级';\r\n\t\t\tmsg = '请点击下面按钮重启';\r\n\t\t}\r\n        return <Page header={false}>\r\n            <div className=\"text-center p-5\">\r\n                <div className=\"text-info py-5\">\r\n\t\t\t\t\t<span className=\"text-danger\">{title}</span>\r\n\t\t\t\t\t<br/>\r\n\t\t\t\t\t{msg}\r\n                    <br/>\r\n                    <span className=\"small text-muted\">{this.props.message}</span>\r\n                </div>\r\n                <button className=\"btn btn-danger\" onClick={this.reload}>立刻重启</button>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface ConfirmReloadPageProps {\r\n    confirm: (ok: boolean)=>Promise<void>;\r\n}\r\nexport const ConfirmReloadPage = (props: ConfirmReloadPageProps):JSX.Element => {\r\n    return <Page header=\"升级软件\" back=\"close\">\r\n        <div className=\"py-5 px-3 my-5 mx-2 border bg-white rounded\">\r\n            <div className=\"text-center text-info\">\r\n                升级将清除所有本机缓冲区内容，并从服务器重新安装程序！\r\n            </div>\r\n            <div className=\"text-center mt-5\">\r\n                <button className=\"btn btn-danger me-3\" onClick={()=>props.confirm(true)}>确认升级</button>\r\n            </div>\r\n        </div>\r\n    </Page>;\r\n    // <button className=\"btn btn-outline-danger\" onClick={()=>props.confirm(false)}>暂不</button>\r\n}\r\n","import { makeObservable, observable } from \"mobx\";\r\nimport { FetchError, Nav, NavPage, Tonva, User, Web } from \"tonva-core\";\r\nimport { WebReact } from \"./app\";\r\n\r\nimport {Page} from './components';\r\n\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport './css/va-form.css';\r\nimport './css/va.css';\r\nimport './css/animation.css';\r\nimport { ReloadPage, ConfirmReloadPage } from './components/reloadPage';\r\n//import { PageWebNav } from './components/page';\r\nimport { createLogin, Login, showForget, showRegister } from './components/login';\r\n//import { env, FetchError, LocalData, User } from 'tonva-core';\r\nimport { SystemNotifyPage } from './nav/FetchErrorView';\r\nimport { NavView } from './nav';\r\n\r\n//export type NavPage = (params:any) => Promise<void>;\r\n\r\nexport class TonvaReact extends Tonva {\r\n    navView:NavView;\r\n\r\n    constructor() {\r\n        super();\r\n\t\tmakeObservable(this, {\r\n\t\t\tuser: observable,\r\n\t\t});\r\n    }\r\n\r\n    createWeb(): Web {return new WebReact();}\r\n\r\n    createObservableMap<K, V>(): Map<K, V> {\r\n        return observable.map({}, {deep: false});\r\n    }\r\n\r\n    set(navView:NavView) {\r\n        //this.logo = logo;\r\n        this.navView = navView;\r\n\t}\r\n\r\n    get nav(): Nav<JSX.Element> {return this.navView};\r\n\r\n    renderNavView(onLogined: (isUserLogin?:boolean)=>Promise<void>,\r\n        notLogined?: ()=>Promise<void>,\r\n\t    userPassword?: () => Promise<{user:string; password:string}>,\r\n    )\r\n    {\r\n        return <NavView ref={nv => this.navView = nv} \r\n            onLogined={onLogined}\r\n            notLogined={notLogined}\r\n            userPassword={userPassword} />;\r\n    }\r\n\r\n    /*\r\n\tsetIsWebNav() {\r\n\t\tthis.isWebNav = true;\r\n\t\tthis.navView.backIcon = <i className=\"fa fa-arrow-left\" />;\r\n\t\tthis.navView.closeIcon = <i className=\"fa fa-close\" />;\r\n\t}\r\n    */\r\n\r\n\t// pageWebNav: PageWebNav;\r\n\r\n    async showAppView(isUserLogin?: boolean):Promise<void> {\r\n        let {onLogined} = this.navView.props;\r\n        if (onLogined === undefined) {\r\n            this.push(<div>NavView has no prop onLogined</div>);\r\n            return;\r\n        }\r\n        this.clear();\r\n        await onLogined(isUserLogin);\r\n    }\r\n\r\n\r\n    privacyEntry() {\r\n        if (!this.getPrivacyContent()) return;\r\n        return <div className=\"text-center\">\r\n            <button className=\"btn btn-sm btn-link\"\r\n                onClick={this.showPrivacyPage}>\r\n                <small className=\"text-muted\">隐私政策</small>\r\n            </button>\r\n        </div>;\r\n    }\r\n\r\n    private getPrivacyContent():string {\r\n        if (!this.navSettings) return;\r\n        let {privacy} = this.navSettings;\r\n        return privacy;\r\n    }\r\n\r\n    showPrivacyPage = () => {\r\n        let privacy = this.getPrivacyContent();\r\n        if (privacy) {\r\n            this.privacyPage(privacy);\r\n        }\r\n        else {\r\n            this.push(<Page header=\"隐私政策\">\r\n                <div className=\"p-3\">AppConfig 中没有定义 privacy。可以定义为字符串，或者url。markdown格式</div>\r\n            </Page>);\r\n        }\r\n    }\r\n\r\n    private privacyPage = async (htmlString: string) => {\r\n        //let html = await this.getPrivacy(privacy);\r\n\t\t//let content = {__html: marked(html)};\r\n\t\tlet content = {__html: htmlString};\r\n        this.push(<Page header=\"隐私政策\">\r\n            <div className=\"p-3\" dangerouslySetInnerHTML={content} />\r\n        </Page>);\r\n    }\r\n\r\n\tprivate createLogin = createLogin;\r\n\tsetCreateLogin(createLogin: (tonva:Tonva)=>Promise<Login>) {\r\n\t\tthis.createLogin = createLogin;\r\n\t}\r\n\r\n    async changePassword() {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showChangePassword();\r\n    }\r\n\r\n    async userQuit() {\r\n        let login = await this.getLogin();\r\n        login.showUserQuit();\r\n    }\r\n\r\n\tprivate navLogin:NavPage = async (params:any) => {\r\n\t\tthis.showLogin(async (user: User) => window.history.back(), false);\r\n\t}\r\n\r\n\tprivate navLogout:NavPage = async (params:any) => {\r\n\t\tthis.showLogout(async () => window.history.back());\r\n\t}\r\n\r\n\tprivate navRegister:NavPage = async (params:any) => {\r\n\t\tthis.showRegister();\r\n\t}\r\n\r\n\tprivate navForget:NavPage = async (params:any) => {\r\n\t\tthis.showForget();\r\n\t}\r\n\r\n\tprivate login: Login;\r\n\tprivate async getLogin():Promise<Login> {\r\n\t\tif (this.login) return this.login;\r\n\t\treturn this.login = await this.createLogin(this);\r\n\t}\r\n\tasync showLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean) {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showLogin(callback, withBack);\r\n    }\r\n\r\n    async showLogout(callback?: ()=>Promise<void>) {\r\n\t\tlet login = await this.getLogin();\r\n\t\tlogin.showLogout(callback);\r\n\t}\r\n\t\r\n\tasync showRegister() {\r\n\t\tshowRegister(this);\r\n\t}\r\n\r\n\tasync showForget() {\r\n\t\tshowForget(this);\r\n\t}\r\n\r\n    resetAll = () => {\r\n        this.push(<ConfirmReloadPage confirm={(ok:boolean):Promise<void> => {\r\n            if (ok === true) {\r\n                this.showReloadPage('彻底升级');\r\n\t\t\t\tlocalStorage.clear();\r\n\t\t\t\t/*\r\n                this.local.readToMemory();\r\n                env.localDb.removeAll();\r\n\t\t\t\tthis.local.saveToLocalStorage();\r\n\t\t\t\t*/\r\n            }\r\n            else {\r\n                this.pop();\r\n            }\r\n            return;\r\n        }} />);\r\n    }\r\n\r\n    async checkVersion():Promise<string> {\r\n        let {href} = document.location;\r\n        href += (href.indexOf('?')>=0? '&':'?') + '_t_t_=' + new Date().getTime();\r\n        let ret = await fetch(href);\r\n        let r = await ret.text();\r\n        let parser = new DOMParser();\r\n        let htmlDoc = parser.parseFromString(r, 'text/html');\r\n        let elHtml = htmlDoc.getElementsByTagName('html');\r\n        let newVersion = elHtml[0].getAttribute('data-version');\r\n        return newVersion;\r\n    }\r\n\r\n    showReloadPage(msg: string) {\r\n        let seconds = -1;\r\n\t\tthis.push(<ReloadPage message={msg} seconds={seconds} />);\r\n\t\t/*\r\n\t\tif (seconds > 0) {\r\n\t\t\tenv.setTimeout(undefined, this.reload, seconds*1000);\r\n\t\t}\r\n\t\t*/\r\n    }\r\n\r\n    get level(): number {\r\n        return this.navView.level;\r\n    }\r\n    startWait() {\r\n        this.navView?.startWait();\r\n    }\r\n    endWait() {\r\n        this.navView?.endWait();\r\n    }\r\n    async onError(fetchError: FetchError)\r\n    {\r\n        let err = fetchError.error;\r\n        if (err !== undefined) {\r\n            if (err.unauthorized === true) {\r\n\t\t\t\tawait this.showLogin(undefined);\r\n\t\t\t\t//nav.navigateToLogin();\r\n                return;\r\n            }\r\n            switch (err.type) {\r\n                case 'unauthorized':\r\n                    await this.showLogin(undefined);\r\n\t\t\t\t\t//nav.navigateToLogin();\r\n                    return;\r\n                case 'sheet-processing':\r\n                    this.push(<SystemNotifyPage message=\"单据正在处理中。请重新操作！\" />);\r\n                    return;\r\n            }\r\n        }\r\n        this.navView.setState({\r\n            fetchError,\r\n        });\r\n    }\r\n\r\n    private upgradeUq = () => {\r\n        this.start();\r\n    }\r\n\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        this.show(<Page header={false}>\r\n            <div>\r\n                UQ升级了，请点击按钮升级 <br />\r\n                <small className=\"text-muted\">{uq} ver-{version}</small>\r\n                <button className=\"btn btn-primary\" onClick={this.upgradeUq}>升级</button>\r\n            </div>\r\n        </Page>)\r\n    }\r\n\r\n    show (view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.show(view, disposer);\r\n    }\r\n    push(view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.push(view, disposer);\r\n    }\r\n    replace(view: JSX.Element, disposer?: ()=>void): void {\r\n        this.navView.replace(view, disposer);\r\n    }\r\n    pop(level:number = 1) {\r\n        this.navView.pop(level);\r\n    }\r\n    topKey():number {\r\n        return this.navView.topKey();\r\n    }\r\n    popTo(key:number) {\r\n        this.navView.popTo(key);\r\n    }\r\n    clear() {\r\n        this.navView?.clear();\r\n    }\r\n    navBack() {\r\n        this.navView.navBack();\r\n    }\r\n    ceaseTop(level?:number) {\r\n        this.navView.ceaseTop(level);\r\n    }\r\n    removeCeased() {\r\n        this.navView.removeCeased();\r\n    }\r\n    async back(confirm:boolean = true) {\r\n        await this.navView.back(confirm);\r\n    }\r\n    regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        this.navView.regConfirmClose(confirmClose);\r\n    }\r\n    confirmBox(message?:string): boolean {\r\n        return this.navView.confirmBox(message);\r\n\t}\r\n\t/*\r\n    async navToApp(url: string, unitId: number, apiId?:number, sheetType?:number, sheetId?:number):Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            let sheet = this.centerHost.includes('http://localhost:') === true? 'sheet_debug':'sheet'\r\n            let uh = sheetId === undefined?\r\n                    appUrl(url, unitId) :\r\n                    appUrl(url, unitId, sheet, [apiId, sheetType, sheetId]);\r\n            console.log('navToApp: %s', JSON.stringify(uh));\r\n            nav.push(<article className='app-container'>\r\n                <span id={uh.hash} onClick={()=>this.back()}/>\r\n                    <i className=\"fa fa-arrow-left\" />\r\n                </span>\r\n                {\r\n                    // eslint-disable-next-line \r\n                    <iframe src={uh.url} title={String(sheetId)} />\r\n                }\r\n            </article>, \r\n            ()=> {\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n\r\n    navToSite(url: string) {\r\n        // show in new window\r\n        window.open(url);\r\n\t}\r\n\t*/\r\n\topenSysPage(url: string):boolean {\r\n\t\tlet navPage: NavPage = this.sysRoutes[url];\r\n\t\tif (navPage === undefined) {\r\n\t\t\t//alert(url + ' is not defined in sysRoutes');\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tnavPage(undefined);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprivate navPageRoutes: {[url:string]: NavPage};\r\n\tprivate routeFromNavPage(navPage: NavPage) {\r\n\t\treturn (params: any, queryStr: any) => {\r\n\t\t\tif (navPage) {\r\n\t\t\t\tif (this.nav.isWebNav) this.clear();\r\n\t\t\t\tnavPage(params);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tonNavRoute(navPage: NavPage) {\r\n\t\tthis.on(this.routeFromNavPage(navPage));\r\n\t}\r\n\tprivate doneSysRoutes:boolean = false;\r\n\tprivate sysRoutes: { [route: string]: NavPage } = {\r\n\t\t'/login': this.navLogin,\r\n\t\t'/logout': this.navLogout,\r\n\t\t'/register': this.navRegister,\r\n\t\t'/forget': this.navForget,\r\n\t}\r\n\t/*\r\n\tonSysNavRoutes() {\r\n\t\tthis.onNavRoutes(this.sysRoutes);\r\n\t}\r\n\t*/\r\n\tonNavRoutes(navPageRoutes: {[url:string]: NavPage}) {\r\n\t\tif (this.doneSysRoutes === false) {\r\n\t\t\tthis.doneSysRoutes = true;\r\n\t\t\tthis.internalOnNavRoutes(this.sysRoutes);\r\n\t\t}\r\n\t\tthis.internalOnNavRoutes(navPageRoutes);\r\n\t}\r\n\r\n\tprivate internalOnNavRoutes(navPageRoutes: {[url:string]: NavPage}) {\r\n\t\tif (!navPageRoutes) return;\r\n\t\tthis.navPageRoutes = Object.assign(this.navPageRoutes, navPageRoutes);\r\n\t\tlet navOns: { [route: string]: (params: any, queryStr: any) => void } = {};\r\n\t\tfor (let route in navPageRoutes) {\r\n\t\t\tlet navPage = navPageRoutes[route];\r\n\t\t\tnavOns[route] = this.routeFromNavPage(navPage);\r\n\t\t}\r\n\t\tthis.on(navOns);\r\n\t}\r\n\r\n}\r\n","//=== UqApp builder created on Fri Nov 19 2021 14:42:41 GMT-0500 (北美东部标准时间) ===//\n    import { CSub, CBase, CAppBase, IConstructor } from \"tonva-view\";\n    import { UQs } from './uqs';\n    import { CApp } from './CApp';\n    \n    export abstract class CUqBase extends CBase<CApp, UQs> {\n        protected async internalStart(param?:any, ...params:any[]):Promise<void> {}\n    }\n    \n    export abstract class CUqSub<A extends CAppBase<U>, U, T extends CBase<A,U>> extends CSub<A, U, T> {\n    }\n    \n    export abstract class CUqApp extends CAppBase<UQs> {\n        protected newC<T extends CUqBase>(type: IConstructor<T>, ...param:any[]): T {\n            let c = new type(this);\n            c.internalInit(...param);\n            return c;\n        }\n    }\n    ","import { VPage } from \"tonva-view\";\r\nimport { CHome } from \"./CHome\";\r\nimport '../App.css';\r\n\r\nexport class VHome extends VPage<CHome> {\r\n\theader() {return '首页'}\r\n\tcontent() {\r\n\t\tlet {cApp, cAccount} = this.controller;\r\n\t\treturn <div>\r\n\t\t\t<div className=\"d-flex flex-wrap p-2\">\r\n\t\t\t\t{cAccount?.renderAccounts()}\r\n\t\t\t</div>\r\n\t\t\t{cApp.renderVPortal()}\r\n\t\t</div>\r\n\t}\r\n}\r\n","import { CAccount } from \"./CAccount\";\r\nimport { View } from 'tonva-view';\r\nimport { EnumAccount, Post } from \"uq-app/uqs/JkMe\";\r\n\r\nexport class VAccount extends View<CAccount> {\r\n    render() {\r\n\t\treturn this.react(() => {\r\n\t\t\tlet {data, cApp, onAccountClick} = this.controller;\r\n\t\t\tlet {accounts} = data;\r\n\t\t\tif (!accounts) return null;\r\n\t\t\tlet {accountTitles, postTitles} = cApp;\r\n\t\t\treturn <>{accounts.map((v, index) => {\r\n\t\t\t\tlet {post, account, balance} = v;\r\n\t\t\t\tlet {title, unit, fixed} = accountTitles[account as EnumAccount];\r\n\t\t\t\tlet postTitle = postTitles[post as Post];\r\n\t\t\t\treturn <div key={index}\r\n\t\t\t\t\tclassName=\"m-2 p-3 border border-info rounded rounded-3 bg-white text-center cursor-pointer\"\r\n\t\t\t\t\tonClick={() => onAccountClick(v)}>\r\n\t\t\t\t\t<div className=\"mb-1 small\">\r\n\t\t\t\t\t\t<span className=\"text-secondary small\">{postTitle?.title}</span>\r\n\t\t\t\t\t\t<span className=\"text-primary\">{title}</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<span className=\"fs-5 me-1\">{balance.toFixed(fixed)}</span>\r\n\t\t\t\t\t\t<small className=\"text-muted\">{unit}</small></div>\r\n\t\t\t\t</div>\r\n\t\t\t})}</>;\r\n\t\t});\r\n    }\r\n}\r\n","import { CAccount } from 'account';\r\nimport { dateFromHourId } from 'tonva-core';\r\nimport { List, LMR, VPage } from \"tonva-view\";\r\nimport { Item, Post, ReturnGetObjectAccountHistoryRet } from \"uq-app/uqs/JkMe\";\r\n\r\nexport class VObjectAccountHistory extends VPage<CAccount> {\r\n    header() {return '账户明细'}\r\n    content() {\r\n        let {accountHistory} = this.controller;\r\n        return <div>\r\n            <List items={accountHistory} item={{render: this.renderHistory}} />\r\n        </div>\r\n    }\r\n\r\n    private renderHistory = (row:ReturnGetObjectAccountHistoryRet, index:number) => {\r\n        let {accountTitle, cApp} = this.controller;\r\n        let {fixed, unit} = accountTitle;\r\n        let {postTitles, itemTitles} = cApp;\r\n        let {date, value, item, post} = row;\r\n        let right = <div>\r\n            <span className=\"me-1\">{value.toFixed(fixed)}</span>\r\n            <small className=\"text-muted\">{unit}</small>\r\n        </div>;\r\n        return <LMR className=\"px-3 py-2\" right={right}>\r\n            <span className=\"d-inline-block w-min-6c\">{dateString(dateFromHourId(date))}</span>\r\n            <small className=\"text-muted\">\r\n            {postTitles[post as Post].title} &nbsp;\r\n            {itemTitles[item as Item].title}\r\n            </small>\r\n        </LMR>\r\n    } \r\n}\r\n\r\nfunction dateString(date: Date) {\r\n    let y = date.getFullYear();\r\n    let m = date.getMonth() + 1;\r\n    let d = date.getDate();\r\n    if (y === new Date().getFullYear()) {\r\n        return `${m}月${d}日`;\r\n    }\r\n    else {\r\n        return `${y}年${m}月${d}日`;\r\n    }\r\n}\r\n","import { isObservable } from \"mobx\";\r\nimport { CApp, CUqBase } from \"uq-app\";\r\nimport { Title } from \"uq-app/CApp\";\r\nimport { EnumAccount, ReturnGetObjectAccountHistoryRet, ReturnGetUserObjectAccountRet } from \"uq-app/uqs/JkMe\";\r\nimport { VAccount } from \"./VAccount\";\r\nimport { VObjectAccountHistory } from \"./VObjectAccountHistory\";\r\n\r\nexport class CAccount extends CUqBase {\r\n\tdata: {\r\n\t\taccounts: ReturnGetUserObjectAccountRet[];\r\n\t};\r\n\taccount: ReturnGetUserObjectAccountRet;\r\n\taccountHistory: ReturnGetObjectAccountHistoryRet[];\r\n\taccountTitle:Title;\r\n\r\n    constructor(cApp: CApp) {\r\n\t\tsuper(cApp);\r\n\t\tthis.data = this.shallow({\r\n\t\t\taccounts: null,\r\n\t\t});\r\n\t}\r\n\r\n    renderAccounts() {\r\n        return this.renderView(VAccount);\r\n    }\r\n\r\n\tasync load(object: number) {\r\n\t\tlet ret = await this.uqs.JkMe.GetUserObjectAccount.query({object});\r\n\t\tthis.runInAction(() => {\r\n\t\t\tthis.data.accounts = ret.ret;\r\n\t\t\tconsole.log('isObservable(this.data.accounts[0])', isObservable(this.data.accounts[0]));\r\n\t\t});\r\n\t}\r\n\r\n\tonAccountClick = async (account: ReturnGetUserObjectAccountRet) => {\r\n\t\tthis.account = account;\r\n\t\tlet {objectAccount, account:enumAccount} = account;\r\n\t\tlet ret = await this.uqs.JkMe.GetObjectAccountHistory.query({objectAccount});\r\n\t\tthis.accountHistory = ret.ret;\r\n\t\tthis.accountTitle = this.cApp.accountTitles[enumAccount as EnumAccount];\r\n\t\tthis.openVPage(VObjectAccountHistory);\r\n\t}\r\n}\r\n","import { CUqBase } from \"uq-app\";\r\nimport { VHome } from \"./VHome\";\r\nimport { CAccount } from \"account\";\r\nimport { VElement } from \"tonva-view\";\r\n\r\nexport interface AccountController {\r\n\tstart(): Promise<void>;\r\n\tloadItem(): Promise<void>;\r\n\trenderItem():VElement;\r\n}\r\n\r\nexport class CHome extends CUqBase {\r\n\tcAccount: CAccount;\r\n\r\n\ttab = () => this.renderView(VHome);\r\n\r\n\tload = async () => {\r\n\t\tthis.cAccount = this.newC(CAccount);\r\n\t\tawait Promise.all([this.cApp.cPortal.load(), this.cAccount.load(undefined)]);\r\n\t}\r\n}\r\n","//=== UqApp builder created on Tue Jan 12 2021 23:14:51 GMT-0500 (GMT-05:00) ===//\r\nimport { AppConfig } from \"tonva-view\";\r\nimport { DevConfig } from 'tonva-core';\r\n\r\n/*\r\nconst bz: DevConfig = {\r\n\tname: 'bizdev',\r\n\talias: 'bz',\r\n}\r\n*/\r\nconst jk: DevConfig = {\r\n\tname: '百灵威系统工程部',\r\n\talias: 'jk',\r\n}\r\n\r\nexport const appConfig: AppConfig = {\r\n\tversion: '0.1.0',\r\n\tapp: undefined,\r\n\tuqs: [\r\n\t\t{\r\n\t\t\tdev: jk,\r\n\t\t\tname: 'me',\r\n\t\t\talias: 'Me',\r\n\t\t\tversion: '0.1.0',\r\n\t\t},\r\n\t\t{\r\n\t\t\tdev: jk,\r\n\t\t\tname: 'product',\r\n\t\t\talias: 'Product',\r\n\t\t\tversion: '0.1.0',\r\n\t\t},\r\n\t\t{\r\n\t\t\tdev: jk,\r\n\t\t\tname: '积分商城',\r\n\t\t\talias: 'PointShop',\r\n\t\t\tversion: '0.1.0',\r\n\t\t},\r\n\t\t{\r\n\t\t\tdev: jk,\r\n\t\t\tname: 'hr',\r\n\t\t\talias: 'Hr',\r\n\t\t\tversion: '0.1.0',\r\n\t\t},\r\n\t],\r\n\tnoUnit: true,\r\n    //tvs: {},\r\n\toem: undefined,\r\n\thtmlTitle: '我',\r\n};\r\n","import { VPage } from \"tonva-view\";\r\nimport { appConfig } from \"../uq-app/appConfig\";\r\nimport { CMe } from \"./CMe\";\r\n\r\nexport class VAbout extends VPage<CMe> {\r\n\theader() {return '关于APP';}\r\n\tcontent() {\r\n\t\treturn <div className=\"py-5 px-3 my-3 w-max-30c mx-auto bg-white\">\r\n\t\t\t<div className=\"text-center mb-5 position-relative\">\r\n\t\t\t\t<small className=\"text-muted position-absolute\"\r\n\t\t\t\t\tstyle={{right:'0', top:'-2.8rem'}}>\r\n\t\t\t\t\t版本: {appConfig.version}\r\n\t\t\t\t</small>\r\n\t\t\t\t<b className=\"text-danger h5 mb-0\">About</b>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { User, Web } from \"tonva-core\";\r\nimport { UserView } from \"tonva-view\";\r\n\r\nexport const renderUserText = (web:Web, user:any):JSX.Element => {\r\n    let renderUser = (user:User) => {\r\n        let {name, nick} = user;\r\n        return <>{nick || name}</>;\r\n    }\r\n    return <UserView web={web} user={user} render={renderUser} />\r\n}\r\n","import { observer } from 'mobx-react';\r\nimport { Image, VPage, IconText, PropGrid, LMR, FA, Prop } from \"tonva-view\";\r\nimport { CMe } from './CMe';\r\nimport { appConfig } from '../uq-app/appConfig';\r\nimport { VAbout } from './VAbout';\r\nimport { renderUserText } from './renderUser';\r\nimport { tonva } from 'tonva-core';\r\n\r\nexport class VMe extends VPage<CMe> {\r\n\theader() {return this.t('me')}\r\n\r\n\tcontent() {\r\n        const { user } = tonva;\r\n        let aboutRows: Prop[] = [\r\n            '',\r\n            {\r\n                type: 'component',\r\n                component: <LMR className=\"w-100\" onClick={this.about}\r\n\t\t\t\t\tright={<FA className=\"align-self-center\" name=\"angle-right\" />}>\r\n                    <IconText iconClass=\"text-info me-2\" \r\n\t\t\t\t\t\ticon=\"smile-o\" \r\n\t\t\t\t\t\ttext={<>{this.t('aboutTheApp')} <small>版本 {appConfig.version}</small></>} />                    \r\n                </LMR>,\r\n            },\r\n        ];\r\n\r\n        let rows: Prop[];\r\n        if (user === undefined) {\r\n            rows = aboutRows;\r\n            rows.push(\r\n                {\r\n                    type: 'component',\r\n                    component: <button className=\"btn btn-success w-100 my-2\" onClick={() => tonva.logout()}>\r\n                        <FA name=\"sign-out\" size=\"lg\" /> {this.t('pleaseLogin')}\r\n                    </button>\r\n                },\r\n            );\r\n        }\r\n        else {\r\n            let logOutRows: Prop[] = [\r\n            ];\r\n\r\n            rows = [\r\n                '',\r\n                {\r\n                    type: 'component',\r\n                    component: <this.meInfo />\r\n                },\r\n\t\t\t\t'',\r\n            ];\r\n\t\t\trows.push({\r\n                type: 'component',\r\n                component: this.react(this.renderAdmin),\r\n            });\r\n            rows.push(...aboutRows, ...logOutRows);\r\n        }\r\n        return <>\r\n            <PropGrid rows={[...rows]} values={{}} />\r\n        </>;\r\n    }\r\n\r\n    private renderAdmin():JSX.Element {\r\n        let {isAdmin} = this.controller.data;\r\n        if (isAdmin === false) return null;\r\n        let {admins, web} = this.controller;\r\n        return <LMR className=\"py-2 cursor-pointer w-100\"\r\n                onClick={this.controller.adminSetting}\r\n                left={<FA name=\"cog\" className=\"text-info mt-1 me-3\" />}\r\n                right={<FA className=\"align-self-center\" name=\"angle-right\" />}\r\n            >\r\n            <div>业务设置</div>\r\n            <div className=\"small text-muted d-flex align-items-center\">\r\n                <small className=\"d-inline\">管理员</small>\r\n                <span className=\"d-inline ms-3 text-danger\">[我]</span>\r\n                {admins.map(v => {\r\n                    let {id} = v;\r\n                    return <span key={id} className=\"d-inline ms-3\">{renderUserText(web, id)}</span>\r\n                })}\r\n            </div>\r\n        </LMR>;\r\n    };\r\n\r\n\tprivate meInfo = observer(() => {\r\n        let { user } = tonva;\r\n        if (user === undefined) return null;\r\n        let { id, name, nick, icon } = user;\r\n        return <LMR className=\"py-2 cursor-pointer w-100\"\r\n            left={<Image className=\"w-3c h-3c me-3\" src={icon || '.user-o'} />}\r\n            right={<FA className=\"align-self-end\" name=\"angle-right\" />}\r\n            onClick={this.controller.showEditMe}>\r\n            <div>\r\n                <div>{userSpan(name, nick)}</div>\r\n                <div className=\"small\"><span className=\"text-muted\">ID:</span> {id > 10000 ? id : String(id + 10000).substr(1)}</div>\r\n            </div>\r\n        </LMR>;\r\n    });\r\n\r\n\t/*\r\n\tprivate renderRolesAdmin = observer(() => {\r\n\t\treturn <LMR className=\"py-2 cursor-pointer w-100\" onClick={this.controller.roleAdmin}>\r\n\t\t\t设置用户角色\r\n\t\t</LMR>\r\n\t});\r\n\t*/\r\n\r\n\tprivate about = () => {\r\n\t\tthis.openVPage(VAbout);\r\n\t}\r\n}\r\n\r\nfunction userSpan(name: string, nick: string): JSX.Element {\r\n    return nick ?\r\n        <><b>{nick} &nbsp; <small className=\"muted\">{name}</small></b></>\r\n        : <b>{name}</b>\r\n}\r\n","import { observable } from 'mobx';\r\nimport { tonva } from 'tonva-core';\r\nimport {\r\n    ItemSchema, StringSchema, ImageSchema, UiTextItem, UiImageItem, Page,\r\n    Edit, UiSchema, VPage, Prop, FA, IconText, PropGrid\r\n} from \"tonva-view\";\r\nimport { CMe } from './CMe';\r\n\r\nexport class VEditMe extends VPage<CMe>{\r\n\r\n    async open(param: any) {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private schema: ItemSchema[] = [\r\n        { name: 'nick', type: 'string' } as StringSchema,\r\n        { name: 'icon', type: 'image' } as ImageSchema,\r\n    ];\r\n    private uiSchema: UiSchema = {\r\n        items: {\r\n            nick: { widget: 'text', label: '别名', placeholder: '好的别名更方便记忆' } as UiTextItem,\r\n            icon: { widget: 'image', label: '头像' } as UiImageItem,\r\n        }\r\n    }\r\n    @observable private data: any;\r\n\r\n    constructor(props: any) {\r\n        super(props);\r\n        let { nick, icon } = tonva.user;\r\n        this.data = {\r\n            nick: nick,\r\n            icon: icon,\r\n        };\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema: ItemSchema, newValue: any, preValue: any) => {\r\n        let { name } = itemSchema;\r\n        await this.controller.web.userApi.userSetProp(name, newValue);\r\n        this.data[name] = newValue;\r\n        tonva.user.name = newValue;\r\n        tonva.saveLocalUser();\r\n    }\r\n\r\n\tprivate onExit = () => {\r\n        tonva.showLogout();\r\n    }\r\n\r\n\tprivate changePassword = async () => {\r\n        await tonva.changePassword();\r\n    }\r\n\r\n    private userQuit = async () => {\r\n        await tonva.userQuit();\r\n    }\r\n\r\n    private page = () => {\r\n\t\tlet { schema, uiSchema, data, onItemChanged } = this;\r\n\t\tlet gridRows: Prop[] = [\r\n\t\t\t'',\r\n\t\t\t{\r\n\t\t\t\ttype: 'component',\r\n\t\t\t\tcomponent: <IconText iconClass=\"text-info me-2\" icon=\"key\" text={this.t('changePassword')} />,\r\n\t\t\t\tonClick: this.changePassword\r\n\t\t\t},\r\n\t\t\t'',\r\n\t\t\t{\r\n\t\t\t\ttype: 'component',\r\n\t\t\t\tcomponent: <IconText iconClass=\"text-danger me-2\" icon=\"ban\" text={this.t('userQuit')} />,\r\n\t\t\t\tonClick: this.userQuit\r\n\t\t\t},\r\n\t\t\t'',\r\n\t\t\t'',\r\n\t\t\t{\r\n\t\t\t\ttype: 'component',\r\n\t\t\t\tbk: '',\r\n\t\t\t\tcomponent: <div className=\"w-100 text-center\">\r\n\t\t\t\t\t<button className=\"btn btn-danger w-100 w-max-20c\" onClick={this.onExit}>\r\n\t\t\t\t\t\t<FA name=\"sign-out\" size=\"lg\" /> {this.t('logout')}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t},\r\n\t\t];\r\n\r\n\r\n\t\t/*\r\n\t\tlet vAdmin: any;\r\n\t\t\r\n\t\tlet { role } = this.controller;\r\n\t\tif ((role & 2) === 2) {\r\n\t\t\tvAdmin = <div className=\"px-3 py-2 cursor-pointer bg-white border-bottom\" onClick={this.controller.showAdmin}>管理员</div>;\r\n\t\t}\r\n\t\t{vAdmin}\r\n\t\t*/\r\n        return <Page header=\"个人信息\">\r\n            <Edit schema={schema} uiSchema={uiSchema}\r\n                data={data}\r\n                onItemChanged={onItemChanged} />\r\n\t\t\t<PropGrid rows={gridRows} values={{}} />\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport const webUserSchema: ItemSchema[] = [\r\n    { name: 'firstName', type: 'string', required: true } as StringSchema,\r\n    { name: 'gender', type: 'string' } as StringSchema,\r\n    { name: 'salutation', type: 'string' } as StringSchema,\r\n    { name: 'organizationName', type: 'string', required: true } as StringSchema,\r\n    { name: 'departmentName', type: 'string' } as StringSchema,\r\n];\r\n\r\n","import { VPage } from \"tonva-view\";\r\nimport { CMe } from \"./CMe\";\r\nimport { renderUserText } from \"./renderUser\";\r\n\r\nexport class VAdminSetting extends VPage<CMe> {\r\n    header() {return '业务设置'}\r\n    content() {\r\n        let {admins, web} = this.controller;\r\n        return <div>\r\n            <div className=\"small text-muted d-flex align-items-center m-3\">\r\n                <small className=\"d-inline\">管理员</small>\r\n                <span className=\"d-inline ms-3 text-danger\">[我]</span>\r\n                {admins.map(v => {\r\n                    return <span className=\"d-inline ms-3\">{renderUserText(web, v.id)}</span>\r\n                })}\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n}\r\n","import { User } from \"tonva-core\";\r\nimport { QueryPager } from \"tonva-view\";\r\nimport { CUqBase } from \"uq-app\";\r\nimport { VMe } from \"./VMe\";\r\nimport { VEditMe } from \"./VEditMe\";\r\nimport { VAdminSetting } from \"./VAdminSetting\";\r\n\r\nexport class CMe extends CUqBase {\r\n\tunitOwner: User;\r\n\trootUnits: QueryPager<any>;\r\n\tadmins: {id:number;role:number}[] = null;\r\n\tdata: {\r\n\t\tisAdmin: boolean;\r\n\t\tmap: Map<any, any>;\r\n\t};\r\n\t// isAdmin: boolean = false;\r\n\t// map = new Map();\r\n\tconstructor(res:any) {\r\n\t\tsuper(res);\r\n\t\t/*\r\n\t\tmakeObservable(this, {\r\n\t\t\tisAdmin: observable,\r\n\t\t\tmap: observable.shallow,\r\n\t\t});\r\n\t\t*/\r\n\t\tthis.data = this.shallow({\r\n\t\t\tisAdmin: false,\r\n\t\t\tmap: new Map(),\r\n\t\t});\r\n\t}\r\n\r\n\tmapAdd = () => {\r\n\t\tlet {map} = this.data;\r\n\t\tlet v = map.get(1);\r\n\t\tif (!v) {\r\n\t\t\tv = 1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tv = {v};\r\n\t\t}\r\n\t\tmap.set(1, v);\r\n\t}\r\n\r\n    protected async internalStart() {\r\n\t}\r\n\r\n\ttab = () => {\r\n\t\treturn this.renderView(VMe);\r\n\t}\r\n\r\n\tshowEditMe = async () => {\r\n\t\tthis.openVPage(VEditMe);\r\n\t}\r\n\r\n\tload = async () => {\r\n\t\tlet admins = await this.uqs.JkMe.getAdmins();\r\n\t\tif (!admins) return;\r\n\t\tthis.runInAction(() => {\r\n\t\t\tlet userId = this.user.id;\r\n\t\t\tlet p = admins.findIndex(v => v.id === userId);\r\n\t\t\tif (p >= 0) admins.splice(p, 1);\r\n\t\t\tthis.admins = admins;\r\n\t\t\tthis.data.isAdmin = true;\t\t\t\t\r\n\t\t});\r\n\t}\r\n\r\n\tbackend = async () => {\r\n\t\t//let cRoles = new CRoles(this.uq, this.res);\r\n\t\t//await cRoles.start();\r\n\t}\r\n\r\n\tadminSetting = async () => {\r\n\t\tthis.openVPage(VAdminSetting);\r\n\t}\r\n\r\n\ttestPointShop = async () => {\r\n\t\t//let ret = await this.uqs.JkPointShop.GetPoints.query({customer: 1});\r\n\t}\r\n}\r\n","import { UQs } from \"uq-app\";\r\nimport { Log } from \"../Logger\";\r\n\r\nexport const testTimesChange = {\r\n\tname: 'TimesChange', \r\n\tdiscription: 'Test Times Change hours', \r\n\ttest: async (log: Log, uqs: UQs):Promise<void> => {\r\n\t\t/*\r\n\t\tlet tc = uqs.BzTimesChange;\r\n\t\tlet ret = await tc.IDActs({\r\n\t\t\tstaff: [\r\n\t\t\t\t{id: undefined, no: '101', firstName: 'Song', lastName: 'Sha'}\r\n\t\t\t]\r\n\t\t});\r\n\t\tlog(ret);\r\n\t\tlet id = 13369344;\r\n\t\tlet r1 = await tc.IDActs({\r\n\t\t\thours: [\r\n\t\t\t\t{id, onsite:{value: 3, time: new Date(2021, 0, 1)}}\r\n\t\t\t]\r\n\t\t});\r\n\t\tlog(r1);\r\n\r\n\t\tlet month = await tc.IDLog({\r\n\t\t\tIDX: tc.Hours,\r\n\t\t\tfield: 'onsite',\r\n\t\t\tid,\r\n\t\t\tlog: 'month',\r\n\t\t\tpage: {\r\n\t\t\t\tstart: undefined,\r\n\t\t\t\tend: new Date(2021,0,1).getTime(),\r\n\t\t\t\tsize: 10,\r\n\t\t\t}\r\n\t\t});\r\n\t\tlog(month);\r\n\r\n\t\tlet sum = await tc.IDSum({\r\n\t\t\tIDX: tc.Hours,\r\n\t\t\tfield: ['onsite'],\r\n\t\t\tid: [id],\r\n\t\t\tfar: undefined,\r\n\t\t\tnear: new Date().getTime(),\r\n\t\t});\r\n\t\tlog(sum);\r\n\t\t*/\r\n\t}\r\n}\r\n","import { DebugItem } from \"../CBug\";\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nimport { UQs } from \"uq-app\";\r\nimport { Log } from \"../Logger\";\r\n\r\n//BzTest, BzHelloTonva, BzCustomerPayment, \r\n\r\nexport const testItem1:DebugItem = {\r\n\tname: 'HelloTonva.GetProductStock',\r\n\tdiscription: '{product: 1}',\r\n\ttest: async ( log: Log, uqs: UQs):Promise<void> => {\r\n\t\t/*\r\n\t\tlet a = await uqs.BzTest.ID({\r\n\t\t\tIDX: uqs.BzTest.X1,\r\n\t\t\tid: 7077888,\r\n\t\t});\r\n\t\tfor (let item of a) {\r\n\t\t\tlog(item);\r\n\t\t}\r\n\r\n\t\tlet e = await uqs.BzTest.IDActs({\r\n\t\t\ttag: [\r\n\t\t\t\t{id: undefined, type: 'a', name: 'b'},\r\n\t\t\t\t{id: undefined, type: 'a', name: 'c'},\r\n\t\t\t\t{id: undefined, type: 'd', name: 'c'},\r\n\t\t\t],\r\n\t\t\tx1: [\r\n\t\t\t\t{id: undefined, a1: 1, a2: 3, a3:5, n5: 7},\r\n\t\t\t\t{id: undefined, a1: 1, a2: 7, a3:51, n5: 71},\r\n\t\t\t],\r\n\t\t\tassign1: [\r\n\t\t\t\t{id: 3, id2: 5, val: 3},\r\n\t\t\t\t{id: 3, id2: 6, val: 30},\r\n\t\t\t],\r\n\t\t\tiBook1: [\r\n\t\t\t\t{id: 7, f1: 3.5, f2: 7.2, b: 'bbbb', c: 1},\r\n\t\t\t\t{id: 8, f1: 3.5, f2: 7.2, b: 'bbbbc', c: 2},\r\n\t\t\t],\r\n\t\t});\r\n\t\tlog(e);\r\n\r\n\t\tlet b = await uqs.BzTest.IDDetail<BzTest.OrderMaster, BzTest.OrderDetail>\r\n\t\t({\r\n\t\t\tmaster: {\r\n\t\t\t\tID: uqs.BzTest.OrderMaster,\r\n\t\t\t\tvalue: {customer: 1 },\r\n\t\t\t},\r\n\t\t\tdetail: {\r\n\t\t\t\tID: uqs.BzTest.OrderDetail,\r\n\t\t\t\tvalues: [\r\n\t\t\t\t\t{product:11, price:2.0, quantity:3.0, amount:6.0},\r\n\t\t\t\t\t{product:12, price:2.0, quantity:5.0, amount:10.0},\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tlog(b);\r\n\r\n\t\tlet c = await uqs.BzTest.IDDetailGet<BzTest.OrderMaster, BzTest.OrderDetail>({\r\n\t\t\tid: 8716325,\r\n\t\t\tmaster: uqs.BzTest.OrderMaster,\r\n\t\t\tdetail: uqs.BzTest.OrderDetail,\r\n\t\t});\r\n\r\n\t\tfor (let ci of c) {\r\n\t\t\tlog(ci);\r\n\t\t}\r\n\r\n\t\t//let u: BzHelloTonva.Return$pokedRet;\r\n\t\t//u.poke = 1;\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tlet f = BzCustomerPayment.EnumCustomerAction.confirm;\r\n\r\n\t\tlet ret = await uqs.BzHelloTonva.GetProductStock.query({product: 1});\r\n\t\tlog(ret);\r\n\t\t*/\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t\tlog('test1');\r\n\t}\r\n}","import { UQs } from \"uq-app\";\r\nimport { Log } from \"../Logger\";\r\n\r\nexport const testItem2 = {\r\n\tname: '第二测试', \r\n\tdiscription: 'second test', \r\n\ttest: async (log: Log, uqs: UQs):Promise<void> => {\r\n\t\t/*\r\n\t\tlet ret = await uqs.BzHelloTonva.TestArr.submitReturns({rows: [\r\n\t\t\t{a: 1, b: 2}, \r\n\t\t\t{a: 3, b: 4}, \r\n\t\t]});\r\n\t\tlog(ret);\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\t*/\r\n\t}\r\n}\r\n","import { UQs } from \"uq-app\";\r\nimport { Log } from \"../Logger\";\r\n\r\nexport const testItem3 = {\r\n\tname: '第三测试', \r\n\tdiscription: 'third test', \r\n\ttest: async (log: Log, uqs: UQs):Promise<void> => {\r\n\t\t/*\r\n\t\tlet a = await uqs.BzTest.IDLog({\r\n\t\t\tIDX: uqs.BzTest.IBook1,\r\n\t\t\tfield: 'f2',\r\n\t\t\tid: 7,\r\n\t\t\tlog: 'each',\r\n\t\t\tpage: {start:undefined, size: 50},\r\n\t\t});\r\n\t\tlog(a);\r\n\r\n\t\tlet b = await uqs.BzTest.KeyID({\r\n\t\t\tID: uqs.BzTest.X1,\r\n\t\t\tkey: {a1: 1, a2: undefined},\r\n\t\t});\r\n\t\tlog(b);\r\n\r\n\t\tlet c = await uqs.BzTest.IX({\r\n\t\t\tIX: uqs.BzTest.Assign1,\r\n\t\t\tid: 3,\r\n\t\t});\r\n\t\tlog(c);\r\n\r\n\t\tlet d = await uqs.BzTest.KeyIX({\r\n\t\t\tID: uqs.BzTest.X1,\r\n\t\t\tkey: {a1: 1, a2: undefined},\r\n\t\t\tIX: uqs.BzTest.Assign1,\r\n\t\t});\r\n\t\tlog(d);\r\n\r\n\t\tlet e = await uqs.BzTest.IDActs({\r\n\t\t\tiBook1: [\r\n\t\t\t\t{id: -7, f1: 3.5, f2: 7.2, b: 'bbbb', c: 1},\r\n\t\t\t]\r\n\t\t});\r\n\t\tlog(e);\r\n\r\n\t\tlet ret = await uqs.BzHelloTonva.TestArr.submitReturns({rows: [\r\n\t\t\t{a: 1, b: 2}, \r\n\t\t\t{a: 3, b: 4}, \r\n\t\t]});\r\n\t\tlog(ret);\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\tlog('test2 - ddd ');\r\n\t\t*/\r\n\t}\r\n}\r\n","import { UQs } from \"uq-app\";\r\nimport { Log } from \"../Logger\";\r\n\r\nexport const testItem4 = {\r\n\tname: 'Tag测试', \r\n\tdiscription: 'Tag Test', \r\n\ttest: async (log: Log, uqs: UQs):Promise<void> => {\r\n\t\t/*\r\n\t\tlet ret = await uqs.BzTest.IX({\r\n\t\t\tIX: uqs.BzTest.CustomerTag,\r\n\t\t\tid: 1,\r\n\t\t\tIDX: [uqs.BzTest.Tag],\r\n\t\t\tpage: undefined,\r\n\t\t});\r\n\t\tlog(ret);\r\n\t\t*/\r\n\t}\r\n}\r\n","import { DebugItem } from \"../CBug\";\r\nimport { testTimesChange } from \"./test-times-change\";\r\nimport { testItem1 } from \"./test1\";\r\nimport { testItem2 } from \"./test2\";\r\nimport { testItem3 } from \"./test3\";\r\nimport { testItem4 } from \"./test4\";\r\n\r\nexport const debugItems: DebugItem[] = [\r\n\ttestItem1,\r\n\ttestItem2,\r\n\ttestItem3,\r\n\ttestItem4,\r\n\ttestTimesChange,\r\n];\r\n","import { FA, LMR, VPage } from \"tonva-view\";\r\nimport { CBug, DebugItem } from \"./CBug\";\r\n\r\nexport class VBug extends VPage<CBug> {\r\n\theader() {\r\n\t\treturn <div className=\"px-3\">\r\n\t\t\tDebug\r\n\t\t\t<small className=\"text-muted\"> - 本页仅调试状态可见</small>\r\n\t\t</div>\r\n\t}\r\n\tcontent() {\r\n        return <div>\r\n\t\t\t<div>\r\n\t\t\t\t{this.controller.debugItems.map(this.renderItem)}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"px-3 py-2\">\r\n\t\t\t\t<button className=\"btn btn-primary\" onClick={this.controller.test}>test</button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderItem = (item:DebugItem, index:number):JSX.Element => {\r\n\t\tlet {name, discription} = item;\r\n\t\tlet right = <FA name=\"angle-right\" />;\r\n\t\treturn <LMR key={index} className=\"px-3 py-2 cursor-pointer mt-1 bg-white\"\r\n\t\t\tonClick={() => this.controller.openDebugPage(item)}\r\n\t\t\tright={right}>\r\n\t\t\t<div>{name} <small className=\"text-muted\">{discription}</small></div>\r\n\t\t</LMR>;\r\n\t}\r\n}","import { VPage } from \"tonva-view\";\r\nimport { CBug } from \"./CBug\";\r\n\r\nexport class VConsole extends VPage<CBug> {\r\n\tprivate div: HTMLDivElement;\r\n\tprivate divBottom: HTMLDivElement;\r\n\tinit() {\r\n\t\tthis.startAutoScrollToBottom();\r\n\t}\r\n\theader() {\r\n\t\treturn this.controller.currentItem.name;\r\n\t}\r\n\tcontent() {\r\n\t\tlet {currentItem} = this.controller;\r\n\t\tlet {name, discription} = currentItem;\r\n\t\treturn <div>\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t<div><b>{name}</b></div>\r\n\t\t\t<div>{discription}</div>\r\n\t\t\t</div>\r\n\t\t\t<div ref={t => this.div = t} className=\"p-3 border-top border-primary bg-light\" />\r\n\t\t\t<div ref={t => this.divBottom = t} />\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate autoScrollEnd:boolean = false;\r\n\tprivate autoScroll = true;\r\n    private lastScrollTop = 0;\r\n    private timeHandler:any;\r\n    private startAutoScrollToBottom() {\r\n\t\tif (this.autoScrollEnd === true) return;\r\n\t\tthis.autoScroll = true;\r\n\t\tif (this.timeHandler !== undefined) return;\r\n        this.timeHandler = setInterval(() => {\r\n\t\t\tif (this.autoScroll === false) return;\r\n            this.divBottom?.scrollIntoView();\r\n        }, 100);\r\n    }\r\n    private endAutoScrollToBottom() {\r\n        setTimeout(() => {\r\n\t\t\tthis.autoScroll = false;\r\n\t\t\tthis.autoScrollEnd = true;\r\n\t\t\tif (this.timeHandler === undefined) return;\r\n\t\t\tclearInterval(this.timeHandler);\r\n\t\t\tthis.timeHandler = undefined;\r\n\t\t}, 300);\r\n\t}\r\n\tprivate pauseAutoScrollToBottom() {\r\n\t\tthis.autoScroll = false;\r\n\t}\r\n\tprotected onPageScroll(e:any) {\r\n        let el = e.target as HTMLBaseElement;\r\n        let {scrollTop, scrollHeight, offsetHeight} = el;\r\n        if (scrollTop <= this.lastScrollTop) {\r\n            this.pauseAutoScrollToBottom();\r\n        }\r\n        else if (scrollTop + offsetHeight > scrollHeight - 30) {\r\n            this.startAutoScrollToBottom();\r\n        }\r\n\r\n        this.lastScrollTop = scrollTop;\r\n\t}\r\n\r\n\tlog = (message?: any):void => {\r\n\t\tconst range = document.createRange();\r\n\t\trange.selectNode(this.div);\r\n\t\tlet html:string;\r\n\t\tif (!message) {\r\n\t\t\thtml = '<div>&nbsp;</div>';\r\n\t\t}\r\n\t\telse if (typeof message === 'object') {\r\n\t\t\thtml = this.objToHtml(message);\r\n\t\t}\r\n\t\telse {\r\n\t\t\thtml = '<div>' + message + '</div>';\r\n\t\t}\r\n\t\tconst child = range.createContextualFragment(html);\r\n\t\tthis.div.appendChild(child);\r\n\t}\r\n\r\n\tprivate objToHtml(obj: any) {\r\n\t\tif (obj === null) return '<div>null</div>';\r\n\t\tif (obj === undefined) return '<div>undefined</div>';\r\n\t\tif (Array.isArray(obj) === true) {\r\n\t\t\treturn this.arrToHtml(0, obj);\r\n\t\t}\r\n\t\tlet ret = '<div>{</div>';\r\n\t\tfor (let i in obj) {\r\n\t\t\tret += this.indent(1) + i + ': ';\r\n\t\t\tlet v = obj[i];\r\n\t\t\tif (Array.isArray(v) === true) {\r\n\t\t\t\tret += this.arrToHtml(1, v);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tret += this.objToString(v);\r\n\t\t\t}\r\n\t\t}\r\n\t\tret += '<div>}</div>';\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate indent(n:number) {\r\n\t\tif (!n) return '';\r\n\t\tlet ret = '';\r\n\t\tn = n*2;\r\n\t\tfor (let i=0; i<n; i++) ret += '&emsp;';\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate objToString(obj: any) {\r\n\t\tif (obj === null) {\r\n\t\t\treturn 'null';\r\n\t\t}\r\n\t\tif (Array.isArray(obj) === true) {\r\n\t\t\treturn 'array[' + obj.length + ']';\r\n\t\t}\r\n\t\tswitch (typeof obj) {\r\n\t\tdefault: return obj.toString();\r\n\t\tcase 'undefined': return 'undefined';\r\n\t\tcase 'object':\r\n\t\t\tif (obj.tuid === undefined) {\r\n\t\t\t\treturn 'obj';\r\n\t\t\t}\r\n\t\t\treturn obj.id;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate objToLine(indent:number, obj:any) {\r\n\t\tlet first = true;\r\n\t\tlet ret = '<div>' + this.indent(indent) + '{ ';\r\n\t\tfor (let i in obj) {\r\n\t\t\tif (first === false) {\r\n\t\t\t\tret += ', ';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfirst = false;\r\n\t\t\t}\r\n\t\t\tret += i + ':' + this.objToString(obj[i]);\r\n\t\t}\r\n\t\tret += ' }</div>';\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate indentVal(indent:number, val:any):string {\r\n\t\treturn '<div>' + this.indent(indent) + val + '</div>'\r\n\t}\r\n\tprivate arrToHtml(indent:number, arr:any[]) {\r\n\t\tlet ret = '<div>' + this.indent(indent) + '[</div>';\r\n\t\tfor (let item of arr) {\r\n\t\t\tlet t:string|number;\r\n\t\t\tswitch (typeof item) {\r\n\t\t\t\tdefault: t = this.indentVal(indent+1, item); break;\r\n\t\t\t\tcase 'object': t = this.objToLine(indent+1, item); break;\r\n\t\t\t\tcase 'string': t = this.indentVal(indent+1, `'${item}'`); break;\r\n\t\t\t}\r\n\t\t\tret += t;\r\n\t\t}\r\n\t\tret += '<div>' + this.indent(indent) + ']</div>';\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import { CUqBase, UQs } from \"uq-app\";\r\nimport { Log } from \"./Logger\";\r\nimport { debugItems } from \"./tester\";\r\nimport { VBug } from \"./VBug\";\r\nimport { VConsole } from \"./VConsole\";\r\n\r\nexport interface DebugItem {\r\n\tname: string;\r\n\tdiscription?: string;\r\n\ttest: (log:Log, uqs: UQs) => Promise<void>;\r\n}\r\n\r\nexport class CBug extends CUqBase {\r\n\tdebugItems = [...debugItems];\r\n\tcurrentItem: DebugItem;\r\n\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\ttab = () => this.renderView(VBug);\r\n\r\n\tload = async () => {\r\n\r\n\t}\r\n\r\n\topenDebugPage = async (item:DebugItem) => {\r\n\t\tthis.currentItem = item;\r\n\t\tlet console = await this.openVPage(VConsole);\r\n\t\tlet {test} = item;\r\n\t\tlet start = new Date();\r\n\t\tconsole.log(`=== test start at ${start} ===`);\r\n\t\tconsole.log();\r\n\t\tawait test(console.log, this.uqs);\r\n\t\tlet span = Date.now() - start.getTime();\r\n\t\tlet ms = (1000 + (span % 1000)).toString().substr(1);\r\n\t\tlet s = Math.floor(span / 1000);\r\n\t\tlet m = Math.floor(s / 60);\r\n\t\tlet t = '';\r\n\t\tif (m > 0) t += ms + '\\'';\r\n\t\tt += s + '\"' + ms;\r\n\t\tconsole.log();\r\n\t\tconsole.log(`=== test end: ${t} ===`);\r\n\t}\r\n\r\n\ttest = async () => {\r\n\t\tlet uqName = 'BizDev/hello-tonva';\r\n\t\tlet roles = await this.getUqRoles(uqName);\r\n\t\talert(roles);\r\n\t}\r\n}\r\n","import { zh } from \"./zh\";\r\nimport { en } from \"./en\";\r\n\r\nexport const res = {\r\n\t$zh: zh,\r\n\t$en: en,\r\n}\r\n","export const zh = {\r\n\thome: '首页',\r\n\trelation: '关系',\r\n\tdiscover: '发现',\r\n\tsupervise: '团队',\r\n\ttest: '测试',\r\n\tdebug: 'Debug',\r\n\tme: '我',\r\n\r\n\tchangePassword: '修改密码',\r\n\taboutTheApp: '关于本APP',\r\n\tlogout: '退出登录',\r\n\tpleaseLogin: '登录',\r\n\tuserQuit: '注销用户',\r\n\r\n\tcontent: '内容',\r\n\tbackend: '后台管理',\r\n\r\n\tlist: '列表',\r\n}\r\n","export const en = {\r\n\thome: 'Home',\r\n\trelation: 'Relation',\r\n\tdiscover: 'Discover',\r\n\tsupervise: 'Supervise',\r\n\ttest: 'Test',\r\n\tdebug: 'Debug',\r\n\tme: 'Me',\r\n\r\n\tchangePassword: 'Change password',\r\n\taboutTheApp: 'About the APP',\r\n\tlogout: 'Logout',\r\n\tpleaseLogin: 'Login',\r\n\tuserQuit: 'User quit',\r\n\r\n\tcontent: 'Content',\r\n\tbackend: 'Backend Management',\r\n\r\n\tlist: 'List',\r\n}\r\n","//=== UqApp builder created on Tue Jan 05 2021 18:41:24 GMT-0500 (GMT-05:00) ===//\r\nimport { PageWebNav } from 'tonva-core';\r\nimport { VPage, TabProp, TabCaptionComponent, TabsProps, t } from \"tonva-view\";\r\nimport { CApp } from './CApp';\r\n\r\nconst color = (selected: boolean) => selected === true ? 'text-primary' : 'text-muted';\r\nfunction caption(label:string|JSX.Element, icon:string) {\r\n\treturn (selected: boolean) => TabCaptionComponent(label, icon, color(selected));\r\n}\r\n\r\nexport class VMain extends VPage<CApp> {\r\n\tprotected get tabsProps(): TabsProps {\r\n\t\tlet { cHome, cMe, cSupervise, ops } = this.controller;\r\n\t\tlet tabs: TabProp[] = [\r\n\t\t\t{name: 'home', caption: caption(t('home'), 'home'), content: cHome.tab},\r\n\t\t]\r\n\t\tif (ops.length > 0) {\r\n\t\t\ttabs.push(\r\n\t\t\t\t{name: 'supervise', caption: caption(t('supervise'), 'bar-chart'), content: cSupervise.tab, load: cSupervise.load},\r\n\t\t\t);\t\r\n\t\t}\r\n\t\ttabs.push(\r\n\t\t\t{name: 'me', caption: caption(t('me'), 'user-o'), content: cMe.tab, load: cMe.load},\r\n\t\t);\r\n\t\t/*\r\n\t\tif (this.isDev === true) {\r\n\t\t\ttabs.push({\r\n\t\t\t\tname: 'UI', caption: caption(t('UI'), 'television'), content: cUI.tab\r\n\t\t\t});\r\n\t\t\ttabs.push({\r\n\t\t\t\tname: 'debug', caption: caption(t('debug'), 'bug'), content: cBug.tab, onShown: cBug.load\r\n\t\t\t});\r\n\t\t}\r\n\t\t*/\r\n\t\treturn {tabs};\r\n\t}\r\n\r\n\tprotected get webNav(): PageWebNav<JSX.Element> {\r\n\t\treturn {\r\n\t\t\tnavHeader: <div>webNav header</div>, \r\n\t\t\tnavFooter: <div>webNav footer</div>,\r\n\t\t};\r\n\t}\r\n}\r\n","//=== UqApp builder created on Fri Nov 19 2021 14:42:41 GMT-0500 (北美东部标准时间) ===//\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\timport { IDXValue, Uq, UqTuid, UqAction, UqQuery, UqID } from \"tonva-core\";\n\t\timport { Render } from \"tonva-view\";\n\n\n//===============================\n//======= UQ 百灵威系统工程部/me ========\n//===============================\n\nexport enum Item {\n\torderDeliver = 1010,\n\torderAmount = 1011,\n\torderProfit = 1012,\n\torderFee = 1013,\n\torderReturn = 1020,\n\torderReceive = 1030,\n\torderReceiveReturn = 1040,\n\tprofitFee = 1110,\n\tcouponFee = 1111,\n\tamountFee = 1120,\n\tcustomerPoint = 2010\n}\n\nexport enum Post {\n\tstaff = 1010,\n\tstaffSales = 1100,\n\tmanager = 2010,\n\tmanagerIT = 2100,\n\tagent = 7010,\n\tagentSales = 7100,\n\tdistributor = 7500,\n\tdistributorSales = 7501,\n\tcustomer = 8010\n}\n\nexport enum OrderReady {\n\tsheet = 1,\n\tmargin = 4\n}\n\nexport enum EnumRole {\n\tall = 1,\n\tdev = 2\n}\n\nexport enum EnumRoleOp {\n\ttest = 1\n}\n\nexport enum EnumObjectType {\n\tnone = 0,\n\tuser = 1,\n\tcustomer = 2,\n\tstaff = 3,\n\tagent = 4,\n\tdistributor = 5,\n\tpost = 6\n}\n\nexport enum EnumAccount {\n\tcommission = 10\n}\n\nexport enum EnumBizOpType {\n\torderDeliverDone = 101,\n\torderReceiveDone = 102,\n\torderReturn = 103\n}\n\nexport interface Tuid$sheet {\n\tid?: number;\n\tno: string;\n\tuser: number;\n\tdate: any;\n\tsheet: number;\n\tversion: number;\n\tflow: number;\n\tapp: number;\n\tstate: number;\n\tdiscription: string;\n\tdata: string;\n\tprocessing: number;\n}\n\nexport interface Tuid$user {\n\tid?: number;\n\tname: string;\n\tnick: string;\n\ticon: string;\n\tassigned: string;\n\tpoke: number;\n\ttimezone: number;\n}\n\nexport interface ParamBusTestBoundStaffSales {\n\torderMain: number;\n}\nexport interface ResultBusTestBoundStaffSales {\n}\n\nexport interface ParamDoneDeliver {\n\tcustomer: number;\n\tcontact: number;\n\twarehouse: number;\n\tdetail: {\n\t\torderDetail: number;\n\t\tquantity: number;\n\t}[];\n\n}\nexport interface ResultDoneDeliver {\n}\n\nexport interface Param$setMyTimezone {\n\t_timezone: number;\n}\nexport interface Result$setMyTimezone {\n}\n\nexport interface Param_BuildLostSalesStaffOrderAmount {\n}\nexport interface Result_BuildLostSalesStaffOrderAmount {\n}\n\nexport interface Param$poked {\n}\nexport interface Return$pokedRet {\n\tpoke: number;\n}\nexport interface Result$poked {\n\tret: Return$pokedRet[];\n}\n\nexport interface ParamGetPostTitles {\n}\nexport interface ReturnGetPostTitlesRet {\n\tid: number;\n\ttitle: string;\n\tvice: string;\n}\nexport interface ResultGetPostTitles {\n\tret: ReturnGetPostTitlesRet[];\n}\n\nexport interface ParamGetItemTitles {\n}\nexport interface ReturnGetItemTitlesRet {\n\tid: number;\n\ttitle: string;\n\tvice: string;\n\tunit: string;\n\tfixed: number;\n}\nexport interface ResultGetItemTitles {\n\tret: ReturnGetItemTitlesRet[];\n}\n\nexport interface ParamUserObjectPostItem {\n}\nexport interface ReturnUserObjectPostItemRet {\n\tid: number;\n\tobject: number;\n\tpost: any;\n\titem: any;\n}\nexport interface ResultUserObjectPostItem {\n\tret: ReturnUserObjectPostItemRet[];\n}\n\nexport interface ParamGetUserSuperviseItem {\n}\nexport interface ReturnGetUserSuperviseItemRet {\n\titem: any;\n}\nexport interface ResultGetUserSuperviseItem {\n\tret: ReturnGetUserSuperviseItemRet[];\n}\n\nexport interface ParamGetItemSumMonths {\n\titem: any;\n\tdate: any;\n\tmonths: number;\n}\nexport interface ReturnGetItemSumMonthsRet {\n\tdate: any;\n\tvalue: number;\n}\nexport interface ResultGetItemSumMonths {\n\tret: ReturnGetItemSumMonthsRet[];\n}\n\nexport interface ParamGetItemSumDays {\n\titem: any;\n\tdate: any;\n\tdays: number;\n}\nexport interface ReturnGetItemSumDaysRet {\n\tdate: any;\n\tvalue: number;\n}\nexport interface ResultGetItemSumDays {\n\tret: ReturnGetItemSumDaysRet[];\n}\n\nexport interface ParamGetItemHistory {\n\titem: any;\n\tfrom: any;\n\tto: any;\n}\nexport interface ReturnGetItemHistory$page {\n\tid: number;\n\tbiz: number;\n\tbizOp: number;\n\titem: any;\n\tvalue: number;\n\tmemo: string;\n}\nexport interface ResultGetItemHistory {\n\t$page: ReturnGetItemHistory$page[];\n}\n\nexport interface ParamGetProductSumByMonth {\n\titem: any;\n\tmonth: number;\n\tcount: number;\n}\nexport interface ReturnGetProductSumByMonthRet {\n\tid: number;\n\tvalue: number;\n\tamount: number;\n\tprofit: number;\n\treceive: number;\n\treturn: number;\n}\nexport interface ResultGetProductSumByMonth {\n\tret: ReturnGetProductSumByMonthRet[];\n}\n\nexport interface ParamGetMonthSumProduct {\n\titem: any;\n\tid: number;\n}\nexport interface ReturnGetMonthSumProduct$page {\n\tmonth: number;\n\tvalue: number;\n\tamount: number;\n\tprofit: number;\n\treceive: number;\n\treturn: number;\n}\nexport interface ResultGetMonthSumProduct {\n\t$page: ReturnGetMonthSumProduct$page[];\n}\n\nexport interface ParamGetMonthSumCustomer {\n\titem: any;\n\tid: number;\n}\nexport interface ReturnGetMonthSumCustomer$page {\n\tmonth: number;\n\tvalue: number;\n\tamount: number;\n\tprofit: number;\n\treceive: number;\n\treturn: number;\n}\nexport interface ResultGetMonthSumCustomer {\n\t$page: ReturnGetMonthSumCustomer$page[];\n}\n\nexport interface ParamGetCustomerSumByMonth {\n\titem: any;\n\tmonth: number;\n\tcount: number;\n}\nexport interface ReturnGetCustomerSumByMonthRet {\n\tid: number;\n\tvalue: number;\n\tamount: number;\n\tprofit: number;\n\treceive: number;\n\treturn: number;\n}\nexport interface ResultGetCustomerSumByMonth {\n\tret: ReturnGetCustomerSumByMonthRet[];\n}\n\nexport interface ParamGetRoleOps {\n}\nexport interface ReturnGetRoleOpsRet {\n\trole: any;\n\top: any;\n}\nexport interface ResultGetRoleOps {\n\tret: ReturnGetRoleOpsRet[];\n}\n\nexport interface ParamGetObjects {\n}\nexport interface ReturnGetObjectsRet {\n\tid: number;\n\ttype: any;\n}\nexport interface ResultGetObjects {\n\tret: ReturnGetObjectsRet[];\n}\n\nexport interface ParamGetGroupObjects {\n\tgroup: number;\n}\nexport interface ReturnGetGroupObjectsRet {\n\tid: number;\n\ttype: any;\n}\nexport interface ResultGetGroupObjects {\n\tret: ReturnGetGroupObjectsRet[];\n}\n\nexport interface ParamGetGroups {\n}\nexport interface ReturnGetGroupsRet {\n\tid: number;\n\tname: string;\n}\nexport interface ResultGetGroups {\n\tret: ReturnGetGroupsRet[];\n}\n\nexport interface ParamGetPosts {\n}\nexport interface ReturnGetPostsRet {\n\topi: number;\n\tobj: number;\n\tpost: any;\n\titem: any;\n\tamountThisMonth: number;\n\tamountLastMonth: number;\n}\nexport interface ResultGetPosts {\n\tret: ReturnGetPostsRet[];\n}\n\nexport interface ParamGetDistributors {\n}\nexport interface ReturnGetDistributorsRet {\n\tid: number;\n\tdistributor: number;\n}\nexport interface ResultGetDistributors {\n\tret: ReturnGetDistributorsRet[];\n}\n\nexport interface ParamGetStaffs {\n}\nexport interface ReturnGetStaffsRet {\n\topi: number;\n\titem: any;\n\tobj: number;\n\tstaff: number;\n\tvalueToday: number;\n\tvalueThisMonth: number;\n\tvalueLastMonth: number;\n}\nexport interface ResultGetStaffs {\n\tret: ReturnGetStaffsRet[];\n}\n\nexport interface ParamGetAgents {\n}\nexport interface ReturnGetAgentsRet {\n\tid: number;\n\tagent: number;\n}\nexport interface ResultGetAgents {\n\tret: ReturnGetAgentsRet[];\n}\n\nexport interface ParamGetObjectItemPeriodHistory {\n\tobjectPostItem: number;\n\tfrom: any;\n\tto: any;\n\tperiod: number;\n}\nexport interface ReturnGetObjectItemPeriodHistoryRet {\n\tdate: any;\n\tvalue: number;\n}\nexport interface ResultGetObjectItemPeriodHistory {\n\tret: ReturnGetObjectItemPeriodHistoryRet[];\n}\n\nexport interface ParamGetObjectPostItem {\n\tobject: number;\n}\nexport interface ReturnGetObjectPostItemRet {\n\tid: number;\n\tobject: number;\n\tpost: any;\n\titem: any;\n}\nexport interface ResultGetObjectPostItem {\n\tret: ReturnGetObjectPostItemRet[];\n}\n\nexport interface ParamGetObjectItemHistory {\n\tobjectPostItem: number;\n\tfrom: any;\n\tto: any;\n}\nexport interface ReturnGetObjectItemHistoryRet {\n\tminuteId: number;\n\tbiz: number;\n\tbizOp: number;\n\tvalue: number;\n\tmemo: string;\n}\nexport interface ResultGetObjectItemHistory {\n\tret: ReturnGetObjectItemHistoryRet[];\n}\n\nexport interface ParamGetObjectItemPeriodSum {\n\tobject: number;\n\tfrom: any;\n\tto: any;\n}\nexport interface ReturnGetObjectItemPeriodSumRet {\n\tid: number;\n\tobject: number;\n\tpost: any;\n\titem: any;\n\tvalue: number;\n}\nexport interface ResultGetObjectItemPeriodSum {\n\tret: ReturnGetObjectItemPeriodSumRet[];\n}\n\nexport interface ParamGetUserObjectItemPeriodSum {\n\tfrom: any;\n\tto: any;\n}\nexport interface ReturnGetUserObjectItemPeriodSumRet {\n\tid: number;\n\tobject: number;\n\tpost: any;\n\titem: any;\n\tvalue: number;\n}\nexport interface ResultGetUserObjectItemPeriodSum {\n\tret: ReturnGetUserObjectItemPeriodSumRet[];\n}\n\nexport interface ParamGetItemPeriodSum {\n\tdate: any;\n\tdays: number;\n}\nexport interface ReturnGetItemPeriodSumRet {\n\titem: any;\n\tvalue: number;\n}\nexport interface ResultGetItemPeriodSum {\n\tret: ReturnGetItemPeriodSumRet[];\n}\n\nexport interface Param$getMyTimezone {\n}\nexport interface Return$getMyTimezoneRet {\n\ttimezone: number;\n\tunitTimeZone: number;\n}\nexport interface Result$getMyTimezone {\n\tret: Return$getMyTimezoneRet[];\n}\n\nexport interface ParamGetUserObjectAccount {\n\tobject: number;\n}\nexport interface ReturnGetUserObjectAccountRet {\n\tobjectAccount: number;\n\tobject: number;\n\tpost: any;\n\taccount: any;\n\tbalance: number;\n}\nexport interface ResultGetUserObjectAccount {\n\tret: ReturnGetUserObjectAccountRet[];\n}\n\nexport interface ParamGetAccountTitles {\n}\nexport interface ReturnGetAccountTitlesRet {\n\tid: number;\n\ttitle: string;\n\tvice: string;\n\tunit: string;\n\tfixed: number;\n}\nexport interface ResultGetAccountTitles {\n\tret: ReturnGetAccountTitlesRet[];\n}\n\nexport interface ParamGetObjectAccountHistory {\n\tobjectAccount: number;\n}\nexport interface ReturnGetObjectAccountHistoryRet {\n\tdate: number;\n\tvalue: number;\n\tpost: any;\n\titem: any;\n}\nexport interface ResultGetObjectAccountHistory {\n\tret: ReturnGetObjectAccountHistoryRet[];\n}\n\nexport interface ParamGetAccounts {\n}\nexport interface ReturnGetAccountsRet {\n\tid: number;\n\tobject: number;\n\taccount: any;\n\tbalance: number;\n\tobjectType: any;\n\tobjectTo: number;\n}\nexport interface ResultGetAccounts {\n\tret: ReturnGetAccountsRet[];\n}\n\nexport interface Group {\n\tid?: number;\n\tname: string;\n}\n\nexport interface ParamActs {\n\tgroup?: Group[];\n}\n\n\t\nexport interface UqExt extends Uq {\n\t\tActs(param:ParamActs): Promise<any>;\n\t\n\t$sheet: UqTuid<Tuid$sheet>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\t$user: UqTuid<Tuid$user>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tBusTestBoundStaffSales: UqAction<ParamBusTestBoundStaffSales, ResultBusTestBoundStaffSales>;\n\tDoneDeliver: UqAction<ParamDoneDeliver, ResultDoneDeliver>;\n\t$setMyTimezone: UqAction<Param$setMyTimezone, Result$setMyTimezone>;\n\t_BuildLostSalesStaffOrderAmount: UqAction<Param_BuildLostSalesStaffOrderAmount, Result_BuildLostSalesStaffOrderAmount>;\n\t$poked: UqQuery<Param$poked, Result$poked>;\n\tGetPostTitles: UqQuery<ParamGetPostTitles, ResultGetPostTitles>;\n\tGetItemTitles: UqQuery<ParamGetItemTitles, ResultGetItemTitles>;\n\tUserObjectPostItem: UqQuery<ParamUserObjectPostItem, ResultUserObjectPostItem>;\n\tGetUserSuperviseItem: UqQuery<ParamGetUserSuperviseItem, ResultGetUserSuperviseItem>;\n\tGetItemSumMonths: UqQuery<ParamGetItemSumMonths, ResultGetItemSumMonths>;\n\tGetItemSumDays: UqQuery<ParamGetItemSumDays, ResultGetItemSumDays>;\n\tGetItemHistory: UqQuery<ParamGetItemHistory, ResultGetItemHistory>;\n\tGetProductSumByMonth: UqQuery<ParamGetProductSumByMonth, ResultGetProductSumByMonth>;\n\tGetMonthSumProduct: UqQuery<ParamGetMonthSumProduct, ResultGetMonthSumProduct>;\n\tGetMonthSumCustomer: UqQuery<ParamGetMonthSumCustomer, ResultGetMonthSumCustomer>;\n\tGetCustomerSumByMonth: UqQuery<ParamGetCustomerSumByMonth, ResultGetCustomerSumByMonth>;\n\tGetRoleOps: UqQuery<ParamGetRoleOps, ResultGetRoleOps>;\n\tGetObjects: UqQuery<ParamGetObjects, ResultGetObjects>;\n\tGetGroupObjects: UqQuery<ParamGetGroupObjects, ResultGetGroupObjects>;\n\tGetGroups: UqQuery<ParamGetGroups, ResultGetGroups>;\n\tGetPosts: UqQuery<ParamGetPosts, ResultGetPosts>;\n\tGetDistributors: UqQuery<ParamGetDistributors, ResultGetDistributors>;\n\tGetStaffs: UqQuery<ParamGetStaffs, ResultGetStaffs>;\n\tGetAgents: UqQuery<ParamGetAgents, ResultGetAgents>;\n\tGetObjectItemPeriodHistory: UqQuery<ParamGetObjectItemPeriodHistory, ResultGetObjectItemPeriodHistory>;\n\tGetObjectPostItem: UqQuery<ParamGetObjectPostItem, ResultGetObjectPostItem>;\n\tGetObjectItemHistory: UqQuery<ParamGetObjectItemHistory, ResultGetObjectItemHistory>;\n\tGetObjectItemPeriodSum: UqQuery<ParamGetObjectItemPeriodSum, ResultGetObjectItemPeriodSum>;\n\tGetUserObjectItemPeriodSum: UqQuery<ParamGetUserObjectItemPeriodSum, ResultGetUserObjectItemPeriodSum>;\n\tGetItemPeriodSum: UqQuery<ParamGetItemPeriodSum, ResultGetItemPeriodSum>;\n\t$getMyTimezone: UqQuery<Param$getMyTimezone, Result$getMyTimezone>;\n\tGetUserObjectAccount: UqQuery<ParamGetUserObjectAccount, ResultGetUserObjectAccount>;\n\tGetAccountTitles: UqQuery<ParamGetAccountTitles, ResultGetAccountTitles>;\n\tGetObjectAccountHistory: UqQuery<ParamGetObjectAccountHistory, ResultGetObjectAccountHistory>;\n\tGetAccounts: UqQuery<ParamGetAccounts, ResultGetAccounts>;\n\tGroup: UqID<any>;\n}\n\n\texport function assign(uq: any, to:string, from:any): void {\n\t\tlet hasEntity = uq.hasEntity(to);\n\t\tif (hasEntity === false) {\n\t\t\treturn;\n\t\t}\n\t\tObject.assign((uq as any)[to], from);\n\t}\n\t","import { FA, LMR, VPage } from \"tonva-view\";\r\nimport { CTester, UIItem } from \"./CTest\";\r\n\r\nexport class VTester extends VPage<CTester> {\r\n\theader() {\r\n\t\treturn <div className=\"px-3\">\r\n\t\t\tUI\r\n\t\t\t<small className=\"text-muted\"> - 本页仅调试状态可见</small>\r\n\t\t</div>\r\n\t}\r\n\tcontent() {\r\n        return <div>\r\n\t\t\t<div>\r\n\t\t\t\t{this.controller.uiItems.map(this.renderItem)}\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderItem = (item:UIItem, index:number):JSX.Element => {\r\n\t\tlet {name, discription, click} = item;\r\n\t\tlet right = <FA name=\"angle-right\" />;\r\n\t\treturn <LMR key={index} className=\"px-3 py-2 cursor-pointer mt-1 bg-white\"\r\n\t\t\tonClick={click}\r\n\t\t\tright={right}>\r\n\t\t\t<div>{name} <small className=\"text-muted\">{discription}</small></div>\r\n\t\t</LMR>;\r\n\t}\r\n}\r\n","/* eslint-disable */\r\nimport { CBase/*, Context*/ } from \"tonva-view\";\r\n/*\r\nimport { CID, MidID, CIDX, MidIDX, MidTag, CIDTagList, CTagIDList\r\n\t, SheetUI, MidIDTagList, CSheetNew, MidSheet } from \"tonva-uqui\";\r\n*/\r\nimport { CApp, CUqBase, UQs } from \"uq-app\";\r\n//import { OrderDetail, OrderMaster } from \"uq-app/uqs/BzHelloTonva\";\r\nimport { VTester } from \"./VTest\";\r\n//import { isNumber } from \"lodash\";\r\n\r\nexport interface UIItem {\r\n\tname: string;\r\n\tdiscription?: string;\r\n\tclick: () => Promise<void>;\r\n}\r\n\r\nexport class CTester extends CUqBase {\r\n\treadonly uiItems:UIItem[] = [\r\n\t\t/*\r\n\t\t{\r\n\t\t\tname: 'customer',\r\n\t\t\tdiscription: '客户信息',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet mid = new MidID(uq, {ID:uq.Customer});\r\n\t\t\t\tlet cID = new CID(mid);\r\n\t\t\t\tawait cID.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'tag',\r\n\t\t\tdiscription: '客户标签',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet midTag = new MidTag(uq, uq.Customer, uq.CustomerTag, uq.Tag, 'customer');\r\n\t\t\t\tlet midIDTagList = new MidIDTagList(midTag);\r\n\t\t\t\tlet cIDTagList = new CIDTagList(midIDTagList);\r\n\t\t\t\tawait cIDTagList.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'tagCustomer',\r\n\t\t\tdiscription: '标签客户',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet midTag = new MidTag(uq, uq.Customer, uq.CustomerTag, uq.Tag, 'customer');\r\n\t\t\t\tlet cTagIDList = new CTagIDList(midTag);\r\n\t\t\t\tawait cTagIDList.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'staff',\r\n\t\t\tdiscription: 'TimeChange Staff',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet mid = new MidID(uq, {ID:uq.Staff});\r\n\t\t\t\tlet cStaff = new CID(mid);\r\n\t\t\t\tcStaff.renderItem = (item:any, index:number): JSX.Element => {\r\n\t\t\t\t\treturn <div className=\"\">{uq.Staff.render(item)}</div>\r\n\t\t\t\t};\r\n\t\t\t\tawait cStaff.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'hours',\r\n\t\t\tdiscription: 'TimeChange Hours',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet mid = new MidIDX(uq, uq.Hours, uq.Staff, this.timeZone);\r\n\t\t\t\tlet cHours = new CIDX(mid);\r\n\t\t\t\tawait cHours.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'sheet-order',\r\n\t\t\tdiscription: 'Sheet Order Hello Tonva',\r\n\t\t\tclick: async () => {\r\n\t\t\t\tlet uq = this.uqs.BzHelloTonva;\r\n\t\t\t\tlet onChanged = async (context:Context, value:any, prev:any) => {\r\n\t\t\t\t\tlet quantity = context.getValue('quantity');\r\n\t\t\t\t\tlet price = context.getValue('price');\r\n\t\t\t\t\tif (isNumber(quantity) && isNumber(value)) {\r\n\t\t\t\t\t\tcontext.setValue('amount', (price*quantity).toFixed(2));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlet sheetUI:SheetUI = {\r\n\t\t\t\t\tmaster: {\r\n\t\t\t\t\t\tID: uq.OrderMaster,\r\n\t\t\t\t\t\tfieldCustoms: {\r\n\t\t\t\t\t\t\tcustomer: {ID: uq.Customer},\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tdetail: {\r\n\t\t\t\t\t\tID: uq.OrderDetail,\r\n\t\t\t\t\t\tfieldCustoms: {\r\n\t\t\t\t\t\t\tproduct: { ID: uq.Customer },\r\n\t\t\t\t\t\t\tprice: { onChanged },\r\n\t\t\t\t\t\t\tquantity: { onChanged },\r\n\t\t\t\t\t\t\tamount: { readOnly: true, }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlet mid = new MidSheet<OrderMaster, OrderDetail>(uq, sheetUI, this.res);\r\n\t\t\t\tlet cSheetNew = new CSheetNew(mid);\r\n\t\t\t\tawait cSheetNew.start();\r\n\t\t\t}\r\n\t\t},\r\n\t\t*/\r\n\t];\r\n\r\n\tprotected async internalStart() {\r\n\t\tthis.openVPage(VTester);\r\n\t}\r\n\r\n\ttab = () => this.renderView(VTester);\r\n}\r\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { Group } from \"./JkMe\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tname: {\n\t\t\"name\": \"name\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"Name\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.name, \n];\n\nexport const ui: UI = {\n\tlabel: \"Group\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: Group):JSX.Element {\n\tlet {name} = item;\n\treturn <>{name}</>;\n};\n","import { UqExt as Uq, assign } from './JkMe';\nimport * as Group from './Group.ui';\n\t\t\n\texport function setUI(uq: Uq) {\n\tassign(uq, 'Group', Group);\n\t}\n\texport * from './JkMe';\n\t","//=== UqApp builder created on Fri Nov 19 2021 14:42:41 GMT-0500 (北美东部标准时间) ===//\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\timport { IDXValue, Uq, UqTuid, UqAction, UqQuery, UqMap, UqHistory, UqIX } from \"tonva-core\";\n\t\timport { Render } from \"tonva-view\";\n\n\n//===============================\n//======= UQ 百灵威系统工程部/product ========\n//===============================\n\nexport interface Tuid$user {\n\tid?: number;\n\tname: string;\n\tnick: string;\n\ticon: string;\n\tassigned: string;\n\tpoke: number;\n\ttimezone: number;\n}\n\nexport interface Tuid$sheet {\n\tid?: number;\n\tno: string;\n\tuser: number;\n\tdate: any;\n\tsheet: number;\n\tversion: number;\n\tflow: number;\n\tapp: number;\n\tstate: number;\n\tdiscription: string;\n\tdata: string;\n\tprocessing: number;\n}\n\nexport interface TuidChemical {\n\tid?: number;\n\tCAS: string;\n}\n\nexport interface TuidSalesRegion {\n\tid?: number;\n\tname: string;\n\tcurrency: number;\n\tno: string;\n}\n\nexport interface TuidCurrency {\n\tid?: number;\n\tname: string;\n\tsuffix: string;\n}\n\nexport interface TuidPackType {\n\tid?: number;\n\tname: string;\n\tdescription: string;\n}\n\nexport interface TuidLanguage {\n\tid?: number;\n\tno: string;\n\tdescription: string;\n}\n\nexport interface TuidBrand {\n\tid?: number;\n\tname: string;\n\tno: string;\n}\n\nexport interface TuidStuff {\n\tid?: number;\n\tname: string;\n\tpackType: number;\n}\n\nexport interface TuidProductX {\n\tid?: number;\n\tbrand: number;\n\torigin: string;\n\tdescription: string;\n\tdescriptionC: string;\n\timageUrl: string;\n\tno: string;\n\tisValid: number;\n}\n\nexport interface TuidProductCategory {\n\tid?: number;\n\tno: number;\n\tparent: number;\n\tisLeaf: number;\n\torderWithinParent: number;\n}\n\nexport interface TuidLot {\n\tid?: number;\n\tlotnumber: string;\n\tproduct: number;\n}\n\nexport interface TuidPackSalesLevel {\n\tid?: number;\n\tname: string;\n\tno: string;\n}\n\nexport interface ParamCountProductCategoryInclusion {\n}\nexport interface ResultCountProductCategoryInclusion {\n}\n\nexport interface Param$setMyTimezone {\n\t_timezone: number;\n}\nexport interface Result$setMyTimezone {\n}\n\nexport interface ParamGetRootCategory {\n\tsalesRegion: number;\n\tlanguage: number;\n}\nexport interface ReturnGetRootCategoryFirst {\n\tproductCategory: number;\n\tname: string;\n\ttotal: number;\n}\nexport interface ReturnGetRootCategorySecend {\n\tproductCategory: number;\n\tparent: number;\n\tname: string;\n\ttotal: number;\n}\nexport interface ReturnGetRootCategoryThird {\n\tproductCategory: number;\n\tparent: number;\n\tname: string;\n\ttotal: number;\n}\nexport interface ResultGetRootCategory {\n\tfirst: ReturnGetRootCategoryFirst[];\n\tsecend: ReturnGetRootCategorySecend[];\n\tthird: ReturnGetRootCategoryThird[];\n}\n\nexport interface ParamGetChildrenCategory {\n\tparent: number;\n\tsalesRegion: number;\n\tlanguage: number;\n}\nexport interface ReturnGetChildrenCategoryFirst {\n\tproductCategory: number;\n\tparent: number;\n\tname: string;\n\ttotal: number;\n}\nexport interface ReturnGetChildrenCategorySecend {\n\tproductCategory: number;\n\tparent: number;\n\tname: string;\n\ttotal: number;\n}\nexport interface ResultGetChildrenCategory {\n\tfirst: ReturnGetChildrenCategoryFirst[];\n\tsecend: ReturnGetChildrenCategorySecend[];\n}\n\nexport interface ParamSearchProductByCategory {\n\tproductCategory: number;\n\tsalesRegion: number;\n\tlanguage: number;\n}\nexport interface ReturnSearchProductByCategory$page {\n\tseq: number;\n\tid: number;\n\tno: string;\n\tbrand: number;\n\torigin: string;\n\tdescription: string;\n\tdescriptionC: string;\n\timageUrl: string;\n\tchemical: number;\n\tCAS: string;\n\tpurity: string;\n\tmolecularFomula: string;\n\tmolecularWeight: string;\n}\nexport interface ResultSearchProductByCategory {\n\t$page: ReturnSearchProductByCategory$page[];\n}\n\nexport interface ParamGetFutureDeliveryTime {\n\tproduct: number;\n\tsalesRegion: number;\n}\nexport interface ReturnGetFutureDeliveryTimeRet {\n\tminValue: number;\n\tmaxValue: number;\n\tunit: string;\n\tdeliveryTimeDescription: string;\n}\nexport interface ResultGetFutureDeliveryTime {\n\tret: ReturnGetFutureDeliveryTimeRet[];\n}\n\nexport interface ParamSearchProduct {\n\tkeyWord: string;\n\tsalesRegion: number;\n}\nexport interface ReturnSearchProduct$page {\n\tseq: number;\n\tid: number;\n\tno: string;\n\tbrand: number;\n\torigin: string;\n\tdescription: string;\n\tdescriptionC: string;\n\timageUrl: string;\n\tchemical: number;\n\tCAS: string;\n\tpurity: string;\n\tgradeCN: string;\n\tmolecularFomula: string;\n\tmolecularWeight: string;\n}\nexport interface ResultSearchProduct {\n\t$page: ReturnSearchProduct$page[];\n}\n\nexport interface ParamGetRootCategories {\n\tsalesRegion: number;\n\tlanguage: number;\n}\nexport interface ReturnGetRootCategoriesRet {\n\tproductCategory: number;\n\tname: string;\n\ttotal: number;\n}\nexport interface ResultGetRootCategories {\n\tret: ReturnGetRootCategoriesRet[];\n}\n\nexport interface ParamGetPack {\n\tbrandName: string;\n\torigin: string;\n\tradiox: number;\n\tradioy: number;\n\tunit: string;\n}\nexport interface ReturnGetPackRet {\n\tproduct: number;\n\tpack: number;\n\tjkcat: string;\n}\nexport interface ResultGetPack {\n\tret: ReturnGetPackRet[];\n}\n\nexport interface Param$poked {\n}\nexport interface Return$pokedRet {\n\tpoke: number;\n}\nexport interface Result$poked {\n\tret: Return$pokedRet[];\n}\n\nexport interface ParamSearchPointProduct {\n\tkeyWord: string;\n\tsalesRegion: number;\n}\nexport interface ReturnSearchPointProduct$page {\n\tseq: number;\n\tid: number;\n\tproduct: number;\n\torigin: string;\n\tdescription: string;\n\tdescriptionC: string;\n\timageUrl: string;\n\tradiox: number;\n\tradioy: number;\n\tunit: string;\n\tretail: number;\n}\nexport interface ResultSearchPointProduct {\n\t$page: ReturnSearchPointProduct$page[];\n}\n\nexport interface ParamGetProductByOrigin {\n\torigin: string;\n\tsalesRegion: number;\n}\nexport interface ReturnGetProductByOriginRet {\n\tid: number;\n}\nexport interface ResultGetProductByOrigin {\n\tret: ReturnGetProductByOriginRet[];\n}\n\nexport interface ParamGetPointProductMoreBySource {\n\tpack: number;\n\tsalesRegion: number;\n}\nexport interface ReturnGetPointProductMoreBySourceRet {\n\tid: number;\n\tproduct: number;\n\torigin: string;\n\tdescription: string;\n\tdescriptionC: string;\n\timageUrl: string;\n\tradiox: number;\n\tradioy: number;\n\tunit: string;\n\tretail: number;\n}\nexport interface ResultGetPointProductMoreBySource {\n\tret: ReturnGetPointProductMoreBySourceRet[];\n}\n\nexport interface ParamGetLotByLotnumber {\n\tlotnumber: string;\n\torigin: string;\n}\nexport interface ReturnGetLotByLotnumberRet {\n\tid: number;\n\tproduct: number;\n}\nexport interface ResultGetLotByLotnumber {\n\tret: ReturnGetLotByLotnumberRet[];\n}\n\nexport interface ParamGetAvailableProductById {\n\tproduct: number;\n\tsalesRegion: number;\n}\nexport interface ReturnGetAvailableProductByIdRet {\n\tid: number;\n\tbrand: number;\n\torigin: string;\n\tdescription: string;\n\tdescriptionC: string;\n\timageUrl: string;\n\tno: string;\n\tisValid: number;\n}\nexport interface ResultGetAvailableProductById {\n\tret: ReturnGetAvailableProductByIdRet[];\n}\n\nexport interface ParamGetProductPackByOrigin {\n\torigin: string;\n\tsalesRegion: number;\n}\nexport interface ReturnGetProductPackByOriginRet {\n\tproduct: number;\n\tpack: number;\n}\nexport interface ResultGetProductPackByOrigin {\n\tret: ReturnGetProductPackByOriginRet[];\n}\n\nexport interface ParamGetProductPrices {\n\tproduct: number;\n\tsalesRegion: number;\n}\nexport interface ReturnGetProductPricesRet {\n\tproduct: number;\n\tpack: number;\n\tsalesRegion: number;\n\tretail: number;\n\texpireDate: any;\n\tdiscountinued: number;\n\tsalesLevel: number;\n}\nexport interface ResultGetProductPrices {\n\tret: ReturnGetProductPricesRet[];\n}\n\nexport interface ParamGetProductLotNumber {\n\tproduct: number;\n}\nexport interface ReturnGetProductLotNumberRet {\n\tid: number;\n\tproduct: number;\n\tlotnumber: string;\n}\nexport interface ResultGetProductLotNumber {\n\tret: ReturnGetProductLotNumberRet[];\n}\n\nexport interface Param$getMyTimezone {\n}\nexport interface Return$getMyTimezoneRet {\n\ttimezone: number;\n\tunitTimeZone: number;\n}\nexport interface Result$getMyTimezone {\n\tret: Return$getMyTimezoneRet[];\n}\n\nexport interface ParamPriceXquery {\n\tproduct: number;\n\tpack: number;\n\tsalesRegion: number;\n}\nexport interface ReturnPriceXqueryRet {\n\tproduct: number;\n\tpack: number;\n\tsalesRegion: number;\n\texpireDate: any;\n\tdiscountinued: number;\n\tretail: number;\n}\nexport interface ResultPriceXquery {\n\tret: ReturnPriceXqueryRet[];\n}\n\nexport interface ParamProductSearchHistory {\n\twebUser: number;\n\tsalesRegion: number;\n\tkeyword: string;\n}\nexport interface ReturnProductSearchHistory$page {\n\tdate: any;\n\twebUser: number;\n\tsalesRegion: number;\n\tkeyword: string;\n}\nexport interface ResultProductSearchHistory {\n\t$page: ReturnProductSearchHistory$page[];\n}\n\nexport interface ProductCategoryResearchDomain {\n\tix: number;\n\txi: number;\n}\n\nexport interface ParamActs {\n\tproductCategoryResearchDomain?: ProductCategoryResearchDomain[];\n}\n\n\t\nexport interface UqExt extends Uq {\n\t\tActs(param:ParamActs): Promise<any>;\n\t\n\t$user: UqTuid<Tuid$user>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\t$sheet: UqTuid<Tuid$sheet>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tChemical: UqTuid<TuidChemical>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tSalesRegion: UqTuid<TuidSalesRegion>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tCurrency: UqTuid<TuidCurrency>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tPackType: UqTuid<TuidPackType>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tLanguage: UqTuid<TuidLanguage>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tBrand: UqTuid<TuidBrand>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tStuff: UqTuid<TuidStuff>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tProductX: UqTuid<TuidProductX>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tProductCategory: UqTuid<TuidProductCategory>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tLot: UqTuid<TuidLot>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tPackSalesLevel: UqTuid<TuidPackSalesLevel>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tCountProductCategoryInclusion: UqAction<ParamCountProductCategoryInclusion, ResultCountProductCategoryInclusion>;\n\t$setMyTimezone: UqAction<Param$setMyTimezone, Result$setMyTimezone>;\n\tGetRootCategory: UqQuery<ParamGetRootCategory, ResultGetRootCategory>;\n\tGetChildrenCategory: UqQuery<ParamGetChildrenCategory, ResultGetChildrenCategory>;\n\tSearchProductByCategory: UqQuery<ParamSearchProductByCategory, ResultSearchProductByCategory>;\n\tGetFutureDeliveryTime: UqQuery<ParamGetFutureDeliveryTime, ResultGetFutureDeliveryTime>;\n\tSearchProduct: UqQuery<ParamSearchProduct, ResultSearchProduct>;\n\tGetRootCategories: UqQuery<ParamGetRootCategories, ResultGetRootCategories>;\n\tGetPack: UqQuery<ParamGetPack, ResultGetPack>;\n\t$poked: UqQuery<Param$poked, Result$poked>;\n\tSearchPointProduct: UqQuery<ParamSearchPointProduct, ResultSearchPointProduct>;\n\tGetProductByOrigin: UqQuery<ParamGetProductByOrigin, ResultGetProductByOrigin>;\n\tGetPointProductMoreBySource: UqQuery<ParamGetPointProductMoreBySource, ResultGetPointProductMoreBySource>;\n\tGetLotByLotnumber: UqQuery<ParamGetLotByLotnumber, ResultGetLotByLotnumber>;\n\tGetAvailableProductById: UqQuery<ParamGetAvailableProductById, ResultGetAvailableProductById>;\n\tGetProductPackByOrigin: UqQuery<ParamGetProductPackByOrigin, ResultGetProductPackByOrigin>;\n\tGetProductPrices: UqQuery<ParamGetProductPrices, ResultGetProductPrices>;\n\tGetProductLotNumber: UqQuery<ParamGetProductLotNumber, ResultGetProductLotNumber>;\n\t$getMyTimezone: UqQuery<Param$getMyTimezone, Result$getMyTimezone>;\n\tPriceXquery: UqQuery<ParamPriceXquery, ResultPriceXquery>;\n\tAgentPrice: UqMap;\n\tBrandSalesRegion: UqMap;\n\tBrandDeliveryTime: UqMap;\n\tProductStuff: UqMap;\n\tPriceX: UqMap;\n\tProductChemical: UqMap;\n\tProductSalesRegion: UqMap;\n\tProductLegallyProhibited: UqMap;\n\tProductCache: UqMap;\n\tProductProductCategory: UqMap;\n\tProductCategoryInclusion: UqMap;\n\tProductProductCategoryCache: UqMap;\n\tProductMSDSFile: UqMap;\n\tProductSpecFile: UqMap;\n\tProductSalesRank: UqMap;\n\tProductCategoryLeafCache: UqMap;\n\tCOA: UqMap;\n\tProductExtention: UqMap;\n\tProductDeliveryTime: UqMap;\n\tProductEmbargo: UqMap;\n\tProductStandardSample: UqMap;\n\tProductUserManualFile: UqMap;\n\tProductSearchHistory: UqHistory<ParamProductSearchHistory, ResultProductSearchHistory>;\n\tProductCategoryResearchDomain: UqIX<any>;\n}\n\n\texport function assign(uq: any, to:string, from:any): void {\n\t\tlet hasEntity = uq.hasEntity(to);\n\t\tif (hasEntity === false) {\n\t\t\treturn;\n\t\t}\n\t\tObject.assign((uq as any)[to], from);\n\t}\n\t","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidChemical } from \"./JkProduct\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidChemical):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidSalesRegion } from \"./JkProduct\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidSalesRegion):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidCurrency } from \"./JkProduct\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidCurrency):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidPackType } from \"./JkProduct\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidPackType):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidLanguage } from \"./JkProduct\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidLanguage):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidBrand } from \"./JkProduct\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidBrand):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidStuff } from \"./JkProduct\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidStuff):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","/* eslint-disable */\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidProductX } from \"./JkProduct\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidProductX):JSX.Element {\n\tlet {description, descriptionC, imageUrl, no} = item;\n\treturn <div>\n\t\t<div>{no} {descriptionC}</div>\n\t\t{\n\t\t\tdescriptionC === description? \n\t\t\t\tnull :\n\t\t\t\t<div className=\"small text-muted\">{description}</div>\n\t\t}\n\t</div>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidProductCategory } from \"./JkProduct\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidProductCategory):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidLot } from \"./JkProduct\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidLot):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidPackSalesLevel } from \"./JkProduct\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidPackSalesLevel):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\timport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\timport { Res, uqStringify, setRes } from \"tonva-core\";\n\timport { ProductCategoryResearchDomain } from \"./JkProduct\";\n\t\n\t/*--fields--*/\n\tconst fields = {\n\t};\n\t/*==fields==*/\n\t\n\tconst fieldArr: FieldItem[] = [\n\t];\n\t\n\texport const ui: UI = {\n\t\tlabel: \"ProductCategoryResearchDomain\",\n\t\tfieldArr,\n\t\tfields,\n\t};\n\t\n\tconst resRaw: Res<any> = {\n\t\t$zh: {\n\t\t},\n\t\t$en: {\n\t\t}\n\t};\n\tconst res: any = {};\n\tsetRes(res, resRaw);\n\t\n\texport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\t\treturn res[str as string] ?? str;\n\t}\n\t\n\texport function render(item: ProductCategoryResearchDomain):JSX.Element {\n\t\treturn <>{uqStringify(item)}</>;\n\t};\n\t","//=== UqApp builder created on Fri Nov 19 2021 14:42:41 GMT-0500 (北美东部标准时间) ===//\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\timport { IDXValue, Uq, UqTuid, UqAction, UqSheet, UqBook, UqQuery, UqMap, UqHistory, UqPending, UqID, UqIDX, UqIX } from \"tonva-core\";\n\t\timport { Render } from \"tonva-view\";\n\n\n//===============================\n//======= UQ 百灵威系统工程部/积分商城 ========\n//===============================\n\nexport enum EnumPointType {\n\ttotal = 1,\n\tpoint = 2,\n\tused = 3\n}\n\nexport enum EnumPointChangingSource {\n\tordermultiple = 1,\n\tsignIn = 2,\n\texchange = 3,\n\torder = 5,\n\tlottery = 8,\n\treturn = 9\n}\n\nexport enum EnumExchangeState {\n\tdelivering = 12,\n\tdelivered = 13,\n\tcompleted = 14,\n\tcanceled = 15\n}\n\nexport interface Tuid$user {\n\tid?: number;\n\tname: string;\n\tnick: string;\n\ticon: string;\n\tassigned: string;\n\tpoke: number;\n\ttimezone: number;\n}\n\nexport interface TuidProductX {\n\tid?: number;\n\timageUrl: string;\n}\n\nexport interface Tuid$sheet {\n\tid?: number;\n\tno: string;\n\tuser: number;\n\tdate: any;\n\tsheet: number;\n\tversion: number;\n\tflow: number;\n\tapp: number;\n\tstate: number;\n\tdiscription: string;\n\tdata: string;\n\tprocessing: number;\n}\n\nexport interface TuidCustomer {\n\tid?: number;\n}\n\nexport interface TuidWebUser {\n\tid?: number;\n}\n\nexport interface TuidContact {\n\tid?: number;\n}\n\nexport interface TuidCurrency {\n\tid?: number;\n}\n\nexport interface TuidBuyerAccount {\n\tid?: number;\n}\n\nexport interface TuidGenre {\n\tid?: number;\n\tname: string;\n\timageUrl: string;\n}\n\nexport interface TuidPointProductLib {\n\tid?: number;\n\tdescription: string;\n\tdescriptionC: string;\n\tgrade: string;\n\tpoint: number;\n\timageUrl: string;\n\tstartDate: any;\n\tendDate: any;\n\tisValid: number;\n}\n\nexport interface TuidBrand {\n\tid?: number;\n}\n\nexport interface ParamIsCanUseOrder {\n\torderId: string;\n\tcustomer: number;\n}\nexport interface ReturnIsCanUseOrderRet {\n\tresult: number;\n\tid: string;\n}\nexport interface ResultIsCanUseOrder {\n\tret: ReturnIsCanUseOrderRet[];\n}\n\nexport interface ParamAddPlatformOrderPoint {\n\torderId: string;\n\tcouponId: string;\n\tcustomer: number;\n}\nexport interface ReturnAddPlatformOrderPointRet {\n\tresult: number;\n}\nexport interface ResultAddPlatformOrderPoint {\n\tret: ReturnAddPlatformOrderPointRet[];\n}\n\nexport interface ParamGetLastPlatFormOrder {\n\tcustomer: number;\n}\nexport interface ReturnGetLastPlatFormOrderRet {\n\tresult: number;\n\tplatformOrderId: string;\n}\nexport interface ResultGetLastPlatFormOrder {\n\tret: ReturnGetLastPlatFormOrderRet[];\n}\n\nexport interface ParamSignin {\n\twebuser: number;\n\tcustomer: number;\n\tamount: number;\n}\nexport interface ResultSignin {\n}\n\nexport interface ParamSetPointProductVisits {\n\tpointProduct: number;\n}\nexport interface ResultSetPointProductVisits {\n}\n\nexport interface ParamPointProductGenreDelete {\n\tgenre: number;\n}\nexport interface ResultPointProductGenreDelete {\n}\n\nexport interface ParamPointChanged {\n\tcustomer: number;\n\tpoint: number;\n\tpointYear: number;\n\tpointType: number;\n\tpointSource: number;\n\tcomments: string;\n}\nexport interface ResultPointChanged {\n}\n\nexport interface Param$setMyTimezone {\n\t_timezone: number;\n}\nexport interface Result$setMyTimezone {\n}\n\nexport interface SheetPointExchangeSheet {\n\tcustomer: number;\n\twebUser: number;\n\tamount: number;\n\tshippingContact: number;\n\texchangeItems: {\n\t\tproduct: number;\n\t\tpoint: number;\n\t\tquantity: number;\n\t\tsubAmount: number;\n\t}[];\n}\n\nexport interface ParamGetPoints {\n\tcustomer: number;\n}\nexport interface ReturnGetPointsRet {\n\ttotalLeftPoint: number;\n\teffectiveLeftPoint: number;\n\tusedPoint: number;\n\tpointYear: number;\n}\nexport interface ResultGetPoints {\n\tret: ReturnGetPointsRet[];\n}\n\nexport interface ParamGetPointProduct {\n\tstartPoint: number;\n\tendPoint: number;\n}\nexport interface ReturnGetPointProductRet {\n\tproduct: number;\n}\nexport interface ResultGetPointProduct {\n\tret: ReturnGetPointProductRet[];\n}\n\nexport interface ParamGetPlatFormOrder {\n\tplatformOrderId: string;\n}\nexport interface ReturnGetPlatFormOrderRet {\n\tcustomer: number;\n\torderMaker: number;\n\tplatformOrderId: string;\n\tdescription: string;\n\tdescriptionC: string;\n\tradiox: number;\n\tradioy: number;\n\tunit: string;\n\tquantity: number;\n\tprice: number;\n\tsubAmount: number;\n\tamount: number;\n\tcurrency: number;\n\tmark: string;\n}\nexport interface ResultGetPlatFormOrder {\n\tret: ReturnGetPlatFormOrderRet[];\n}\n\nexport interface ParamGetOrderDrawable {\n\tcustomer: number;\n\tstartDate: any;\n}\nexport interface ReturnGetOrderDrawableRet {\n\torderId: string;\n\torderMaker: number;\n\tpoint: number;\n}\nexport interface ResultGetOrderDrawable {\n\tret: ReturnGetOrderDrawableRet[];\n}\n\nexport interface Param$poked {\n}\nexport interface Return$pokedRet {\n\tpoke: number;\n}\nexport interface Result$poked {\n\tret: Return$pokedRet[];\n}\n\nexport interface ParamGetPointHistory {\n\tcustomer: number;\n\tkey: string;\n}\nexport interface ReturnGetPointHistory$page {\n\tid: number;\n\tdate: any;\n\tpoint: number;\n\tpointYear: number;\n\tcomments: string;\n\tpointType: number;\n\tsource: number;\n}\nexport interface ResultGetPointHistory {\n\t$page: ReturnGetPointHistory$page[];\n}\n\nexport interface ParamCheckIsSignin {\n\tcustomer: number;\n}\nexport interface ReturnCheckIsSigninRet {\n\tresult: number;\n}\nexport interface ResultCheckIsSignin {\n\tret: ReturnCheckIsSigninRet[];\n}\n\nexport interface ParamGetPointSigninHistory {\n\tcustomer: number;\n}\nexport interface ReturnGetPointSigninHistory$page {\n\tid: number;\n\tdate: any;\n\tpoint: number;\n\tpointYear: number;\n\tcomments: string;\n\tpointType: number;\n\tsource: number;\n}\nexport interface ResultGetPointSigninHistory {\n\t$page: ReturnGetPointSigninHistory$page[];\n}\n\nexport interface ParamGetNewPointProducts {\n}\nexport interface ReturnGetNewPointProductsRet {\n\tid: number;\n\tpoint: number;\n\tstartDate: any;\n\tendDate: any;\n\timageUrl: string;\n}\nexport interface ResultGetNewPointProducts {\n\tret: ReturnGetNewPointProductsRet[];\n}\n\nexport interface ParamGetHotPointProducts {\n}\nexport interface ReturnGetHotPointProductsRet {\n\tid: number;\n\tpoint: number;\n\tstartDate: any;\n\tendDate: any;\n\timageUrl: string;\n}\nexport interface ResultGetHotPointProducts {\n\tret: ReturnGetHotPointProductsRet[];\n}\n\nexport interface ParamGetPointProductGenre {\n\tpointProduct: number;\n}\nexport interface ReturnGetPointProductGenreRet {\n\tpointProduct: number;\n\tgenre: number;\n}\nexport interface ResultGetPointProductGenre {\n\tret: ReturnGetPointProductGenreRet[];\n}\n\nexport interface ParamGetPointDistribution {\n\tstart: number;\n\tend: number;\n\tgranularity: number;\n}\nexport interface ReturnGetPointDistributionRet {\n\tsubStart: number;\n\tsubEnd: number;\n\tnumbers: number;\n}\nexport interface ResultGetPointDistribution {\n\tret: ReturnGetPointDistributionRet[];\n}\n\nexport interface ParamGetMaxPoints {\n}\nexport interface ReturnGetMaxPointsRet {\n\tmaxPoints: number;\n}\nexport interface ResultGetMaxPoints {\n\tret: ReturnGetMaxPointsRet[];\n}\n\nexport interface ParamGetPointProductBySource {\n\tsourceId: number;\n\ttype: string;\n}\nexport interface ReturnGetPointProductBySourceRet {\n\tpointProduct: number;\n}\nexport interface ResultGetPointProductBySource {\n\tret: ReturnGetPointProductBySourceRet[];\n}\n\nexport interface ParamGetVisitPointProducts {\n}\nexport interface ReturnGetVisitPointProducts$page {\n\tseq: number;\n\tid: number;\n\tpoint: number;\n\tstartDate: any;\n\tendDate: any;\n\timageUrl: string;\n\tvisits: number;\n\texchanges: number;\n}\nexport interface ResultGetVisitPointProducts {\n\t$page: ReturnGetVisitPointProducts$page[];\n}\n\nexport interface ParamGetPointProductByGenre {\n\tgenre: number;\n}\nexport interface ReturnGetPointProductByGenreRet {\n\tpointProduct: number;\n\tgenre: number;\n}\nexport interface ResultGetPointProductByGenre {\n\tret: ReturnGetPointProductByGenreRet[];\n}\n\nexport interface ParamGetPointProductsByPage {\n\tkeyWord: string;\n}\nexport interface ReturnGetPointProductsByPage$page {\n\tseq: number;\n\tid: number;\n\tdescription: string;\n\tdescriptionC: string;\n\tgrade: string;\n\tpoint: number;\n\timageUrl: string;\n}\nexport interface ResultGetPointProductsByPage {\n\t$page: ReturnGetPointProductsByPage$page[];\n}\n\nexport interface ParamGetBrandMinDiscount {\n}\nexport interface ReturnGetBrandMinDiscount$page {\n\tseq: number;\n\tbrand: number;\n\tdiscount: number;\n\tisValid: number;\n}\nexport interface ResultGetBrandMinDiscount {\n\t$page: ReturnGetBrandMinDiscount$page[];\n}\n\nexport interface ParamSearchExchangeOrders {\n\tcustomer: number;\n}\nexport interface ReturnSearchExchangeOrders$page {\n\tseq: number;\n\tid: number;\n\tno: string;\n\tdate: any;\n\tstate: string;\n}\nexport interface ResultSearchExchangeOrders {\n\t$page: ReturnSearchExchangeOrders$page[];\n}\n\nexport interface Param$getMyTimezone {\n}\nexport interface Return$getMyTimezoneRet {\n\ttimezone: number;\n\tunitTimeZone: number;\n}\nexport interface Result$getMyTimezone {\n\tret: Return$getMyTimezoneRet[];\n}\n\nexport interface ParamPointBook {\n\twebUser: number;\n}\nexport interface ReturnPointBook$page {\n\tpointYear: number;\n\tpoint: number;\n\tusedPoint: number;\n\ttotalPoint: number;\n\ttempPoint: number;\n\ttempUsedPoint: number;\n\ttempSignInPoint: number;\n}\nexport interface ResultPointBook {\n\t$page: ReturnPointBook$page[];\n}\n\nexport interface ParamPointBookByCustomer {\n\tcustomer: number;\n}\nexport interface ReturnPointBookByCustomer$page {\n\tpointYear: number;\n\tpoint: number;\n\tusedPoint: number;\n\ttotalPoint: number;\n}\nexport interface ResultPointBookByCustomer {\n\t$page: ReturnPointBookByCustomer$page[];\n}\n\nexport interface ParamPointProductHotStat {\n}\nexport interface ReturnPointProductHotStat$page {\n\tpointProduct: number;\n\tvisits: number;\n\texchanges: number;\n}\nexport interface ResultPointProductHotStat {\n\t$page: ReturnPointProductHotStat$page[];\n}\n\nexport interface ParamPointDistributionBook {\n}\nexport interface ReturnPointDistributionBook$page {\n\tpointStart: number;\n\tnumbers: number;\n}\nexport interface ResultPointDistributionBook {\n\t$page: ReturnPointDistributionBook$page[];\n}\n\nexport interface ParamPointHistory {\n\tpointYear: number;\n\tpoint: number;\n\tpointType: any;\n\tsource: any;\n\tcomments: string;\n\twebUser: number;\n}\nexport interface ReturnPointHistory$page {\n\tdate: any;\n\tpointYear: number;\n\tpoint: number;\n\tpointType: any;\n\tsource: any;\n\tcomments: string;\n\twebUser: number;\n\ttype: number;\n\tsheet: number;\n\trow: number;\n}\nexport interface ResultPointHistory {\n\t$page: ReturnPointHistory$page[];\n}\n\nexport interface ParamPointProductVisitHistory {\n\tpointProduct: number;\n\twebUser: number;\n}\nexport interface ReturnPointProductVisitHistory$page {\n\tdate: any;\n\tpointProduct: number;\n\twebUser: number;\n}\nexport interface ResultPointProductVisitHistory {\n\t$page: ReturnPointProductVisitHistory$page[];\n}\n\nexport interface ParamPointProductLibHistory {\n\tpointProduct: number;\n\tstartDate: any;\n\tendDate: any;\n\treason: string;\n\tcreateTime: any;\n}\nexport interface ReturnPointProductLibHistory$page {\n\tdate: any;\n\tpointProduct: number;\n\tstartDate: any;\n\tendDate: any;\n\treason: string;\n\tcreateTime: any;\n}\nexport interface ResultPointProductLibHistory {\n\t$page: ReturnPointProductLibHistory$page[];\n}\n\nexport interface ParamPointHistoryByCustomer {\n\tpointYear: number;\n\tpoint: number;\n\tpointType: any;\n\tsource: any;\n\tcomments: string;\n\tcustomer: number;\n}\nexport interface ReturnPointHistoryByCustomer$page {\n\tdate: any;\n\tpointYear: number;\n\tpoint: number;\n\tpointType: any;\n\tsource: any;\n\tcomments: string;\n\tcustomer: number;\n\ttype: number;\n\tsheet: number;\n\trow: number;\n}\nexport interface ResultPointHistoryByCustomer {\n\t$page: ReturnPointHistoryByCustomer$page[];\n}\n\nexport interface ParamOrderDetailPointHistory {\n\torderDetailId: number;\n\tpointYear: number;\n\tpoint: number;\n\ttype: number;\n\tcomments: string;\n}\nexport interface ReturnOrderDetailPointHistory$page {\n\tdate: any;\n\torderDetailId: number;\n\tpointYear: number;\n\tpoint: number;\n\ttype: number;\n\tcomments: string;\n}\nexport interface ResultOrderDetailPointHistory {\n\t$page: ReturnOrderDetailPointHistory$page[];\n}\n\nexport interface ParamReOrderDetailPointHistory {\n\torderDetailId: number;\n\tpointYear: number;\n\tpoint: number;\n\ttype: number;\n\tcomments: string;\n}\nexport interface ReturnReOrderDetailPointHistory$page {\n\tdate: any;\n\torderDetailId: number;\n\tpointYear: number;\n\tpoint: number;\n\ttype: number;\n\tcomments: string;\n}\nexport interface ResultReOrderDetailPointHistory {\n\t$page: ReturnReOrderDetailPointHistory$page[];\n}\n\nexport interface OrderMain {\n\tid?: number;\n\tno?: string;\n}\n\nexport interface OrderDetail {\n\tid?: number;\n\tmain?: number;\n\torderMainNo: string;\n\torderDetailNo: string;\n\tendUser: number;\n\tcreateDate: any;\n}\n\nexport interface ExchangeDetail {\n\tid?: number;\n\tmain?: number;\n\titem: number;\n\tquantity: number;\n\tpoint: number;\n\tsubAmount: number;\n}\n\nexport interface ExchangeMain {\n\tid?: number;\n\tno?: string;\n\tcustomer: number;\n\tshippingContact: number;\n\tamount: number;\n\tsheetId: number;\n\tcreateDate: any;\n}\n\nexport interface ReceiveMain {\n\tid?: number;\n\tcreateDate: any;\n}\n\nexport interface ReceiveDetail {\n\tid?: number;\n\tmain?: number;\n\torderDetail: number;\n\tamount: number;\n\tcreateDate: any;\n}\n\nexport interface DxOrderDetail {\n\tid: number;\n\tpoint?: number;\n\ttotalPoint?: number;\n\tmultiple?: number;\n\t$act?: number;\n}\n\nexport interface DxReOrderDetail {\n\tid: number;\n\tpoint?: number;\n\ttotalPoint?: number;\n\t$act?: number;\n}\n\nexport interface DxExchangeDetail {\n\tid: number;\n\tdeliver?: number;\n\tdeliverDone?: number;\n\tdeliverTime?: any;\n\t$act?: number;\n}\n\nexport interface DxExchangeMainState {\n\tid: number;\n\tstate?: any;\n\tcreateDate?: any;\n\t$act?: number;\n}\n\nexport interface ActParamDxOrderDetail {\n\tid: number|IDXValue;\n\tpoint?: number|IDXValue;\n\ttotalPoint?: number|IDXValue;\n\tmultiple?: number|IDXValue;\n\t$act?: number;\n}\n\nexport interface ActParamDxReOrderDetail {\n\tid: number|IDXValue;\n\tpoint?: number|IDXValue;\n\ttotalPoint?: number|IDXValue;\n\t$act?: number;\n}\n\nexport interface ActParamDxExchangeDetail {\n\tid: number|IDXValue;\n\tdeliver?: number|IDXValue;\n\tdeliverDone?: number|IDXValue;\n\tdeliverTime?: any|IDXValue;\n\t$act?: number;\n}\n\nexport interface ActParamDxExchangeMainState {\n\tid: number|IDXValue;\n\tstate?: any|IDXValue;\n\tcreateDate?: any|IDXValue;\n\t$act?: number;\n}\n\nexport interface IxExchangeMainUsedPoint {\n\tix: number;\n\txi: number;\n\tpoint: number;\n}\n\nexport interface ExchangeDetailDeliver {\n\tix: number;\n\txi: number;\n\tdeliverDone: number;\n\tdeliverTime: any;\n}\n\nexport interface IxOrderDetailReceive {\n\tix: number;\n\txi: number;\n\treceiveAmount: number;\n\tcreateDate: any;\n}\n\nexport interface ParamActs {\n\torderMain?: OrderMain[];\n\torderDetail?: OrderDetail[];\n\texchangeDetail?: ExchangeDetail[];\n\texchangeMain?: ExchangeMain[];\n\treceiveMain?: ReceiveMain[];\n\treceiveDetail?: ReceiveDetail[];\n\tdxOrderDetail?: ActParamDxOrderDetail[];\n\tdxReOrderDetail?: ActParamDxReOrderDetail[];\n\tdxExchangeDetail?: ActParamDxExchangeDetail[];\n\tdxExchangeMainState?: ActParamDxExchangeMainState[];\n\tixExchangeMainUsedPoint?: IxExchangeMainUsedPoint[];\n\texchangeDetailDeliver?: ExchangeDetailDeliver[];\n\tixOrderDetailReceive?: IxOrderDetailReceive[];\n}\n\n\t\nexport interface UqExt extends Uq {\n\t\tActs(param:ParamActs): Promise<any>;\n\t\n\t$user: UqTuid<Tuid$user>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tProductX: UqTuid<TuidProductX>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\t$sheet: UqTuid<Tuid$sheet>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tCustomer: UqTuid<TuidCustomer>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tWebUser: UqTuid<TuidWebUser>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tContact: UqTuid<TuidContact>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tCurrency: UqTuid<TuidCurrency>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tBuyerAccount: UqTuid<TuidBuyerAccount>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tGenre: UqTuid<TuidGenre>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tPointProductLib: UqTuid<TuidPointProductLib>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tBrand: UqTuid<TuidBrand>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tIsCanUseOrder: UqAction<ParamIsCanUseOrder, ResultIsCanUseOrder>;\n\tAddPlatformOrderPoint: UqAction<ParamAddPlatformOrderPoint, ResultAddPlatformOrderPoint>;\n\tGetLastPlatFormOrder: UqAction<ParamGetLastPlatFormOrder, ResultGetLastPlatFormOrder>;\n\tSignin: UqAction<ParamSignin, ResultSignin>;\n\tSetPointProductVisits: UqAction<ParamSetPointProductVisits, ResultSetPointProductVisits>;\n\tPointProductGenreDelete: UqAction<ParamPointProductGenreDelete, ResultPointProductGenreDelete>;\n\tPointChanged: UqAction<ParamPointChanged, ResultPointChanged>;\n\t$setMyTimezone: UqAction<Param$setMyTimezone, Result$setMyTimezone>;\n\tPointExchangeSheet: UqSheet<SheetPointExchangeSheet, any>;\n\tPointBook: UqBook<ParamPointBook, ResultPointBook>;\n\tPointBookByCustomer: UqBook<ParamPointBookByCustomer, ResultPointBookByCustomer>;\n\tPointProductHotStat: UqBook<ParamPointProductHotStat, ResultPointProductHotStat>;\n\tPointDistributionBook: UqBook<ParamPointDistributionBook, ResultPointDistributionBook>;\n\tGetPoints: UqQuery<ParamGetPoints, ResultGetPoints>;\n\tGetPointProduct: UqQuery<ParamGetPointProduct, ResultGetPointProduct>;\n\tGetPlatFormOrder: UqQuery<ParamGetPlatFormOrder, ResultGetPlatFormOrder>;\n\tGetOrderDrawable: UqQuery<ParamGetOrderDrawable, ResultGetOrderDrawable>;\n\t$poked: UqQuery<Param$poked, Result$poked>;\n\tGetPointHistory: UqQuery<ParamGetPointHistory, ResultGetPointHistory>;\n\tCheckIsSignin: UqQuery<ParamCheckIsSignin, ResultCheckIsSignin>;\n\tGetPointSigninHistory: UqQuery<ParamGetPointSigninHistory, ResultGetPointSigninHistory>;\n\tGetNewPointProducts: UqQuery<ParamGetNewPointProducts, ResultGetNewPointProducts>;\n\tGetHotPointProducts: UqQuery<ParamGetHotPointProducts, ResultGetHotPointProducts>;\n\tGetPointProductGenre: UqQuery<ParamGetPointProductGenre, ResultGetPointProductGenre>;\n\tGetPointDistribution: UqQuery<ParamGetPointDistribution, ResultGetPointDistribution>;\n\tGetMaxPoints: UqQuery<ParamGetMaxPoints, ResultGetMaxPoints>;\n\tGetPointProductBySource: UqQuery<ParamGetPointProductBySource, ResultGetPointProductBySource>;\n\tGetVisitPointProducts: UqQuery<ParamGetVisitPointProducts, ResultGetVisitPointProducts>;\n\tGetPointProductByGenre: UqQuery<ParamGetPointProductByGenre, ResultGetPointProductByGenre>;\n\tGetPointProductsByPage: UqQuery<ParamGetPointProductsByPage, ResultGetPointProductsByPage>;\n\tGetBrandMinDiscount: UqQuery<ParamGetBrandMinDiscount, ResultGetBrandMinDiscount>;\n\tSearchExchangeOrders: UqQuery<ParamSearchExchangeOrders, ResultSearchExchangeOrders>;\n\t$getMyTimezone: UqQuery<Param$getMyTimezone, Result$getMyTimezone>;\n\tPointProduct: UqMap;\n\tPlatformOrder: UqMap;\n\tPlatformOrderUsed: UqMap;\n\tPointShopOrder: UqMap;\n\tPointProductGenre: UqMap;\n\tPointProductSource: UqMap;\n\tPointProductDetail: UqMap;\n\tBrandMinDiscount: UqMap;\n\tOrderBack: UqMap;\n\tPointCustomerBlacklist: UqMap;\n\tPointHistory: UqHistory<ParamPointHistory, ResultPointHistory>;\n\tPointProductVisitHistory: UqHistory<ParamPointProductVisitHistory, ResultPointProductVisitHistory>;\n\tPointProductLibHistory: UqHistory<ParamPointProductLibHistory, ResultPointProductLibHistory>;\n\tPointHistoryByCustomer: UqHistory<ParamPointHistoryByCustomer, ResultPointHistoryByCustomer>;\n\tOrderDetailPointHistory: UqHistory<ParamOrderDetailPointHistory, ResultOrderDetailPointHistory>;\n\tReOrderDetailPointHistory: UqHistory<ParamReOrderDetailPointHistory, ResultReOrderDetailPointHistory>;\n\tPlatformOrderPending: UqPending<any, any>;\n\tSOrderPaymentPending: UqPending<any, any>;\n\tOrderMain: UqID<any>;\n\tOrderDetail: UqID<any>;\n\tExchangeDetail: UqID<any>;\n\tExchangeMain: UqID<any>;\n\tReceiveMain: UqID<any>;\n\tReceiveDetail: UqID<any>;\n\tDxOrderDetail: UqIDX<any>;\n\tDxReOrderDetail: UqIDX<any>;\n\tDxExchangeDetail: UqIDX<any>;\n\tDxExchangeMainState: UqIDX<any>;\n\tIxExchangeMainUsedPoint: UqIX<any>;\n\tExchangeDetailDeliver: UqIX<any>;\n\tIxOrderDetailReceive: UqIX<any>;\n}\n\n\texport function assign(uq: any, to:string, from:any): void {\n\t\tlet hasEntity = uq.hasEntity(to);\n\t\tif (hasEntity === false) {\n\t\t\treturn;\n\t\t}\n\t\tObject.assign((uq as any)[to], from);\n\t}\n\t","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidProductX } from \"./JkPointShop\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidProductX):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidCustomer } from \"./JkPointShop\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidCustomer):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidWebUser } from \"./JkPointShop\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidWebUser):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidContact } from \"./JkPointShop\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidContact):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidCurrency } from \"./JkPointShop\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidCurrency):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidBuyerAccount } from \"./JkPointShop\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidBuyerAccount):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidGenre } from \"./JkPointShop\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidGenre):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidPointProductLib } from \"./JkPointShop\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidPointProductLib):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidBrand } from \"./JkPointShop\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidBrand):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { OrderMain } from \"./JkPointShop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tno: {\n\t\t\"name\": \"no\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"No\"\n\t} as FieldItemString,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.no, \n];\n\nexport const ui: UI = {\n\tlabel: \"OrderMain\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: OrderMain):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { OrderDetail } from \"./JkPointShop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tmain: {\n\t\t\"name\": \"main\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Main\"\n\t} as FieldItemId,\n\torderMainNo: {\n\t\t\"name\": \"orderMainNo\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"OrderMainNo\"\n\t} as FieldItemString,\n\torderDetailNo: {\n\t\t\"name\": \"orderDetailNo\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"OrderDetailNo\"\n\t} as FieldItemString,\n\tendUser: {\n\t\t\"name\": \"endUser\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"EndUser\"\n\t} as FieldItemId,\n\tcreateDate: {\n\t\t\"name\": \"createDate\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"CreateDate\"\n\t} as undefined,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.main, fields.orderMainNo, fields.orderDetailNo, fields.endUser, fields.createDate, \n];\n\nexport const ui: UI = {\n\tlabel: \"OrderDetail\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: OrderDetail):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { ExchangeDetail } from \"./JkPointShop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tmain: {\n\t\t\"name\": \"main\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Main\"\n\t} as FieldItemId,\n\titem: {\n\t\t\"name\": \"item\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Item\"\n\t} as FieldItemId,\n\tquantity: {\n\t\t\"name\": \"quantity\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"number\",\n\t\t\"label\": \"Quantity\"\n\t} as FieldItemNumber,\n\tpoint: {\n\t\t\"name\": \"point\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"number\",\n\t\t\"label\": \"Point\"\n\t} as FieldItemNumber,\n\tsubAmount: {\n\t\t\"name\": \"subAmount\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"number\",\n\t\t\"label\": \"SubAmount\"\n\t} as FieldItemNumber,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.main, fields.item, fields.quantity, fields.point, fields.subAmount, \n];\n\nexport const ui: UI = {\n\tlabel: \"ExchangeDetail\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: ExchangeDetail):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { ExchangeMain } from \"./JkPointShop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tno: {\n\t\t\"name\": \"no\",\n\t\t\"type\": \"string\",\n\t\t\"isKey\": true,\n\t\t\"widget\": \"string\",\n\t\t\"label\": \"No\"\n\t} as FieldItemString,\n\tcustomer: {\n\t\t\"name\": \"customer\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Customer\"\n\t} as FieldItemId,\n\tshippingContact: {\n\t\t\"name\": \"shippingContact\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"ShippingContact\"\n\t} as FieldItemId,\n\tamount: {\n\t\t\"name\": \"amount\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"number\",\n\t\t\"label\": \"Amount\"\n\t} as FieldItemNumber,\n\tsheetId: {\n\t\t\"name\": \"sheetId\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"SheetId\"\n\t} as FieldItemId,\n\tcreateDate: {\n\t\t\"name\": \"createDate\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"CreateDate\"\n\t} as undefined,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.no, fields.customer, fields.shippingContact, fields.amount, fields.sheetId, fields.createDate, \n];\n\nexport const ui: UI = {\n\tlabel: \"ExchangeMain\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: ExchangeMain):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { ReceiveMain } from \"./JkPointShop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tcreateDate: {\n\t\t\"name\": \"createDate\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"CreateDate\"\n\t} as undefined,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.createDate, \n];\n\nexport const ui: UI = {\n\tlabel: \"ReceiveMain\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: ReceiveMain):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { ReceiveDetail } from \"./JkPointShop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tmain: {\n\t\t\"name\": \"main\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Main\"\n\t} as FieldItemId,\n\torderDetail: {\n\t\t\"name\": \"orderDetail\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"OrderDetail\"\n\t} as FieldItemId,\n\tamount: {\n\t\t\"name\": \"amount\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"number\",\n\t\t\"label\": \"Amount\"\n\t} as FieldItemNumber,\n\tcreateDate: {\n\t\t\"name\": \"createDate\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"CreateDate\"\n\t} as undefined,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.main, fields.orderDetail, fields.amount, fields.createDate, \n];\n\nexport const ui: UI = {\n\tlabel: \"ReceiveDetail\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: ReceiveDetail):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { DxOrderDetail } from \"./JkPointShop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tpoint: {\n\t\t\"name\": \"point\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Point\"\n\t} as FieldItemInt,\n\ttotalPoint: {\n\t\t\"name\": \"totalPoint\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"TotalPoint\"\n\t} as FieldItemInt,\n\tmultiple: {\n\t\t\"name\": \"multiple\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Multiple\"\n\t} as FieldItemInt,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.point, fields.totalPoint, fields.multiple, \n];\n\nexport const ui: UI = {\n\tlabel: \"DxOrderDetail\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: DxOrderDetail):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { DxReOrderDetail } from \"./JkPointShop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tpoint: {\n\t\t\"name\": \"point\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"Point\"\n\t} as FieldItemInt,\n\ttotalPoint: {\n\t\t\"name\": \"totalPoint\",\n\t\t\"type\": \"integer\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"updown\",\n\t\t\"label\": \"TotalPoint\"\n\t} as FieldItemInt,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.point, fields.totalPoint, \n];\n\nexport const ui: UI = {\n\tlabel: \"DxReOrderDetail\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: DxReOrderDetail):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { DxExchangeDetail } from \"./JkPointShop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tdeliver: {\n\t\t\"name\": \"deliver\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"number\",\n\t\t\"label\": \"Deliver\"\n\t} as FieldItemNumber,\n\tdeliverDone: {\n\t\t\"name\": \"deliverDone\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"number\",\n\t\t\"label\": \"DeliverDone\"\n\t} as FieldItemNumber,\n\tdeliverTime: {\n\t\t\"name\": \"deliverTime\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"DeliverTime\"\n\t} as undefined,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.deliver, fields.deliverDone, fields.deliverTime, \n];\n\nexport const ui: UI = {\n\tlabel: \"DxExchangeDetail\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: DxExchangeDetail):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { DxExchangeMainState } from \"./JkPointShop\";\n\n/*--fields--*/\nconst fields = {\n\tid: {\n\t\t\"name\": \"id\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Id\"\n\t} as FieldItemId,\n\tstate: {\n\t\t\"name\": \"state\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"State\"\n\t} as undefined,\n\tcreateDate: {\n\t\t\"name\": \"createDate\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"CreateDate\"\n\t} as undefined,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.state, fields.createDate, \n];\n\nexport const ui: UI = {\n\tlabel: \"DxExchangeMainState\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: DxExchangeMainState):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { IxExchangeMainUsedPoint } from \"./JkPointShop\";\n\n/*--fields--*/\nconst fields = {\n\tix: {\n\t\t\"name\": \"ix\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Ix\"\n\t} as FieldItemId,\n\txi: {\n\t\t\"name\": \"xi\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Xi\"\n\t} as FieldItemId,\n\tpoint: {\n\t\t\"name\": \"point\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"number\",\n\t\t\"label\": \"Point\"\n\t} as FieldItemNumber,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.xi, fields.point, \n];\n\nexport const ui: UI = {\n\tlabel: \"IxExchangeMainUsedPoint\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: IxExchangeMainUsedPoint):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { ExchangeDetailDeliver } from \"./JkPointShop\";\n\n/*--fields--*/\nconst fields = {\n\tix: {\n\t\t\"name\": \"ix\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Ix\"\n\t} as FieldItemId,\n\txi: {\n\t\t\"name\": \"xi\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Xi\"\n\t} as FieldItemId,\n\tdeliverDone: {\n\t\t\"name\": \"deliverDone\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"number\",\n\t\t\"label\": \"DeliverDone\"\n\t} as FieldItemNumber,\n\tdeliverTime: {\n\t\t\"name\": \"deliverTime\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"DeliverTime\"\n\t} as undefined,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.xi, fields.deliverDone, fields.deliverTime, \n];\n\nexport const ui: UI = {\n\tlabel: \"ExchangeDetailDeliver\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: ExchangeDetailDeliver):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { IxOrderDetailReceive } from \"./JkPointShop\";\n\n/*--fields--*/\nconst fields = {\n\tix: {\n\t\t\"name\": \"ix\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Ix\"\n\t} as FieldItemId,\n\txi: {\n\t\t\"name\": \"xi\",\n\t\t\"type\": \"id\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"Xi\"\n\t} as FieldItemId,\n\treceiveAmount: {\n\t\t\"name\": \"receiveAmount\",\n\t\t\"type\": \"number\",\n\t\t\"isKey\": false,\n\t\t\"widget\": \"number\",\n\t\t\"label\": \"ReceiveAmount\"\n\t} as FieldItemNumber,\n\tcreateDate: {\n\t\t\"name\": \"createDate\",\n\t\t\"isKey\": false,\n\t\t\"label\": \"CreateDate\"\n\t} as undefined,\n};\n/*==fields==*/\n\nconst fieldArr: FieldItem[] = [\n\tfields.xi, fields.receiveAmount, fields.createDate, \n];\n\nexport const ui: UI = {\n\tlabel: \"IxOrderDetailReceive\",\n\tfieldArr,\n\tfields,\n};\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: IxOrderDetailReceive):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","//=== UqApp builder created on Fri Nov 19 2021 14:42:41 GMT-0500 (北美东部标准时间) ===//\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\timport { IDXValue, Uq, UqTuid, UqAction, UqQuery, UqMap } from \"tonva-core\";\n\t\timport { Render } from \"tonva-view\";\n\n\n//===============================\n//======= UQ 百灵威系统工程部/hr ========\n//===============================\n\nexport interface Tuid$user {\n\tid?: number;\n\tname: string;\n\tnick: string;\n\ticon: string;\n\tassigned: string;\n\tpoke: number;\n\ttimezone: number;\n}\n\nexport interface Tuid$sheet {\n\tid?: number;\n\tno: string;\n\tuser: number;\n\tdate: any;\n\tsheet: number;\n\tversion: number;\n\tflow: number;\n\tapp: number;\n\tstate: number;\n\tdiscription: string;\n\tdata: string;\n\tprocessing: number;\n}\n\nexport interface TuidEmployee {\n\tid?: number;\n\tname: string;\n\tno: string;\n\tfirstName: string;\n\tlastName: string;\n\ttitle: string;\n\tStatus: string;\n\tCreateTime: any;\n}\n\nexport interface TuidRole {\n\tid?: number;\n\tno: string;\n\tname: string;\n\tnote: string;\n\tIsValid: number;\n\tCreateTime: any;\n}\n\nexport interface TuidCompany {\n\tid?: number;\n\tno: string;\n\tname: string;\n}\n\nexport interface ParamDeleteWebuseEmployee {\n\twebuser: number;\n\temployee: number;\n}\nexport interface ResultDeleteWebuseEmployee {\n}\n\nexport interface ParamAddWebuseEmployee {\n\twebuser: number;\n\temployee: number;\n}\nexport interface ResultAddWebuseEmployee {\n}\n\nexport interface Param$setMyTimezone {\n\t_timezone: number;\n}\nexport interface Result$setMyTimezone {\n}\n\nexport interface ParamSearchEmployee {\n\tkey: string;\n}\nexport interface ReturnSearchEmployee$page {\n\tid: number;\n\tno: string;\n\tname: string;\n\tfirstName: string;\n\tlastName: string;\n\ttitle: string;\n\tStatus: string;\n\tCreateTime: any;\n\twebuser: number;\n\temployee: number;\n}\nexport interface ResultSearchEmployee {\n\t$page: ReturnSearchEmployee$page[];\n}\n\nexport interface ParamSearchTeam {\n\tkey: string;\n}\nexport interface ReturnSearchTeam$page {\n\tid: number;\n\twebuser: number;\n\temployee: number;\n}\nexport interface ResultSearchTeam {\n\t$page: ReturnSearchTeam$page[];\n}\n\nexport interface Param$poked {\n}\nexport interface Return$pokedRet {\n\tpoke: number;\n}\nexport interface Result$poked {\n\tret: Return$pokedRet[];\n}\n\nexport interface ParamGetWebUser {\n\temployee: number;\n}\nexport interface ReturnGetWebUserRet {\n\twebuser: number;\n\temployee: number;\n}\nexport interface ResultGetWebUser {\n\tret: ReturnGetWebUserRet[];\n}\n\nexport interface Param$getMyTimezone {\n}\nexport interface Return$getMyTimezoneRet {\n\ttimezone: number;\n\tunitTimeZone: number;\n}\nexport interface Result$getMyTimezone {\n\tret: Return$getMyTimezoneRet[];\n}\n\nexport interface ParamActs {\n}\n\n\t\nexport interface UqExt extends Uq {\n\t\tActs(param:ParamActs): Promise<any>;\n\t\n\t$user: UqTuid<Tuid$user>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\t$sheet: UqTuid<Tuid$sheet>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tEmployee: UqTuid<TuidEmployee>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tRole: UqTuid<TuidRole>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tCompany: UqTuid<TuidCompany>&{tv:(id:number, render?:Render<any>)=>JSX.Element};\n\tDeleteWebuseEmployee: UqAction<ParamDeleteWebuseEmployee, ResultDeleteWebuseEmployee>;\n\tAddWebuseEmployee: UqAction<ParamAddWebuseEmployee, ResultAddWebuseEmployee>;\n\t$setMyTimezone: UqAction<Param$setMyTimezone, Result$setMyTimezone>;\n\tSearchEmployee: UqQuery<ParamSearchEmployee, ResultSearchEmployee>;\n\tSearchTeam: UqQuery<ParamSearchTeam, ResultSearchTeam>;\n\t$poked: UqQuery<Param$poked, Result$poked>;\n\tGetWebUser: UqQuery<ParamGetWebUser, ResultGetWebUser>;\n\t$getMyTimezone: UqQuery<Param$getMyTimezone, Result$getMyTimezone>;\n\tEmployeeRole: UqMap;\n\tWebuserEmployee: UqMap;\n\tEmployeeRelation: UqMap;\n}\n\n\texport function assign(uq: any, to:string, from:any): void {\n\t\tlet hasEntity = uq.hasEntity(to);\n\t\tif (hasEntity === false) {\n\t\t\treturn;\n\t\t}\n\t\tObject.assign((uq as any)[to], from);\n\t}\n\t","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\nimport { TuidEmployee } from \"./JkHr\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidEmployee):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidRole } from \"./JkHr\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidRole):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { FieldItem, FieldItemNumber, FieldItemString, FieldItemId, FieldItemInt, UI, TFunc } from \"tonva-view\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport { Res, uqStringify, setRes } from \"tonva-core\";\nimport { TuidCompany } from \"./JkHr\";\n\nconst resRaw: Res<any> = {\n\t$zh: {\n\t},\n\t$en: {\n\t}\n};\nconst res: any = {};\nsetRes(res, resRaw);\n\nexport const t:TFunc = (str:string|JSX.Element): string|JSX.Element => {\n\treturn res[str as string] ?? str;\n}\n\nexport function render(item: TuidCompany):JSX.Element {\n\treturn <>{uqStringify(item)}</>;\n};\n","//=== UqApp builder created on Fri Nov 19 2021 14:42:41 GMT-0500 (北美东部标准时间) ===//\nimport * as JkMe from './JkMe';\nimport * as JkProduct from './JkProduct';\nimport * as JkPointShop from './JkPointShop';\nimport * as JkHr from './JkHr';\n\nexport interface UQs {\n\tJkMe: JkMe.UqExt;\n\tJkProduct: JkProduct.UqExt;\n\tJkPointShop: JkPointShop.UqExt;\n\tJkHr: JkHr.UqExt;\n}\n\nexport * as JkMe from './JkMe';\nexport * as JkProduct from './JkProduct';\nexport * as JkPointShop from './JkPointShop';\nexport * as JkHr from './JkHr';\n\nexport function setUI(uqs:UQs) {\n\tJkMe.setUI(uqs.JkMe);\n\tJkProduct.setUI(uqs.JkProduct);\n\tJkPointShop.setUI(uqs.JkPointShop);\n\tJkHr.setUI(uqs.JkHr);\n}\n","import { UqExt as Uq, assign } from './JkProduct';\nimport * as Chemical from './Chemical.ui';\nimport * as SalesRegion from './SalesRegion.ui';\nimport * as Currency from './Currency.ui';\nimport * as PackType from './PackType.ui';\nimport * as Language from './Language.ui';\nimport * as Brand from './Brand.ui';\nimport * as Stuff from './Stuff.ui';\nimport * as ProductX from './ProductX.ui';\nimport * as ProductCategory from './ProductCategory.ui';\nimport * as Lot from './Lot.ui';\nimport * as PackSalesLevel from './PackSalesLevel.ui';\nimport * as ProductCategoryResearchDomain from './ProductCategoryResearchDomain.ui';\n\t\t\n\texport function setUI(uq: Uq) {\n\tassign(uq, 'Chemical', Chemical);\n\tassign(uq, 'SalesRegion', SalesRegion);\n\tassign(uq, 'Currency', Currency);\n\tassign(uq, 'PackType', PackType);\n\tassign(uq, 'Language', Language);\n\tassign(uq, 'Brand', Brand);\n\tassign(uq, 'Stuff', Stuff);\n\tassign(uq, 'ProductX', ProductX);\n\tassign(uq, 'ProductCategory', ProductCategory);\n\tassign(uq, 'Lot', Lot);\n\tassign(uq, 'PackSalesLevel', PackSalesLevel);\n\tassign(uq, 'ProductCategoryResearchDomain', ProductCategoryResearchDomain);\n\t}\n\texport * from './JkProduct';\n\t","import { UqExt as Uq, assign } from './JkPointShop';\nimport * as ProductX from './ProductX.ui';\nimport * as Customer from './Customer.ui';\nimport * as WebUser from './WebUser.ui';\nimport * as Contact from './Contact.ui';\nimport * as Currency from './Currency.ui';\nimport * as BuyerAccount from './BuyerAccount.ui';\nimport * as Genre from './Genre.ui';\nimport * as PointProductLib from './PointProductLib.ui';\nimport * as Brand from './Brand.ui';\nimport * as OrderMain from './OrderMain.ui';\nimport * as OrderDetail from './OrderDetail.ui';\nimport * as ExchangeDetail from './ExchangeDetail.ui';\nimport * as ExchangeMain from './ExchangeMain.ui';\nimport * as ReceiveMain from './ReceiveMain.ui';\nimport * as ReceiveDetail from './ReceiveDetail.ui';\nimport * as DxOrderDetail from './DxOrderDetail.ui';\nimport * as DxReOrderDetail from './DxReOrderDetail.ui';\nimport * as DxExchangeDetail from './DxExchangeDetail.ui';\nimport * as DxExchangeMainState from './DxExchangeMainState.ui';\nimport * as IxExchangeMainUsedPoint from './IxExchangeMainUsedPoint.ui';\nimport * as ExchangeDetailDeliver from './ExchangeDetailDeliver.ui';\nimport * as IxOrderDetailReceive from './IxOrderDetailReceive.ui';\n\t\t\n\texport function setUI(uq: Uq) {\n\tassign(uq, 'ProductX', ProductX);\n\tassign(uq, 'Customer', Customer);\n\tassign(uq, 'WebUser', WebUser);\n\tassign(uq, 'Contact', Contact);\n\tassign(uq, 'Currency', Currency);\n\tassign(uq, 'BuyerAccount', BuyerAccount);\n\tassign(uq, 'Genre', Genre);\n\tassign(uq, 'PointProductLib', PointProductLib);\n\tassign(uq, 'Brand', Brand);\n\tassign(uq, 'OrderMain', OrderMain);\n\tassign(uq, 'OrderDetail', OrderDetail);\n\tassign(uq, 'ExchangeDetail', ExchangeDetail);\n\tassign(uq, 'ExchangeMain', ExchangeMain);\n\tassign(uq, 'ReceiveMain', ReceiveMain);\n\tassign(uq, 'ReceiveDetail', ReceiveDetail);\n\tassign(uq, 'DxOrderDetail', DxOrderDetail);\n\tassign(uq, 'DxReOrderDetail', DxReOrderDetail);\n\tassign(uq, 'DxExchangeDetail', DxExchangeDetail);\n\tassign(uq, 'DxExchangeMainState', DxExchangeMainState);\n\tassign(uq, 'IxExchangeMainUsedPoint', IxExchangeMainUsedPoint);\n\tassign(uq, 'ExchangeDetailDeliver', ExchangeDetailDeliver);\n\tassign(uq, 'IxOrderDetailReceive', IxOrderDetailReceive);\n\t}\n\texport * from './JkPointShop';\n\t","import { UqExt as Uq, assign } from './JkHr';\nimport * as Employee from './Employee.ui';\nimport * as Role from './Role.ui';\nimport * as Company from './Company.ui';\n\t\t\n\texport function setUI(uq: Uq) {\n\tassign(uq, 'Employee', Employee);\n\tassign(uq, 'Role', Role);\n\tassign(uq, 'Company', Company);\n\t}\n\texport * from './JkHr';\n\t","import { FA, List, LMR, VPage } from \"tonva-view\";\r\nimport { EnumRoleOp\r\n    , ReturnGetUserSuperviseItemRet } from \"uq-app/uqs/JkMe\";\r\nimport { Item  } from \"uq-app/uqs/JkMe/JkMe\";\r\nimport { CSupervise } from \"./CSupervise\";\r\n\r\ninterface VIndexProps {\r\n    icon?:string; \r\n    iconColor?:string;\r\n    caption:string; \r\n    action: ()=>void;\r\n}\r\n\r\nconst VIndex = ({icon, caption, action, iconColor}:VIndexProps) => {\r\n    let fa = <FA name={icon??'chevron-circle-right'} className={'me-3 ' + (iconColor??' text-success ')} />;\r\n    let right = <FA name=\"angle-right\" />\r\n    return <LMR left={fa} right={right}\r\n        className=\"px-3 py-2 mb-1 bg-white cursor-pointer align-items-center\" \r\n        onClick={action}>\r\n        {caption}\r\n    </LMR>\r\n}\r\n\r\nexport class VSupervise extends VPage<CSupervise> {\r\n    private renderOpTest = () => {\r\n        const queryList: {\r\n            caption: string;\r\n            item: Item;\r\n            action: (caption:string, item: Item) => void;\r\n        }[] = [\r\n            {\r\n                caption: '按月商品销售额排序',\r\n                item: Item.orderAmount,\r\n                action: this.controller.showProductSumByMonth,\r\n            },\r\n            {\r\n                caption: '按月商品毛利润排序',\r\n                item: Item.orderProfit,\r\n                action: this.controller.showProductSumByMonth,\r\n            },\r\n            {\r\n                caption: '按月客户销售额排序',\r\n                item: Item.orderAmount,\r\n                action: this.controller.showCustomerSumByMonth,\r\n            },\r\n            {\r\n                caption: '按月客户毛利润排序',\r\n                item: Item.orderProfit,\r\n                action: this.controller.showCustomerSumByMonth,\r\n            },\r\n        ];\r\n        let {superviseItems} = this.controller;\r\n        return <>\r\n            <div className=\"mb-4\">\r\n                <div className=\"my-2 mx-1 border border-info rounded\">\r\n                    <div className=\"p-3 border-bottom border-info bg-white\">\r\n                        <b>公司业务</b>\r\n                    </div>\r\n                    <div>\r\n                        {this.controller.renderVUnitSum()}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            {this.controller.cObjectsArr.map((v, index) => {\r\n                return <VIndex key={index} \r\n                    action={() => v.loadAndShowList()}\r\n                    caption={v.header()}\r\n                    iconColor=\"text-primary\" />;\r\n                /*\r\n                return <div key={index} className=\"px-3 py-2 mb-1 bg-white cursor-pointer\" \r\n                    onClick={() => v.loadAndShowList()}>\r\n                    {v.header()}\r\n                </div>\r\n                */\r\n            })}\r\n            <VIndex action={this.controller.showAccounts}\r\n                caption=\"账户余额列表\"\r\n                iconColor=\"text-primary\" />\r\n            <div className=\"mb-3\" />\r\n            {\r\n                queryList.map((v, index) => {\r\n                    let {caption, item, action} = v;\r\n                    return <VIndex key={index} iconColor=\"text-danger\"\r\n                        caption={caption} \r\n                        action={()=>action(caption, item)} />;\r\n                    /*\r\n                    return <div key={index} \r\n                        className=\"px-3 py-2 mb-1 bg-white cursor-pointer\" \r\n                        onClick={() => action(caption, item)}>\r\n                        {caption}\r\n                    </div>;\r\n                    */\r\n                })\r\n            }\r\n            <div className=\"mb-3\" />\r\n            <List items={superviseItems} none={null}\r\n                item={{render: this.renderSuperviseItem, onClick: this.onClickSuperviseItem}} />\r\n        </>;\r\n        /*\r\n            <List items={superviseObjects} \r\n            item={{render: this.renderSuperviseObject, onClick: this.onClickSuperviseObject}} />\r\n        <div className=\"mb-3\" />\r\n        */\r\n}\r\n\r\n    private opRenders: {[key in EnumRoleOp]: () => JSX.Element} = {\r\n        [EnumRoleOp.test]: this.renderOpTest,\r\n    }\r\n\r\n    superviseItems: ReturnGetUserSuperviseItemRet[];\r\n\r\n    header() {return '团队'}\r\n    content() {    \r\n        return <div>\r\n            {\r\n                this.controller.cApp.ops.map((v, index) => {\r\n                    let {op} = v;\r\n                    return <div key={index} className=\"py-2\">\r\n                        {this.opRenders[op]()}\r\n                    </div>;\r\n                })\r\n            }\r\n        </div>;\r\n    }\r\n\r\n    private renderSuperviseItem = (row: ReturnGetUserSuperviseItemRet, index: number) => {\r\n        let {item} = row;\r\n        let {itemTitles} = this.controller.cApp;\r\n\t\tlet {title, vice} = itemTitles[item as Item];\r\n        return <div className=\"px-3 py-2 align-items-center\">\r\n            全公司{title} <small className=\"text-muted ms-3\">{vice}</small>\r\n        </div>;\r\n    }\r\n    \r\n    private onClickSuperviseItem = (row: ReturnGetUserSuperviseItemRet) => {\r\n        this.controller.showItemSumHistory(row.item);\r\n    }\r\n}\r\n","import { CSupervise } from \"supervise\";\r\nimport { List, LMR, View, VPage } from \"tonva-view\";\r\nimport { ReturnGetItemSumDaysRet } from \"uq-app/uqs/JkMe\";\r\n\r\nexport class ViewItemDayHistory extends View<CSupervise> {\r\n    render() {\r\n        return <List items={this.controller.itemSumDays} \r\n            item={{render: this.renderDayItem, onClick: this.onClickDayItem}} />\r\n    }\r\n\r\n    private renderDayItem = (row: ReturnGetItemSumDaysRet, index: number) => {\r\n        let {cApp, item} = this.controller;\r\n        let {itemTitles} = cApp;\r\n        let {unit, fixed} = itemTitles[item];\r\n        let {date, value} = row;\r\n        return <LMR  className=\"px-3 py-2\" \r\n            left={<div>{new Date(date).toLocaleDateString()}</div>} \r\n            right={<div>{(value??0).toFixed(fixed??2)} {unit}</div>} />\r\n    }\r\n\r\n    private onClickDayItem = async (row: ReturnGetItemSumDaysRet) => {\r\n        let {date} = row;\r\n        let from = new Date(date);\r\n        let to = new Date(from);\r\n        to.setDate(to.getDate() + 1);\r\n        await this.controller.showItemHistory(from, to);\r\n    }\r\n}\r\n\r\nexport class VItemDayHistory extends VPage<CSupervise> {\r\n    header() {\r\n        let {cApp, item} = this.controller;\r\n        let {itemTitles} = cApp;\r\n\t\tlet {title} = itemTitles[item];\r\n        return title;\r\n    }\r\n\r\n    content() {\r\n        let v = new ViewItemDayHistory(this.controller);\r\n        return <div className=\"\">\r\n            {v.render()}\r\n        </div>\r\n    }\r\n}\r\n","import { CSupervise } from \"supervise\";\r\nimport { List, LMR, VPage } from \"tonva-view\";\r\nimport { ReturnGetItemSumMonthsRet } from \"uq-app/uqs/JkMe\";\r\nimport { ViewItemDayHistory } from \"./VItemDayHistory\";\r\n\r\nexport class VItemSumHistory extends VPage<CSupervise> {\r\n    header() {\r\n        let {cApp, item} = this.controller;\r\n        let {itemTitles} = cApp;\r\n\t\tlet {title} = itemTitles[item];\r\n        return title;\r\n    }\r\n\r\n    content() {\r\n        let v = new ViewItemDayHistory(this.controller);\r\n        return <div className=\"\">\r\n            <div className=\"px-3 pt-4 pb-2 text-center\">按日汇总 <small className=\"text-muted\">(近30日)</small></div>\r\n            {v.render()}\r\n            <div className=\"px-3 pt-4 pb-2 text-center\">按月汇总 <small className=\"text-muted\">(近12月))</small></div>\r\n            <List items={this.controller.itemSumMonths} \r\n                item={{render: this.renderMonthItem, onClick: this.onClickMonthItem}} />\r\n        </div>\r\n    }\r\n\r\n    private renderMonthItem = (row: ReturnGetItemSumMonthsRet, index: number) => {\r\n        let {cApp, item} = this.controller;\r\n        let {itemTitles} = cApp;\r\n        let {unit, fixed} = itemTitles[item];\r\n        let {date, value} = row;\r\n        let d = new Date(date);\r\n        return <LMR  className=\"px-3 py-2\" \r\n            left={<div>{d.getFullYear()}年{(d.getMonth()+1)}月</div>} \r\n            right={<div>{(value??0).toFixed(fixed??2)} {unit}</div>} />\r\n    }\r\n\r\n    private onClickMonthItem = async (row: ReturnGetItemSumMonthsRet) => {\r\n        let {date} = row;\r\n        let from = new Date(date.getFullYear(), date.getMonth(), 1);\r\n        let to = new Date(from);\r\n        to.setMonth(to.getMonth()+1);\r\n        await this.controller.showItemDayHistory(undefined, from, to);\r\n    }\r\n}\r\n","import { dateFromMinuteId } from 'tonva-core';\r\nimport { List, LMR, VDate, VPage } from \"tonva-view\";\r\nimport { CSupervise } from \"supervise\";\r\nimport { ReturnGetItemHistory$page } from \"uq-app/uqs/JkMe\";\r\n\r\nexport class VItemHistory extends VPage<CSupervise> {\r\n    header() {\r\n        let {cApp, item} = this.controller;\r\n        let {itemTitles} = cApp;\r\n\t\tlet {title} = itemTitles[item];\r\n        return title + '明细';\r\n    }\r\n\r\n    content() {\r\n        return <div className=\"\">\r\n            <List items={this.controller.pageItemHistory} \r\n                item={{render: this.renderItem, onClick: this.onClickItem}} />\r\n        </div>\r\n    }\r\n\r\n    private renderItem = (row: ReturnGetItemHistory$page, index: number) => {\r\n        let {cApp, item} = this.controller;\r\n        let {itemTitles, timezone} = cApp;\r\n        let {unit, fixed} = itemTitles[item];\r\n        let {id, bizOp, value, memo} = row;\r\n        let date = dateFromMinuteId(id, timezone);\r\n        let left = <div className=\"small text-muted w-min-6c\">\r\n            <VDate date={date} hideSameYear={true} />\r\n        </div>; \r\n        return <LMR className=\"px-3 py-2 align-items-center\" \r\n            left={left} \r\n            right={<div>{(value??0).toFixed(fixed??2)} <small className=\"text-muted\">{unit}</small></div>}>\r\n            <b>{bizOp}</b> {memo}\r\n        </LMR>;\r\n    }\r\n\r\n    private onClickItem = (row: ReturnGetItemHistory$page) => {\r\n        alert(JSON.stringify(row));\r\n    }\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { CSupervise } from \"supervise\";\r\nimport { FA, List, LMR, VPage } from \"tonva-view\";\r\nimport { ReturnGetProductSumByMonthRet } from \"uq-app/uqs/JkMe\";\r\n\r\nabstract class VSumByMonth extends VPage<CSupervise> {\r\n    header() { return this.controller.monthSum.vCaption; }\r\n\r\n    content() {\r\n        return <div className=\"\">\r\n            {\r\n                React.createElement(observer(() => <>\r\n                    {this.renderDate()}\r\n                    <List items={this.controller.monthSum.list} \r\n                        item={{render: this.renderItem, onClick: this.onClick}} />\r\n                </>))\r\n            }\r\n        </div>;\r\n    }\r\n    \r\n    protected abstract renderId(id: number): JSX.Element;\r\n\r\n    private renderDate() {\r\n        let {month, hasNext, prev, next} = this.controller.monthSum;\r\n        let left = <div className=\"cursor-pointer px-5 py-3\" onClick={prev}><FA name=\"angle-left\" /></div>;\r\n        let right = <div className={' px-5 py-3 ' + (hasNext? ' cursor-pointer ':' text-light ')} onClick={next}><FA name=\"angle-right\" /></div>\r\n        return <div className=\"d-flex justify-content-center\">\r\n            <div className=\"d-flex mx-auto\">\r\n                {left}\r\n                <div className=\"text-center py-3\">{month.getFullYear()}年{month.getMonth()+1}月</div>\r\n                {right}\r\n            </div>\r\n        </div>;\r\n\t}\r\n\r\n    private renderItem = (row: ReturnGetProductSumByMonthRet, index: number) => {\r\n        let {id, value} = row;\r\n        let {$serial} = row as any;\r\n        return <LMR  className=\"pe-2 pe-sm-3 py-2\" \r\n            left={<div className=\"w-min-2c text-center text-primary me-1 small\">{$serial}</div>} \r\n            right={<div className=\"ms-1\">{(value??0).toFixed(2)}<small className=\"text-muted\">元</small></div>}>\r\n                <div>{this.renderId(id)}</div>\r\n            </LMR>\r\n    }\r\n\r\n    private onClick = async (row: ReturnGetProductSumByMonthRet) => {\r\n        alert(JSON.stringify(row));\r\n    }\r\n}\r\n\r\nexport class VProductSumByMonth extends VSumByMonth {\r\n    protected renderId(id: number) {\r\n        return this.controller.uqs.JkProduct.ProductX.tv(id);\r\n    }\r\n}\r\n\r\nexport class VCustomerSumByMonth extends VSumByMonth {\r\n    protected renderId(id: number) {\r\n        return <>客户{id}</>;\r\n    }\r\n}\r\n","import { CSupervise } from \"../CSupervise\";\r\nimport { CApp, CUqSub, UQs } from \"uq-app\";\r\nimport { computed, makeObservable } from \"mobx\";\r\n\r\nexport abstract class CObjects extends CUqSub<CApp, UQs, CSupervise> {\r\n    abstract get baseList(): any[];\r\n\r\n    constructor(owner: CSupervise) {\r\n        super(owner);\r\n        makeObservable(this, {\r\n            baseList: computed,\r\n        });\r\n    }\r\n\r\n    protected async internalStart() {        \r\n    }\r\n    header() {return this.caption + '销售额列表'}\r\n    protected abstract get caption(): string;\r\n\r\n    protected async loadList(): Promise<void> {\r\n        // if (this.baseList) return;\r\n        await this.internalLoadList();\r\n    }\r\n    protected abstract internalLoadList(): Promise<void>;\r\n    async loadAndShowList(): Promise<void> {\r\n        await this.loadList();\r\n        this.showList();\r\n    }\r\n    protected abstract showList(): Promise<void>;\r\n}\r\n","import { observer } from \"mobx-react\";\r\nimport React from \"react\";\r\nimport { List, VPage } from \"tonva-view\";\r\nimport { CObjects } from \"./CObjects\";\r\n\r\nexport abstract class VObjects<T extends CObjects> extends VPage<T> {\r\n    header() {return this.controller.header()}\r\n    content() {\r\n        return React.createElement(observer(() => {\r\n            return <div className=\"\">\r\n                {this.renderListHeader()}\r\n                <List items={this.controller.baseList}\r\n                    item={{render: this.renderRow, onClick: this.onClickRow}} />\r\n                {this.renderListFooter()}\r\n            </div>\r\n        }));\r\n    }\r\n\r\n    private renderRow = (v:any, index:number): JSX.Element => {\r\n        return this.renderItem(v, index);\r\n    }\r\n\r\n    private onClickRow = (v:any) => {\r\n        this.onClickItem(v);\r\n    }\r\n\r\n    protected renderListHeader(): JSX.Element {\r\n        return <></>;\r\n    }\r\n\r\n    protected renderListFooter(): JSX.Element {\r\n        return <></>;\r\n    }\r\n\r\n    protected renderItem(v:any, index:number): JSX.Element {\r\n        return <div className=\"px-3 py-2\">\r\n            {v.id}\r\n        </div>;\r\n    }\r\n\r\n    protected onClickItem(v:any) {\r\n        alert(v.id);\r\n    }\r\n}\r\n","import { CAgents } from \"./CAgents\";\r\nimport { VObjects } from \"./VObjects\";\r\n\r\nexport class VAgents extends VObjects<CAgents> {\r\n}\r\n","import { CObjects } from \"./CObjects\";\r\nimport { VAgents } from \"./VAgents\";\r\n\r\nexport class CAgents extends CObjects {\r\n    protected list: any[];\r\n\r\n    get baseList(): any[] {return this.list}\r\n\r\n    protected get caption(): string {return '轻代理';}\r\n\r\n    protected async internalLoadList(): Promise<void> {\r\n        let ret = await this.uqs.JkMe.GetAgents.query({});\r\n        this.list = ret.ret;\r\n    }\r\n\r\n    protected async showList(): Promise<void> {\r\n        this.openVPage(VAgents);\r\n    }\r\n}\r\n\r\n","import { CDistributors } from \"./CDistributors\";\r\nimport { VObjects } from \"./VObjects\";\r\n\r\nexport class VDistributors extends VObjects<CDistributors> {\r\n}\r\n","import { VDistributors } from \"./VDistributors\";\r\nimport { CObjects } from \"./CObjects\";\r\n\r\nexport class CDistributors extends CObjects {\r\n    protected list: any[];\r\n\r\n    get baseList(): any[] {return this.list}\r\n\r\n    protected get caption(): string {return '经销商'}\r\n\r\n    protected async internalLoadList(): Promise<void> {\r\n        let ret = await this.uqs.JkMe.GetDistributors.query({});\r\n        this.list = ret.ret;\r\n    }\r\n\r\n    protected async showList(): Promise<void> {\r\n        this.openVPage(VDistributors);\r\n    }\r\n}\r\n\r\n","import { CGroups } from \"./CGroups\";\r\nimport { VObjects } from \"./VObjects\";\r\n\r\nexport class VGroups extends VObjects<CGroups> {\r\n}\r\n","import { CObjects } from \"./CObjects\";\r\nimport { VGroups } from \"./VGroups\";\r\n\r\nexport class CGroups extends CObjects {\r\n    protected list: any[];\r\n\r\n    get baseList(): any[] {return this.list}\r\n\r\n    protected get caption(): string {return '部门';}\r\n\r\n    protected async internalLoadList(): Promise<void> {\r\n        let ret = await this.uqs.JkMe.GetGroups.query({});\r\n        this.list = ret.ret;\r\n    }\r\n\r\n    protected async showList(): Promise<void> {\r\n        this.openVPage(VGroups);\r\n    }\r\n}\r\n","export const cnAmount = ' w-min-6c text-end ms-2';\r\n\r\n","import { LMR } from \"tonva-view\";\r\nimport { cnAmount } from \"tools\";\r\nimport { Item, Post } from \"uq-app/uqs/JkMe\";\r\nimport { CPosts } from \"./CPosts\";\r\nimport { VObjects } from \"./VObjects\";\r\n\r\nexport class VPosts extends VObjects<CPosts> {\r\n    protected renderItem(v:any, index:number): JSX.Element {\r\n\t\tlet {postTitles, itemTitles} = this.controller.cApp;\r\n        let {post, item, amountThisMonth, amountLastMonth} = v;\r\n\t\tlet {title:postTitle} = postTitles[post as Post];\r\n\t\tlet {title:itemTitle} = itemTitles[item as Item];\r\n        let right = <div className=\"d-flex align-items-center\">\r\n            {this.vAmount(amountThisMonth, item)}\r\n            {this.vAmount(amountLastMonth, item)}\r\n        </div>;\r\n        return <LMR className=\"px-3 py-2\" right={right}>\r\n            {postTitle} {itemTitle}\r\n        </LMR>;\r\n    }\r\n\r\n    protected renderListHeader(): JSX.Element {\r\n        return <div>\r\n            <div className=\"d-flex px-3 py-3 border-bottom border-primary\">\r\n                <div className=\"flex-fill\"></div>\r\n                <div className={cnAmount}>本月</div>\r\n                <div className={cnAmount}>上月</div>\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    private vAmount(amount:number, item:Item):JSX.Element {\r\n\t\tlet {itemTitles} = this.controller.cApp;\r\n\t\tlet {fixed, unit} = itemTitles[item];\r\n        return <div className={cnAmount}>\r\n            {((amount??0) as number).toFixed(fixed)} \r\n            <small className=\"text-muted\">{unit}</small>\r\n        </div>;\r\n    }\r\n\r\n    /*\r\n    protected onClickItem(v:any) {\r\n        this.controller.showPostItemHistory(v);\r\n    }\r\n    */\r\n}\r\n","import { CObjects } from \"./CObjects\";\r\nimport { VPosts } from \"./VPosts\";\r\n\r\nexport class CPosts extends CObjects {\r\n    protected list: any[];\r\n\r\n    get baseList(): any[] {return this.list}\r\n\r\n    protected get caption(): string {return '岗位'}\r\n    header() {return this.caption + '绩效列表'}\r\n\r\n    protected async internalLoadList(): Promise<void> {\r\n        let ret = await this.uqs.JkMe.GetPosts.query({\r\n        });\r\n        this.list = ret.ret;\r\n    }\r\n\r\n    protected async showList(): Promise<void> {\r\n        this.openVPage(VPosts);\r\n    }\r\n}\r\n","import { cnAmount } from \"tools\";\r\nimport { Item } from \"uq-app/uqs/JkMe\";\r\nimport { CStaffs, StaffRow } from \"./CStaffs\";\r\nimport { VObjects } from \"./VObjects\";\r\n\r\nexport class VStaffs extends VObjects<CStaffs> {\r\n    protected renderItem(v:StaffRow, index:number): JSX.Element {\r\n        let {staff, monthValuesArr} = v;\r\n        let right = <div className=\"d-block\">\r\n            {monthValuesArr.map((v, index) => {\r\n                let {item, dThis, mThis, mLast} = v;\r\n                if (mThis === undefined && mLast === undefined) return null;\r\n                let {itemTitles} = this.controller.cApp;\r\n                let {title} = itemTitles[item];\r\n                return <div key={index} className=\"d-flex\">\r\n                    <div className=\"flex-fill text-sm-end small text-muted\">{title}</div>\r\n                    <div className=\"d-sm-flex\">\r\n                        <div className=\"d-flex d-sm-block\">\r\n                            <div className=\"flex-fill small text-muted d-sm-none\">今日</div>\r\n                            <div>{this.vValue(dThis)}</div>\r\n                        </div>\r\n                        <div className=\"d-flex d-sm-block\">\r\n                            <div className=\"flex-fill small text-muted d-sm-none\">本月</div>\r\n                            <div>{this.vValue(mThis)}</div>\r\n                        </div>\r\n                        <div className=\"d-flex d-sm-block\">\r\n                            <div className=\"flex-fill small text-muted d-sm-none\">上月</div>\r\n                            <div>{this.vValue(mLast)}</div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            })}\r\n        </div>;\r\n        return <div className=\"px-3 py-2 d-block d-sm-flex\">\r\n            <div className=\"flex-fill\">\r\n                {this.controller.uqs.JkHr.Employee.tv(staff, renderEmployee)}\r\n            </div>\r\n            {right}\r\n        </div>;\r\n    }\r\n\r\n    protected renderListHeader(): JSX.Element {\r\n        return <div>\r\n            <div className=\"d-flex px-3 py-3 border-bottom border-primary\">\r\n                <div className=\"flex-fill\">员工</div>\r\n                <div className=\"d-none d-sm-flex\">\r\n                    <div className={cnAmount}>今天</div>\r\n                    <div className={cnAmount}>本月</div>\r\n                    <div className={cnAmount}>上月</div>\r\n                </div>\r\n            </div>\r\n            {this.renderListFooter()}\r\n        </div>;\r\n    }\r\n\r\n    protected renderListFooter(): JSX.Element {\r\n        let {sum} = this.controller;\r\n        return <div className=\"px-3 py-3 d-block d-sm-flex\">\r\n            <div className=\"flex-fill fw-bold text-sm-end small text-muted me-3\">合计</div>\r\n            <div>\r\n                {sum.map((v, index) => {\r\n                    let {item, dThis, mThis, mLast} = v;\r\n                    if ((mThis === 0 || mThis === undefined) \r\n                        && (mLast === 0 || mLast === undefined)) return null;\r\n                    let {itemTitles} = this.controller.cApp;\r\n                    let {title} = itemTitles[item];\r\n                    return <div key={index} className=\"d-flex\">\r\n                        <div className=\"flex-fill text-sm-end small text-muted\">{title}</div>\r\n                        <div className=\"d-sm-flex\">\r\n                            <div className=\"d-flex d-sm-block\">\r\n                                <div className=\"flex-fill small text-muted d-sm-none\">今日</div>\r\n                                <div>{this.vValue(dThis)}</div>\r\n                            </div>\r\n                            <div className=\"d-flex d-sm-block\">\r\n                                <div className=\"flex-fill small text-muted d-sm-none\">本月</div>\r\n                                <div>{this.vValue(mThis)}</div>\r\n                            </div>\r\n                            <div className=\"d-flex d-sm-block\">\r\n                                <div className=\"flex-fill small text-muted d-sm-none\">上月</div>\r\n                                <div>{this.vValue(mLast)}</div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                })}\r\n            </div>\r\n        </div>;\r\n    }\r\n\r\n    private vValue(amount:number):JSX.Element {\r\n\t\tlet {itemTitles} = this.controller.cApp;\r\n\t\tlet {fixed, unit} = itemTitles[Item.orderAmount];\r\n        return <div className={cnAmount}>\r\n            {((amount??0) as number).toFixed(fixed)} \r\n            <small className=\"text-muted\">{unit}</small>\r\n        </div>;\r\n    }\r\n\r\n    protected onClickItem(v:any) {\r\n        let {obj, staff} = v;\r\n        let pageTop = <div className=\"px-3 py-4\">\r\n            <div>职员 <b>{this.controller.uqs.JkHr.Employee.tv(staff, renderEmployee)}</b></div>\r\n        </div>;\r\n        this.controller.showObjectPortal(obj, pageTop);\r\n    }\r\n}\r\n\r\nfunction renderEmployee(employee: any):JSX.Element {\r\n    let {name} = employee;\r\n    return <>{name}</>;\r\n}\r\n","import { makeObservable, observable } from \"mobx\";\r\nimport { CSupervise } from \"supervise\";\r\nimport { Item } from \"uq-app/uqs/JkMe\";\r\nimport { CObjects } from \"./CObjects\";\r\nimport { VStaffs } from \"./VStaffs\";\r\n\r\nexport interface MonthValues {\r\n\topi: number;\r\n    item: Item;\r\n    dThis: number;\r\n    mThis: number;\r\n    mLast: number;\r\n}\r\n\r\nexport interface ItemMonthValues {\r\n    [Item.orderAmount]?: MonthValues;\r\n    [Item.couponFee]?: MonthValues;\r\n    [Item.profitFee]?: MonthValues;\r\n}\r\n\r\nexport interface StaffRow {\r\n\tobj: number;\r\n\tstaff: number;\r\n    monthValuesArr: MonthValues[];\r\n}\r\n\r\nexport class CStaffs extends CObjects {\r\n    list: StaffRow[];\r\n    sum: {item: Item; dThis: number; mThis: number; mLast: number; }[] = [];\r\n\r\n    get baseList(): any[] {return this.list}\r\n\r\n    constructor(owner: CSupervise) {\r\n        super(owner);\r\n        makeObservable(this, {\r\n            list: observable.shallow,\r\n        });\r\n    }\r\n\r\n    protected get caption(): string {return '员工'}\r\n\r\n    protected async internalLoadList(): Promise<void> {\r\n        let ret = await this.uqs.JkMe.GetStaffs.query({\r\n        });\r\n        let list = ret.ret;\r\n        let coll:{[staff:number]: StaffRow} = {};\r\n        let arr: StaffRow[] = [];\r\n        let sum: {[key in Item]?: {item: Item; dThis: number; mThis: number; mLast: number; }} = {};\r\n        for (let r of list) {\r\n            let {opi, item, obj, staff, valueToday, valueThisMonth, valueLastMonth} = r;\r\n            let staffRow = coll[staff];\r\n            if (staffRow === undefined) {\r\n                coll[staff] = staffRow = {\r\n                    obj,\r\n                    staff,\r\n                    monthValuesArr: [],\r\n                };\r\n                arr.push(staffRow);\r\n            }\r\n            let {monthValuesArr} = staffRow;\r\n            monthValuesArr.push({\r\n                opi,\r\n                item,\r\n                dThis: valueToday,\r\n                mThis: valueThisMonth,\r\n                mLast: valueLastMonth,\r\n            });\r\n            let sumItem = sum[item as Item];\r\n            if (sumItem === undefined) {\r\n                sumItem = {\r\n                    item,\r\n                    dThis: 0,\r\n                    mThis: 0,\r\n                    mLast: 0,\r\n                };\r\n                sum[item as Item] = sumItem;\r\n            }\r\n            sumItem.dThis += (valueToday ?? 0);\r\n            sumItem.mThis += (valueThisMonth ?? 0);\r\n            sumItem.mLast += (valueLastMonth ?? 0);\r\n        }\r\n        this.sum.splice(0, this.sum.length);\r\n        for (let i in sum) this.sum.push(sum[Number(i) as Item]);\r\n        this.list = arr;\r\n    }\r\n\r\n    protected async showList(): Promise<void> {\r\n        this.openVPage(VStaffs);\r\n    }\r\n\r\n    async showObjectPortal(object: number, pageTop: JSX.Element) {\r\n        let cObjectPortal = this.cApp.newCObjectPortal(object, pageTop);\r\n        cObjectPortal.showObjectPortal();\r\n    }\r\n}\r\n","import { CSupervise } from \"../CSupervise\";\r\nimport { CAgents } from \"./CAgents\";\r\nimport { CDistributors } from \"./CDistributors\";\r\nimport { CGroups } from \"./CGroups\";\r\nimport { CObjects } from \"./CObjects\";\r\nimport { CPosts } from \"./CPosts\";\r\nimport { CStaffs } from \"./CStaffs\";\r\n\r\nexport function initCObjects(cSupervise: CSupervise): CObjects[] {\r\n    return [\r\n        new CGroups(cSupervise),\r\n        new CDistributors(cSupervise),\r\n        new CAgents(cSupervise),\r\n        new CPosts(cSupervise),\r\n        new CStaffs(cSupervise),\r\n    ];\r\n}\r\n","import { List, LMR, VPage } from \"tonva-view\";\r\nimport { EnumAccount, EnumObjectType, Post, ReturnGetAccountsRet } from \"uq-app/uqs/JkMe\";\r\nimport { CSupervise } from \"./CSupervise\";\r\n\r\nexport class VAccounts extends VPage<CSupervise> {\r\n    header() {return '账户余额列表'}\r\n    content() {\r\n        return <List items={this.controller.accounts}\r\n            item={{render: this.renderAccount, onClick: this.controller.showAccountHistory}} />\r\n    }\r\n\r\n    private renderAccount = (row: ReturnGetAccountsRet, index:number) => {\r\n        let {cApp, uqs} = this.controller;\r\n        let {accountTitles} = cApp;\r\n        let {account, balance, objectType, objectTo} = row;\r\n        let {title:accountTitle, unit, fixed} = accountTitles[account as EnumAccount];\r\n        let right = <div>\r\n            <span>{balance.toFixed(fixed??2)}</span>\r\n            <small className=\"ms-1 text-muted\">{unit}</small>\r\n        </div>;\r\n        let {Employee} = uqs.JkHr;\r\n        const renderObject = () => {\r\n            switch (Number(objectType) as EnumObjectType) {\r\n                default: return <>{objectType} {objectTo}</>;\r\n                case EnumObjectType.post:\r\n                    let {postTitles} = cApp;\r\n                    return <>{postTitles[objectTo as Post]?.title}</>;\r\n                case EnumObjectType.staff:\r\n                    return Employee.tv(objectTo, renderEmployee);\r\n            }\r\n        }\r\n        return <LMR className=\"px-3 py-2\" right={right}>\r\n            {renderObject()} {accountTitle}\r\n        </LMR>\r\n    }\r\n}\r\n\r\nfunction renderEmployee(employee: any):JSX.Element {\r\n    let {name} = employee;\r\n    return <>{name}</>;\r\n}\r\n","import { CUqBase, UQs } from \"uq-app\";\r\nimport { ReturnGetObjectsRet\r\n\t, ReturnGetGroupsRet\r\n\t, ReturnGetDistributorsRet\r\n\t, ReturnGetAgentsRet\r\n\t, ReturnGetStaffsRet\r\n\t, ReturnGetPostsRet\r\n\t, ReturnGetUserSuperviseItemRet\r\n\t, ReturnGetCustomerSumByMonthRet, ReturnGetItemHistory$page\r\n\t, ReturnGetItemSumDaysRet, ReturnGetItemSumMonthsRet\r\n\t, ReturnGetProductSumByMonthRet\r\n\t, ReturnGetAccountsRet\r\n} from \"uq-app/uqs/JkMe\";\r\nimport { Item } from \"uq-app/uqs/JkMe/JkMe\";\r\nimport { VSupervise } from \"./VSupervise\";\r\nimport { VItemSumHistory } from \"./VItemSumHistory\";\r\n//import { PageItems } from \"tonva-core\";\r\nimport { VItemHistory } from \"./VItemHistory\";\r\nimport { VItemDayHistory } from \"./VItemDayHistory\";\r\nimport { VCustomerSumByMonth, VProductSumByMonth } from \"./VSumByMonth\";\r\nimport { action, computed, makeObservable, observable, runInAction } from \"mobx\";\r\nimport { CObjects } from \"./objects/CObjects\";\r\nimport { initCObjects } from \"./objects\";\r\nimport { VAccounts } from \"./VAccounts\";\r\nimport { PageItems } from \"tonva-view\";\r\n\r\nexport class CSupervise extends CUqBase {\r\n\titem: Item;\r\n\titemSumDays: ReturnGetItemSumDaysRet[];\r\n\titemSumMonths: ReturnGetItemSumMonthsRet[];\r\n\tpageItemHistory: PageItemHistory;\r\n\tmonthSum: MonthSum<any>;\r\n\tsuperviseItems: ReturnGetUserSuperviseItemRet[];\r\n\tobjects: ReturnGetObjectsRet[];\r\n\tgroups: ReturnGetGroupsRet[];\r\n\tdistributors: ReturnGetDistributorsRet[];\r\n\tagents: ReturnGetAgentsRet[];\r\n\tstaffs: ReturnGetStaffsRet[];\r\n\tposts: ReturnGetPostsRet[];\r\n\tcObjectsArr: CObjects[];\r\n\taccounts: ReturnGetAccountsRet[];\r\n\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\ttab = () => this.renderView(VSupervise);\r\n\r\n\tload = async() => {\r\n\t\tthis.cObjectsArr = initCObjects(this);\r\n\t\tlet {JkMe} = this.uqs;\r\n\t\tlet [superviseItems] = await Promise.all([\r\n\t\t\tJkMe.GetUserSuperviseItem.query({}),\r\n\t\t]);\r\n\t\tthis.superviseItems = superviseItems.ret;\r\n\t}\r\n\r\n\tasync showItemSumHistory(item: Item) {\r\n\t\tif (item) this.item = item;\r\n\t\telse item = this.item;\r\n\t\tlet date = new Date();\r\n\t\tdate.setDate(date.getDate() + 1);\r\n\t\tlet [itemSumDays, itemSumMonths] = await Promise.all([\r\n\t\t\tthis.uqs.JkMe.GetItemSumDays.query({\r\n\t\t\t\titem, \r\n\t\t\t\tdate, \r\n\t\t\t\tdays: 30,\r\n\t\t\t}),\r\n\t\t\tthis.uqs.JkMe.GetItemSumMonths.query({\r\n\t\t\t\titem, \r\n\t\t\t\tdate, \r\n\t\t\t\tmonths: 12,\r\n\t\t\t}),\r\n\t\t]);\r\n\t\tthis.itemSumDays = itemSumDays.ret;\r\n\t\tthis.itemSumMonths = itemSumMonths.ret;\r\n\t\tthis.openVPage(VItemSumHistory);\r\n\t}\r\n\r\n\tasync showItemDayHistory(item: Item, from:Date, to:Date) {\r\n\t\tif (item) this.item = item;\r\n\t\telse item = this.item;\r\n\t\tlet days = Math.floor((to.getTime() - from.getTime())/ (1000*3600*24));\r\n\t\tlet [itemSumDays] = await Promise.all([\r\n\t\t\tthis.uqs.JkMe.GetItemSumDays.query({\r\n\t\t\t\titem, \r\n\t\t\t\tdate: to, \r\n\t\t\t\tdays,\r\n\t\t\t})\r\n\t\t]);\r\n\t\tthis.itemSumDays = itemSumDays.ret;\r\n\t\tthis.openVPage(VItemDayHistory);\r\n\t}\r\n\r\n\tasync showItemHistory(from:Date, to:Date) {\r\n\t\tthis.pageItemHistory = new PageItemHistory(this.uqs);\r\n\t\tawait this.pageItemHistory.first({\r\n\t\t\titem:this.item, \r\n\t\t\tfrom, \r\n\t\t\tto,\r\n\t\t});\r\n\t\tthis.openVPage(VItemHistory);\r\n\t}\r\n\r\n\tshowProductSumByMonth = async (caption: string, item: Item) => {\r\n\t\tthis.monthSum = new MonthSumProduct(this, caption, item);\r\n\t\tawait this.monthSum.load();\r\n\t\tthis.openVPage(VProductSumByMonth);\r\n\t}\r\n\r\n\tshowCustomerSumByMonth = async (caption: string, item: Item) => {\r\n\t\tthis.monthSum = new MonthSumCustomer(this, caption, item);\r\n\t\tawait this.monthSum.load();\r\n\t\tthis.openVPage(VCustomerSumByMonth);\r\n\t}\r\n\r\n\trenderVUnitSum() {\r\n\t\treturn this.cApp.renderVUnitSum();\r\n\t}\r\n\r\n\tshowAccounts = async () => {\r\n\t\tlet ret = await this.uqs.JkMe.GetAccounts.query({});\r\n\t\tthis.accounts = ret.ret;\r\n\t\tthis.openVPage(VAccounts);\r\n\t}\r\n\r\n\tshowAccountHistory = async () => {\r\n\t\talert('显示账户明细 正在设计中...');\r\n\t}\r\n}\r\n\r\nclass PageItemHistory extends PageItems<ReturnGetItemHistory$page> {\r\n\tprivate uqs: UQs;\r\n\tconstructor(uqs: UQs) {\r\n\t\tsuper();\r\n\t\tthis.uqs = uqs;\r\n\t}\r\n\tprotected async loadResults(param: any, pageStart: any, pageSize: number): Promise<{\r\n        [name: string]: any[];\r\n    }> {\r\n\t\tlet ret = await this.uqs.JkMe.GetItemHistory.page(param, pageStart, pageSize);\r\n\t\treturn ret as any;\r\n\t}\r\n}\r\n\r\nabstract class MonthSum<T> {\r\n\tprotected controller: CSupervise;\r\n\tvCaption: string;\r\n\titem: Item;\r\n\tmonth: Date;\r\n\tlist: T[];\r\n\tconstructor(controller: CSupervise, caption: string, item: Item) {\r\n\t\tthis.controller = controller;\r\n\t\tthis.month = new Date();\r\n\t\tthis.month.setDate(1);\r\n\t\tthis.month.setHours(0, 0, 0, 0);\r\n\t\tthis.vCaption = caption;\r\n\t\tthis.item = item;\r\n\t\tmakeObservable(this, {\r\n\t\t\tmonth: observable,\r\n\t\t\thasNext: computed,\r\n\t\t\tprev: action,\r\n\t\t\tnext: action,\r\n\t\t\tlist: observable.shallow,\r\n\t\t});\r\n\t}\r\n\r\n\tprev = async () => {\r\n\t\tlet m = new Date(this.month);\r\n\t\tm.setMonth(m.getMonth() - 1);\r\n\t\tthis.month = m;\r\n\t\tawait this.load();\r\n\t}\r\n\r\n\tnext = async () => {\r\n\t\tif (this.hasNext === true) {\r\n\t\t\tlet m = new Date(this.month);\r\n\t\t\tm.setMonth(m.getMonth() + 1);\r\n\t\t\tthis.month = m;\r\n\t\t\tawait this.load();\r\n\t\t}\r\n\t}\r\n\r\n\tget hasNext():boolean {\r\n\t\tlet d = new Date();\r\n\t\td.setDate(0);\r\n\t\td.setHours(0, 0, 0, 0);\r\n\t\treturn this.month < d;\r\n\t}\r\n\r\n\tabstract load(): Promise<void>;\r\n}\r\n\r\nclass MonthSumProduct extends MonthSum<ReturnGetProductSumByMonthRet> {\r\n\tasync load(): Promise<void> {\r\n\t\tlet m = this.month.getFullYear() * 100 + (this.month.getMonth() + 1);\r\n\t\tlet param = {\r\n\t\t\titem: this.item, \r\n\t\t\tmonth: m,\r\n\t\t\tcount: 200,\r\n\t\t};\r\n\t\tlet ret = await this.controller.uqs.JkMe.GetProductSumByMonth.query(param);\r\n\t\tlet list = ret.ret;\r\n\t\tlet len = list.length;\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t(list[i] as any).$serial = i+1;\r\n\t\t}\r\n\t\trunInAction(() => {\r\n\t\t\tthis.list = list;\r\n\t\t});\r\n\t}\r\n}\r\n\r\nclass MonthSumCustomer extends MonthSum<ReturnGetCustomerSumByMonthRet> {\r\n\tasync load(): Promise<void> {\r\n\t\tlet m = this.month.getFullYear() * 100 + (this.month.getMonth() + 1);\r\n\t\tlet param = {\r\n\t\t\titem: this.item, \r\n\t\t\tmonth: m,\r\n\t\t\tcount: 200,\r\n\t\t};\r\n\t\tlet ret = await this.controller.uqs.JkMe.GetCustomerSumByMonth.query(param);\r\n\t\tlet list = ret.ret;\r\n\t\tlet len = list.length;\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t(list[i] as any).$serial = i+1;\r\n\t\t}\r\n\t\trunInAction(() => {\r\n\t\t\tthis.list = list;\r\n\t\t});\r\n\t}\r\n}","import { action, computed, makeObservable, observable } from \"mobx\";\r\nimport { env } from \"tonva-core\";\r\nimport { Item, Post, ReturnGetObjectItemPeriodSumRet } from \"uq-app/uqs/JkMe\";\r\n\r\nexport enum EnumPeriod {day = 0, month = 1, week = 2, year = 3}\r\n\r\nexport interface ItemPeriodSum extends ReturnGetObjectItemPeriodSumRet {\r\n\tid: number;\r\n\tobject: number;\r\n\tpost: Post;\r\n\titem: Item;\r\n\tvalue: number;\r\n}\r\n\r\nexport interface PostPeriodSum {\r\n    post: Post;\r\n    itemColl: {[item in keyof typeof Item]: ItemPeriodSum};\r\n    itemList: ItemPeriodSum[];\r\n}\r\n\r\nexport abstract class Period {\r\n    private timezone: number;\r\n    constructor(timezone: number) {\r\n        this.timezone = timezone;\r\n        this.to = this.newDate();\r\n        this.from = new Date(this.to);\r\n        this.init();\r\n        this.initObservable();\r\n    }\r\n    private newDate():Date {\r\n        let ret = new Date();\r\n        ret.setHours(ret.getHours() - env.timeZone + this.timezone)\r\n        ret.setHours(0, 0, 0, 0);\r\n        return ret;\r\n    }\r\n    protected initObservable() {\r\n        makeObservable(this, {\r\n            from: observable,\r\n            to: observable,\r\n            prev: action,\r\n            next: action,\r\n            hasNext: computed,\r\n        });\r\n    }\r\n    type: EnumPeriod;\r\n\tfrom: Date;\r\n\tto: Date;\r\n    abstract init(): void;\r\n    abstract prev(): void;\r\n    abstract next(): void;\r\n    get hasNext(): boolean {\r\n        let date = this.newDate();\r\n        return this.to <= date;\r\n    }\r\n    abstract render(): string;\r\n}\r\n\r\nconst weekday = '日一二三四五六';\r\nclass DayPeriod extends Period {\r\n    init(): void {\r\n        this.type = EnumPeriod.day;\r\n        this.to.setDate(this.from.getDate()+1);\r\n    }\r\n    prev(): void {\r\n        this.to = new Date(this.to.setDate(this.to.getDate()-1));\r\n        this.from = new Date(this.from.setDate(this.from.getDate()-1));\r\n    }\r\n    next(): void {\r\n        this.to = new Date(this.to.setDate(this.to.getDate()+1));\r\n        this.from = new Date(this.from.setDate(this.from.getDate()+1));\r\n    }\r\n    render(): string {\r\n        let year = new Date().getFullYear();\r\n        let y = this.from.getFullYear();\r\n        let m = this.from.getMonth();\r\n        let d = this.from.getDate();\r\n        let dw = this.from.getDay();\r\n        return (y === year? '': `${y}年`) + `${m+1}月${d}日 星期${weekday[dw]}`;\r\n    }\r\n}\r\n\r\nclass WeekPeriod extends Period {\r\n    init(): void {\r\n        this.type = EnumPeriod.week;\r\n        let day = this.to.getDay();\r\n        let diff = this.to.getDate() - day + (day === 0 ? -6:1); // adjust when day is sunday\r\n        this.from = new Date(this.to.setDate(diff));\r\n        this.to.setDate(this.to.getDate() + 7);\r\n    }\r\n    prev(): void {\r\n        this.from = new Date(this.from.setDate(this.from.getDate() - 7));\r\n        this.to = new Date(this.to.setDate(this.to.getDate() - 7));\r\n    }\r\n    next(): void {\r\n        this.from = new Date(this.from.setDate(this.from.getDate() + 7));\r\n        this.to = new Date(this.to.setDate(this.to.getDate() + 7));\r\n    }\r\n    render(): string {\r\n        let year = new Date().getFullYear();\r\n        let yf = this.from.getFullYear();\r\n        let mf = this.from.getMonth();\r\n        let df = this.from.getDate();\r\n        let mt = this.to.getMonth();\r\n        let dt = this.to.getDate();\r\n        return (yf === year? '': `${yf}年`) + `${mf+1}月${df}日 - `\r\n            + (mt === mf? '': `${mt}月`) + `${dt}日`;\r\n    }\r\n}\r\n\r\nclass MonthPeriod extends Period {\r\n    init(): void {\r\n        this.type = EnumPeriod.month;\r\n        this.from = new Date(this.to.getFullYear(), this.to.getMonth(), 1);\r\n        this.to = new Date(this.to.getFullYear(), this.to.getMonth() + 1, 1);\r\n    }\r\n    prev(): void {\r\n        this.from = new Date(this.from.setMonth(this.from.getMonth() - 1));\r\n        this.to = new Date(this.to.setMonth(this.to.getMonth() - 1));\r\n    }\r\n    next(): void {\r\n        this.from = new Date(this.from.setMonth(this.from.getMonth() + 1));\r\n        this.to = new Date(this.to.setMonth(this.to.getMonth() + 1));\r\n    }\r\n    render(): string {\r\n        let year = new Date().getFullYear();\r\n        let yf = this.from.getFullYear();\r\n        return `${year===yf? '': year+'年'}${this.from.getMonth()+1}月`;\r\n    }\r\n}\r\n\r\nclass YearPeriod extends Period {\r\n    init(): void {\r\n        this.type = EnumPeriod.year;\r\n        this.from = new Date(this.to.getFullYear(), 0, 1);\r\n        this.to = new Date(this.to.getFullYear() + 1, 0, 1);\r\n    }\r\n    prev(): void {\r\n        this.from = new Date(this.from.setFullYear(this.from.getFullYear() - 1));\r\n        this.to = new Date(this.to.setFullYear(this.to.getFullYear() - 1));\r\n    }\r\n    next(): void {\r\n        this.from = new Date(this.from.setFullYear(this.from.getFullYear() + 1));\r\n        this.to = new Date(this.to.setFullYear(this.to.getFullYear() + 1));\r\n    }\r\n    render(): string {return `${this.from.getFullYear()}年`}\r\n}\r\n\r\nexport function createPeriod(periodType: EnumPeriod, timezone:number): Period {\r\n    let period: Period;\r\n    switch (periodType) {\r\n        case EnumPeriod.day: period = new DayPeriod(timezone); break;\r\n        case EnumPeriod.week: period = new WeekPeriod(timezone); break;\r\n        case EnumPeriod.month: period = new MonthPeriod(timezone); break;\r\n        case EnumPeriod.year: period = new YearPeriod(timezone); break;\r\n    }\r\n    return period;\r\n}","import { UQs } from \"uq-app\";\r\nimport { ReturnGetObjectItemHistoryRet } from \"uq-app/uqs/JkMe\";\r\n\r\nexport class BizOpDetail {\r\n    private uqs: UQs;\r\n    item: ReturnGetObjectItemHistoryRet;\r\n\r\n    constructor(uqs: UQs, item: ReturnGetObjectItemHistoryRet) {\r\n        this.uqs = uqs;\r\n        this.item = item;\r\n    }\r\n}","import { dateFromMinuteId } from 'tonva-core';\r\nimport { EasyTime, FA, VPage } from \"tonva-view\";\r\nimport { CPortal } from \"./CPortal\";\r\n\r\nexport class VBizOpDetail extends VPage<CPortal> {\r\n    header() {return '业务详情'}\r\n    content() {\r\n        let {bizOpDetail} = this.controller;\r\n        let {minuteId, bizOp, memo, value} = bizOpDetail.item;\r\n        let {itemTitles, timezone} = this.controller.cApp;\r\n        let {item} = this.controller.itemPeriodSum;\r\n        let {unit, fixed} = itemTitles[item];\r\n        let d = dateFromMinuteId(minuteId, timezone);\r\n        return <div className=\"p-3\">\r\n            <div>业务编号：{bizOp}</div>\r\n            <div>发生时间：<EasyTime date={d} timeZone={-5} /></div>\r\n            <div>{memo} {(value??0).toFixed(fixed??2)} {unit}</div>\r\n            <div className=\"my-3\">\r\n                <FA className=\"text-danger me-3\" name=\"smile-o\" size=\"lg\" />\r\n                <span className=\"text-muted\">业务详情显示正在开发中</span>\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import { dateFromMinuteId } from 'tonva-core';\r\nimport { List, LMR, VDate, VPage } from \"tonva-view\";\r\nimport { ReturnGetObjectItemHistoryRet } from \"uq-app/uqs/JkMe\";\r\nimport { CPortal } from \"./CPortal\";\r\n\r\nexport class VPostItemHistory extends VPage<CPortal> {\r\n\theader() {\r\n        let {itemTitles, postTitles} = this.controller.cApp;\r\n        let {itemPeriodSum} = this.controller;\r\n        let {post, item} = itemPeriodSum;\r\n        return `${postTitles[post].title} - ${itemTitles[item].title}`;\r\n    }\r\n\tcontent() {\r\n        let {history} = this.controller;\r\n\t\treturn <div className=\"\">\r\n            <List items={history} \r\n                item={{render: this.renderItem, onClick: this.onClickItem}} />\r\n        </div>;\r\n    }\r\n\r\n    private renderItem = (history: ReturnGetObjectItemHistoryRet, index: number) => {\r\n        let {itemTitles, timezone} = this.controller.cApp;\r\n        let {minuteId, value, bizOp, memo} = history;\r\n        let {item} = this.controller.itemPeriodSum;\r\n        let {unit, fixed} = itemTitles[item];\r\n        let d = dateFromMinuteId(minuteId, timezone);\r\n        let left = <div className=\"text-muted small w-min-4c me-2\">\r\n            <VDate date={d} hideSameYear={true} />\r\n        </div>;\r\n        let right = <div className=\"ms-2\">{(value??0).toFixed(fixed??2)} {unit}</div>;\r\n        return <LMR className=\"px-3 py-2 align-items-center\" left={left} right={right}>\r\n            <small>{bizOp}{memo? ': ' + memo : ''}</small>\r\n        </LMR>;\r\n    }\r\n\r\n    private onClickItem = (item: ReturnGetObjectItemHistoryRet) => {\r\n        this.controller.showBizOpDetail(item);\r\n    }\r\n}","import { List, LMR, VPage } from \"tonva-view\";\r\nimport { ReturnGetObjectItemPeriodHistoryRet } from \"uq-app/uqs/JkMe\";\r\nimport { CPortal } from \"./CPortal\";\r\n\r\nabstract class VPeriodPostItemHistory extends VPage<CPortal> {\r\n\theader() {\r\n        let {itemTitles, postTitles} = this.controller.cApp;\r\n        let {itemPeriodSum} = this.controller;\r\n        let {post, item} = itemPeriodSum;\r\n        return `${postTitles[post].title} - ${itemTitles[item].title}`;\r\n    }\r\n\tcontent() {\r\n        let {periodHistory} = this.controller;\r\n\t\treturn <div className=\"\">\r\n            <List items={periodHistory} \r\n                item={{render: this.renderItem, onClick: this.onClickItem}} />\r\n        </div>;\r\n    }\r\n\r\n    private renderItem = (history: ReturnGetObjectItemPeriodHistoryRet, index: number) => {\r\n        let {itemTitles} = this.controller.cApp;\r\n        let {date, value} = history;\r\n        let {item} = this.controller.itemPeriodSum;\r\n        let {unit, fixed} = itemTitles[item];\r\n        let d = new Date(date);\r\n        let left = <div className=\"text-muted small\">{this.renderDate(d)}</div>;\r\n        let right = <div>{(value??0).toFixed(fixed??2)} {unit}</div>;\r\n        return <LMR className=\"px-3 py-2\" left={left} right={right}></LMR>;\r\n    }\r\n\r\n    private onClickItem = async (item: ReturnGetObjectItemPeriodHistoryRet) => {\r\n        await this.clickItem(item);\r\n    }\r\n\r\n    protected abstract renderDate(date: Date): JSX.Element;\r\n    protected abstract clickItem(item: ReturnGetObjectItemPeriodHistoryRet): Promise<void>;\r\n}\r\n\r\nexport class VDayPostItemHistory extends VPeriodPostItemHistory {\r\n    protected renderDate(d: Date): JSX.Element {\r\n        return <>{d.getMonth()+1}月{String(100+d.getDate()).substr(1)}日</>;\r\n    }\r\n\r\n    protected async clickItem(item: ReturnGetObjectItemPeriodHistoryRet): Promise<void> {\r\n        let from: Date = item.date;\r\n        let to: Date = new Date(from);\r\n        to.setDate(to.getDate()+1);\r\n        await this.controller.showPostItemHistory(undefined, from, to);\r\n    }\r\n}\r\n\r\nexport class VMonthPostItemHistory extends VPeriodPostItemHistory {\r\n    protected renderDate(d: Date): JSX.Element {\r\n        return <>{d.getMonth()+1}月</>;\r\n    }\r\n\r\n    protected async clickItem(item: ReturnGetObjectItemPeriodHistoryRet): Promise<void> {\r\n        let from: Date = item.date;\r\n        let to: Date = new Date(from);\r\n        to.setMonth(to.getMonth()+1);\r\n        await this.controller.showDayPostItemHistory(undefined, from, to);\r\n    }\r\n}\r\n","import { VElement, View, EasyTime, FA, List, LMR } from \"tonva-view\";\r\nimport { CPortal } from \"./CPortal\";\r\nimport { EnumPeriod, PostPeriodSum, ItemPeriodSum } from \"./period\";\r\nimport { ReturnGetObjectItemPeriodSumRet } from \"uq-app/uqs/JkMe\";\r\n\r\nconst cnColPeriod = \"col text-center\";\r\nconst cnPeriod = \" py-2 px-3 \";\r\nconst cnTabCur = ' border-2 border-bottom border-primary fw-bold bg-light ';\r\nconst cnTab = ' border-bottom border-muted cursor-pointer text-muted ';\r\n\r\nexport class VPeriodSum<T extends CPortal = CPortal> extends View<T> {\r\n    render(): VElement {\r\n\t\treturn this.react(() => {\r\n\t\t\tlet periodList:[EnumPeriod, string, string][] = [\r\n\t\t\t\t[EnumPeriod.day, '日', undefined],\r\n\t\t\t\t[EnumPeriod.week, '周', undefined],\r\n\t\t\t\t[EnumPeriod.month, '月', undefined],\r\n\t\t\t\t[EnumPeriod.year, '年', undefined],\r\n\t\t\t];\r\n\t\t\tlet {period} = this.controller;\r\n\t\t\tlet {type} = period;\r\n\t\t\tfor (let p of periodList) {\r\n\t\t\t\tlet [ep] = p;\r\n\t\t\t\tp[2] = cnPeriod + (ep === type? cnTabCur : cnTab);\r\n\t\t\t}\r\n\t\t\treturn <div className=\"\">\r\n\t\t\t\t<div className=\"row g-0\">\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tperiodList.map(v => {\r\n\t\t\t\t\t\t\tlet [ep, title, cn] = v;\r\n\t\t\t\t\t\t\treturn <div key={title} className={cnColPeriod} \r\n\t\t\t\t\t\t\t\tonClick={() => this.controller.setPeriod(ep)}>\r\n\t\t\t\t\t\t\t\t<div className={cn}>{title}</div>\r\n\t\t\t\t\t\t\t</div>;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t\t{this.renderDate()}\r\n\t\t\t\t<div className=\"\">\r\n\t\t\t\t\t<List items={this.controller.list} \r\n\t\t\t\t\t\titem={{render: this.renderItem, onClick: undefined/*this.onClickItem*/}} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"d-flex py-2 px-3\">\r\n\t\t\t\t\t<div className=\"flex-fill\"></div>\r\n\t\t\t\t\t<div className=\"small text-muted cursor-pointer\"\r\n\t\t\t\t\t\tonClick={this.controller.cApp.refresh}>\r\n\t\t\t\t\t\t<FA name=\"refresh\" /> \r\n\t\t\t\t\t\t{this.react(() => <EasyTime date={this.controller.cApp.refreshTime}/>)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t});\r\n    }\r\n\r\n\tprivate renderDate() {\r\n\t\tlet {period, prev, next} = this.controller;\r\n\t\tlet {hasNext} = period;\r\n\t\tlet left = <div className=\"cursor-pointer p-3\" onClick={prev}><FA name=\"angle-left\" /></div>;\r\n\t\tlet right = <div className={' p-3 ' + (hasNext? ' cursor-pointer ':' text-light ')} onClick={next}><FA name=\"angle-right\" /></div>\r\n\t\treturn <div className=\"d-flex\">\r\n\t\t\t{left}\r\n\t\t\t<div className=\"text-center flex-fill py-3\">{period.render()}</div>\r\n\t\t\t{right}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onClickItem = (item: ReturnGetObjectItemPeriodSumRet) => {\r\n\t\t//this.controller.showItemHistory(item.id, EnumSumPeriod.day);\r\n\t}\r\n\r\n\tprotected renderItem = (postPeriodSum: PostPeriodSum, index: number) => {\r\n\t\tlet {postTitles} = this.controller.cApp;\r\n\t\tlet {post, itemList} = postPeriodSum;\r\n\t\tlet {title, vice} = postTitles[post];\r\n\t\treturn <div className=\"d-block mx-3 my-3 border border-success\">\r\n\t\t\t<div className=\"px-3 py-2\">\r\n\t\t\t\t<b className=\"text-primary\">{title}</b>\r\n\t\t\t\t<small className=\"text-muted ms-3\">{vice}</small>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<List items={itemList} \r\n\t\t\t\t\titem={{render: this.renderItemPeriodSum, onClick: this.onClickItemPeriodSum}} />\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderItemPeriodSum = (ips: ItemPeriodSum, index: number) => {\r\n\t\tlet {itemTitles} = this.controller.cApp;\r\n\t\tlet {item, value} = ips;\r\n\t\tlet {title, vice, fixed} = itemTitles[item];\r\n\t\treturn <LMR className=\"px-3 py-2 w-100\" right={<div>{(value??0).toFixed(fixed)}</div>}>\r\n\t\t\t{title} <small className=\"text-muted ms-3\">{vice}</small>\r\n\t\t</LMR>;\r\n\t}\r\n\t\r\n\tprivate onClickItemPeriodSum = (ips: ItemPeriodSum) => {\r\n\t\tswitch (this.controller.period.type) {\r\n\t\t\tcase EnumPeriod.day:\r\n\t\t\t\tthis.controller.showPostItemHistory(ips, undefined, undefined);\r\n\t\t\t\tbreak;\r\n\t\t\tcase EnumPeriod.month:\r\n\t\t\tcase EnumPeriod.week:\r\n\t\t\t\tthis.controller.showDayPostItemHistory(ips, undefined, undefined);\r\n\t\t\t\tbreak;\r\n\t\t\tcase EnumPeriod.year:\r\n\t\t\t\tthis.controller.showMonthPostItemHistory(ips, undefined, undefined);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n}\r\n","import { action, makeObservable, observable, runInAction } from \"mobx\";\r\nimport { CApp, CUqBase } from \"uq-app\";\r\nimport { Item, ReturnGetObjectItemHistoryRet, ReturnGetObjectItemPeriodHistoryRet\r\n    , ReturnGetObjectItemPeriodSumRet } from \"uq-app/uqs/JkMe\";\r\nimport { BizOpDetail } from \"./bizOpDetail\";\r\nimport { PostPeriodSum, Period, ItemPeriodSum, EnumPeriod, createPeriod } from \"./period\";\r\nimport { VBizOpDetail } from \"./VBizOpDetail\";\r\nimport { VPostItemHistory } from \"./VPostItemHistory\";\r\nimport { VDayPostItemHistory, VMonthPostItemHistory } from \"./VPeriodPostItemHistory\";\r\nimport { VPeriodSum } from \"./VPortal\";\r\n\r\nexport class CPortal extends  CUqBase {\r\n\tbizOpDetail: BizOpDetail;\r\n\r\n    period: Period;\r\n    list: any[];\r\n    // objectPostItem: ObjectPostItem;\r\n    itemPeriodSum: ItemPeriodSum;\r\n    history: ReturnGetObjectItemHistoryRet[];\r\n    periodHistory: ReturnGetObjectItemPeriodHistoryRet[];\r\n\r\n    constructor(cApp: CApp) {\r\n\t\tsuper(cApp);\r\n        makeObservable(this, {\r\n            period: observable,\r\n            history: observable.shallow,\r\n            periodHistory: observable.shallow,\r\n            //postPeriodSumColl: observable.ref,\r\n            //postPeriodSumList: observable.shallow,\r\n            list: observable.shallow,\r\n            internalSetPeriod: action,\r\n        });\r\n        this.internalSetPeriod(EnumPeriod.day);\r\n    }\r\n\r\n    protected async internalStart() {\r\n    }\r\n\r\n    internalSetPeriod(periodType: EnumPeriod) {\r\n        this.period = createPeriod(periodType, this.cApp.timezone);\r\n    }\r\n\r\n    async setPeriod(periodType: EnumPeriod) {\r\n        this.internalSetPeriod(periodType);\r\n        await this.load();\r\n    }\r\n\r\n    protected async GetPeriodSum(from: Date, to: Date):Promise<{ret:any[]}> {\r\n        let ret = await this.uqs.JkMe.GetUserObjectItemPeriodSum.query({\r\n            from,\r\n            to,\r\n        });\r\n        return ret;\r\n    }\r\n\r\n    async load() {\r\n        let {from, to} = this.period;\r\n        let ret = await this.GetPeriodSum(from, to);\r\n        let arr: ReturnGetObjectItemPeriodSumRet[] = ret.ret;\r\n        let postPeriodSumColl = {} as any;\r\n        let postPeriodSumList:PostPeriodSum[] = [];\r\n        for (let n of arr) {\r\n            let post = Number(n.post);\r\n            let item = Number(n.item);\r\n            let ips:ItemPeriodSum = {...n, post, item};\r\n            let postPeriodSum = postPeriodSumColl[post];\r\n            if (postPeriodSum === undefined) {\r\n                let itemColl: {[item in keyof typeof Item]: ItemPeriodSum} = {} as any;\r\n                postPeriodSumColl[post] = postPeriodSum = {\r\n                    post: post,\r\n                    itemColl,\r\n                    itemList: [],\r\n                }\r\n                postPeriodSumList.push(postPeriodSum);\r\n            }\r\n            postPeriodSum.itemColl[item] = ips;\r\n            postPeriodSum.itemList.push(ips);\r\n        }\r\n        runInAction(() => {\r\n            //this.postPeriodSumColl = postPeriodSumColl;\r\n            //this.postPeriodSumList = postPeriodSumList;\r\n            this.list = postPeriodSumList;\r\n        });\r\n    }\r\n\r\n    private async loadPostItemHistory(ips: ItemPeriodSum, fromDate: Date, toDate: Date) {\r\n        if (!ips) {\r\n            ips = this.itemPeriodSum;\r\n        }\r\n        else {\r\n            this.itemPeriodSum = ips;\r\n        }\r\n        let {id: objectPostItem} = ips;\r\n      \r\n        let {from, to} = this.period;\r\n        if (fromDate) from = fromDate;\r\n        if (toDate) to = toDate;\r\n\t\tlet ret = await this.uqs.JkMe.GetObjectItemHistory.query({\r\n\t\t\tobjectPostItem, \r\n\t\t\tfrom,\r\n\t\t\tto,\r\n\t\t});\r\n        runInAction(() => {\r\n            this.history = ret.ret;\r\n        });\r\n\t}\r\n\r\n    private async loadPeriodPostItemHistory(ips: ItemPeriodSum, fromDate: Date, toDate: Date, sumPeriod: EnumPeriod) {\r\n        if (ips) {\r\n            this.itemPeriodSum = ips;\r\n        }\r\n        else {\r\n            ips = this.itemPeriodSum;\r\n        }\r\n        let {id: objectPostItem} = ips;\r\n        let {from, to} = this.period;\r\n        if (fromDate) from = fromDate;\r\n        if (toDate) to = toDate;\r\n\t\tlet ret = await this.uqs.JkMe.GetObjectItemPeriodHistory.query({\r\n\t\t\tobjectPostItem, \r\n\t\t\tfrom,\r\n\t\t\tto,\r\n\t\t\tperiod: sumPeriod,\r\n\t\t});\r\n        runInAction(() => {\r\n            this.periodHistory = ret.ret;\r\n        });\r\n\t}\r\n\r\n    prev = async () => {\r\n        this.period.prev();\r\n        await this.load();\r\n    }\r\n\r\n    next = async () => {\r\n        if (this.period.hasNext === false) return;\r\n        this.period.next();\r\n        await this.load();\r\n    }\r\n\r\n\tasync showBizOpDetail(item: ReturnGetObjectItemHistoryRet) {\r\n\t\tthis.bizOpDetail = new BizOpDetail(this.uqs, item);\r\n\t\tthis.openVPage(VBizOpDetail);\r\n\t}\r\n\r\n\tasync showPostItemHistory(ips: ItemPeriodSum, from: Date, to: Date) {\r\n\t\tawait this.loadPostItemHistory(ips, from, to);\r\n\t\tthis.openVPage(VPostItemHistory);\r\n\t}\r\n\r\n\tasync showDayPostItemHistory(ips: ItemPeriodSum, from: Date, to: Date) {\r\n\t\tawait this.loadPeriodPostItemHistory(ips, from, to, EnumPeriod.day);\r\n\t\tthis.openVPage(VDayPostItemHistory);\r\n\t}\r\n\r\n\tasync showMonthPostItemHistory(ips: ItemPeriodSum, from: Date, to: Date) {\r\n\t\tawait this.loadPeriodPostItemHistory(ips, from, to, EnumPeriod.month);\r\n\t\tthis.openVPage(VMonthPostItemHistory);\r\n\t}\r\n\r\n    renderVPortal() {\r\n        return this.renderView(VPeriodSum as any);\r\n    }\r\n}\r\n","import { VPage } from \"tonva-view\";\r\nimport { CObjectPortal } from \"./CObjectPortal\";\r\n\r\nexport class VObjectPortal extends VPage<CObjectPortal> {\r\n    header() { return '详情'; }\r\n    content() {\r\n        return <div>\r\n            <div>{this.controller.pageTop}</div>\r\n            <div className=\"d-flex flex-wrap p-2\">\r\n                {this.controller.cAccount?.renderAccounts()}\r\n            </div>\r\n            <div>{this.controller.renderVPortal()}</div>\r\n        </div>;\r\n    }\r\n}\r\n","import { ResultGetUserObjectItemPeriodSum } from \"uq-app/uqs/JkMe\";\r\nimport { EnumPeriod } from \"../period\";\r\nimport { CPortal } from '../CPortal';\r\nimport { VObjectPortal } from \"./VObjectPortal\";\r\nimport { CAccount } from \"account\";\r\n\r\nexport class CObjectPortal extends CPortal {\r\n\tcAccount: CAccount;\r\n    object: number;\r\n    pageTop: JSX.Element;\r\n\r\n    init(object: number, pageTop: JSX.Element) {\r\n        this.cAccount = this.newC(CAccount);\r\n        this.object = object;\r\n        this.pageTop = pageTop;\r\n    }\r\n\r\n    protected async GetPeriodSum(from: Date, to: Date):Promise<ResultGetUserObjectItemPeriodSum> {\r\n        let ret = await this.uqs.JkMe.GetObjectItemPeriodSum.query({\r\n            object: this.object,\r\n\t\t\tfrom,\r\n\t\t\tto,\r\n\t\t});\r\n        return ret;\r\n    }\r\n\r\n    async showObjectPortal() {\r\n        await Promise.all([\r\n            this.setPeriod(EnumPeriod.month),\r\n            this.cAccount.load(this.object),\r\n        ]);\r\n        this.openVPage(VObjectPortal);\r\n    }\r\n}\r\n","import { VPeriodSum } from \"../VPortal\";\r\nimport { CUnitPortal } from \"./CUnitPortal\";\r\nimport { Item } from \"uq-app/uqs/JkMe\";\r\nimport { FA, LMR } from \"tonva-view\";\r\n\r\nconst nf = new Intl.NumberFormat('en-US', {minimumFractionDigits:2, maximumFractionDigits:2});\r\n\r\nexport class VUnitPortal extends VPeriodSum<CUnitPortal> {\r\n    header() { return '详情'; }\r\n    content() {\r\n        return <div>\r\n            <div>{/*this.controller.pageTop*/}</div>\r\n            <div>{this.controller.renderVPortal()}</div>\r\n        </div>;        \r\n    }\r\n\r\n    protected renderItem = (row: any, index: number) => {\r\n        let {item, value} = row;\r\n        let {itemTitles} = this.controller.cApp;\r\n\t\tlet {title, unit} = itemTitles[item as Item];\r\n        let left = <div>\r\n            <FA className=\"text-info me-3\" name=\"lightbulb-o\" />\r\n            {title}\r\n        </div>;\r\n        let right = <div>\r\n            {\r\n                value<0?\r\n                <span className=\"text-danger\">({nf.format(-value)})</span>\r\n                :\r\n                <>{nf.format(value??0)}</>\r\n            } \r\n            <small className=\"text-muted ms-1\">{unit}</small>\r\n        </div>;\r\n        return <LMR className=\"py-2 px-3 d-flex align-items-center\"\r\n            left={left} right={right} />;\r\n    }\r\n}\r\n","import { runInAction } from \"mobx\";\r\nimport { EnumPeriod } from \"portal\";\r\nimport { CApp } from \"uq-app\";\r\nimport { ResultGetItemPeriodSum } from \"uq-app/uqs/JkMe\";\r\nimport { CPortal } from '../CPortal';\r\nimport { VUnitPortal } from \"./VUnitPortal\";\r\n\r\nexport class CUnitPortal extends CPortal {\r\n    constructor(cApp: CApp) {\r\n\t\tsuper(cApp);\r\n        this.internalSetPeriod(EnumPeriod.month);\r\n    }\r\n\r\n    protected async GetPeriodSum(from: Date, to: Date):Promise<ResultGetItemPeriodSum> {\r\n        let ret = await this.uqs.JkMe.GetItemPeriodSum.query({\r\n\t\t\tdate: from,\r\n\t\t\tdays: Math.round(Math.abs((to.getTime() - from.getTime()) / (24 * 60 * 60 * 1000))),\r\n\t\t});\r\n        return ret;\r\n    }\r\n    async load() {\r\n        let {from, to} = this.period;\r\n        let ret = await this.GetPeriodSum(from, to);\r\n        runInAction(() => {\r\n            this.list = ret.ret;\r\n        });\r\n    }\r\n\r\n    renderVPortal() {\r\n        return this.renderView(VUnitPortal as any);\r\n    }\r\n}\r\n","import { CHome } from \"../home\";\r\nimport { CMe } from \"../me\";\r\nimport { CBug } from \"./bug\";\r\nimport { CUqApp } from \"./CBase\";\r\nimport { res } from \"./res\";\r\nimport { VMain } from \"./VMain\";\r\nimport { CTester } from \"./test-uqui\";\r\nimport { setUI } from \"./uqs\";\r\nimport { Item, Post, EnumRole, EnumRoleOp, EnumAccount } from \"./uqs/JkMe\";\r\nimport { CSupervise } from \"supervise\";\r\nimport { CPortal, CObjectPortal, CUnitPortal } from \"portal\";\r\nimport { makeObservable, observable, runInAction } from \"mobx\";\r\nimport { start } from \"tonva-view\";\r\nimport { appConfig } from \"./appConfig\";\r\nimport { Tonva } from \"tonva-core\";\r\n\r\nconst gaps = [10, 3,3,3,3,3,5,5,5,5,5,5,5,5,10,10,10,10,15,15,15,30,30,60];\r\n\r\nexport interface Title {\r\n    title: string;\r\n    vice?: string;\r\n    unit?: string;\r\n    fixed?: number;\r\n}\r\n\r\n\r\nexport class CApp extends CUqApp {\r\n\tconstructor(tonva: Tonva) {\r\n\t\tsuper(tonva, appConfig);\r\n\t}\r\n\r\n\tcHome: CHome;\r\n\tcSupervise: CSupervise;\r\n\tcBug: CBug;\r\n\tcMe: CMe;\r\n\tcUI: CTester;\r\n\tcPortal: CPortal;\r\n\tcUnitPortal: CUnitPortal;\r\n\r\n\treadonly itemTitles:{[item in Item]: Title} = {} as any;\r\n\treadonly postTitles:{[post in Post]: Title} = {} as any;\r\n\treadonly accountTitles:{[acount in EnumAccount]: Title} = {} as any;\r\n\tops: {role: EnumRole; op: EnumRoleOp}[];\r\n\t\r\n\tprotected async internalStart(isUserLogin: boolean) {\r\n\t\tmakeObservable(this, {\r\n\t\t\trefreshTime: observable\r\n\t\t});\r\n\t\tthis.setRes(res);\r\n\t\tsetUI(this.uqs);\r\n\r\n\t\tawait this.loadBaseData();\r\n\r\n\t\tthis.cHome = this.newC(CHome);\r\n\t\tthis.cSupervise = this.newC(CSupervise);\r\n\t\tthis.cBug = this.newC(CBug);\r\n\t\tthis.cMe = this.newC(CMe);\r\n\t\tthis.cUI = this.newC(CTester);\r\n\t\tthis.cPortal = this.newC(CPortal);\r\n\t\tthis.cHome.load();\r\n\t\tthis.openVPage(VMain, undefined, this.dispose);\r\n\t\t// 加上下面一句，可以实现主动页面刷新\r\n\t\tthis.timer = setInterval(this.callTick, 1000);\r\n\t\t// uq 里面加入这一句，会让相应的$Poked查询返回poke=1：\r\n\t\t// TUID [$User] ID (member) SET poke=1;\r\n\t}\r\n\r\n\tprivate timer:any;\r\n\tprotected onDispose() {\r\n\t\tclearInterval(this.timer);\r\n\t\tthis.timer = undefined;\r\n\t}\r\n\t\r\n\tasync initStart() {\r\n\t\tawait this.tonva.appStart();\r\n\t}\r\n\r\n\trender(loginedOnly: boolean = true):JSX.Element {\r\n\t\tconst onLogined = async (isUserLogin?:boolean) => {\r\n\t\t\tawait start(CApp, this.tonva, appConfig, isUserLogin);\r\n\t\t}\r\n\t\tlet onNotLogined: () => Promise<void>;\r\n\t\tif (loginedOnly === false) onNotLogined = onLogined;\r\n\t\treturn this.tonva.nav.renderNavView(onLogined, onNotLogined);\r\n\t}\r\n\r\n\r\n\tprivate async loadBaseData() {\r\n\t\tlet {JkMe} = this.uqs;\r\n\t\tlet [retItemTitles, retPostTitles, retAccountTitles, roleOps, myTimezone] = await Promise.all([\r\n\t\t\tJkMe.GetItemTitles.query({}),\r\n\t\t\tJkMe.GetPostTitles.query({}),\r\n\t\t\tJkMe.GetAccountTitles.query({}),\r\n\t\t\tJkMe.GetRoleOps.query({}),\r\n\t\t\tJkMe.$getMyTimezone.query({}),\r\n\t\t]);\r\n\t\tfor (let it of retItemTitles.ret) this.itemTitles[it.id as Item] = it;\r\n\t\tfor (let pt of retPostTitles.ret) this.postTitles[pt.id as Post] = pt;\r\n\t\tfor (let at of retAccountTitles.ret) this.accountTitles[at.id as EnumAccount] = at;\r\n\t\tthis.ops = roleOps.ret;\r\n\t\tlet tz = myTimezone.ret[0];\r\n\t\tthis.timezone = tz.timezone;\r\n\t\tthis.unitTimezone = tz.unitTimeZone;\r\n\t}\r\n\t\r\n\trenderVPortal() {\r\n\t\treturn this.cPortal.renderVPortal();\r\n\t}\r\n\r\n\tnewCObjectPortal(object: number, pageTop: JSX.Element): CObjectPortal {\r\n\t\tlet ret = this.newC(CObjectPortal, object, pageTop);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\trenderVUnitSum() {\r\n\t\tif (!this.cUnitPortal) {\r\n\t\t\tthis.cUnitPortal = this.newC(CUnitPortal);\r\n\t\t\tthis.cUnitPortal.load();\r\n\t\t}\r\n\t\treturn this.cUnitPortal.renderVPortal();\r\n\t}\r\n\r\n\t// 数据服务器提醒客户端刷新，下面代码重新调入的数据\r\n\trefresh = async () => {\r\n\t\tlet d = Date.now() / 1000;\r\n\t\tif (d - this.refreshTime < 30) return;\r\n\t\tawait Promise.all([\r\n\t\t\tthis.cHome.load(),\r\n\t\t\tthis.cUnitPortal?.load(),\r\n\t\t]);\r\n\t\trunInAction(() => {\r\n\t\t\tthis.refreshTime = d;\r\n\t\t});\r\n\t}\r\n\r\n\trefreshTime: number = Date.now() / 1000;\r\n\r\n\tprivate tick = 0;\r\n\tprivate gapIndex = 0;\r\n\tprivate callTick = async () => {\r\n\t\ttry {\r\n\t\t\tif (!this.user) return;\r\n\t\t\t++this.tick;\r\n\t\t\tif (this.tick<gaps[this.gapIndex]) return;\r\n\t\t\tthis.tick = 0;\r\n\t\t\tif (this.gapIndex < gaps.length - 1) ++this.gapIndex;\r\n\t\t\tlet ret = await this.uqs.JkMe.$poked.query(undefined, undefined, false);\r\n\t\t\tlet v = ret.ret[0];\r\n\t\t\tif (v === undefined) return;\r\n\t\t\tif (!v.poke) return;\r\n\t\t\tthis.gapIndex = 1;\r\n\t\t\tawait this.refresh();\r\n\t\t}\r\n\t\tcatch {\r\n\t\t}\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { NavView, start, TonvaReact } from \"tonva-view\";\r\nimport { CApp } from './CApp';\r\nimport { appConfig } from './appConfig';\r\n// import { App } from './App';\r\n\r\nexport async function startApp() {\r\n    let tonva = new TonvaReact();\r\n    //initNav(tonva);\r\n\ttonva.setSettings(appConfig);\r\n\tconst onLogined = async (isUserLogin?:boolean) => {\r\n\t\tawait start(CApp, tonva, appConfig, isUserLogin);\r\n\t}\r\n    const notLogined: ()=>Promise<void> = undefined;\r\n    const userPassword: () => Promise<{user:string; password:string}> = undefined;\r\n\ttonva.appStart();\r\n    ReactDOM.render(\r\n        <React.StrictMode>\r\n            <NavView ref={navView => tonva.set(navView)} \r\n                onLogined={onLogined}\r\n                notLogined={notLogined}\r\n                userPassword={userPassword} />\r\n        </React.StrictMode>,\r\n        document.getElementById('root')\r\n    );\r\n}\r\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","////import ReactDOM from 'react-dom';\r\nimport 'bootstrap/dist/css/bootstrap.css';\r\nimport { startApp } from 'uq-app';\r\nimport './index.css';\r\nimport reportWebVitals from './reportWebVitals';\r\n//import { App } from 'uq-app';\r\n\r\nconst a:{b?:number;} = {\r\n    b: void(0),\r\n};\r\n\r\n/*\r\nReactDOM.render(\r\n    <React.StrictMode>\r\n        <App />\r\n    </React.StrictMode>,\r\n    document.getElementById('root')\r\n);\r\n*/\r\n(function() {\r\n    for (let i in a) {\r\n        console.log('property ', i, (a as any)[i]);\r\n    }\r\n    delete a.b;\r\n    console.log('after delete a.b;');\r\n    for (let i in a) {\r\n        console.log('property ', i, (a as any)[i]);\r\n    }\r\n    startApp();\r\n})();\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}