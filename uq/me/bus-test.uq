-- Deliver Cost Bound
-- 暂时不支持const里面的表达式引用const
CONST JkOrderTest={
    id: 31195716,
    detail1: 31195717,
    detail2: 31195718,
    detail3: 31195719,
    itemId: 'JKItem-2021-08-03-0001',
    quantity: 2+3,
    date: unix_timestamp() + 6,
};

ACT BusTest ver 0.3 (
    orderMain ID
) {
    BUS JkOrderBus.[deliver-done] SET warehouse=-1, id=orderMain;
    FOR (VAR detailId ID, value DEC(18,4) OF 
        SELECT id as detailId, quantity as value FROM OrderDetail WHERE main=orderMain)
    {
        BUS JkOrderBus.[deliver-done] INTO detail ADD id=detailId, value=value;
    }

    BUS JkOrderBus.[order-cost-price] SET order=orderMain;
    FOR (VAR detailId ID, price DEC(18,4) OF 
        SELECT id as detailId, price FROM OrderDetail WHERE main=orderMain)
    {
        BUS JkOrderBus.[order-cost-price] INTO detail 
            ADD [order-detail]=detailId, [cost-price]=price*0.15;
    }

    BUS JkOrderBus.[order-bound-staff-sales] SET order=orderMain;
    BUS JkOrderBus.[order-bound-staff-sales] INTO to ADD id=999;

    BUS JkOrderBus.[deliver-done] LOCAL;
    BUS JkOrderBus.[order-cost-price] LOCAL;
    BUS JkOrderBus.[order-bound-staff-sales] LOCAL;
};
